var _D=Object.defineProperty;var ED=(t,e,n)=>e in t?_D(t,e,{enumerable:!0,configurable:!0,writable:!0,value:n}):t[e]=n;var y=(t,e,n)=>(ED(t,typeof e!="symbol"?e+"":e,n),n);function PD(t,e){for(var n=0;n<e.length;n++){const r=e[n];if(typeof r!="string"&&!Array.isArray(r)){for(const s in r)if(s!=="default"&&!(s in t)){const o=Object.getOwnPropertyDescriptor(r,s);o&&Object.defineProperty(t,s,o.get?o:{enumerable:!0,get:()=>r[s]})}}}return Object.freeze(Object.defineProperty(t,Symbol.toStringTag,{value:"Module"}))}(function(){const e=document.createElement("link").relList;if(e&&e.supports&&e.supports("modulepreload"))return;for(const s of document.querySelectorAll('link[rel="modulepreload"]'))r(s);new MutationObserver(s=>{for(const o of s)if(o.type==="childList")for(const i of o.addedNodes)i.tagName==="LINK"&&i.rel==="modulepreload"&&r(i)}).observe(document,{childList:!0,subtree:!0});function n(s){const o={};return s.integrity&&(o.integrity=s.integrity),s.referrerPolicy&&(o.referrerPolicy=s.referrerPolicy),s.crossOrigin==="use-credentials"?o.credentials="include":s.crossOrigin==="anonymous"?o.credentials="omit":o.credentials="same-origin",o}function r(s){if(s.ep)return;s.ep=!0;const o=n(s);fetch(s.href,o)}})();var hn=typeof globalThis<"u"?globalThis:typeof window<"u"?window:typeof global<"u"?global:typeof self<"u"?self:{};function Sa(t){return t&&t.__esModule&&Object.prototype.hasOwnProperty.call(t,"default")?t.default:t}var Nk={exports:{}},Ug={},zk={exports:{}},Se={};/**
 * @license React
 * react.production.min.js
 *
 * Copyright (c) Facebook, Inc. and its affiliates.
 *
 * This source code is licensed under the MIT license found in the
 * LICENSE file in the root directory of this source tree.
 */var _d=Symbol.for("react.element"),kD=Symbol.for("react.portal"),ID=Symbol.for("react.fragment"),$D=Symbol.for("react.strict_mode"),TD=Symbol.for("react.profiler"),AD=Symbol.for("react.provider"),MD=Symbol.for("react.context"),OD=Symbol.for("react.forward_ref"),DD=Symbol.for("react.suspense"),RD=Symbol.for("react.memo"),LD=Symbol.for("react.lazy"),y2=Symbol.iterator;function jD(t){return t===null||typeof t!="object"?null:(t=y2&&t[y2]||t["@@iterator"],typeof t=="function"?t:null)}var Fk={isMounted:function(){return!1},enqueueForceUpdate:function(){},enqueueReplaceState:function(){},enqueueSetState:function(){}},Bk=Object.assign,Uk={};function rl(t,e,n){this.props=t,this.context=e,this.refs=Uk,this.updater=n||Fk}rl.prototype.isReactComponent={};rl.prototype.setState=function(t,e){if(typeof t!="object"&&typeof t!="function"&&t!=null)throw Error("setState(...): takes an object of state variables to update or a function which returns an object of state variables.");this.updater.enqueueSetState(this,t,e,"setState")};rl.prototype.forceUpdate=function(t){this.updater.enqueueForceUpdate(this,t,"forceUpdate")};function Hk(){}Hk.prototype=rl.prototype;function US(t,e,n){this.props=t,this.context=e,this.refs=Uk,this.updater=n||Fk}var HS=US.prototype=new Hk;HS.constructor=US;Bk(HS,rl.prototype);HS.isPureReactComponent=!0;var v2=Array.isArray,Kk=Object.prototype.hasOwnProperty,KS={current:null},Vk={key:!0,ref:!0,__self:!0,__source:!0};function Wk(t,e,n){var r,s={},o=null,i=null;if(e!=null)for(r in e.ref!==void 0&&(i=e.ref),e.key!==void 0&&(o=""+e.key),e)Kk.call(e,r)&&!Vk.hasOwnProperty(r)&&(s[r]=e[r]);var a=arguments.length-2;if(a===1)s.children=n;else if(1<a){for(var c=Array(a),l=0;l<a;l++)c[l]=arguments[l+2];s.children=c}if(t&&t.defaultProps)for(r in a=t.defaultProps,a)s[r]===void 0&&(s[r]=a[r]);return{$$typeof:_d,type:t,key:o,ref:i,props:s,_owner:KS.current}}function ND(t,e){return{$$typeof:_d,type:t.type,key:e,ref:t.ref,props:t.props,_owner:t._owner}}function VS(t){return typeof t=="object"&&t!==null&&t.$$typeof===_d}function zD(t){var e={"=":"=0",":":"=2"};return"$"+t.replace(/[=:]/g,function(n){return e[n]})}var w2=/\/+/g;function oy(t,e){return typeof t=="object"&&t!==null&&t.key!=null?zD(""+t.key):e.toString(36)}function yf(t,e,n,r,s){var o=typeof t;(o==="undefined"||o==="boolean")&&(t=null);var i=!1;if(t===null)i=!0;else switch(o){case"string":case"number":i=!0;break;case"object":switch(t.$$typeof){case _d:case kD:i=!0}}if(i)return i=t,s=s(i),t=r===""?"."+oy(i,0):r,v2(s)?(n="",t!=null&&(n=t.replace(w2,"$&/")+"/"),yf(s,e,n,"",function(l){return l})):s!=null&&(VS(s)&&(s=ND(s,n+(!s.key||i&&i.key===s.key?"":(""+s.key).replace(w2,"$&/")+"/")+t)),e.push(s)),1;if(i=0,r=r===""?".":r+":",v2(t))for(var a=0;a<t.length;a++){o=t[a];var c=r+oy(o,a);i+=yf(o,e,n,c,s)}else if(c=jD(t),typeof c=="function")for(t=c.call(t),a=0;!(o=t.next()).done;)o=o.value,c=r+oy(o,a++),i+=yf(o,e,n,c,s);else if(o==="object")throw e=String(t),Error("Objects are not valid as a React child (found: "+(e==="[object Object]"?"object with keys {"+Object.keys(t).join(", ")+"}":e)+"). If you meant to render a collection of children, use an array instead.");return i}function ph(t,e,n){if(t==null)return t;var r=[],s=0;return yf(t,r,"","",function(o){return e.call(n,o,s++)}),r}function FD(t){if(t._status===-1){var e=t._result;e=e(),e.then(function(n){(t._status===0||t._status===-1)&&(t._status=1,t._result=n)},function(n){(t._status===0||t._status===-1)&&(t._status=2,t._result=n)}),t._status===-1&&(t._status=0,t._result=e)}if(t._status===1)return t._result.default;throw t._result}var pn={current:null},vf={transition:null},BD={ReactCurrentDispatcher:pn,ReactCurrentBatchConfig:vf,ReactCurrentOwner:KS};Se.Children={map:ph,forEach:function(t,e,n){ph(t,function(){e.apply(this,arguments)},n)},count:function(t){var e=0;return ph(t,function(){e++}),e},toArray:function(t){return ph(t,function(e){return e})||[]},only:function(t){if(!VS(t))throw Error("React.Children.only expected to receive a single React element child.");return t}};Se.Component=rl;Se.Fragment=ID;Se.Profiler=TD;Se.PureComponent=US;Se.StrictMode=$D;Se.Suspense=DD;Se.__SECRET_INTERNALS_DO_NOT_USE_OR_YOU_WILL_BE_FIRED=BD;Se.cloneElement=function(t,e,n){if(t==null)throw Error("React.cloneElement(...): The argument must be a React element, but you passed "+t+".");var r=Bk({},t.props),s=t.key,o=t.ref,i=t._owner;if(e!=null){if(e.ref!==void 0&&(o=e.ref,i=KS.current),e.key!==void 0&&(s=""+e.key),t.type&&t.type.defaultProps)var a=t.type.defaultProps;for(c in e)Kk.call(e,c)&&!Vk.hasOwnProperty(c)&&(r[c]=e[c]===void 0&&a!==void 0?a[c]:e[c])}var c=arguments.length-2;if(c===1)r.children=n;else if(1<c){a=Array(c);for(var l=0;l<c;l++)a[l]=arguments[l+2];r.children=a}return{$$typeof:_d,type:t.type,key:s,ref:o,props:r,_owner:i}};Se.createContext=function(t){return t={$$typeof:MD,_currentValue:t,_currentValue2:t,_threadCount:0,Provider:null,Consumer:null,_defaultValue:null,_globalName:null},t.Provider={$$typeof:AD,_context:t},t.Consumer=t};Se.createElement=Wk;Se.createFactory=function(t){var e=Wk.bind(null,t);return e.type=t,e};Se.createRef=function(){return{current:null}};Se.forwardRef=function(t){return{$$typeof:OD,render:t}};Se.isValidElement=VS;Se.lazy=function(t){return{$$typeof:LD,_payload:{_status:-1,_result:t},_init:FD}};Se.memo=function(t,e){return{$$typeof:RD,type:t,compare:e===void 0?null:e}};Se.startTransition=function(t){var e=vf.transition;vf.transition={};try{t()}finally{vf.transition=e}};Se.unstable_act=function(){throw Error("act(...) is not supported in production builds of React.")};Se.useCallback=function(t,e){return pn.current.useCallback(t,e)};Se.useContext=function(t){return pn.current.useContext(t)};Se.useDebugValue=function(){};Se.useDeferredValue=function(t){return pn.current.useDeferredValue(t)};Se.useEffect=function(t,e){return pn.current.useEffect(t,e)};Se.useId=function(){return pn.current.useId()};Se.useImperativeHandle=function(t,e,n){return pn.current.useImperativeHandle(t,e,n)};Se.useInsertionEffect=function(t,e){return pn.current.useInsertionEffect(t,e)};Se.useLayoutEffect=function(t,e){return pn.current.useLayoutEffect(t,e)};Se.useMemo=function(t,e){return pn.current.useMemo(t,e)};Se.useReducer=function(t,e,n){return pn.current.useReducer(t,e,n)};Se.useRef=function(t){return pn.current.useRef(t)};Se.useState=function(t){return pn.current.useState(t)};Se.useSyncExternalStore=function(t,e,n){return pn.current.useSyncExternalStore(t,e,n)};Se.useTransition=function(){return pn.current.useTransition()};Se.version="18.2.0";zk.exports=Se;var S=zk.exports;const Z=Sa(S),Gk=PD({__proto__:null,default:Z},[S]);/**
 * @license React
 * react-jsx-runtime.production.min.js
 *
 * Copyright (c) Facebook, Inc. and its affiliates.
 *
 * This source code is licensed under the MIT license found in the
 * LICENSE file in the root directory of this source tree.
 */var UD=S,HD=Symbol.for("react.element"),KD=Symbol.for("react.fragment"),VD=Object.prototype.hasOwnProperty,WD=UD.__SECRET_INTERNALS_DO_NOT_USE_OR_YOU_WILL_BE_FIRED.ReactCurrentOwner,GD={key:!0,ref:!0,__self:!0,__source:!0};function Yk(t,e,n){var r,s={},o=null,i=null;n!==void 0&&(o=""+n),e.key!==void 0&&(o=""+e.key),e.ref!==void 0&&(i=e.ref);for(r in e)VD.call(e,r)&&!GD.hasOwnProperty(r)&&(s[r]=e[r]);if(t&&t.defaultProps)for(r in e=t.defaultProps,e)s[r]===void 0&&(s[r]=e[r]);return{$$typeof:HD,type:t,key:o,ref:i,props:s,_owner:WD.current}}Ug.Fragment=KD;Ug.jsx=Yk;Ug.jsxs=Yk;Nk.exports=Ug;var g=Nk.exports,Av={},Xk={exports:{}},Zn={},qk={exports:{}},Qk={};/**
 * @license React
 * scheduler.production.min.js
 *
 * Copyright (c) Facebook, Inc. and its affiliates.
 *
 * This source code is licensed under the MIT license found in the
 * LICENSE file in the root directory of this source tree.
 */(function(t){function e(N,F){var K=N.length;N.push(F);e:for(;0<K;){var Q=K-1>>>1,ne=N[Q];if(0<s(ne,F))N[Q]=F,N[K]=ne,K=Q;else break e}}function n(N){return N.length===0?null:N[0]}function r(N){if(N.length===0)return null;var F=N[0],K=N.pop();if(K!==F){N[0]=K;e:for(var Q=0,ne=N.length,we=ne>>>1;Q<we;){var ke=2*(Q+1)-1,de=N[ke],Ye=ke+1,Xe=N[Ye];if(0>s(de,K))Ye<ne&&0>s(Xe,de)?(N[Q]=Xe,N[Ye]=K,Q=Ye):(N[Q]=de,N[ke]=K,Q=ke);else if(Ye<ne&&0>s(Xe,K))N[Q]=Xe,N[Ye]=K,Q=Ye;else break e}}return F}function s(N,F){var K=N.sortIndex-F.sortIndex;return K!==0?K:N.id-F.id}if(typeof performance=="object"&&typeof performance.now=="function"){var o=performance;t.unstable_now=function(){return o.now()}}else{var i=Date,a=i.now();t.unstable_now=function(){return i.now()-a}}var c=[],l=[],u=1,d=null,h=3,f=!1,p=!1,m=!1,v=typeof setTimeout=="function"?setTimeout:null,w=typeof clearTimeout=="function"?clearTimeout:null,x=typeof setImmediate<"u"?setImmediate:null;typeof navigator<"u"&&navigator.scheduling!==void 0&&navigator.scheduling.isInputPending!==void 0&&navigator.scheduling.isInputPending.bind(navigator.scheduling);function b(N){for(var F=n(l);F!==null;){if(F.callback===null)r(l);else if(F.startTime<=N)r(l),F.sortIndex=F.expirationTime,e(c,F);else break;F=n(l)}}function C(N){if(m=!1,b(N),!p)if(n(c)!==null)p=!0,U(E);else{var F=n(l);F!==null&&q(C,F.startTime-N)}}function E(N,F){p=!1,m&&(m=!1,w(I),I=-1),f=!0;var K=h;try{for(b(F),d=n(c);d!==null&&(!(d.expirationTime>F)||N&&!D());){var Q=d.callback;if(typeof Q=="function"){d.callback=null,h=d.priorityLevel;var ne=Q(d.expirationTime<=F);F=t.unstable_now(),typeof ne=="function"?d.callback=ne:d===n(c)&&r(c),b(F)}else r(c);d=n(c)}if(d!==null)var we=!0;else{var ke=n(l);ke!==null&&q(C,ke.startTime-F),we=!1}return we}finally{d=null,h=K,f=!1}}var _=!1,k=null,I=-1,$=5,A=-1;function D(){return!(t.unstable_now()-A<$)}function L(){if(k!==null){var N=t.unstable_now();A=N;var F=!0;try{F=k(!0,N)}finally{F?j():(_=!1,k=null)}}else _=!1}var j;if(typeof x=="function")j=function(){x(L)};else if(typeof MessageChannel<"u"){var M=new MessageChannel,B=M.port2;M.port1.onmessage=L,j=function(){B.postMessage(null)}}else j=function(){v(L,0)};function U(N){k=N,_||(_=!0,j())}function q(N,F){I=v(function(){N(t.unstable_now())},F)}t.unstable_IdlePriority=5,t.unstable_ImmediatePriority=1,t.unstable_LowPriority=4,t.unstable_NormalPriority=3,t.unstable_Profiling=null,t.unstable_UserBlockingPriority=2,t.unstable_cancelCallback=function(N){N.callback=null},t.unstable_continueExecution=function(){p||f||(p=!0,U(E))},t.unstable_forceFrameRate=function(N){0>N||125<N?console.error("forceFrameRate takes a positive int between 0 and 125, forcing frame rates higher than 125 fps is not supported"):$=0<N?Math.floor(1e3/N):5},t.unstable_getCurrentPriorityLevel=function(){return h},t.unstable_getFirstCallbackNode=function(){return n(c)},t.unstable_next=function(N){switch(h){case 1:case 2:case 3:var F=3;break;default:F=h}var K=h;h=F;try{return N()}finally{h=K}},t.unstable_pauseExecution=function(){},t.unstable_requestPaint=function(){},t.unstable_runWithPriority=function(N,F){switch(N){case 1:case 2:case 3:case 4:case 5:break;default:N=3}var K=h;h=N;try{return F()}finally{h=K}},t.unstable_scheduleCallback=function(N,F,K){var Q=t.unstable_now();switch(typeof K=="object"&&K!==null?(K=K.delay,K=typeof K=="number"&&0<K?Q+K:Q):K=Q,N){case 1:var ne=-1;break;case 2:ne=250;break;case 5:ne=1073741823;break;case 4:ne=1e4;break;default:ne=5e3}return ne=K+ne,N={id:u++,callback:F,priorityLevel:N,startTime:K,expirationTime:ne,sortIndex:-1},K>Q?(N.sortIndex=K,e(l,N),n(c)===null&&N===n(l)&&(m?(w(I),I=-1):m=!0,q(C,K-Q))):(N.sortIndex=ne,e(c,N),p||f||(p=!0,U(E))),N},t.unstable_shouldYield=D,t.unstable_wrapCallback=function(N){var F=h;return function(){var K=h;h=F;try{return N.apply(this,arguments)}finally{h=K}}}})(Qk);qk.exports=Qk;var YD=qk.exports;/**
 * @license React
 * react-dom.production.min.js
 *
 * Copyright (c) Facebook, Inc. and its affiliates.
 *
 * This source code is licensed under the MIT license found in the
 * LICENSE file in the root directory of this source tree.
 */var Zk=S,Qn=YD;function G(t){for(var e="https://reactjs.org/docs/error-decoder.html?invariant="+t,n=1;n<arguments.length;n++)e+="&args[]="+encodeURIComponent(arguments[n]);return"Minified React error #"+t+"; visit "+e+" for the full message or use the non-minified dev environment for full errors and additional helpful warnings."}var Jk=new Set,ku={};function xa(t,e){Lc(t,e),Lc(t+"Capture",e)}function Lc(t,e){for(ku[t]=e,t=0;t<e.length;t++)Jk.add(e[t])}var Xs=!(typeof window>"u"||typeof window.document>"u"||typeof window.document.createElement>"u"),Mv=Object.prototype.hasOwnProperty,XD=/^[:A-Z_a-z\u00C0-\u00D6\u00D8-\u00F6\u00F8-\u02FF\u0370-\u037D\u037F-\u1FFF\u200C-\u200D\u2070-\u218F\u2C00-\u2FEF\u3001-\uD7FF\uF900-\uFDCF\uFDF0-\uFFFD][:A-Z_a-z\u00C0-\u00D6\u00D8-\u00F6\u00F8-\u02FF\u0370-\u037D\u037F-\u1FFF\u200C-\u200D\u2070-\u218F\u2C00-\u2FEF\u3001-\uD7FF\uF900-\uFDCF\uFDF0-\uFFFD\-.0-9\u00B7\u0300-\u036F\u203F-\u2040]*$/,S2={},x2={};function qD(t){return Mv.call(x2,t)?!0:Mv.call(S2,t)?!1:XD.test(t)?x2[t]=!0:(S2[t]=!0,!1)}function QD(t,e,n,r){if(n!==null&&n.type===0)return!1;switch(typeof e){case"function":case"symbol":return!0;case"boolean":return r?!1:n!==null?!n.acceptsBooleans:(t=t.toLowerCase().slice(0,5),t!=="data-"&&t!=="aria-");default:return!1}}function ZD(t,e,n,r){if(e===null||typeof e>"u"||QD(t,e,n,r))return!0;if(r)return!1;if(n!==null)switch(n.type){case 3:return!e;case 4:return e===!1;case 5:return isNaN(e);case 6:return isNaN(e)||1>e}return!1}function gn(t,e,n,r,s,o,i){this.acceptsBooleans=e===2||e===3||e===4,this.attributeName=r,this.attributeNamespace=s,this.mustUseProperty=n,this.propertyName=t,this.type=e,this.sanitizeURL=o,this.removeEmptyString=i}var Ht={};"children dangerouslySetInnerHTML defaultValue defaultChecked innerHTML suppressContentEditableWarning suppressHydrationWarning style".split(" ").forEach(function(t){Ht[t]=new gn(t,0,!1,t,null,!1,!1)});[["acceptCharset","accept-charset"],["className","class"],["htmlFor","for"],["httpEquiv","http-equiv"]].forEach(function(t){var e=t[0];Ht[e]=new gn(e,1,!1,t[1],null,!1,!1)});["contentEditable","draggable","spellCheck","value"].forEach(function(t){Ht[t]=new gn(t,2,!1,t.toLowerCase(),null,!1,!1)});["autoReverse","externalResourcesRequired","focusable","preserveAlpha"].forEach(function(t){Ht[t]=new gn(t,2,!1,t,null,!1,!1)});"allowFullScreen async autoFocus autoPlay controls default defer disabled disablePictureInPicture disableRemotePlayback formNoValidate hidden loop noModule noValidate open playsInline readOnly required reversed scoped seamless itemScope".split(" ").forEach(function(t){Ht[t]=new gn(t,3,!1,t.toLowerCase(),null,!1,!1)});["checked","multiple","muted","selected"].forEach(function(t){Ht[t]=new gn(t,3,!0,t,null,!1,!1)});["capture","download"].forEach(function(t){Ht[t]=new gn(t,4,!1,t,null,!1,!1)});["cols","rows","size","span"].forEach(function(t){Ht[t]=new gn(t,6,!1,t,null,!1,!1)});["rowSpan","start"].forEach(function(t){Ht[t]=new gn(t,5,!1,t.toLowerCase(),null,!1,!1)});var WS=/[\-:]([a-z])/g;function GS(t){return t[1].toUpperCase()}"accent-height alignment-baseline arabic-form baseline-shift cap-height clip-path clip-rule color-interpolation color-interpolation-filters color-profile color-rendering dominant-baseline enable-background fill-opacity fill-rule flood-color flood-opacity font-family font-size font-size-adjust font-stretch font-style font-variant font-weight glyph-name glyph-orientation-horizontal glyph-orientation-vertical horiz-adv-x horiz-origin-x image-rendering letter-spacing lighting-color marker-end marker-mid marker-start overline-position overline-thickness paint-order panose-1 pointer-events rendering-intent shape-rendering stop-color stop-opacity strikethrough-position strikethrough-thickness stroke-dasharray stroke-dashoffset stroke-linecap stroke-linejoin stroke-miterlimit stroke-opacity stroke-width text-anchor text-decoration text-rendering underline-position underline-thickness unicode-bidi unicode-range units-per-em v-alphabetic v-hanging v-ideographic v-mathematical vector-effect vert-adv-y vert-origin-x vert-origin-y word-spacing writing-mode xmlns:xlink x-height".split(" ").forEach(function(t){var e=t.replace(WS,GS);Ht[e]=new gn(e,1,!1,t,null,!1,!1)});"xlink:actuate xlink:arcrole xlink:role xlink:show xlink:title xlink:type".split(" ").forEach(function(t){var e=t.replace(WS,GS);Ht[e]=new gn(e,1,!1,t,"http://www.w3.org/1999/xlink",!1,!1)});["xml:base","xml:lang","xml:space"].forEach(function(t){var e=t.replace(WS,GS);Ht[e]=new gn(e,1,!1,t,"http://www.w3.org/XML/1998/namespace",!1,!1)});["tabIndex","crossOrigin"].forEach(function(t){Ht[t]=new gn(t,1,!1,t.toLowerCase(),null,!1,!1)});Ht.xlinkHref=new gn("xlinkHref",1,!1,"xlink:href","http://www.w3.org/1999/xlink",!0,!1);["src","href","action","formAction"].forEach(function(t){Ht[t]=new gn(t,1,!1,t.toLowerCase(),null,!0,!0)});function YS(t,e,n,r){var s=Ht.hasOwnProperty(e)?Ht[e]:null;(s!==null?s.type!==0:r||!(2<e.length)||e[0]!=="o"&&e[0]!=="O"||e[1]!=="n"&&e[1]!=="N")&&(ZD(e,n,s,r)&&(n=null),r||s===null?qD(e)&&(n===null?t.removeAttribute(e):t.setAttribute(e,""+n)):s.mustUseProperty?t[s.propertyName]=n===null?s.type===3?!1:"":n:(e=s.attributeName,r=s.attributeNamespace,n===null?t.removeAttribute(e):(s=s.type,n=s===3||s===4&&n===!0?"":""+n,r?t.setAttributeNS(r,e,n):t.setAttribute(e,n))))}var ro=Zk.__SECRET_INTERNALS_DO_NOT_USE_OR_YOU_WILL_BE_FIRED,gh=Symbol.for("react.element"),sc=Symbol.for("react.portal"),oc=Symbol.for("react.fragment"),XS=Symbol.for("react.strict_mode"),Ov=Symbol.for("react.profiler"),eI=Symbol.for("react.provider"),tI=Symbol.for("react.context"),qS=Symbol.for("react.forward_ref"),Dv=Symbol.for("react.suspense"),Rv=Symbol.for("react.suspense_list"),QS=Symbol.for("react.memo"),$o=Symbol.for("react.lazy"),nI=Symbol.for("react.offscreen"),b2=Symbol.iterator;function kl(t){return t===null||typeof t!="object"?null:(t=b2&&t[b2]||t["@@iterator"],typeof t=="function"?t:null)}var at=Object.assign,iy;function Jl(t){if(iy===void 0)try{throw Error()}catch(n){var e=n.stack.trim().match(/\n( *(at )?)/);iy=e&&e[1]||""}return`
`+iy+t}var ay=!1;function cy(t,e){if(!t||ay)return"";ay=!0;var n=Error.prepareStackTrace;Error.prepareStackTrace=void 0;try{if(e)if(e=function(){throw Error()},Object.defineProperty(e.prototype,"props",{set:function(){throw Error()}}),typeof Reflect=="object"&&Reflect.construct){try{Reflect.construct(e,[])}catch(l){var r=l}Reflect.construct(t,[],e)}else{try{e.call()}catch(l){r=l}t.call(e.prototype)}else{try{throw Error()}catch(l){r=l}t()}}catch(l){if(l&&r&&typeof l.stack=="string"){for(var s=l.stack.split(`
`),o=r.stack.split(`
`),i=s.length-1,a=o.length-1;1<=i&&0<=a&&s[i]!==o[a];)a--;for(;1<=i&&0<=a;i--,a--)if(s[i]!==o[a]){if(i!==1||a!==1)do if(i--,a--,0>a||s[i]!==o[a]){var c=`
`+s[i].replace(" at new "," at ");return t.displayName&&c.includes("<anonymous>")&&(c=c.replace("<anonymous>",t.displayName)),c}while(1<=i&&0<=a);break}}}finally{ay=!1,Error.prepareStackTrace=n}return(t=t?t.displayName||t.name:"")?Jl(t):""}function JD(t){switch(t.tag){case 5:return Jl(t.type);case 16:return Jl("Lazy");case 13:return Jl("Suspense");case 19:return Jl("SuspenseList");case 0:case 2:case 15:return t=cy(t.type,!1),t;case 11:return t=cy(t.type.render,!1),t;case 1:return t=cy(t.type,!0),t;default:return""}}function Lv(t){if(t==null)return null;if(typeof t=="function")return t.displayName||t.name||null;if(typeof t=="string")return t;switch(t){case oc:return"Fragment";case sc:return"Portal";case Ov:return"Profiler";case XS:return"StrictMode";case Dv:return"Suspense";case Rv:return"SuspenseList"}if(typeof t=="object")switch(t.$$typeof){case tI:return(t.displayName||"Context")+".Consumer";case eI:return(t._context.displayName||"Context")+".Provider";case qS:var e=t.render;return t=t.displayName,t||(t=e.displayName||e.name||"",t=t!==""?"ForwardRef("+t+")":"ForwardRef"),t;case QS:return e=t.displayName||null,e!==null?e:Lv(t.type)||"Memo";case $o:e=t._payload,t=t._init;try{return Lv(t(e))}catch{}}return null}function eR(t){var e=t.type;switch(t.tag){case 24:return"Cache";case 9:return(e.displayName||"Context")+".Consumer";case 10:return(e._context.displayName||"Context")+".Provider";case 18:return"DehydratedFragment";case 11:return t=e.render,t=t.displayName||t.name||"",e.displayName||(t!==""?"ForwardRef("+t+")":"ForwardRef");case 7:return"Fragment";case 5:return e;case 4:return"Portal";case 3:return"Root";case 6:return"Text";case 16:return Lv(e);case 8:return e===XS?"StrictMode":"Mode";case 22:return"Offscreen";case 12:return"Profiler";case 21:return"Scope";case 13:return"Suspense";case 19:return"SuspenseList";case 25:return"TracingMarker";case 1:case 0:case 17:case 2:case 14:case 15:if(typeof e=="function")return e.displayName||e.name||null;if(typeof e=="string")return e}return null}function ri(t){switch(typeof t){case"boolean":case"number":case"string":case"undefined":return t;case"object":return t;default:return""}}function rI(t){var e=t.type;return(t=t.nodeName)&&t.toLowerCase()==="input"&&(e==="checkbox"||e==="radio")}function tR(t){var e=rI(t)?"checked":"value",n=Object.getOwnPropertyDescriptor(t.constructor.prototype,e),r=""+t[e];if(!t.hasOwnProperty(e)&&typeof n<"u"&&typeof n.get=="function"&&typeof n.set=="function"){var s=n.get,o=n.set;return Object.defineProperty(t,e,{configurable:!0,get:function(){return s.call(this)},set:function(i){r=""+i,o.call(this,i)}}),Object.defineProperty(t,e,{enumerable:n.enumerable}),{getValue:function(){return r},setValue:function(i){r=""+i},stopTracking:function(){t._valueTracker=null,delete t[e]}}}}function mh(t){t._valueTracker||(t._valueTracker=tR(t))}function sI(t){if(!t)return!1;var e=t._valueTracker;if(!e)return!0;var n=e.getValue(),r="";return t&&(r=rI(t)?t.checked?"true":"false":t.value),t=r,t!==n?(e.setValue(t),!0):!1}function wp(t){if(t=t||(typeof document<"u"?document:void 0),typeof t>"u")return null;try{return t.activeElement||t.body}catch{return t.body}}function jv(t,e){var n=e.checked;return at({},e,{defaultChecked:void 0,defaultValue:void 0,value:void 0,checked:n??t._wrapperState.initialChecked})}function C2(t,e){var n=e.defaultValue==null?"":e.defaultValue,r=e.checked!=null?e.checked:e.defaultChecked;n=ri(e.value!=null?e.value:n),t._wrapperState={initialChecked:r,initialValue:n,controlled:e.type==="checkbox"||e.type==="radio"?e.checked!=null:e.value!=null}}function oI(t,e){e=e.checked,e!=null&&YS(t,"checked",e,!1)}function Nv(t,e){oI(t,e);var n=ri(e.value),r=e.type;if(n!=null)r==="number"?(n===0&&t.value===""||t.value!=n)&&(t.value=""+n):t.value!==""+n&&(t.value=""+n);else if(r==="submit"||r==="reset"){t.removeAttribute("value");return}e.hasOwnProperty("value")?zv(t,e.type,n):e.hasOwnProperty("defaultValue")&&zv(t,e.type,ri(e.defaultValue)),e.checked==null&&e.defaultChecked!=null&&(t.defaultChecked=!!e.defaultChecked)}function _2(t,e,n){if(e.hasOwnProperty("value")||e.hasOwnProperty("defaultValue")){var r=e.type;if(!(r!=="submit"&&r!=="reset"||e.value!==void 0&&e.value!==null))return;e=""+t._wrapperState.initialValue,n||e===t.value||(t.value=e),t.defaultValue=e}n=t.name,n!==""&&(t.name=""),t.defaultChecked=!!t._wrapperState.initialChecked,n!==""&&(t.name=n)}function zv(t,e,n){(e!=="number"||wp(t.ownerDocument)!==t)&&(n==null?t.defaultValue=""+t._wrapperState.initialValue:t.defaultValue!==""+n&&(t.defaultValue=""+n))}var eu=Array.isArray;function bc(t,e,n,r){if(t=t.options,e){e={};for(var s=0;s<n.length;s++)e["$"+n[s]]=!0;for(n=0;n<t.length;n++)s=e.hasOwnProperty("$"+t[n].value),t[n].selected!==s&&(t[n].selected=s),s&&r&&(t[n].defaultSelected=!0)}else{for(n=""+ri(n),e=null,s=0;s<t.length;s++){if(t[s].value===n){t[s].selected=!0,r&&(t[s].defaultSelected=!0);return}e!==null||t[s].disabled||(e=t[s])}e!==null&&(e.selected=!0)}}function Fv(t,e){if(e.dangerouslySetInnerHTML!=null)throw Error(G(91));return at({},e,{value:void 0,defaultValue:void 0,children:""+t._wrapperState.initialValue})}function E2(t,e){var n=e.value;if(n==null){if(n=e.children,e=e.defaultValue,n!=null){if(e!=null)throw Error(G(92));if(eu(n)){if(1<n.length)throw Error(G(93));n=n[0]}e=n}e==null&&(e=""),n=e}t._wrapperState={initialValue:ri(n)}}function iI(t,e){var n=ri(e.value),r=ri(e.defaultValue);n!=null&&(n=""+n,n!==t.value&&(t.value=n),e.defaultValue==null&&t.defaultValue!==n&&(t.defaultValue=n)),r!=null&&(t.defaultValue=""+r)}function P2(t){var e=t.textContent;e===t._wrapperState.initialValue&&e!==""&&e!==null&&(t.value=e)}function aI(t){switch(t){case"svg":return"http://www.w3.org/2000/svg";case"math":return"http://www.w3.org/1998/Math/MathML";default:return"http://www.w3.org/1999/xhtml"}}function Bv(t,e){return t==null||t==="http://www.w3.org/1999/xhtml"?aI(e):t==="http://www.w3.org/2000/svg"&&e==="foreignObject"?"http://www.w3.org/1999/xhtml":t}var yh,cI=function(t){return typeof MSApp<"u"&&MSApp.execUnsafeLocalFunction?function(e,n,r,s){MSApp.execUnsafeLocalFunction(function(){return t(e,n,r,s)})}:t}(function(t,e){if(t.namespaceURI!=="http://www.w3.org/2000/svg"||"innerHTML"in t)t.innerHTML=e;else{for(yh=yh||document.createElement("div"),yh.innerHTML="<svg>"+e.valueOf().toString()+"</svg>",e=yh.firstChild;t.firstChild;)t.removeChild(t.firstChild);for(;e.firstChild;)t.appendChild(e.firstChild)}});function Iu(t,e){if(e){var n=t.firstChild;if(n&&n===t.lastChild&&n.nodeType===3){n.nodeValue=e;return}}t.textContent=e}var au={animationIterationCount:!0,aspectRatio:!0,borderImageOutset:!0,borderImageSlice:!0,borderImageWidth:!0,boxFlex:!0,boxFlexGroup:!0,boxOrdinalGroup:!0,columnCount:!0,columns:!0,flex:!0,flexGrow:!0,flexPositive:!0,flexShrink:!0,flexNegative:!0,flexOrder:!0,gridArea:!0,gridRow:!0,gridRowEnd:!0,gridRowSpan:!0,gridRowStart:!0,gridColumn:!0,gridColumnEnd:!0,gridColumnSpan:!0,gridColumnStart:!0,fontWeight:!0,lineClamp:!0,lineHeight:!0,opacity:!0,order:!0,orphans:!0,tabSize:!0,widows:!0,zIndex:!0,zoom:!0,fillOpacity:!0,floodOpacity:!0,stopOpacity:!0,strokeDasharray:!0,strokeDashoffset:!0,strokeMiterlimit:!0,strokeOpacity:!0,strokeWidth:!0},nR=["Webkit","ms","Moz","O"];Object.keys(au).forEach(function(t){nR.forEach(function(e){e=e+t.charAt(0).toUpperCase()+t.substring(1),au[e]=au[t]})});function lI(t,e,n){return e==null||typeof e=="boolean"||e===""?"":n||typeof e!="number"||e===0||au.hasOwnProperty(t)&&au[t]?(""+e).trim():e+"px"}function uI(t,e){t=t.style;for(var n in e)if(e.hasOwnProperty(n)){var r=n.indexOf("--")===0,s=lI(n,e[n],r);n==="float"&&(n="cssFloat"),r?t.setProperty(n,s):t[n]=s}}var rR=at({menuitem:!0},{area:!0,base:!0,br:!0,col:!0,embed:!0,hr:!0,img:!0,input:!0,keygen:!0,link:!0,meta:!0,param:!0,source:!0,track:!0,wbr:!0});function Uv(t,e){if(e){if(rR[t]&&(e.children!=null||e.dangerouslySetInnerHTML!=null))throw Error(G(137,t));if(e.dangerouslySetInnerHTML!=null){if(e.children!=null)throw Error(G(60));if(typeof e.dangerouslySetInnerHTML!="object"||!("__html"in e.dangerouslySetInnerHTML))throw Error(G(61))}if(e.style!=null&&typeof e.style!="object")throw Error(G(62))}}function Hv(t,e){if(t.indexOf("-")===-1)return typeof e.is=="string";switch(t){case"annotation-xml":case"color-profile":case"font-face":case"font-face-src":case"font-face-uri":case"font-face-format":case"font-face-name":case"missing-glyph":return!1;default:return!0}}var Kv=null;function ZS(t){return t=t.target||t.srcElement||window,t.correspondingUseElement&&(t=t.correspondingUseElement),t.nodeType===3?t.parentNode:t}var Vv=null,Cc=null,_c=null;function k2(t){if(t=kd(t)){if(typeof Vv!="function")throw Error(G(280));var e=t.stateNode;e&&(e=Gg(e),Vv(t.stateNode,t.type,e))}}function dI(t){Cc?_c?_c.push(t):_c=[t]:Cc=t}function hI(){if(Cc){var t=Cc,e=_c;if(_c=Cc=null,k2(t),e)for(t=0;t<e.length;t++)k2(e[t])}}function fI(t,e){return t(e)}function pI(){}var ly=!1;function gI(t,e,n){if(ly)return t(e,n);ly=!0;try{return fI(t,e,n)}finally{ly=!1,(Cc!==null||_c!==null)&&(pI(),hI())}}function $u(t,e){var n=t.stateNode;if(n===null)return null;var r=Gg(n);if(r===null)return null;n=r[e];e:switch(e){case"onClick":case"onClickCapture":case"onDoubleClick":case"onDoubleClickCapture":case"onMouseDown":case"onMouseDownCapture":case"onMouseMove":case"onMouseMoveCapture":case"onMouseUp":case"onMouseUpCapture":case"onMouseEnter":(r=!r.disabled)||(t=t.type,r=!(t==="button"||t==="input"||t==="select"||t==="textarea")),t=!r;break e;default:t=!1}if(t)return null;if(n&&typeof n!="function")throw Error(G(231,e,typeof n));return n}var Wv=!1;if(Xs)try{var Il={};Object.defineProperty(Il,"passive",{get:function(){Wv=!0}}),window.addEventListener("test",Il,Il),window.removeEventListener("test",Il,Il)}catch{Wv=!1}function sR(t,e,n,r,s,o,i,a,c){var l=Array.prototype.slice.call(arguments,3);try{e.apply(n,l)}catch(u){this.onError(u)}}var cu=!1,Sp=null,xp=!1,Gv=null,oR={onError:function(t){cu=!0,Sp=t}};function iR(t,e,n,r,s,o,i,a,c){cu=!1,Sp=null,sR.apply(oR,arguments)}function aR(t,e,n,r,s,o,i,a,c){if(iR.apply(this,arguments),cu){if(cu){var l=Sp;cu=!1,Sp=null}else throw Error(G(198));xp||(xp=!0,Gv=l)}}function ba(t){var e=t,n=t;if(t.alternate)for(;e.return;)e=e.return;else{t=e;do e=t,e.flags&4098&&(n=e.return),t=e.return;while(t)}return e.tag===3?n:null}function mI(t){if(t.tag===13){var e=t.memoizedState;if(e===null&&(t=t.alternate,t!==null&&(e=t.memoizedState)),e!==null)return e.dehydrated}return null}function I2(t){if(ba(t)!==t)throw Error(G(188))}function cR(t){var e=t.alternate;if(!e){if(e=ba(t),e===null)throw Error(G(188));return e!==t?null:t}for(var n=t,r=e;;){var s=n.return;if(s===null)break;var o=s.alternate;if(o===null){if(r=s.return,r!==null){n=r;continue}break}if(s.child===o.child){for(o=s.child;o;){if(o===n)return I2(s),t;if(o===r)return I2(s),e;o=o.sibling}throw Error(G(188))}if(n.return!==r.return)n=s,r=o;else{for(var i=!1,a=s.child;a;){if(a===n){i=!0,n=s,r=o;break}if(a===r){i=!0,r=s,n=o;break}a=a.sibling}if(!i){for(a=o.child;a;){if(a===n){i=!0,n=o,r=s;break}if(a===r){i=!0,r=o,n=s;break}a=a.sibling}if(!i)throw Error(G(189))}}if(n.alternate!==r)throw Error(G(190))}if(n.tag!==3)throw Error(G(188));return n.stateNode.current===n?t:e}function yI(t){return t=cR(t),t!==null?vI(t):null}function vI(t){if(t.tag===5||t.tag===6)return t;for(t=t.child;t!==null;){var e=vI(t);if(e!==null)return e;t=t.sibling}return null}var wI=Qn.unstable_scheduleCallback,$2=Qn.unstable_cancelCallback,lR=Qn.unstable_shouldYield,uR=Qn.unstable_requestPaint,gt=Qn.unstable_now,dR=Qn.unstable_getCurrentPriorityLevel,JS=Qn.unstable_ImmediatePriority,SI=Qn.unstable_UserBlockingPriority,bp=Qn.unstable_NormalPriority,hR=Qn.unstable_LowPriority,xI=Qn.unstable_IdlePriority,Hg=null,is=null;function fR(t){if(is&&typeof is.onCommitFiberRoot=="function")try{is.onCommitFiberRoot(Hg,t,void 0,(t.current.flags&128)===128)}catch{}}var Fr=Math.clz32?Math.clz32:mR,pR=Math.log,gR=Math.LN2;function mR(t){return t>>>=0,t===0?32:31-(pR(t)/gR|0)|0}var vh=64,wh=4194304;function tu(t){switch(t&-t){case 1:return 1;case 2:return 2;case 4:return 4;case 8:return 8;case 16:return 16;case 32:return 32;case 64:case 128:case 256:case 512:case 1024:case 2048:case 4096:case 8192:case 16384:case 32768:case 65536:case 131072:case 262144:case 524288:case 1048576:case 2097152:return t&4194240;case 4194304:case 8388608:case 16777216:case 33554432:case 67108864:return t&130023424;case 134217728:return 134217728;case 268435456:return 268435456;case 536870912:return 536870912;case 1073741824:return 1073741824;default:return t}}function Cp(t,e){var n=t.pendingLanes;if(n===0)return 0;var r=0,s=t.suspendedLanes,o=t.pingedLanes,i=n&268435455;if(i!==0){var a=i&~s;a!==0?r=tu(a):(o&=i,o!==0&&(r=tu(o)))}else i=n&~s,i!==0?r=tu(i):o!==0&&(r=tu(o));if(r===0)return 0;if(e!==0&&e!==r&&!(e&s)&&(s=r&-r,o=e&-e,s>=o||s===16&&(o&4194240)!==0))return e;if(r&4&&(r|=n&16),e=t.entangledLanes,e!==0)for(t=t.entanglements,e&=r;0<e;)n=31-Fr(e),s=1<<n,r|=t[n],e&=~s;return r}function yR(t,e){switch(t){case 1:case 2:case 4:return e+250;case 8:case 16:case 32:case 64:case 128:case 256:case 512:case 1024:case 2048:case 4096:case 8192:case 16384:case 32768:case 65536:case 131072:case 262144:case 524288:case 1048576:case 2097152:return e+5e3;case 4194304:case 8388608:case 16777216:case 33554432:case 67108864:return-1;case 134217728:case 268435456:case 536870912:case 1073741824:return-1;default:return-1}}function vR(t,e){for(var n=t.suspendedLanes,r=t.pingedLanes,s=t.expirationTimes,o=t.pendingLanes;0<o;){var i=31-Fr(o),a=1<<i,c=s[i];c===-1?(!(a&n)||a&r)&&(s[i]=yR(a,e)):c<=e&&(t.expiredLanes|=a),o&=~a}}function Yv(t){return t=t.pendingLanes&-1073741825,t!==0?t:t&1073741824?1073741824:0}function bI(){var t=vh;return vh<<=1,!(vh&4194240)&&(vh=64),t}function uy(t){for(var e=[],n=0;31>n;n++)e.push(t);return e}function Ed(t,e,n){t.pendingLanes|=e,e!==536870912&&(t.suspendedLanes=0,t.pingedLanes=0),t=t.eventTimes,e=31-Fr(e),t[e]=n}function wR(t,e){var n=t.pendingLanes&~e;t.pendingLanes=e,t.suspendedLanes=0,t.pingedLanes=0,t.expiredLanes&=e,t.mutableReadLanes&=e,t.entangledLanes&=e,e=t.entanglements;var r=t.eventTimes;for(t=t.expirationTimes;0<n;){var s=31-Fr(n),o=1<<s;e[s]=0,r[s]=-1,t[s]=-1,n&=~o}}function e1(t,e){var n=t.entangledLanes|=e;for(t=t.entanglements;n;){var r=31-Fr(n),s=1<<r;s&e|t[r]&e&&(t[r]|=e),n&=~s}}var De=0;function CI(t){return t&=-t,1<t?4<t?t&268435455?16:536870912:4:1}var _I,t1,EI,PI,kI,Xv=!1,Sh=[],Ko=null,Vo=null,Wo=null,Tu=new Map,Au=new Map,Oo=[],SR="mousedown mouseup touchcancel touchend touchstart auxclick dblclick pointercancel pointerdown pointerup dragend dragstart drop compositionend compositionstart keydown keypress keyup input textInput copy cut paste click change contextmenu reset submit".split(" ");function T2(t,e){switch(t){case"focusin":case"focusout":Ko=null;break;case"dragenter":case"dragleave":Vo=null;break;case"mouseover":case"mouseout":Wo=null;break;case"pointerover":case"pointerout":Tu.delete(e.pointerId);break;case"gotpointercapture":case"lostpointercapture":Au.delete(e.pointerId)}}function $l(t,e,n,r,s,o){return t===null||t.nativeEvent!==o?(t={blockedOn:e,domEventName:n,eventSystemFlags:r,nativeEvent:o,targetContainers:[s]},e!==null&&(e=kd(e),e!==null&&t1(e)),t):(t.eventSystemFlags|=r,e=t.targetContainers,s!==null&&e.indexOf(s)===-1&&e.push(s),t)}function xR(t,e,n,r,s){switch(e){case"focusin":return Ko=$l(Ko,t,e,n,r,s),!0;case"dragenter":return Vo=$l(Vo,t,e,n,r,s),!0;case"mouseover":return Wo=$l(Wo,t,e,n,r,s),!0;case"pointerover":var o=s.pointerId;return Tu.set(o,$l(Tu.get(o)||null,t,e,n,r,s)),!0;case"gotpointercapture":return o=s.pointerId,Au.set(o,$l(Au.get(o)||null,t,e,n,r,s)),!0}return!1}function II(t){var e=zi(t.target);if(e!==null){var n=ba(e);if(n!==null){if(e=n.tag,e===13){if(e=mI(n),e!==null){t.blockedOn=e,kI(t.priority,function(){EI(n)});return}}else if(e===3&&n.stateNode.current.memoizedState.isDehydrated){t.blockedOn=n.tag===3?n.stateNode.containerInfo:null;return}}}t.blockedOn=null}function wf(t){if(t.blockedOn!==null)return!1;for(var e=t.targetContainers;0<e.length;){var n=qv(t.domEventName,t.eventSystemFlags,e[0],t.nativeEvent);if(n===null){n=t.nativeEvent;var r=new n.constructor(n.type,n);Kv=r,n.target.dispatchEvent(r),Kv=null}else return e=kd(n),e!==null&&t1(e),t.blockedOn=n,!1;e.shift()}return!0}function A2(t,e,n){wf(t)&&n.delete(e)}function bR(){Xv=!1,Ko!==null&&wf(Ko)&&(Ko=null),Vo!==null&&wf(Vo)&&(Vo=null),Wo!==null&&wf(Wo)&&(Wo=null),Tu.forEach(A2),Au.forEach(A2)}function Tl(t,e){t.blockedOn===e&&(t.blockedOn=null,Xv||(Xv=!0,Qn.unstable_scheduleCallback(Qn.unstable_NormalPriority,bR)))}function Mu(t){function e(s){return Tl(s,t)}if(0<Sh.length){Tl(Sh[0],t);for(var n=1;n<Sh.length;n++){var r=Sh[n];r.blockedOn===t&&(r.blockedOn=null)}}for(Ko!==null&&Tl(Ko,t),Vo!==null&&Tl(Vo,t),Wo!==null&&Tl(Wo,t),Tu.forEach(e),Au.forEach(e),n=0;n<Oo.length;n++)r=Oo[n],r.blockedOn===t&&(r.blockedOn=null);for(;0<Oo.length&&(n=Oo[0],n.blockedOn===null);)II(n),n.blockedOn===null&&Oo.shift()}var Ec=ro.ReactCurrentBatchConfig,_p=!0;function CR(t,e,n,r){var s=De,o=Ec.transition;Ec.transition=null;try{De=1,n1(t,e,n,r)}finally{De=s,Ec.transition=o}}function _R(t,e,n,r){var s=De,o=Ec.transition;Ec.transition=null;try{De=4,n1(t,e,n,r)}finally{De=s,Ec.transition=o}}function n1(t,e,n,r){if(_p){var s=qv(t,e,n,r);if(s===null)Sy(t,e,r,Ep,n),T2(t,r);else if(xR(s,t,e,n,r))r.stopPropagation();else if(T2(t,r),e&4&&-1<SR.indexOf(t)){for(;s!==null;){var o=kd(s);if(o!==null&&_I(o),o=qv(t,e,n,r),o===null&&Sy(t,e,r,Ep,n),o===s)break;s=o}s!==null&&r.stopPropagation()}else Sy(t,e,r,null,n)}}var Ep=null;function qv(t,e,n,r){if(Ep=null,t=ZS(r),t=zi(t),t!==null)if(e=ba(t),e===null)t=null;else if(n=e.tag,n===13){if(t=mI(e),t!==null)return t;t=null}else if(n===3){if(e.stateNode.current.memoizedState.isDehydrated)return e.tag===3?e.stateNode.containerInfo:null;t=null}else e!==t&&(t=null);return Ep=t,null}function $I(t){switch(t){case"cancel":case"click":case"close":case"contextmenu":case"copy":case"cut":case"auxclick":case"dblclick":case"dragend":case"dragstart":case"drop":case"focusin":case"focusout":case"input":case"invalid":case"keydown":case"keypress":case"keyup":case"mousedown":case"mouseup":case"paste":case"pause":case"play":case"pointercancel":case"pointerdown":case"pointerup":case"ratechange":case"reset":case"resize":case"seeked":case"submit":case"touchcancel":case"touchend":case"touchstart":case"volumechange":case"change":case"selectionchange":case"textInput":case"compositionstart":case"compositionend":case"compositionupdate":case"beforeblur":case"afterblur":case"beforeinput":case"blur":case"fullscreenchange":case"focus":case"hashchange":case"popstate":case"select":case"selectstart":return 1;case"drag":case"dragenter":case"dragexit":case"dragleave":case"dragover":case"mousemove":case"mouseout":case"mouseover":case"pointermove":case"pointerout":case"pointerover":case"scroll":case"toggle":case"touchmove":case"wheel":case"mouseenter":case"mouseleave":case"pointerenter":case"pointerleave":return 4;case"message":switch(dR()){case JS:return 1;case SI:return 4;case bp:case hR:return 16;case xI:return 536870912;default:return 16}default:return 16}}var jo=null,r1=null,Sf=null;function TI(){if(Sf)return Sf;var t,e=r1,n=e.length,r,s="value"in jo?jo.value:jo.textContent,o=s.length;for(t=0;t<n&&e[t]===s[t];t++);var i=n-t;for(r=1;r<=i&&e[n-r]===s[o-r];r++);return Sf=s.slice(t,1<r?1-r:void 0)}function xf(t){var e=t.keyCode;return"charCode"in t?(t=t.charCode,t===0&&e===13&&(t=13)):t=e,t===10&&(t=13),32<=t||t===13?t:0}function xh(){return!0}function M2(){return!1}function Jn(t){function e(n,r,s,o,i){this._reactName=n,this._targetInst=s,this.type=r,this.nativeEvent=o,this.target=i,this.currentTarget=null;for(var a in t)t.hasOwnProperty(a)&&(n=t[a],this[a]=n?n(o):o[a]);return this.isDefaultPrevented=(o.defaultPrevented!=null?o.defaultPrevented:o.returnValue===!1)?xh:M2,this.isPropagationStopped=M2,this}return at(e.prototype,{preventDefault:function(){this.defaultPrevented=!0;var n=this.nativeEvent;n&&(n.preventDefault?n.preventDefault():typeof n.returnValue!="unknown"&&(n.returnValue=!1),this.isDefaultPrevented=xh)},stopPropagation:function(){var n=this.nativeEvent;n&&(n.stopPropagation?n.stopPropagation():typeof n.cancelBubble!="unknown"&&(n.cancelBubble=!0),this.isPropagationStopped=xh)},persist:function(){},isPersistent:xh}),e}var sl={eventPhase:0,bubbles:0,cancelable:0,timeStamp:function(t){return t.timeStamp||Date.now()},defaultPrevented:0,isTrusted:0},s1=Jn(sl),Pd=at({},sl,{view:0,detail:0}),ER=Jn(Pd),dy,hy,Al,Kg=at({},Pd,{screenX:0,screenY:0,clientX:0,clientY:0,pageX:0,pageY:0,ctrlKey:0,shiftKey:0,altKey:0,metaKey:0,getModifierState:o1,button:0,buttons:0,relatedTarget:function(t){return t.relatedTarget===void 0?t.fromElement===t.srcElement?t.toElement:t.fromElement:t.relatedTarget},movementX:function(t){return"movementX"in t?t.movementX:(t!==Al&&(Al&&t.type==="mousemove"?(dy=t.screenX-Al.screenX,hy=t.screenY-Al.screenY):hy=dy=0,Al=t),dy)},movementY:function(t){return"movementY"in t?t.movementY:hy}}),O2=Jn(Kg),PR=at({},Kg,{dataTransfer:0}),kR=Jn(PR),IR=at({},Pd,{relatedTarget:0}),fy=Jn(IR),$R=at({},sl,{animationName:0,elapsedTime:0,pseudoElement:0}),TR=Jn($R),AR=at({},sl,{clipboardData:function(t){return"clipboardData"in t?t.clipboardData:window.clipboardData}}),MR=Jn(AR),OR=at({},sl,{data:0}),D2=Jn(OR),DR={Esc:"Escape",Spacebar:" ",Left:"ArrowLeft",Up:"ArrowUp",Right:"ArrowRight",Down:"ArrowDown",Del:"Delete",Win:"OS",Menu:"ContextMenu",Apps:"ContextMenu",Scroll:"ScrollLock",MozPrintableKey:"Unidentified"},RR={8:"Backspace",9:"Tab",12:"Clear",13:"Enter",16:"Shift",17:"Control",18:"Alt",19:"Pause",20:"CapsLock",27:"Escape",32:" ",33:"PageUp",34:"PageDown",35:"End",36:"Home",37:"ArrowLeft",38:"ArrowUp",39:"ArrowRight",40:"ArrowDown",45:"Insert",46:"Delete",112:"F1",113:"F2",114:"F3",115:"F4",116:"F5",117:"F6",118:"F7",119:"F8",120:"F9",121:"F10",122:"F11",123:"F12",144:"NumLock",145:"ScrollLock",224:"Meta"},LR={Alt:"altKey",Control:"ctrlKey",Meta:"metaKey",Shift:"shiftKey"};function jR(t){var e=this.nativeEvent;return e.getModifierState?e.getModifierState(t):(t=LR[t])?!!e[t]:!1}function o1(){return jR}var NR=at({},Pd,{key:function(t){if(t.key){var e=DR[t.key]||t.key;if(e!=="Unidentified")return e}return t.type==="keypress"?(t=xf(t),t===13?"Enter":String.fromCharCode(t)):t.type==="keydown"||t.type==="keyup"?RR[t.keyCode]||"Unidentified":""},code:0,location:0,ctrlKey:0,shiftKey:0,altKey:0,metaKey:0,repeat:0,locale:0,getModifierState:o1,charCode:function(t){return t.type==="keypress"?xf(t):0},keyCode:function(t){return t.type==="keydown"||t.type==="keyup"?t.keyCode:0},which:function(t){return t.type==="keypress"?xf(t):t.type==="keydown"||t.type==="keyup"?t.keyCode:0}}),zR=Jn(NR),FR=at({},Kg,{pointerId:0,width:0,height:0,pressure:0,tangentialPressure:0,tiltX:0,tiltY:0,twist:0,pointerType:0,isPrimary:0}),R2=Jn(FR),BR=at({},Pd,{touches:0,targetTouches:0,changedTouches:0,altKey:0,metaKey:0,ctrlKey:0,shiftKey:0,getModifierState:o1}),UR=Jn(BR),HR=at({},sl,{propertyName:0,elapsedTime:0,pseudoElement:0}),KR=Jn(HR),VR=at({},Kg,{deltaX:function(t){return"deltaX"in t?t.deltaX:"wheelDeltaX"in t?-t.wheelDeltaX:0},deltaY:function(t){return"deltaY"in t?t.deltaY:"wheelDeltaY"in t?-t.wheelDeltaY:"wheelDelta"in t?-t.wheelDelta:0},deltaZ:0,deltaMode:0}),WR=Jn(VR),GR=[9,13,27,32],i1=Xs&&"CompositionEvent"in window,lu=null;Xs&&"documentMode"in document&&(lu=document.documentMode);var YR=Xs&&"TextEvent"in window&&!lu,AI=Xs&&(!i1||lu&&8<lu&&11>=lu),L2=String.fromCharCode(32),j2=!1;function MI(t,e){switch(t){case"keyup":return GR.indexOf(e.keyCode)!==-1;case"keydown":return e.keyCode!==229;case"keypress":case"mousedown":case"focusout":return!0;default:return!1}}function OI(t){return t=t.detail,typeof t=="object"&&"data"in t?t.data:null}var ic=!1;function XR(t,e){switch(t){case"compositionend":return OI(e);case"keypress":return e.which!==32?null:(j2=!0,L2);case"textInput":return t=e.data,t===L2&&j2?null:t;default:return null}}function qR(t,e){if(ic)return t==="compositionend"||!i1&&MI(t,e)?(t=TI(),Sf=r1=jo=null,ic=!1,t):null;switch(t){case"paste":return null;case"keypress":if(!(e.ctrlKey||e.altKey||e.metaKey)||e.ctrlKey&&e.altKey){if(e.char&&1<e.char.length)return e.char;if(e.which)return String.fromCharCode(e.which)}return null;case"compositionend":return AI&&e.locale!=="ko"?null:e.data;default:return null}}var QR={color:!0,date:!0,datetime:!0,"datetime-local":!0,email:!0,month:!0,number:!0,password:!0,range:!0,search:!0,tel:!0,text:!0,time:!0,url:!0,week:!0};function N2(t){var e=t&&t.nodeName&&t.nodeName.toLowerCase();return e==="input"?!!QR[t.type]:e==="textarea"}function DI(t,e,n,r){dI(r),e=Pp(e,"onChange"),0<e.length&&(n=new s1("onChange","change",null,n,r),t.push({event:n,listeners:e}))}var uu=null,Ou=null;function ZR(t){VI(t,0)}function Vg(t){var e=lc(t);if(sI(e))return t}function JR(t,e){if(t==="change")return e}var RI=!1;if(Xs){var py;if(Xs){var gy="oninput"in document;if(!gy){var z2=document.createElement("div");z2.setAttribute("oninput","return;"),gy=typeof z2.oninput=="function"}py=gy}else py=!1;RI=py&&(!document.documentMode||9<document.documentMode)}function F2(){uu&&(uu.detachEvent("onpropertychange",LI),Ou=uu=null)}function LI(t){if(t.propertyName==="value"&&Vg(Ou)){var e=[];DI(e,Ou,t,ZS(t)),gI(ZR,e)}}function e8(t,e,n){t==="focusin"?(F2(),uu=e,Ou=n,uu.attachEvent("onpropertychange",LI)):t==="focusout"&&F2()}function t8(t){if(t==="selectionchange"||t==="keyup"||t==="keydown")return Vg(Ou)}function n8(t,e){if(t==="click")return Vg(e)}function r8(t,e){if(t==="input"||t==="change")return Vg(e)}function s8(t,e){return t===e&&(t!==0||1/t===1/e)||t!==t&&e!==e}var Wr=typeof Object.is=="function"?Object.is:s8;function Du(t,e){if(Wr(t,e))return!0;if(typeof t!="object"||t===null||typeof e!="object"||e===null)return!1;var n=Object.keys(t),r=Object.keys(e);if(n.length!==r.length)return!1;for(r=0;r<n.length;r++){var s=n[r];if(!Mv.call(e,s)||!Wr(t[s],e[s]))return!1}return!0}function B2(t){for(;t&&t.firstChild;)t=t.firstChild;return t}function U2(t,e){var n=B2(t);t=0;for(var r;n;){if(n.nodeType===3){if(r=t+n.textContent.length,t<=e&&r>=e)return{node:n,offset:e-t};t=r}e:{for(;n;){if(n.nextSibling){n=n.nextSibling;break e}n=n.parentNode}n=void 0}n=B2(n)}}function jI(t,e){return t&&e?t===e?!0:t&&t.nodeType===3?!1:e&&e.nodeType===3?jI(t,e.parentNode):"contains"in t?t.contains(e):t.compareDocumentPosition?!!(t.compareDocumentPosition(e)&16):!1:!1}function NI(){for(var t=window,e=wp();e instanceof t.HTMLIFrameElement;){try{var n=typeof e.contentWindow.location.href=="string"}catch{n=!1}if(n)t=e.contentWindow;else break;e=wp(t.document)}return e}function a1(t){var e=t&&t.nodeName&&t.nodeName.toLowerCase();return e&&(e==="input"&&(t.type==="text"||t.type==="search"||t.type==="tel"||t.type==="url"||t.type==="password")||e==="textarea"||t.contentEditable==="true")}function o8(t){var e=NI(),n=t.focusedElem,r=t.selectionRange;if(e!==n&&n&&n.ownerDocument&&jI(n.ownerDocument.documentElement,n)){if(r!==null&&a1(n)){if(e=r.start,t=r.end,t===void 0&&(t=e),"selectionStart"in n)n.selectionStart=e,n.selectionEnd=Math.min(t,n.value.length);else if(t=(e=n.ownerDocument||document)&&e.defaultView||window,t.getSelection){t=t.getSelection();var s=n.textContent.length,o=Math.min(r.start,s);r=r.end===void 0?o:Math.min(r.end,s),!t.extend&&o>r&&(s=r,r=o,o=s),s=U2(n,o);var i=U2(n,r);s&&i&&(t.rangeCount!==1||t.anchorNode!==s.node||t.anchorOffset!==s.offset||t.focusNode!==i.node||t.focusOffset!==i.offset)&&(e=e.createRange(),e.setStart(s.node,s.offset),t.removeAllRanges(),o>r?(t.addRange(e),t.extend(i.node,i.offset)):(e.setEnd(i.node,i.offset),t.addRange(e)))}}for(e=[],t=n;t=t.parentNode;)t.nodeType===1&&e.push({element:t,left:t.scrollLeft,top:t.scrollTop});for(typeof n.focus=="function"&&n.focus(),n=0;n<e.length;n++)t=e[n],t.element.scrollLeft=t.left,t.element.scrollTop=t.top}}var i8=Xs&&"documentMode"in document&&11>=document.documentMode,ac=null,Qv=null,du=null,Zv=!1;function H2(t,e,n){var r=n.window===n?n.document:n.nodeType===9?n:n.ownerDocument;Zv||ac==null||ac!==wp(r)||(r=ac,"selectionStart"in r&&a1(r)?r={start:r.selectionStart,end:r.selectionEnd}:(r=(r.ownerDocument&&r.ownerDocument.defaultView||window).getSelection(),r={anchorNode:r.anchorNode,anchorOffset:r.anchorOffset,focusNode:r.focusNode,focusOffset:r.focusOffset}),du&&Du(du,r)||(du=r,r=Pp(Qv,"onSelect"),0<r.length&&(e=new s1("onSelect","select",null,e,n),t.push({event:e,listeners:r}),e.target=ac)))}function bh(t,e){var n={};return n[t.toLowerCase()]=e.toLowerCase(),n["Webkit"+t]="webkit"+e,n["Moz"+t]="moz"+e,n}var cc={animationend:bh("Animation","AnimationEnd"),animationiteration:bh("Animation","AnimationIteration"),animationstart:bh("Animation","AnimationStart"),transitionend:bh("Transition","TransitionEnd")},my={},zI={};Xs&&(zI=document.createElement("div").style,"AnimationEvent"in window||(delete cc.animationend.animation,delete cc.animationiteration.animation,delete cc.animationstart.animation),"TransitionEvent"in window||delete cc.transitionend.transition);function Wg(t){if(my[t])return my[t];if(!cc[t])return t;var e=cc[t],n;for(n in e)if(e.hasOwnProperty(n)&&n in zI)return my[t]=e[n];return t}var FI=Wg("animationend"),BI=Wg("animationiteration"),UI=Wg("animationstart"),HI=Wg("transitionend"),KI=new Map,K2="abort auxClick cancel canPlay canPlayThrough click close contextMenu copy cut drag dragEnd dragEnter dragExit dragLeave dragOver dragStart drop durationChange emptied encrypted ended error gotPointerCapture input invalid keyDown keyPress keyUp load loadedData loadedMetadata loadStart lostPointerCapture mouseDown mouseMove mouseOut mouseOver mouseUp paste pause play playing pointerCancel pointerDown pointerMove pointerOut pointerOver pointerUp progress rateChange reset resize seeked seeking stalled submit suspend timeUpdate touchCancel touchEnd touchStart volumeChange scroll toggle touchMove waiting wheel".split(" ");function mi(t,e){KI.set(t,e),xa(e,[t])}for(var yy=0;yy<K2.length;yy++){var vy=K2[yy],a8=vy.toLowerCase(),c8=vy[0].toUpperCase()+vy.slice(1);mi(a8,"on"+c8)}mi(FI,"onAnimationEnd");mi(BI,"onAnimationIteration");mi(UI,"onAnimationStart");mi("dblclick","onDoubleClick");mi("focusin","onFocus");mi("focusout","onBlur");mi(HI,"onTransitionEnd");Lc("onMouseEnter",["mouseout","mouseover"]);Lc("onMouseLeave",["mouseout","mouseover"]);Lc("onPointerEnter",["pointerout","pointerover"]);Lc("onPointerLeave",["pointerout","pointerover"]);xa("onChange","change click focusin focusout input keydown keyup selectionchange".split(" "));xa("onSelect","focusout contextmenu dragend focusin keydown keyup mousedown mouseup selectionchange".split(" "));xa("onBeforeInput",["compositionend","keypress","textInput","paste"]);xa("onCompositionEnd","compositionend focusout keydown keypress keyup mousedown".split(" "));xa("onCompositionStart","compositionstart focusout keydown keypress keyup mousedown".split(" "));xa("onCompositionUpdate","compositionupdate focusout keydown keypress keyup mousedown".split(" "));var nu="abort canplay canplaythrough durationchange emptied encrypted ended error loadeddata loadedmetadata loadstart pause play playing progress ratechange resize seeked seeking stalled suspend timeupdate volumechange waiting".split(" "),l8=new Set("cancel close invalid load scroll toggle".split(" ").concat(nu));function V2(t,e,n){var r=t.type||"unknown-event";t.currentTarget=n,aR(r,e,void 0,t),t.currentTarget=null}function VI(t,e){e=(e&4)!==0;for(var n=0;n<t.length;n++){var r=t[n],s=r.event;r=r.listeners;e:{var o=void 0;if(e)for(var i=r.length-1;0<=i;i--){var a=r[i],c=a.instance,l=a.currentTarget;if(a=a.listener,c!==o&&s.isPropagationStopped())break e;V2(s,a,l),o=c}else for(i=0;i<r.length;i++){if(a=r[i],c=a.instance,l=a.currentTarget,a=a.listener,c!==o&&s.isPropagationStopped())break e;V2(s,a,l),o=c}}}if(xp)throw t=Gv,xp=!1,Gv=null,t}function We(t,e){var n=e[rw];n===void 0&&(n=e[rw]=new Set);var r=t+"__bubble";n.has(r)||(WI(e,t,2,!1),n.add(r))}function wy(t,e,n){var r=0;e&&(r|=4),WI(n,t,r,e)}var Ch="_reactListening"+Math.random().toString(36).slice(2);function Ru(t){if(!t[Ch]){t[Ch]=!0,Jk.forEach(function(n){n!=="selectionchange"&&(l8.has(n)||wy(n,!1,t),wy(n,!0,t))});var e=t.nodeType===9?t:t.ownerDocument;e===null||e[Ch]||(e[Ch]=!0,wy("selectionchange",!1,e))}}function WI(t,e,n,r){switch($I(e)){case 1:var s=CR;break;case 4:s=_R;break;default:s=n1}n=s.bind(null,e,n,t),s=void 0,!Wv||e!=="touchstart"&&e!=="touchmove"&&e!=="wheel"||(s=!0),r?s!==void 0?t.addEventListener(e,n,{capture:!0,passive:s}):t.addEventListener(e,n,!0):s!==void 0?t.addEventListener(e,n,{passive:s}):t.addEventListener(e,n,!1)}function Sy(t,e,n,r,s){var o=r;if(!(e&1)&&!(e&2)&&r!==null)e:for(;;){if(r===null)return;var i=r.tag;if(i===3||i===4){var a=r.stateNode.containerInfo;if(a===s||a.nodeType===8&&a.parentNode===s)break;if(i===4)for(i=r.return;i!==null;){var c=i.tag;if((c===3||c===4)&&(c=i.stateNode.containerInfo,c===s||c.nodeType===8&&c.parentNode===s))return;i=i.return}for(;a!==null;){if(i=zi(a),i===null)return;if(c=i.tag,c===5||c===6){r=o=i;continue e}a=a.parentNode}}r=r.return}gI(function(){var l=o,u=ZS(n),d=[];e:{var h=KI.get(t);if(h!==void 0){var f=s1,p=t;switch(t){case"keypress":if(xf(n)===0)break e;case"keydown":case"keyup":f=zR;break;case"focusin":p="focus",f=fy;break;case"focusout":p="blur",f=fy;break;case"beforeblur":case"afterblur":f=fy;break;case"click":if(n.button===2)break e;case"auxclick":case"dblclick":case"mousedown":case"mousemove":case"mouseup":case"mouseout":case"mouseover":case"contextmenu":f=O2;break;case"drag":case"dragend":case"dragenter":case"dragexit":case"dragleave":case"dragover":case"dragstart":case"drop":f=kR;break;case"touchcancel":case"touchend":case"touchmove":case"touchstart":f=UR;break;case FI:case BI:case UI:f=TR;break;case HI:f=KR;break;case"scroll":f=ER;break;case"wheel":f=WR;break;case"copy":case"cut":case"paste":f=MR;break;case"gotpointercapture":case"lostpointercapture":case"pointercancel":case"pointerdown":case"pointermove":case"pointerout":case"pointerover":case"pointerup":f=R2}var m=(e&4)!==0,v=!m&&t==="scroll",w=m?h!==null?h+"Capture":null:h;m=[];for(var x=l,b;x!==null;){b=x;var C=b.stateNode;if(b.tag===5&&C!==null&&(b=C,w!==null&&(C=$u(x,w),C!=null&&m.push(Lu(x,C,b)))),v)break;x=x.return}0<m.length&&(h=new f(h,p,null,n,u),d.push({event:h,listeners:m}))}}if(!(e&7)){e:{if(h=t==="mouseover"||t==="pointerover",f=t==="mouseout"||t==="pointerout",h&&n!==Kv&&(p=n.relatedTarget||n.fromElement)&&(zi(p)||p[qs]))break e;if((f||h)&&(h=u.window===u?u:(h=u.ownerDocument)?h.defaultView||h.parentWindow:window,f?(p=n.relatedTarget||n.toElement,f=l,p=p?zi(p):null,p!==null&&(v=ba(p),p!==v||p.tag!==5&&p.tag!==6)&&(p=null)):(f=null,p=l),f!==p)){if(m=O2,C="onMouseLeave",w="onMouseEnter",x="mouse",(t==="pointerout"||t==="pointerover")&&(m=R2,C="onPointerLeave",w="onPointerEnter",x="pointer"),v=f==null?h:lc(f),b=p==null?h:lc(p),h=new m(C,x+"leave",f,n,u),h.target=v,h.relatedTarget=b,C=null,zi(u)===l&&(m=new m(w,x+"enter",p,n,u),m.target=b,m.relatedTarget=v,C=m),v=C,f&&p)t:{for(m=f,w=p,x=0,b=m;b;b=za(b))x++;for(b=0,C=w;C;C=za(C))b++;for(;0<x-b;)m=za(m),x--;for(;0<b-x;)w=za(w),b--;for(;x--;){if(m===w||w!==null&&m===w.alternate)break t;m=za(m),w=za(w)}m=null}else m=null;f!==null&&W2(d,h,f,m,!1),p!==null&&v!==null&&W2(d,v,p,m,!0)}}e:{if(h=l?lc(l):window,f=h.nodeName&&h.nodeName.toLowerCase(),f==="select"||f==="input"&&h.type==="file")var E=JR;else if(N2(h))if(RI)E=r8;else{E=t8;var _=e8}else(f=h.nodeName)&&f.toLowerCase()==="input"&&(h.type==="checkbox"||h.type==="radio")&&(E=n8);if(E&&(E=E(t,l))){DI(d,E,n,u);break e}_&&_(t,h,l),t==="focusout"&&(_=h._wrapperState)&&_.controlled&&h.type==="number"&&zv(h,"number",h.value)}switch(_=l?lc(l):window,t){case"focusin":(N2(_)||_.contentEditable==="true")&&(ac=_,Qv=l,du=null);break;case"focusout":du=Qv=ac=null;break;case"mousedown":Zv=!0;break;case"contextmenu":case"mouseup":case"dragend":Zv=!1,H2(d,n,u);break;case"selectionchange":if(i8)break;case"keydown":case"keyup":H2(d,n,u)}var k;if(i1)e:{switch(t){case"compositionstart":var I="onCompositionStart";break e;case"compositionend":I="onCompositionEnd";break e;case"compositionupdate":I="onCompositionUpdate";break e}I=void 0}else ic?MI(t,n)&&(I="onCompositionEnd"):t==="keydown"&&n.keyCode===229&&(I="onCompositionStart");I&&(AI&&n.locale!=="ko"&&(ic||I!=="onCompositionStart"?I==="onCompositionEnd"&&ic&&(k=TI()):(jo=u,r1="value"in jo?jo.value:jo.textContent,ic=!0)),_=Pp(l,I),0<_.length&&(I=new D2(I,t,null,n,u),d.push({event:I,listeners:_}),k?I.data=k:(k=OI(n),k!==null&&(I.data=k)))),(k=YR?XR(t,n):qR(t,n))&&(l=Pp(l,"onBeforeInput"),0<l.length&&(u=new D2("onBeforeInput","beforeinput",null,n,u),d.push({event:u,listeners:l}),u.data=k))}VI(d,e)})}function Lu(t,e,n){return{instance:t,listener:e,currentTarget:n}}function Pp(t,e){for(var n=e+"Capture",r=[];t!==null;){var s=t,o=s.stateNode;s.tag===5&&o!==null&&(s=o,o=$u(t,n),o!=null&&r.unshift(Lu(t,o,s)),o=$u(t,e),o!=null&&r.push(Lu(t,o,s))),t=t.return}return r}function za(t){if(t===null)return null;do t=t.return;while(t&&t.tag!==5);return t||null}function W2(t,e,n,r,s){for(var o=e._reactName,i=[];n!==null&&n!==r;){var a=n,c=a.alternate,l=a.stateNode;if(c!==null&&c===r)break;a.tag===5&&l!==null&&(a=l,s?(c=$u(n,o),c!=null&&i.unshift(Lu(n,c,a))):s||(c=$u(n,o),c!=null&&i.push(Lu(n,c,a)))),n=n.return}i.length!==0&&t.push({event:e,listeners:i})}var u8=/\r\n?/g,d8=/\u0000|\uFFFD/g;function G2(t){return(typeof t=="string"?t:""+t).replace(u8,`
`).replace(d8,"")}function _h(t,e,n){if(e=G2(e),G2(t)!==e&&n)throw Error(G(425))}function kp(){}var Jv=null,ew=null;function tw(t,e){return t==="textarea"||t==="noscript"||typeof e.children=="string"||typeof e.children=="number"||typeof e.dangerouslySetInnerHTML=="object"&&e.dangerouslySetInnerHTML!==null&&e.dangerouslySetInnerHTML.__html!=null}var nw=typeof setTimeout=="function"?setTimeout:void 0,h8=typeof clearTimeout=="function"?clearTimeout:void 0,Y2=typeof Promise=="function"?Promise:void 0,f8=typeof queueMicrotask=="function"?queueMicrotask:typeof Y2<"u"?function(t){return Y2.resolve(null).then(t).catch(p8)}:nw;function p8(t){setTimeout(function(){throw t})}function xy(t,e){var n=e,r=0;do{var s=n.nextSibling;if(t.removeChild(n),s&&s.nodeType===8)if(n=s.data,n==="/$"){if(r===0){t.removeChild(s),Mu(e);return}r--}else n!=="$"&&n!=="$?"&&n!=="$!"||r++;n=s}while(n);Mu(e)}function Go(t){for(;t!=null;t=t.nextSibling){var e=t.nodeType;if(e===1||e===3)break;if(e===8){if(e=t.data,e==="$"||e==="$!"||e==="$?")break;if(e==="/$")return null}}return t}function X2(t){t=t.previousSibling;for(var e=0;t;){if(t.nodeType===8){var n=t.data;if(n==="$"||n==="$!"||n==="$?"){if(e===0)return t;e--}else n==="/$"&&e++}t=t.previousSibling}return null}var ol=Math.random().toString(36).slice(2),ns="__reactFiber$"+ol,ju="__reactProps$"+ol,qs="__reactContainer$"+ol,rw="__reactEvents$"+ol,g8="__reactListeners$"+ol,m8="__reactHandles$"+ol;function zi(t){var e=t[ns];if(e)return e;for(var n=t.parentNode;n;){if(e=n[qs]||n[ns]){if(n=e.alternate,e.child!==null||n!==null&&n.child!==null)for(t=X2(t);t!==null;){if(n=t[ns])return n;t=X2(t)}return e}t=n,n=t.parentNode}return null}function kd(t){return t=t[ns]||t[qs],!t||t.tag!==5&&t.tag!==6&&t.tag!==13&&t.tag!==3?null:t}function lc(t){if(t.tag===5||t.tag===6)return t.stateNode;throw Error(G(33))}function Gg(t){return t[ju]||null}var sw=[],uc=-1;function yi(t){return{current:t}}function Ge(t){0>uc||(t.current=sw[uc],sw[uc]=null,uc--)}function He(t,e){uc++,sw[uc]=t.current,t.current=e}var si={},nn=yi(si),_n=yi(!1),oa=si;function jc(t,e){var n=t.type.contextTypes;if(!n)return si;var r=t.stateNode;if(r&&r.__reactInternalMemoizedUnmaskedChildContext===e)return r.__reactInternalMemoizedMaskedChildContext;var s={},o;for(o in n)s[o]=e[o];return r&&(t=t.stateNode,t.__reactInternalMemoizedUnmaskedChildContext=e,t.__reactInternalMemoizedMaskedChildContext=s),s}function En(t){return t=t.childContextTypes,t!=null}function Ip(){Ge(_n),Ge(nn)}function q2(t,e,n){if(nn.current!==si)throw Error(G(168));He(nn,e),He(_n,n)}function GI(t,e,n){var r=t.stateNode;if(e=e.childContextTypes,typeof r.getChildContext!="function")return n;r=r.getChildContext();for(var s in r)if(!(s in e))throw Error(G(108,eR(t)||"Unknown",s));return at({},n,r)}function $p(t){return t=(t=t.stateNode)&&t.__reactInternalMemoizedMergedChildContext||si,oa=nn.current,He(nn,t),He(_n,_n.current),!0}function Q2(t,e,n){var r=t.stateNode;if(!r)throw Error(G(169));n?(t=GI(t,e,oa),r.__reactInternalMemoizedMergedChildContext=t,Ge(_n),Ge(nn),He(nn,t)):Ge(_n),He(_n,n)}var As=null,Yg=!1,by=!1;function YI(t){As===null?As=[t]:As.push(t)}function y8(t){Yg=!0,YI(t)}function vi(){if(!by&&As!==null){by=!0;var t=0,e=De;try{var n=As;for(De=1;t<n.length;t++){var r=n[t];do r=r(!0);while(r!==null)}As=null,Yg=!1}catch(s){throw As!==null&&(As=As.slice(t+1)),wI(JS,vi),s}finally{De=e,by=!1}}return null}var dc=[],hc=0,Tp=null,Ap=0,cr=[],lr=0,ia=null,Ls=1,js="";function Ri(t,e){dc[hc++]=Ap,dc[hc++]=Tp,Tp=t,Ap=e}function XI(t,e,n){cr[lr++]=Ls,cr[lr++]=js,cr[lr++]=ia,ia=t;var r=Ls;t=js;var s=32-Fr(r)-1;r&=~(1<<s),n+=1;var o=32-Fr(e)+s;if(30<o){var i=s-s%5;o=(r&(1<<i)-1).toString(32),r>>=i,s-=i,Ls=1<<32-Fr(e)+s|n<<s|r,js=o+t}else Ls=1<<o|n<<s|r,js=t}function c1(t){t.return!==null&&(Ri(t,1),XI(t,1,0))}function l1(t){for(;t===Tp;)Tp=dc[--hc],dc[hc]=null,Ap=dc[--hc],dc[hc]=null;for(;t===ia;)ia=cr[--lr],cr[lr]=null,js=cr[--lr],cr[lr]=null,Ls=cr[--lr],cr[lr]=null}var Wn=null,Kn=null,Qe=!1,Dr=null;function qI(t,e){var n=mr(5,null,null,0);n.elementType="DELETED",n.stateNode=e,n.return=t,e=t.deletions,e===null?(t.deletions=[n],t.flags|=16):e.push(n)}function Z2(t,e){switch(t.tag){case 5:var n=t.type;return e=e.nodeType!==1||n.toLowerCase()!==e.nodeName.toLowerCase()?null:e,e!==null?(t.stateNode=e,Wn=t,Kn=Go(e.firstChild),!0):!1;case 6:return e=t.pendingProps===""||e.nodeType!==3?null:e,e!==null?(t.stateNode=e,Wn=t,Kn=null,!0):!1;case 13:return e=e.nodeType!==8?null:e,e!==null?(n=ia!==null?{id:Ls,overflow:js}:null,t.memoizedState={dehydrated:e,treeContext:n,retryLane:1073741824},n=mr(18,null,null,0),n.stateNode=e,n.return=t,t.child=n,Wn=t,Kn=null,!0):!1;default:return!1}}function ow(t){return(t.mode&1)!==0&&(t.flags&128)===0}function iw(t){if(Qe){var e=Kn;if(e){var n=e;if(!Z2(t,e)){if(ow(t))throw Error(G(418));e=Go(n.nextSibling);var r=Wn;e&&Z2(t,e)?qI(r,n):(t.flags=t.flags&-4097|2,Qe=!1,Wn=t)}}else{if(ow(t))throw Error(G(418));t.flags=t.flags&-4097|2,Qe=!1,Wn=t}}}function J2(t){for(t=t.return;t!==null&&t.tag!==5&&t.tag!==3&&t.tag!==13;)t=t.return;Wn=t}function Eh(t){if(t!==Wn)return!1;if(!Qe)return J2(t),Qe=!0,!1;var e;if((e=t.tag!==3)&&!(e=t.tag!==5)&&(e=t.type,e=e!=="head"&&e!=="body"&&!tw(t.type,t.memoizedProps)),e&&(e=Kn)){if(ow(t))throw QI(),Error(G(418));for(;e;)qI(t,e),e=Go(e.nextSibling)}if(J2(t),t.tag===13){if(t=t.memoizedState,t=t!==null?t.dehydrated:null,!t)throw Error(G(317));e:{for(t=t.nextSibling,e=0;t;){if(t.nodeType===8){var n=t.data;if(n==="/$"){if(e===0){Kn=Go(t.nextSibling);break e}e--}else n!=="$"&&n!=="$!"&&n!=="$?"||e++}t=t.nextSibling}Kn=null}}else Kn=Wn?Go(t.stateNode.nextSibling):null;return!0}function QI(){for(var t=Kn;t;)t=Go(t.nextSibling)}function Nc(){Kn=Wn=null,Qe=!1}function u1(t){Dr===null?Dr=[t]:Dr.push(t)}var v8=ro.ReactCurrentBatchConfig;function Tr(t,e){if(t&&t.defaultProps){e=at({},e),t=t.defaultProps;for(var n in t)e[n]===void 0&&(e[n]=t[n]);return e}return e}var Mp=yi(null),Op=null,fc=null,d1=null;function h1(){d1=fc=Op=null}function f1(t){var e=Mp.current;Ge(Mp),t._currentValue=e}function aw(t,e,n){for(;t!==null;){var r=t.alternate;if((t.childLanes&e)!==e?(t.childLanes|=e,r!==null&&(r.childLanes|=e)):r!==null&&(r.childLanes&e)!==e&&(r.childLanes|=e),t===n)break;t=t.return}}function Pc(t,e){Op=t,d1=fc=null,t=t.dependencies,t!==null&&t.firstContext!==null&&(t.lanes&e&&(bn=!0),t.firstContext=null)}function wr(t){var e=t._currentValue;if(d1!==t)if(t={context:t,memoizedValue:e,next:null},fc===null){if(Op===null)throw Error(G(308));fc=t,Op.dependencies={lanes:0,firstContext:t}}else fc=fc.next=t;return e}var Fi=null;function p1(t){Fi===null?Fi=[t]:Fi.push(t)}function ZI(t,e,n,r){var s=e.interleaved;return s===null?(n.next=n,p1(e)):(n.next=s.next,s.next=n),e.interleaved=n,Qs(t,r)}function Qs(t,e){t.lanes|=e;var n=t.alternate;for(n!==null&&(n.lanes|=e),n=t,t=t.return;t!==null;)t.childLanes|=e,n=t.alternate,n!==null&&(n.childLanes|=e),n=t,t=t.return;return n.tag===3?n.stateNode:null}var To=!1;function g1(t){t.updateQueue={baseState:t.memoizedState,firstBaseUpdate:null,lastBaseUpdate:null,shared:{pending:null,interleaved:null,lanes:0},effects:null}}function JI(t,e){t=t.updateQueue,e.updateQueue===t&&(e.updateQueue={baseState:t.baseState,firstBaseUpdate:t.firstBaseUpdate,lastBaseUpdate:t.lastBaseUpdate,shared:t.shared,effects:t.effects})}function zs(t,e){return{eventTime:t,lane:e,tag:0,payload:null,callback:null,next:null}}function Yo(t,e,n){var r=t.updateQueue;if(r===null)return null;if(r=r.shared,_e&2){var s=r.pending;return s===null?e.next=e:(e.next=s.next,s.next=e),r.pending=e,Qs(t,n)}return s=r.interleaved,s===null?(e.next=e,p1(r)):(e.next=s.next,s.next=e),r.interleaved=e,Qs(t,n)}function bf(t,e,n){if(e=e.updateQueue,e!==null&&(e=e.shared,(n&4194240)!==0)){var r=e.lanes;r&=t.pendingLanes,n|=r,e.lanes=n,e1(t,n)}}function eC(t,e){var n=t.updateQueue,r=t.alternate;if(r!==null&&(r=r.updateQueue,n===r)){var s=null,o=null;if(n=n.firstBaseUpdate,n!==null){do{var i={eventTime:n.eventTime,lane:n.lane,tag:n.tag,payload:n.payload,callback:n.callback,next:null};o===null?s=o=i:o=o.next=i,n=n.next}while(n!==null);o===null?s=o=e:o=o.next=e}else s=o=e;n={baseState:r.baseState,firstBaseUpdate:s,lastBaseUpdate:o,shared:r.shared,effects:r.effects},t.updateQueue=n;return}t=n.lastBaseUpdate,t===null?n.firstBaseUpdate=e:t.next=e,n.lastBaseUpdate=e}function Dp(t,e,n,r){var s=t.updateQueue;To=!1;var o=s.firstBaseUpdate,i=s.lastBaseUpdate,a=s.shared.pending;if(a!==null){s.shared.pending=null;var c=a,l=c.next;c.next=null,i===null?o=l:i.next=l,i=c;var u=t.alternate;u!==null&&(u=u.updateQueue,a=u.lastBaseUpdate,a!==i&&(a===null?u.firstBaseUpdate=l:a.next=l,u.lastBaseUpdate=c))}if(o!==null){var d=s.baseState;i=0,u=l=c=null,a=o;do{var h=a.lane,f=a.eventTime;if((r&h)===h){u!==null&&(u=u.next={eventTime:f,lane:0,tag:a.tag,payload:a.payload,callback:a.callback,next:null});e:{var p=t,m=a;switch(h=e,f=n,m.tag){case 1:if(p=m.payload,typeof p=="function"){d=p.call(f,d,h);break e}d=p;break e;case 3:p.flags=p.flags&-65537|128;case 0:if(p=m.payload,h=typeof p=="function"?p.call(f,d,h):p,h==null)break e;d=at({},d,h);break e;case 2:To=!0}}a.callback!==null&&a.lane!==0&&(t.flags|=64,h=s.effects,h===null?s.effects=[a]:h.push(a))}else f={eventTime:f,lane:h,tag:a.tag,payload:a.payload,callback:a.callback,next:null},u===null?(l=u=f,c=d):u=u.next=f,i|=h;if(a=a.next,a===null){if(a=s.shared.pending,a===null)break;h=a,a=h.next,h.next=null,s.lastBaseUpdate=h,s.shared.pending=null}}while(1);if(u===null&&(c=d),s.baseState=c,s.firstBaseUpdate=l,s.lastBaseUpdate=u,e=s.shared.interleaved,e!==null){s=e;do i|=s.lane,s=s.next;while(s!==e)}else o===null&&(s.shared.lanes=0);ca|=i,t.lanes=i,t.memoizedState=d}}function tC(t,e,n){if(t=e.effects,e.effects=null,t!==null)for(e=0;e<t.length;e++){var r=t[e],s=r.callback;if(s!==null){if(r.callback=null,r=n,typeof s!="function")throw Error(G(191,s));s.call(r)}}}var e$=new Zk.Component().refs;function cw(t,e,n,r){e=t.memoizedState,n=n(r,e),n=n==null?e:at({},e,n),t.memoizedState=n,t.lanes===0&&(t.updateQueue.baseState=n)}var Xg={isMounted:function(t){return(t=t._reactInternals)?ba(t)===t:!1},enqueueSetState:function(t,e,n){t=t._reactInternals;var r=fn(),s=qo(t),o=zs(r,s);o.payload=e,n!=null&&(o.callback=n),e=Yo(t,o,s),e!==null&&(Br(e,t,s,r),bf(e,t,s))},enqueueReplaceState:function(t,e,n){t=t._reactInternals;var r=fn(),s=qo(t),o=zs(r,s);o.tag=1,o.payload=e,n!=null&&(o.callback=n),e=Yo(t,o,s),e!==null&&(Br(e,t,s,r),bf(e,t,s))},enqueueForceUpdate:function(t,e){t=t._reactInternals;var n=fn(),r=qo(t),s=zs(n,r);s.tag=2,e!=null&&(s.callback=e),e=Yo(t,s,r),e!==null&&(Br(e,t,r,n),bf(e,t,r))}};function nC(t,e,n,r,s,o,i){return t=t.stateNode,typeof t.shouldComponentUpdate=="function"?t.shouldComponentUpdate(r,o,i):e.prototype&&e.prototype.isPureReactComponent?!Du(n,r)||!Du(s,o):!0}function t$(t,e,n){var r=!1,s=si,o=e.contextType;return typeof o=="object"&&o!==null?o=wr(o):(s=En(e)?oa:nn.current,r=e.contextTypes,o=(r=r!=null)?jc(t,s):si),e=new e(n,o),t.memoizedState=e.state!==null&&e.state!==void 0?e.state:null,e.updater=Xg,t.stateNode=e,e._reactInternals=t,r&&(t=t.stateNode,t.__reactInternalMemoizedUnmaskedChildContext=s,t.__reactInternalMemoizedMaskedChildContext=o),e}function rC(t,e,n,r){t=e.state,typeof e.componentWillReceiveProps=="function"&&e.componentWillReceiveProps(n,r),typeof e.UNSAFE_componentWillReceiveProps=="function"&&e.UNSAFE_componentWillReceiveProps(n,r),e.state!==t&&Xg.enqueueReplaceState(e,e.state,null)}function lw(t,e,n,r){var s=t.stateNode;s.props=n,s.state=t.memoizedState,s.refs=e$,g1(t);var o=e.contextType;typeof o=="object"&&o!==null?s.context=wr(o):(o=En(e)?oa:nn.current,s.context=jc(t,o)),s.state=t.memoizedState,o=e.getDerivedStateFromProps,typeof o=="function"&&(cw(t,e,o,n),s.state=t.memoizedState),typeof e.getDerivedStateFromProps=="function"||typeof s.getSnapshotBeforeUpdate=="function"||typeof s.UNSAFE_componentWillMount!="function"&&typeof s.componentWillMount!="function"||(e=s.state,typeof s.componentWillMount=="function"&&s.componentWillMount(),typeof s.UNSAFE_componentWillMount=="function"&&s.UNSAFE_componentWillMount(),e!==s.state&&Xg.enqueueReplaceState(s,s.state,null),Dp(t,n,s,r),s.state=t.memoizedState),typeof s.componentDidMount=="function"&&(t.flags|=4194308)}function Ml(t,e,n){if(t=n.ref,t!==null&&typeof t!="function"&&typeof t!="object"){if(n._owner){if(n=n._owner,n){if(n.tag!==1)throw Error(G(309));var r=n.stateNode}if(!r)throw Error(G(147,t));var s=r,o=""+t;return e!==null&&e.ref!==null&&typeof e.ref=="function"&&e.ref._stringRef===o?e.ref:(e=function(i){var a=s.refs;a===e$&&(a=s.refs={}),i===null?delete a[o]:a[o]=i},e._stringRef=o,e)}if(typeof t!="string")throw Error(G(284));if(!n._owner)throw Error(G(290,t))}return t}function Ph(t,e){throw t=Object.prototype.toString.call(e),Error(G(31,t==="[object Object]"?"object with keys {"+Object.keys(e).join(", ")+"}":t))}function sC(t){var e=t._init;return e(t._payload)}function n$(t){function e(w,x){if(t){var b=w.deletions;b===null?(w.deletions=[x],w.flags|=16):b.push(x)}}function n(w,x){if(!t)return null;for(;x!==null;)e(w,x),x=x.sibling;return null}function r(w,x){for(w=new Map;x!==null;)x.key!==null?w.set(x.key,x):w.set(x.index,x),x=x.sibling;return w}function s(w,x){return w=Qo(w,x),w.index=0,w.sibling=null,w}function o(w,x,b){return w.index=b,t?(b=w.alternate,b!==null?(b=b.index,b<x?(w.flags|=2,x):b):(w.flags|=2,x)):(w.flags|=1048576,x)}function i(w){return t&&w.alternate===null&&(w.flags|=2),w}function a(w,x,b,C){return x===null||x.tag!==6?(x=$y(b,w.mode,C),x.return=w,x):(x=s(x,b),x.return=w,x)}function c(w,x,b,C){var E=b.type;return E===oc?u(w,x,b.props.children,C,b.key):x!==null&&(x.elementType===E||typeof E=="object"&&E!==null&&E.$$typeof===$o&&sC(E)===x.type)?(C=s(x,b.props),C.ref=Ml(w,x,b),C.return=w,C):(C=If(b.type,b.key,b.props,null,w.mode,C),C.ref=Ml(w,x,b),C.return=w,C)}function l(w,x,b,C){return x===null||x.tag!==4||x.stateNode.containerInfo!==b.containerInfo||x.stateNode.implementation!==b.implementation?(x=Ty(b,w.mode,C),x.return=w,x):(x=s(x,b.children||[]),x.return=w,x)}function u(w,x,b,C,E){return x===null||x.tag!==7?(x=qi(b,w.mode,C,E),x.return=w,x):(x=s(x,b),x.return=w,x)}function d(w,x,b){if(typeof x=="string"&&x!==""||typeof x=="number")return x=$y(""+x,w.mode,b),x.return=w,x;if(typeof x=="object"&&x!==null){switch(x.$$typeof){case gh:return b=If(x.type,x.key,x.props,null,w.mode,b),b.ref=Ml(w,null,x),b.return=w,b;case sc:return x=Ty(x,w.mode,b),x.return=w,x;case $o:var C=x._init;return d(w,C(x._payload),b)}if(eu(x)||kl(x))return x=qi(x,w.mode,b,null),x.return=w,x;Ph(w,x)}return null}function h(w,x,b,C){var E=x!==null?x.key:null;if(typeof b=="string"&&b!==""||typeof b=="number")return E!==null?null:a(w,x,""+b,C);if(typeof b=="object"&&b!==null){switch(b.$$typeof){case gh:return b.key===E?c(w,x,b,C):null;case sc:return b.key===E?l(w,x,b,C):null;case $o:return E=b._init,h(w,x,E(b._payload),C)}if(eu(b)||kl(b))return E!==null?null:u(w,x,b,C,null);Ph(w,b)}return null}function f(w,x,b,C,E){if(typeof C=="string"&&C!==""||typeof C=="number")return w=w.get(b)||null,a(x,w,""+C,E);if(typeof C=="object"&&C!==null){switch(C.$$typeof){case gh:return w=w.get(C.key===null?b:C.key)||null,c(x,w,C,E);case sc:return w=w.get(C.key===null?b:C.key)||null,l(x,w,C,E);case $o:var _=C._init;return f(w,x,b,_(C._payload),E)}if(eu(C)||kl(C))return w=w.get(b)||null,u(x,w,C,E,null);Ph(x,C)}return null}function p(w,x,b,C){for(var E=null,_=null,k=x,I=x=0,$=null;k!==null&&I<b.length;I++){k.index>I?($=k,k=null):$=k.sibling;var A=h(w,k,b[I],C);if(A===null){k===null&&(k=$);break}t&&k&&A.alternate===null&&e(w,k),x=o(A,x,I),_===null?E=A:_.sibling=A,_=A,k=$}if(I===b.length)return n(w,k),Qe&&Ri(w,I),E;if(k===null){for(;I<b.length;I++)k=d(w,b[I],C),k!==null&&(x=o(k,x,I),_===null?E=k:_.sibling=k,_=k);return Qe&&Ri(w,I),E}for(k=r(w,k);I<b.length;I++)$=f(k,w,I,b[I],C),$!==null&&(t&&$.alternate!==null&&k.delete($.key===null?I:$.key),x=o($,x,I),_===null?E=$:_.sibling=$,_=$);return t&&k.forEach(function(D){return e(w,D)}),Qe&&Ri(w,I),E}function m(w,x,b,C){var E=kl(b);if(typeof E!="function")throw Error(G(150));if(b=E.call(b),b==null)throw Error(G(151));for(var _=E=null,k=x,I=x=0,$=null,A=b.next();k!==null&&!A.done;I++,A=b.next()){k.index>I?($=k,k=null):$=k.sibling;var D=h(w,k,A.value,C);if(D===null){k===null&&(k=$);break}t&&k&&D.alternate===null&&e(w,k),x=o(D,x,I),_===null?E=D:_.sibling=D,_=D,k=$}if(A.done)return n(w,k),Qe&&Ri(w,I),E;if(k===null){for(;!A.done;I++,A=b.next())A=d(w,A.value,C),A!==null&&(x=o(A,x,I),_===null?E=A:_.sibling=A,_=A);return Qe&&Ri(w,I),E}for(k=r(w,k);!A.done;I++,A=b.next())A=f(k,w,I,A.value,C),A!==null&&(t&&A.alternate!==null&&k.delete(A.key===null?I:A.key),x=o(A,x,I),_===null?E=A:_.sibling=A,_=A);return t&&k.forEach(function(L){return e(w,L)}),Qe&&Ri(w,I),E}function v(w,x,b,C){if(typeof b=="object"&&b!==null&&b.type===oc&&b.key===null&&(b=b.props.children),typeof b=="object"&&b!==null){switch(b.$$typeof){case gh:e:{for(var E=b.key,_=x;_!==null;){if(_.key===E){if(E=b.type,E===oc){if(_.tag===7){n(w,_.sibling),x=s(_,b.props.children),x.return=w,w=x;break e}}else if(_.elementType===E||typeof E=="object"&&E!==null&&E.$$typeof===$o&&sC(E)===_.type){n(w,_.sibling),x=s(_,b.props),x.ref=Ml(w,_,b),x.return=w,w=x;break e}n(w,_);break}else e(w,_);_=_.sibling}b.type===oc?(x=qi(b.props.children,w.mode,C,b.key),x.return=w,w=x):(C=If(b.type,b.key,b.props,null,w.mode,C),C.ref=Ml(w,x,b),C.return=w,w=C)}return i(w);case sc:e:{for(_=b.key;x!==null;){if(x.key===_)if(x.tag===4&&x.stateNode.containerInfo===b.containerInfo&&x.stateNode.implementation===b.implementation){n(w,x.sibling),x=s(x,b.children||[]),x.return=w,w=x;break e}else{n(w,x);break}else e(w,x);x=x.sibling}x=Ty(b,w.mode,C),x.return=w,w=x}return i(w);case $o:return _=b._init,v(w,x,_(b._payload),C)}if(eu(b))return p(w,x,b,C);if(kl(b))return m(w,x,b,C);Ph(w,b)}return typeof b=="string"&&b!==""||typeof b=="number"?(b=""+b,x!==null&&x.tag===6?(n(w,x.sibling),x=s(x,b),x.return=w,w=x):(n(w,x),x=$y(b,w.mode,C),x.return=w,w=x),i(w)):n(w,x)}return v}var zc=n$(!0),r$=n$(!1),Id={},as=yi(Id),Nu=yi(Id),zu=yi(Id);function Bi(t){if(t===Id)throw Error(G(174));return t}function m1(t,e){switch(He(zu,e),He(Nu,t),He(as,Id),t=e.nodeType,t){case 9:case 11:e=(e=e.documentElement)?e.namespaceURI:Bv(null,"");break;default:t=t===8?e.parentNode:e,e=t.namespaceURI||null,t=t.tagName,e=Bv(e,t)}Ge(as),He(as,e)}function Fc(){Ge(as),Ge(Nu),Ge(zu)}function s$(t){Bi(zu.current);var e=Bi(as.current),n=Bv(e,t.type);e!==n&&(He(Nu,t),He(as,n))}function y1(t){Nu.current===t&&(Ge(as),Ge(Nu))}var st=yi(0);function Rp(t){for(var e=t;e!==null;){if(e.tag===13){var n=e.memoizedState;if(n!==null&&(n=n.dehydrated,n===null||n.data==="$?"||n.data==="$!"))return e}else if(e.tag===19&&e.memoizedProps.revealOrder!==void 0){if(e.flags&128)return e}else if(e.child!==null){e.child.return=e,e=e.child;continue}if(e===t)break;for(;e.sibling===null;){if(e.return===null||e.return===t)return null;e=e.return}e.sibling.return=e.return,e=e.sibling}return null}var Cy=[];function v1(){for(var t=0;t<Cy.length;t++)Cy[t]._workInProgressVersionPrimary=null;Cy.length=0}var Cf=ro.ReactCurrentDispatcher,_y=ro.ReactCurrentBatchConfig,aa=0,it=null,vt=null,Et=null,Lp=!1,hu=!1,Fu=0,w8=0;function Vt(){throw Error(G(321))}function w1(t,e){if(e===null)return!1;for(var n=0;n<e.length&&n<t.length;n++)if(!Wr(t[n],e[n]))return!1;return!0}function S1(t,e,n,r,s,o){if(aa=o,it=e,e.memoizedState=null,e.updateQueue=null,e.lanes=0,Cf.current=t===null||t.memoizedState===null?C8:_8,t=n(r,s),hu){o=0;do{if(hu=!1,Fu=0,25<=o)throw Error(G(301));o+=1,Et=vt=null,e.updateQueue=null,Cf.current=E8,t=n(r,s)}while(hu)}if(Cf.current=jp,e=vt!==null&&vt.next!==null,aa=0,Et=vt=it=null,Lp=!1,e)throw Error(G(300));return t}function x1(){var t=Fu!==0;return Fu=0,t}function Jr(){var t={memoizedState:null,baseState:null,baseQueue:null,queue:null,next:null};return Et===null?it.memoizedState=Et=t:Et=Et.next=t,Et}function Sr(){if(vt===null){var t=it.alternate;t=t!==null?t.memoizedState:null}else t=vt.next;var e=Et===null?it.memoizedState:Et.next;if(e!==null)Et=e,vt=t;else{if(t===null)throw Error(G(310));vt=t,t={memoizedState:vt.memoizedState,baseState:vt.baseState,baseQueue:vt.baseQueue,queue:vt.queue,next:null},Et===null?it.memoizedState=Et=t:Et=Et.next=t}return Et}function Bu(t,e){return typeof e=="function"?e(t):e}function Ey(t){var e=Sr(),n=e.queue;if(n===null)throw Error(G(311));n.lastRenderedReducer=t;var r=vt,s=r.baseQueue,o=n.pending;if(o!==null){if(s!==null){var i=s.next;s.next=o.next,o.next=i}r.baseQueue=s=o,n.pending=null}if(s!==null){o=s.next,r=r.baseState;var a=i=null,c=null,l=o;do{var u=l.lane;if((aa&u)===u)c!==null&&(c=c.next={lane:0,action:l.action,hasEagerState:l.hasEagerState,eagerState:l.eagerState,next:null}),r=l.hasEagerState?l.eagerState:t(r,l.action);else{var d={lane:u,action:l.action,hasEagerState:l.hasEagerState,eagerState:l.eagerState,next:null};c===null?(a=c=d,i=r):c=c.next=d,it.lanes|=u,ca|=u}l=l.next}while(l!==null&&l!==o);c===null?i=r:c.next=a,Wr(r,e.memoizedState)||(bn=!0),e.memoizedState=r,e.baseState=i,e.baseQueue=c,n.lastRenderedState=r}if(t=n.interleaved,t!==null){s=t;do o=s.lane,it.lanes|=o,ca|=o,s=s.next;while(s!==t)}else s===null&&(n.lanes=0);return[e.memoizedState,n.dispatch]}function Py(t){var e=Sr(),n=e.queue;if(n===null)throw Error(G(311));n.lastRenderedReducer=t;var r=n.dispatch,s=n.pending,o=e.memoizedState;if(s!==null){n.pending=null;var i=s=s.next;do o=t(o,i.action),i=i.next;while(i!==s);Wr(o,e.memoizedState)||(bn=!0),e.memoizedState=o,e.baseQueue===null&&(e.baseState=o),n.lastRenderedState=o}return[o,r]}function o$(){}function i$(t,e){var n=it,r=Sr(),s=e(),o=!Wr(r.memoizedState,s);if(o&&(r.memoizedState=s,bn=!0),r=r.queue,b1(l$.bind(null,n,r,t),[t]),r.getSnapshot!==e||o||Et!==null&&Et.memoizedState.tag&1){if(n.flags|=2048,Uu(9,c$.bind(null,n,r,s,e),void 0,null),kt===null)throw Error(G(349));aa&30||a$(n,e,s)}return s}function a$(t,e,n){t.flags|=16384,t={getSnapshot:e,value:n},e=it.updateQueue,e===null?(e={lastEffect:null,stores:null},it.updateQueue=e,e.stores=[t]):(n=e.stores,n===null?e.stores=[t]:n.push(t))}function c$(t,e,n,r){e.value=n,e.getSnapshot=r,u$(e)&&d$(t)}function l$(t,e,n){return n(function(){u$(e)&&d$(t)})}function u$(t){var e=t.getSnapshot;t=t.value;try{var n=e();return!Wr(t,n)}catch{return!0}}function d$(t){var e=Qs(t,1);e!==null&&Br(e,t,1,-1)}function oC(t){var e=Jr();return typeof t=="function"&&(t=t()),e.memoizedState=e.baseState=t,t={pending:null,interleaved:null,lanes:0,dispatch:null,lastRenderedReducer:Bu,lastRenderedState:t},e.queue=t,t=t.dispatch=b8.bind(null,it,t),[e.memoizedState,t]}function Uu(t,e,n,r){return t={tag:t,create:e,destroy:n,deps:r,next:null},e=it.updateQueue,e===null?(e={lastEffect:null,stores:null},it.updateQueue=e,e.lastEffect=t.next=t):(n=e.lastEffect,n===null?e.lastEffect=t.next=t:(r=n.next,n.next=t,t.next=r,e.lastEffect=t)),t}function h$(){return Sr().memoizedState}function _f(t,e,n,r){var s=Jr();it.flags|=t,s.memoizedState=Uu(1|e,n,void 0,r===void 0?null:r)}function qg(t,e,n,r){var s=Sr();r=r===void 0?null:r;var o=void 0;if(vt!==null){var i=vt.memoizedState;if(o=i.destroy,r!==null&&w1(r,i.deps)){s.memoizedState=Uu(e,n,o,r);return}}it.flags|=t,s.memoizedState=Uu(1|e,n,o,r)}function iC(t,e){return _f(8390656,8,t,e)}function b1(t,e){return qg(2048,8,t,e)}function f$(t,e){return qg(4,2,t,e)}function p$(t,e){return qg(4,4,t,e)}function g$(t,e){if(typeof e=="function")return t=t(),e(t),function(){e(null)};if(e!=null)return t=t(),e.current=t,function(){e.current=null}}function m$(t,e,n){return n=n!=null?n.concat([t]):null,qg(4,4,g$.bind(null,e,t),n)}function C1(){}function y$(t,e){var n=Sr();e=e===void 0?null:e;var r=n.memoizedState;return r!==null&&e!==null&&w1(e,r[1])?r[0]:(n.memoizedState=[t,e],t)}function v$(t,e){var n=Sr();e=e===void 0?null:e;var r=n.memoizedState;return r!==null&&e!==null&&w1(e,r[1])?r[0]:(t=t(),n.memoizedState=[t,e],t)}function w$(t,e,n){return aa&21?(Wr(n,e)||(n=bI(),it.lanes|=n,ca|=n,t.baseState=!0),e):(t.baseState&&(t.baseState=!1,bn=!0),t.memoizedState=n)}function S8(t,e){var n=De;De=n!==0&&4>n?n:4,t(!0);var r=_y.transition;_y.transition={};try{t(!1),e()}finally{De=n,_y.transition=r}}function S$(){return Sr().memoizedState}function x8(t,e,n){var r=qo(t);if(n={lane:r,action:n,hasEagerState:!1,eagerState:null,next:null},x$(t))b$(e,n);else if(n=ZI(t,e,n,r),n!==null){var s=fn();Br(n,t,r,s),C$(n,e,r)}}function b8(t,e,n){var r=qo(t),s={lane:r,action:n,hasEagerState:!1,eagerState:null,next:null};if(x$(t))b$(e,s);else{var o=t.alternate;if(t.lanes===0&&(o===null||o.lanes===0)&&(o=e.lastRenderedReducer,o!==null))try{var i=e.lastRenderedState,a=o(i,n);if(s.hasEagerState=!0,s.eagerState=a,Wr(a,i)){var c=e.interleaved;c===null?(s.next=s,p1(e)):(s.next=c.next,c.next=s),e.interleaved=s;return}}catch{}finally{}n=ZI(t,e,s,r),n!==null&&(s=fn(),Br(n,t,r,s),C$(n,e,r))}}function x$(t){var e=t.alternate;return t===it||e!==null&&e===it}function b$(t,e){hu=Lp=!0;var n=t.pending;n===null?e.next=e:(e.next=n.next,n.next=e),t.pending=e}function C$(t,e,n){if(n&4194240){var r=e.lanes;r&=t.pendingLanes,n|=r,e.lanes=n,e1(t,n)}}var jp={readContext:wr,useCallback:Vt,useContext:Vt,useEffect:Vt,useImperativeHandle:Vt,useInsertionEffect:Vt,useLayoutEffect:Vt,useMemo:Vt,useReducer:Vt,useRef:Vt,useState:Vt,useDebugValue:Vt,useDeferredValue:Vt,useTransition:Vt,useMutableSource:Vt,useSyncExternalStore:Vt,useId:Vt,unstable_isNewReconciler:!1},C8={readContext:wr,useCallback:function(t,e){return Jr().memoizedState=[t,e===void 0?null:e],t},useContext:wr,useEffect:iC,useImperativeHandle:function(t,e,n){return n=n!=null?n.concat([t]):null,_f(4194308,4,g$.bind(null,e,t),n)},useLayoutEffect:function(t,e){return _f(4194308,4,t,e)},useInsertionEffect:function(t,e){return _f(4,2,t,e)},useMemo:function(t,e){var n=Jr();return e=e===void 0?null:e,t=t(),n.memoizedState=[t,e],t},useReducer:function(t,e,n){var r=Jr();return e=n!==void 0?n(e):e,r.memoizedState=r.baseState=e,t={pending:null,interleaved:null,lanes:0,dispatch:null,lastRenderedReducer:t,lastRenderedState:e},r.queue=t,t=t.dispatch=x8.bind(null,it,t),[r.memoizedState,t]},useRef:function(t){var e=Jr();return t={current:t},e.memoizedState=t},useState:oC,useDebugValue:C1,useDeferredValue:function(t){return Jr().memoizedState=t},useTransition:function(){var t=oC(!1),e=t[0];return t=S8.bind(null,t[1]),Jr().memoizedState=t,[e,t]},useMutableSource:function(){},useSyncExternalStore:function(t,e,n){var r=it,s=Jr();if(Qe){if(n===void 0)throw Error(G(407));n=n()}else{if(n=e(),kt===null)throw Error(G(349));aa&30||a$(r,e,n)}s.memoizedState=n;var o={value:n,getSnapshot:e};return s.queue=o,iC(l$.bind(null,r,o,t),[t]),r.flags|=2048,Uu(9,c$.bind(null,r,o,n,e),void 0,null),n},useId:function(){var t=Jr(),e=kt.identifierPrefix;if(Qe){var n=js,r=Ls;n=(r&~(1<<32-Fr(r)-1)).toString(32)+n,e=":"+e+"R"+n,n=Fu++,0<n&&(e+="H"+n.toString(32)),e+=":"}else n=w8++,e=":"+e+"r"+n.toString(32)+":";return t.memoizedState=e},unstable_isNewReconciler:!1},_8={readContext:wr,useCallback:y$,useContext:wr,useEffect:b1,useImperativeHandle:m$,useInsertionEffect:f$,useLayoutEffect:p$,useMemo:v$,useReducer:Ey,useRef:h$,useState:function(){return Ey(Bu)},useDebugValue:C1,useDeferredValue:function(t){var e=Sr();return w$(e,vt.memoizedState,t)},useTransition:function(){var t=Ey(Bu)[0],e=Sr().memoizedState;return[t,e]},useMutableSource:o$,useSyncExternalStore:i$,useId:S$,unstable_isNewReconciler:!1},E8={readContext:wr,useCallback:y$,useContext:wr,useEffect:b1,useImperativeHandle:m$,useInsertionEffect:f$,useLayoutEffect:p$,useMemo:v$,useReducer:Py,useRef:h$,useState:function(){return Py(Bu)},useDebugValue:C1,useDeferredValue:function(t){var e=Sr();return vt===null?e.memoizedState=t:w$(e,vt.memoizedState,t)},useTransition:function(){var t=Py(Bu)[0],e=Sr().memoizedState;return[t,e]},useMutableSource:o$,useSyncExternalStore:i$,useId:S$,unstable_isNewReconciler:!1};function Bc(t,e){try{var n="",r=e;do n+=JD(r),r=r.return;while(r);var s=n}catch(o){s=`
Error generating stack: `+o.message+`
`+o.stack}return{value:t,source:e,stack:s,digest:null}}function ky(t,e,n){return{value:t,source:null,stack:n??null,digest:e??null}}function uw(t,e){try{console.error(e.value)}catch(n){setTimeout(function(){throw n})}}var P8=typeof WeakMap=="function"?WeakMap:Map;function _$(t,e,n){n=zs(-1,n),n.tag=3,n.payload={element:null};var r=e.value;return n.callback=function(){zp||(zp=!0,Sw=r),uw(t,e)},n}function E$(t,e,n){n=zs(-1,n),n.tag=3;var r=t.type.getDerivedStateFromError;if(typeof r=="function"){var s=e.value;n.payload=function(){return r(s)},n.callback=function(){uw(t,e)}}var o=t.stateNode;return o!==null&&typeof o.componentDidCatch=="function"&&(n.callback=function(){uw(t,e),typeof r!="function"&&(Xo===null?Xo=new Set([this]):Xo.add(this));var i=e.stack;this.componentDidCatch(e.value,{componentStack:i!==null?i:""})}),n}function aC(t,e,n){var r=t.pingCache;if(r===null){r=t.pingCache=new P8;var s=new Set;r.set(e,s)}else s=r.get(e),s===void 0&&(s=new Set,r.set(e,s));s.has(n)||(s.add(n),t=F8.bind(null,t,e,n),e.then(t,t))}function cC(t){do{var e;if((e=t.tag===13)&&(e=t.memoizedState,e=e!==null?e.dehydrated!==null:!0),e)return t;t=t.return}while(t!==null);return null}function lC(t,e,n,r,s){return t.mode&1?(t.flags|=65536,t.lanes=s,t):(t===e?t.flags|=65536:(t.flags|=128,n.flags|=131072,n.flags&=-52805,n.tag===1&&(n.alternate===null?n.tag=17:(e=zs(-1,1),e.tag=2,Yo(n,e,1))),n.lanes|=1),t)}var k8=ro.ReactCurrentOwner,bn=!1;function dn(t,e,n,r){e.child=t===null?r$(e,null,n,r):zc(e,t.child,n,r)}function uC(t,e,n,r,s){n=n.render;var o=e.ref;return Pc(e,s),r=S1(t,e,n,r,o,s),n=x1(),t!==null&&!bn?(e.updateQueue=t.updateQueue,e.flags&=-2053,t.lanes&=~s,Zs(t,e,s)):(Qe&&n&&c1(e),e.flags|=1,dn(t,e,r,s),e.child)}function dC(t,e,n,r,s){if(t===null){var o=n.type;return typeof o=="function"&&!A1(o)&&o.defaultProps===void 0&&n.compare===null&&n.defaultProps===void 0?(e.tag=15,e.type=o,P$(t,e,o,r,s)):(t=If(n.type,null,r,e,e.mode,s),t.ref=e.ref,t.return=e,e.child=t)}if(o=t.child,!(t.lanes&s)){var i=o.memoizedProps;if(n=n.compare,n=n!==null?n:Du,n(i,r)&&t.ref===e.ref)return Zs(t,e,s)}return e.flags|=1,t=Qo(o,r),t.ref=e.ref,t.return=e,e.child=t}function P$(t,e,n,r,s){if(t!==null){var o=t.memoizedProps;if(Du(o,r)&&t.ref===e.ref)if(bn=!1,e.pendingProps=r=o,(t.lanes&s)!==0)t.flags&131072&&(bn=!0);else return e.lanes=t.lanes,Zs(t,e,s)}return dw(t,e,n,r,s)}function k$(t,e,n){var r=e.pendingProps,s=r.children,o=t!==null?t.memoizedState:null;if(r.mode==="hidden")if(!(e.mode&1))e.memoizedState={baseLanes:0,cachePool:null,transitions:null},He(gc,Nn),Nn|=n;else{if(!(n&1073741824))return t=o!==null?o.baseLanes|n:n,e.lanes=e.childLanes=1073741824,e.memoizedState={baseLanes:t,cachePool:null,transitions:null},e.updateQueue=null,He(gc,Nn),Nn|=t,null;e.memoizedState={baseLanes:0,cachePool:null,transitions:null},r=o!==null?o.baseLanes:n,He(gc,Nn),Nn|=r}else o!==null?(r=o.baseLanes|n,e.memoizedState=null):r=n,He(gc,Nn),Nn|=r;return dn(t,e,s,n),e.child}function I$(t,e){var n=e.ref;(t===null&&n!==null||t!==null&&t.ref!==n)&&(e.flags|=512,e.flags|=2097152)}function dw(t,e,n,r,s){var o=En(n)?oa:nn.current;return o=jc(e,o),Pc(e,s),n=S1(t,e,n,r,o,s),r=x1(),t!==null&&!bn?(e.updateQueue=t.updateQueue,e.flags&=-2053,t.lanes&=~s,Zs(t,e,s)):(Qe&&r&&c1(e),e.flags|=1,dn(t,e,n,s),e.child)}function hC(t,e,n,r,s){if(En(n)){var o=!0;$p(e)}else o=!1;if(Pc(e,s),e.stateNode===null)Ef(t,e),t$(e,n,r),lw(e,n,r,s),r=!0;else if(t===null){var i=e.stateNode,a=e.memoizedProps;i.props=a;var c=i.context,l=n.contextType;typeof l=="object"&&l!==null?l=wr(l):(l=En(n)?oa:nn.current,l=jc(e,l));var u=n.getDerivedStateFromProps,d=typeof u=="function"||typeof i.getSnapshotBeforeUpdate=="function";d||typeof i.UNSAFE_componentWillReceiveProps!="function"&&typeof i.componentWillReceiveProps!="function"||(a!==r||c!==l)&&rC(e,i,r,l),To=!1;var h=e.memoizedState;i.state=h,Dp(e,r,i,s),c=e.memoizedState,a!==r||h!==c||_n.current||To?(typeof u=="function"&&(cw(e,n,u,r),c=e.memoizedState),(a=To||nC(e,n,a,r,h,c,l))?(d||typeof i.UNSAFE_componentWillMount!="function"&&typeof i.componentWillMount!="function"||(typeof i.componentWillMount=="function"&&i.componentWillMount(),typeof i.UNSAFE_componentWillMount=="function"&&i.UNSAFE_componentWillMount()),typeof i.componentDidMount=="function"&&(e.flags|=4194308)):(typeof i.componentDidMount=="function"&&(e.flags|=4194308),e.memoizedProps=r,e.memoizedState=c),i.props=r,i.state=c,i.context=l,r=a):(typeof i.componentDidMount=="function"&&(e.flags|=4194308),r=!1)}else{i=e.stateNode,JI(t,e),a=e.memoizedProps,l=e.type===e.elementType?a:Tr(e.type,a),i.props=l,d=e.pendingProps,h=i.context,c=n.contextType,typeof c=="object"&&c!==null?c=wr(c):(c=En(n)?oa:nn.current,c=jc(e,c));var f=n.getDerivedStateFromProps;(u=typeof f=="function"||typeof i.getSnapshotBeforeUpdate=="function")||typeof i.UNSAFE_componentWillReceiveProps!="function"&&typeof i.componentWillReceiveProps!="function"||(a!==d||h!==c)&&rC(e,i,r,c),To=!1,h=e.memoizedState,i.state=h,Dp(e,r,i,s);var p=e.memoizedState;a!==d||h!==p||_n.current||To?(typeof f=="function"&&(cw(e,n,f,r),p=e.memoizedState),(l=To||nC(e,n,l,r,h,p,c)||!1)?(u||typeof i.UNSAFE_componentWillUpdate!="function"&&typeof i.componentWillUpdate!="function"||(typeof i.componentWillUpdate=="function"&&i.componentWillUpdate(r,p,c),typeof i.UNSAFE_componentWillUpdate=="function"&&i.UNSAFE_componentWillUpdate(r,p,c)),typeof i.componentDidUpdate=="function"&&(e.flags|=4),typeof i.getSnapshotBeforeUpdate=="function"&&(e.flags|=1024)):(typeof i.componentDidUpdate!="function"||a===t.memoizedProps&&h===t.memoizedState||(e.flags|=4),typeof i.getSnapshotBeforeUpdate!="function"||a===t.memoizedProps&&h===t.memoizedState||(e.flags|=1024),e.memoizedProps=r,e.memoizedState=p),i.props=r,i.state=p,i.context=c,r=l):(typeof i.componentDidUpdate!="function"||a===t.memoizedProps&&h===t.memoizedState||(e.flags|=4),typeof i.getSnapshotBeforeUpdate!="function"||a===t.memoizedProps&&h===t.memoizedState||(e.flags|=1024),r=!1)}return hw(t,e,n,r,o,s)}function hw(t,e,n,r,s,o){I$(t,e);var i=(e.flags&128)!==0;if(!r&&!i)return s&&Q2(e,n,!1),Zs(t,e,o);r=e.stateNode,k8.current=e;var a=i&&typeof n.getDerivedStateFromError!="function"?null:r.render();return e.flags|=1,t!==null&&i?(e.child=zc(e,t.child,null,o),e.child=zc(e,null,a,o)):dn(t,e,a,o),e.memoizedState=r.state,s&&Q2(e,n,!0),e.child}function $$(t){var e=t.stateNode;e.pendingContext?q2(t,e.pendingContext,e.pendingContext!==e.context):e.context&&q2(t,e.context,!1),m1(t,e.containerInfo)}function fC(t,e,n,r,s){return Nc(),u1(s),e.flags|=256,dn(t,e,n,r),e.child}var fw={dehydrated:null,treeContext:null,retryLane:0};function pw(t){return{baseLanes:t,cachePool:null,transitions:null}}function T$(t,e,n){var r=e.pendingProps,s=st.current,o=!1,i=(e.flags&128)!==0,a;if((a=i)||(a=t!==null&&t.memoizedState===null?!1:(s&2)!==0),a?(o=!0,e.flags&=-129):(t===null||t.memoizedState!==null)&&(s|=1),He(st,s&1),t===null)return iw(e),t=e.memoizedState,t!==null&&(t=t.dehydrated,t!==null)?(e.mode&1?t.data==="$!"?e.lanes=8:e.lanes=1073741824:e.lanes=1,null):(i=r.children,t=r.fallback,o?(r=e.mode,o=e.child,i={mode:"hidden",children:i},!(r&1)&&o!==null?(o.childLanes=0,o.pendingProps=i):o=Jg(i,r,0,null),t=qi(t,r,n,null),o.return=e,t.return=e,o.sibling=t,e.child=o,e.child.memoizedState=pw(n),e.memoizedState=fw,t):_1(e,i));if(s=t.memoizedState,s!==null&&(a=s.dehydrated,a!==null))return I8(t,e,i,r,a,s,n);if(o){o=r.fallback,i=e.mode,s=t.child,a=s.sibling;var c={mode:"hidden",children:r.children};return!(i&1)&&e.child!==s?(r=e.child,r.childLanes=0,r.pendingProps=c,e.deletions=null):(r=Qo(s,c),r.subtreeFlags=s.subtreeFlags&14680064),a!==null?o=Qo(a,o):(o=qi(o,i,n,null),o.flags|=2),o.return=e,r.return=e,r.sibling=o,e.child=r,r=o,o=e.child,i=t.child.memoizedState,i=i===null?pw(n):{baseLanes:i.baseLanes|n,cachePool:null,transitions:i.transitions},o.memoizedState=i,o.childLanes=t.childLanes&~n,e.memoizedState=fw,r}return o=t.child,t=o.sibling,r=Qo(o,{mode:"visible",children:r.children}),!(e.mode&1)&&(r.lanes=n),r.return=e,r.sibling=null,t!==null&&(n=e.deletions,n===null?(e.deletions=[t],e.flags|=16):n.push(t)),e.child=r,e.memoizedState=null,r}function _1(t,e){return e=Jg({mode:"visible",children:e},t.mode,0,null),e.return=t,t.child=e}function kh(t,e,n,r){return r!==null&&u1(r),zc(e,t.child,null,n),t=_1(e,e.pendingProps.children),t.flags|=2,e.memoizedState=null,t}function I8(t,e,n,r,s,o,i){if(n)return e.flags&256?(e.flags&=-257,r=ky(Error(G(422))),kh(t,e,i,r)):e.memoizedState!==null?(e.child=t.child,e.flags|=128,null):(o=r.fallback,s=e.mode,r=Jg({mode:"visible",children:r.children},s,0,null),o=qi(o,s,i,null),o.flags|=2,r.return=e,o.return=e,r.sibling=o,e.child=r,e.mode&1&&zc(e,t.child,null,i),e.child.memoizedState=pw(i),e.memoizedState=fw,o);if(!(e.mode&1))return kh(t,e,i,null);if(s.data==="$!"){if(r=s.nextSibling&&s.nextSibling.dataset,r)var a=r.dgst;return r=a,o=Error(G(419)),r=ky(o,r,void 0),kh(t,e,i,r)}if(a=(i&t.childLanes)!==0,bn||a){if(r=kt,r!==null){switch(i&-i){case 4:s=2;break;case 16:s=8;break;case 64:case 128:case 256:case 512:case 1024:case 2048:case 4096:case 8192:case 16384:case 32768:case 65536:case 131072:case 262144:case 524288:case 1048576:case 2097152:case 4194304:case 8388608:case 16777216:case 33554432:case 67108864:s=32;break;case 536870912:s=268435456;break;default:s=0}s=s&(r.suspendedLanes|i)?0:s,s!==0&&s!==o.retryLane&&(o.retryLane=s,Qs(t,s),Br(r,t,s,-1))}return T1(),r=ky(Error(G(421))),kh(t,e,i,r)}return s.data==="$?"?(e.flags|=128,e.child=t.child,e=B8.bind(null,t),s._reactRetry=e,null):(t=o.treeContext,Kn=Go(s.nextSibling),Wn=e,Qe=!0,Dr=null,t!==null&&(cr[lr++]=Ls,cr[lr++]=js,cr[lr++]=ia,Ls=t.id,js=t.overflow,ia=e),e=_1(e,r.children),e.flags|=4096,e)}function pC(t,e,n){t.lanes|=e;var r=t.alternate;r!==null&&(r.lanes|=e),aw(t.return,e,n)}function Iy(t,e,n,r,s){var o=t.memoizedState;o===null?t.memoizedState={isBackwards:e,rendering:null,renderingStartTime:0,last:r,tail:n,tailMode:s}:(o.isBackwards=e,o.rendering=null,o.renderingStartTime=0,o.last=r,o.tail=n,o.tailMode=s)}function A$(t,e,n){var r=e.pendingProps,s=r.revealOrder,o=r.tail;if(dn(t,e,r.children,n),r=st.current,r&2)r=r&1|2,e.flags|=128;else{if(t!==null&&t.flags&128)e:for(t=e.child;t!==null;){if(t.tag===13)t.memoizedState!==null&&pC(t,n,e);else if(t.tag===19)pC(t,n,e);else if(t.child!==null){t.child.return=t,t=t.child;continue}if(t===e)break e;for(;t.sibling===null;){if(t.return===null||t.return===e)break e;t=t.return}t.sibling.return=t.return,t=t.sibling}r&=1}if(He(st,r),!(e.mode&1))e.memoizedState=null;else switch(s){case"forwards":for(n=e.child,s=null;n!==null;)t=n.alternate,t!==null&&Rp(t)===null&&(s=n),n=n.sibling;n=s,n===null?(s=e.child,e.child=null):(s=n.sibling,n.sibling=null),Iy(e,!1,s,n,o);break;case"backwards":for(n=null,s=e.child,e.child=null;s!==null;){if(t=s.alternate,t!==null&&Rp(t)===null){e.child=s;break}t=s.sibling,s.sibling=n,n=s,s=t}Iy(e,!0,n,null,o);break;case"together":Iy(e,!1,null,null,void 0);break;default:e.memoizedState=null}return e.child}function Ef(t,e){!(e.mode&1)&&t!==null&&(t.alternate=null,e.alternate=null,e.flags|=2)}function Zs(t,e,n){if(t!==null&&(e.dependencies=t.dependencies),ca|=e.lanes,!(n&e.childLanes))return null;if(t!==null&&e.child!==t.child)throw Error(G(153));if(e.child!==null){for(t=e.child,n=Qo(t,t.pendingProps),e.child=n,n.return=e;t.sibling!==null;)t=t.sibling,n=n.sibling=Qo(t,t.pendingProps),n.return=e;n.sibling=null}return e.child}function $8(t,e,n){switch(e.tag){case 3:$$(e),Nc();break;case 5:s$(e);break;case 1:En(e.type)&&$p(e);break;case 4:m1(e,e.stateNode.containerInfo);break;case 10:var r=e.type._context,s=e.memoizedProps.value;He(Mp,r._currentValue),r._currentValue=s;break;case 13:if(r=e.memoizedState,r!==null)return r.dehydrated!==null?(He(st,st.current&1),e.flags|=128,null):n&e.child.childLanes?T$(t,e,n):(He(st,st.current&1),t=Zs(t,e,n),t!==null?t.sibling:null);He(st,st.current&1);break;case 19:if(r=(n&e.childLanes)!==0,t.flags&128){if(r)return A$(t,e,n);e.flags|=128}if(s=e.memoizedState,s!==null&&(s.rendering=null,s.tail=null,s.lastEffect=null),He(st,st.current),r)break;return null;case 22:case 23:return e.lanes=0,k$(t,e,n)}return Zs(t,e,n)}var M$,gw,O$,D$;M$=function(t,e){for(var n=e.child;n!==null;){if(n.tag===5||n.tag===6)t.appendChild(n.stateNode);else if(n.tag!==4&&n.child!==null){n.child.return=n,n=n.child;continue}if(n===e)break;for(;n.sibling===null;){if(n.return===null||n.return===e)return;n=n.return}n.sibling.return=n.return,n=n.sibling}};gw=function(){};O$=function(t,e,n,r){var s=t.memoizedProps;if(s!==r){t=e.stateNode,Bi(as.current);var o=null;switch(n){case"input":s=jv(t,s),r=jv(t,r),o=[];break;case"select":s=at({},s,{value:void 0}),r=at({},r,{value:void 0}),o=[];break;case"textarea":s=Fv(t,s),r=Fv(t,r),o=[];break;default:typeof s.onClick!="function"&&typeof r.onClick=="function"&&(t.onclick=kp)}Uv(n,r);var i;n=null;for(l in s)if(!r.hasOwnProperty(l)&&s.hasOwnProperty(l)&&s[l]!=null)if(l==="style"){var a=s[l];for(i in a)a.hasOwnProperty(i)&&(n||(n={}),n[i]="")}else l!=="dangerouslySetInnerHTML"&&l!=="children"&&l!=="suppressContentEditableWarning"&&l!=="suppressHydrationWarning"&&l!=="autoFocus"&&(ku.hasOwnProperty(l)?o||(o=[]):(o=o||[]).push(l,null));for(l in r){var c=r[l];if(a=s!=null?s[l]:void 0,r.hasOwnProperty(l)&&c!==a&&(c!=null||a!=null))if(l==="style")if(a){for(i in a)!a.hasOwnProperty(i)||c&&c.hasOwnProperty(i)||(n||(n={}),n[i]="");for(i in c)c.hasOwnProperty(i)&&a[i]!==c[i]&&(n||(n={}),n[i]=c[i])}else n||(o||(o=[]),o.push(l,n)),n=c;else l==="dangerouslySetInnerHTML"?(c=c?c.__html:void 0,a=a?a.__html:void 0,c!=null&&a!==c&&(o=o||[]).push(l,c)):l==="children"?typeof c!="string"&&typeof c!="number"||(o=o||[]).push(l,""+c):l!=="suppressContentEditableWarning"&&l!=="suppressHydrationWarning"&&(ku.hasOwnProperty(l)?(c!=null&&l==="onScroll"&&We("scroll",t),o||a===c||(o=[])):(o=o||[]).push(l,c))}n&&(o=o||[]).push("style",n);var l=o;(e.updateQueue=l)&&(e.flags|=4)}};D$=function(t,e,n,r){n!==r&&(e.flags|=4)};function Ol(t,e){if(!Qe)switch(t.tailMode){case"hidden":e=t.tail;for(var n=null;e!==null;)e.alternate!==null&&(n=e),e=e.sibling;n===null?t.tail=null:n.sibling=null;break;case"collapsed":n=t.tail;for(var r=null;n!==null;)n.alternate!==null&&(r=n),n=n.sibling;r===null?e||t.tail===null?t.tail=null:t.tail.sibling=null:r.sibling=null}}function Wt(t){var e=t.alternate!==null&&t.alternate.child===t.child,n=0,r=0;if(e)for(var s=t.child;s!==null;)n|=s.lanes|s.childLanes,r|=s.subtreeFlags&14680064,r|=s.flags&14680064,s.return=t,s=s.sibling;else for(s=t.child;s!==null;)n|=s.lanes|s.childLanes,r|=s.subtreeFlags,r|=s.flags,s.return=t,s=s.sibling;return t.subtreeFlags|=r,t.childLanes=n,e}function T8(t,e,n){var r=e.pendingProps;switch(l1(e),e.tag){case 2:case 16:case 15:case 0:case 11:case 7:case 8:case 12:case 9:case 14:return Wt(e),null;case 1:return En(e.type)&&Ip(),Wt(e),null;case 3:return r=e.stateNode,Fc(),Ge(_n),Ge(nn),v1(),r.pendingContext&&(r.context=r.pendingContext,r.pendingContext=null),(t===null||t.child===null)&&(Eh(e)?e.flags|=4:t===null||t.memoizedState.isDehydrated&&!(e.flags&256)||(e.flags|=1024,Dr!==null&&(Cw(Dr),Dr=null))),gw(t,e),Wt(e),null;case 5:y1(e);var s=Bi(zu.current);if(n=e.type,t!==null&&e.stateNode!=null)O$(t,e,n,r,s),t.ref!==e.ref&&(e.flags|=512,e.flags|=2097152);else{if(!r){if(e.stateNode===null)throw Error(G(166));return Wt(e),null}if(t=Bi(as.current),Eh(e)){r=e.stateNode,n=e.type;var o=e.memoizedProps;switch(r[ns]=e,r[ju]=o,t=(e.mode&1)!==0,n){case"dialog":We("cancel",r),We("close",r);break;case"iframe":case"object":case"embed":We("load",r);break;case"video":case"audio":for(s=0;s<nu.length;s++)We(nu[s],r);break;case"source":We("error",r);break;case"img":case"image":case"link":We("error",r),We("load",r);break;case"details":We("toggle",r);break;case"input":C2(r,o),We("invalid",r);break;case"select":r._wrapperState={wasMultiple:!!o.multiple},We("invalid",r);break;case"textarea":E2(r,o),We("invalid",r)}Uv(n,o),s=null;for(var i in o)if(o.hasOwnProperty(i)){var a=o[i];i==="children"?typeof a=="string"?r.textContent!==a&&(o.suppressHydrationWarning!==!0&&_h(r.textContent,a,t),s=["children",a]):typeof a=="number"&&r.textContent!==""+a&&(o.suppressHydrationWarning!==!0&&_h(r.textContent,a,t),s=["children",""+a]):ku.hasOwnProperty(i)&&a!=null&&i==="onScroll"&&We("scroll",r)}switch(n){case"input":mh(r),_2(r,o,!0);break;case"textarea":mh(r),P2(r);break;case"select":case"option":break;default:typeof o.onClick=="function"&&(r.onclick=kp)}r=s,e.updateQueue=r,r!==null&&(e.flags|=4)}else{i=s.nodeType===9?s:s.ownerDocument,t==="http://www.w3.org/1999/xhtml"&&(t=aI(n)),t==="http://www.w3.org/1999/xhtml"?n==="script"?(t=i.createElement("div"),t.innerHTML="<script><\/script>",t=t.removeChild(t.firstChild)):typeof r.is=="string"?t=i.createElement(n,{is:r.is}):(t=i.createElement(n),n==="select"&&(i=t,r.multiple?i.multiple=!0:r.size&&(i.size=r.size))):t=i.createElementNS(t,n),t[ns]=e,t[ju]=r,M$(t,e,!1,!1),e.stateNode=t;e:{switch(i=Hv(n,r),n){case"dialog":We("cancel",t),We("close",t),s=r;break;case"iframe":case"object":case"embed":We("load",t),s=r;break;case"video":case"audio":for(s=0;s<nu.length;s++)We(nu[s],t);s=r;break;case"source":We("error",t),s=r;break;case"img":case"image":case"link":We("error",t),We("load",t),s=r;break;case"details":We("toggle",t),s=r;break;case"input":C2(t,r),s=jv(t,r),We("invalid",t);break;case"option":s=r;break;case"select":t._wrapperState={wasMultiple:!!r.multiple},s=at({},r,{value:void 0}),We("invalid",t);break;case"textarea":E2(t,r),s=Fv(t,r),We("invalid",t);break;default:s=r}Uv(n,s),a=s;for(o in a)if(a.hasOwnProperty(o)){var c=a[o];o==="style"?uI(t,c):o==="dangerouslySetInnerHTML"?(c=c?c.__html:void 0,c!=null&&cI(t,c)):o==="children"?typeof c=="string"?(n!=="textarea"||c!=="")&&Iu(t,c):typeof c=="number"&&Iu(t,""+c):o!=="suppressContentEditableWarning"&&o!=="suppressHydrationWarning"&&o!=="autoFocus"&&(ku.hasOwnProperty(o)?c!=null&&o==="onScroll"&&We("scroll",t):c!=null&&YS(t,o,c,i))}switch(n){case"input":mh(t),_2(t,r,!1);break;case"textarea":mh(t),P2(t);break;case"option":r.value!=null&&t.setAttribute("value",""+ri(r.value));break;case"select":t.multiple=!!r.multiple,o=r.value,o!=null?bc(t,!!r.multiple,o,!1):r.defaultValue!=null&&bc(t,!!r.multiple,r.defaultValue,!0);break;default:typeof s.onClick=="function"&&(t.onclick=kp)}switch(n){case"button":case"input":case"select":case"textarea":r=!!r.autoFocus;break e;case"img":r=!0;break e;default:r=!1}}r&&(e.flags|=4)}e.ref!==null&&(e.flags|=512,e.flags|=2097152)}return Wt(e),null;case 6:if(t&&e.stateNode!=null)D$(t,e,t.memoizedProps,r);else{if(typeof r!="string"&&e.stateNode===null)throw Error(G(166));if(n=Bi(zu.current),Bi(as.current),Eh(e)){if(r=e.stateNode,n=e.memoizedProps,r[ns]=e,(o=r.nodeValue!==n)&&(t=Wn,t!==null))switch(t.tag){case 3:_h(r.nodeValue,n,(t.mode&1)!==0);break;case 5:t.memoizedProps.suppressHydrationWarning!==!0&&_h(r.nodeValue,n,(t.mode&1)!==0)}o&&(e.flags|=4)}else r=(n.nodeType===9?n:n.ownerDocument).createTextNode(r),r[ns]=e,e.stateNode=r}return Wt(e),null;case 13:if(Ge(st),r=e.memoizedState,t===null||t.memoizedState!==null&&t.memoizedState.dehydrated!==null){if(Qe&&Kn!==null&&e.mode&1&&!(e.flags&128))QI(),Nc(),e.flags|=98560,o=!1;else if(o=Eh(e),r!==null&&r.dehydrated!==null){if(t===null){if(!o)throw Error(G(318));if(o=e.memoizedState,o=o!==null?o.dehydrated:null,!o)throw Error(G(317));o[ns]=e}else Nc(),!(e.flags&128)&&(e.memoizedState=null),e.flags|=4;Wt(e),o=!1}else Dr!==null&&(Cw(Dr),Dr=null),o=!0;if(!o)return e.flags&65536?e:null}return e.flags&128?(e.lanes=n,e):(r=r!==null,r!==(t!==null&&t.memoizedState!==null)&&r&&(e.child.flags|=8192,e.mode&1&&(t===null||st.current&1?wt===0&&(wt=3):T1())),e.updateQueue!==null&&(e.flags|=4),Wt(e),null);case 4:return Fc(),gw(t,e),t===null&&Ru(e.stateNode.containerInfo),Wt(e),null;case 10:return f1(e.type._context),Wt(e),null;case 17:return En(e.type)&&Ip(),Wt(e),null;case 19:if(Ge(st),o=e.memoizedState,o===null)return Wt(e),null;if(r=(e.flags&128)!==0,i=o.rendering,i===null)if(r)Ol(o,!1);else{if(wt!==0||t!==null&&t.flags&128)for(t=e.child;t!==null;){if(i=Rp(t),i!==null){for(e.flags|=128,Ol(o,!1),r=i.updateQueue,r!==null&&(e.updateQueue=r,e.flags|=4),e.subtreeFlags=0,r=n,n=e.child;n!==null;)o=n,t=r,o.flags&=14680066,i=o.alternate,i===null?(o.childLanes=0,o.lanes=t,o.child=null,o.subtreeFlags=0,o.memoizedProps=null,o.memoizedState=null,o.updateQueue=null,o.dependencies=null,o.stateNode=null):(o.childLanes=i.childLanes,o.lanes=i.lanes,o.child=i.child,o.subtreeFlags=0,o.deletions=null,o.memoizedProps=i.memoizedProps,o.memoizedState=i.memoizedState,o.updateQueue=i.updateQueue,o.type=i.type,t=i.dependencies,o.dependencies=t===null?null:{lanes:t.lanes,firstContext:t.firstContext}),n=n.sibling;return He(st,st.current&1|2),e.child}t=t.sibling}o.tail!==null&&gt()>Uc&&(e.flags|=128,r=!0,Ol(o,!1),e.lanes=4194304)}else{if(!r)if(t=Rp(i),t!==null){if(e.flags|=128,r=!0,n=t.updateQueue,n!==null&&(e.updateQueue=n,e.flags|=4),Ol(o,!0),o.tail===null&&o.tailMode==="hidden"&&!i.alternate&&!Qe)return Wt(e),null}else 2*gt()-o.renderingStartTime>Uc&&n!==1073741824&&(e.flags|=128,r=!0,Ol(o,!1),e.lanes=4194304);o.isBackwards?(i.sibling=e.child,e.child=i):(n=o.last,n!==null?n.sibling=i:e.child=i,o.last=i)}return o.tail!==null?(e=o.tail,o.rendering=e,o.tail=e.sibling,o.renderingStartTime=gt(),e.sibling=null,n=st.current,He(st,r?n&1|2:n&1),e):(Wt(e),null);case 22:case 23:return $1(),r=e.memoizedState!==null,t!==null&&t.memoizedState!==null!==r&&(e.flags|=8192),r&&e.mode&1?Nn&1073741824&&(Wt(e),e.subtreeFlags&6&&(e.flags|=8192)):Wt(e),null;case 24:return null;case 25:return null}throw Error(G(156,e.tag))}function A8(t,e){switch(l1(e),e.tag){case 1:return En(e.type)&&Ip(),t=e.flags,t&65536?(e.flags=t&-65537|128,e):null;case 3:return Fc(),Ge(_n),Ge(nn),v1(),t=e.flags,t&65536&&!(t&128)?(e.flags=t&-65537|128,e):null;case 5:return y1(e),null;case 13:if(Ge(st),t=e.memoizedState,t!==null&&t.dehydrated!==null){if(e.alternate===null)throw Error(G(340));Nc()}return t=e.flags,t&65536?(e.flags=t&-65537|128,e):null;case 19:return Ge(st),null;case 4:return Fc(),null;case 10:return f1(e.type._context),null;case 22:case 23:return $1(),null;case 24:return null;default:return null}}var Ih=!1,qt=!1,M8=typeof WeakSet=="function"?WeakSet:Set,ee=null;function pc(t,e){var n=t.ref;if(n!==null)if(typeof n=="function")try{n(null)}catch(r){dt(t,e,r)}else n.current=null}function mw(t,e,n){try{n()}catch(r){dt(t,e,r)}}var gC=!1;function O8(t,e){if(Jv=_p,t=NI(),a1(t)){if("selectionStart"in t)var n={start:t.selectionStart,end:t.selectionEnd};else e:{n=(n=t.ownerDocument)&&n.defaultView||window;var r=n.getSelection&&n.getSelection();if(r&&r.rangeCount!==0){n=r.anchorNode;var s=r.anchorOffset,o=r.focusNode;r=r.focusOffset;try{n.nodeType,o.nodeType}catch{n=null;break e}var i=0,a=-1,c=-1,l=0,u=0,d=t,h=null;t:for(;;){for(var f;d!==n||s!==0&&d.nodeType!==3||(a=i+s),d!==o||r!==0&&d.nodeType!==3||(c=i+r),d.nodeType===3&&(i+=d.nodeValue.length),(f=d.firstChild)!==null;)h=d,d=f;for(;;){if(d===t)break t;if(h===n&&++l===s&&(a=i),h===o&&++u===r&&(c=i),(f=d.nextSibling)!==null)break;d=h,h=d.parentNode}d=f}n=a===-1||c===-1?null:{start:a,end:c}}else n=null}n=n||{start:0,end:0}}else n=null;for(ew={focusedElem:t,selectionRange:n},_p=!1,ee=e;ee!==null;)if(e=ee,t=e.child,(e.subtreeFlags&1028)!==0&&t!==null)t.return=e,ee=t;else for(;ee!==null;){e=ee;try{var p=e.alternate;if(e.flags&1024)switch(e.tag){case 0:case 11:case 15:break;case 1:if(p!==null){var m=p.memoizedProps,v=p.memoizedState,w=e.stateNode,x=w.getSnapshotBeforeUpdate(e.elementType===e.type?m:Tr(e.type,m),v);w.__reactInternalSnapshotBeforeUpdate=x}break;case 3:var b=e.stateNode.containerInfo;b.nodeType===1?b.textContent="":b.nodeType===9&&b.documentElement&&b.removeChild(b.documentElement);break;case 5:case 6:case 4:case 17:break;default:throw Error(G(163))}}catch(C){dt(e,e.return,C)}if(t=e.sibling,t!==null){t.return=e.return,ee=t;break}ee=e.return}return p=gC,gC=!1,p}function fu(t,e,n){var r=e.updateQueue;if(r=r!==null?r.lastEffect:null,r!==null){var s=r=r.next;do{if((s.tag&t)===t){var o=s.destroy;s.destroy=void 0,o!==void 0&&mw(e,n,o)}s=s.next}while(s!==r)}}function Qg(t,e){if(e=e.updateQueue,e=e!==null?e.lastEffect:null,e!==null){var n=e=e.next;do{if((n.tag&t)===t){var r=n.create;n.destroy=r()}n=n.next}while(n!==e)}}function yw(t){var e=t.ref;if(e!==null){var n=t.stateNode;switch(t.tag){case 5:t=n;break;default:t=n}typeof e=="function"?e(t):e.current=t}}function R$(t){var e=t.alternate;e!==null&&(t.alternate=null,R$(e)),t.child=null,t.deletions=null,t.sibling=null,t.tag===5&&(e=t.stateNode,e!==null&&(delete e[ns],delete e[ju],delete e[rw],delete e[g8],delete e[m8])),t.stateNode=null,t.return=null,t.dependencies=null,t.memoizedProps=null,t.memoizedState=null,t.pendingProps=null,t.stateNode=null,t.updateQueue=null}function L$(t){return t.tag===5||t.tag===3||t.tag===4}function mC(t){e:for(;;){for(;t.sibling===null;){if(t.return===null||L$(t.return))return null;t=t.return}for(t.sibling.return=t.return,t=t.sibling;t.tag!==5&&t.tag!==6&&t.tag!==18;){if(t.flags&2||t.child===null||t.tag===4)continue e;t.child.return=t,t=t.child}if(!(t.flags&2))return t.stateNode}}function vw(t,e,n){var r=t.tag;if(r===5||r===6)t=t.stateNode,e?n.nodeType===8?n.parentNode.insertBefore(t,e):n.insertBefore(t,e):(n.nodeType===8?(e=n.parentNode,e.insertBefore(t,n)):(e=n,e.appendChild(t)),n=n._reactRootContainer,n!=null||e.onclick!==null||(e.onclick=kp));else if(r!==4&&(t=t.child,t!==null))for(vw(t,e,n),t=t.sibling;t!==null;)vw(t,e,n),t=t.sibling}function ww(t,e,n){var r=t.tag;if(r===5||r===6)t=t.stateNode,e?n.insertBefore(t,e):n.appendChild(t);else if(r!==4&&(t=t.child,t!==null))for(ww(t,e,n),t=t.sibling;t!==null;)ww(t,e,n),t=t.sibling}var Ot=null,Ar=!1;function _o(t,e,n){for(n=n.child;n!==null;)j$(t,e,n),n=n.sibling}function j$(t,e,n){if(is&&typeof is.onCommitFiberUnmount=="function")try{is.onCommitFiberUnmount(Hg,n)}catch{}switch(n.tag){case 5:qt||pc(n,e);case 6:var r=Ot,s=Ar;Ot=null,_o(t,e,n),Ot=r,Ar=s,Ot!==null&&(Ar?(t=Ot,n=n.stateNode,t.nodeType===8?t.parentNode.removeChild(n):t.removeChild(n)):Ot.removeChild(n.stateNode));break;case 18:Ot!==null&&(Ar?(t=Ot,n=n.stateNode,t.nodeType===8?xy(t.parentNode,n):t.nodeType===1&&xy(t,n),Mu(t)):xy(Ot,n.stateNode));break;case 4:r=Ot,s=Ar,Ot=n.stateNode.containerInfo,Ar=!0,_o(t,e,n),Ot=r,Ar=s;break;case 0:case 11:case 14:case 15:if(!qt&&(r=n.updateQueue,r!==null&&(r=r.lastEffect,r!==null))){s=r=r.next;do{var o=s,i=o.destroy;o=o.tag,i!==void 0&&(o&2||o&4)&&mw(n,e,i),s=s.next}while(s!==r)}_o(t,e,n);break;case 1:if(!qt&&(pc(n,e),r=n.stateNode,typeof r.componentWillUnmount=="function"))try{r.props=n.memoizedProps,r.state=n.memoizedState,r.componentWillUnmount()}catch(a){dt(n,e,a)}_o(t,e,n);break;case 21:_o(t,e,n);break;case 22:n.mode&1?(qt=(r=qt)||n.memoizedState!==null,_o(t,e,n),qt=r):_o(t,e,n);break;default:_o(t,e,n)}}function yC(t){var e=t.updateQueue;if(e!==null){t.updateQueue=null;var n=t.stateNode;n===null&&(n=t.stateNode=new M8),e.forEach(function(r){var s=U8.bind(null,t,r);n.has(r)||(n.add(r),r.then(s,s))})}}function Ir(t,e){var n=e.deletions;if(n!==null)for(var r=0;r<n.length;r++){var s=n[r];try{var o=t,i=e,a=i;e:for(;a!==null;){switch(a.tag){case 5:Ot=a.stateNode,Ar=!1;break e;case 3:Ot=a.stateNode.containerInfo,Ar=!0;break e;case 4:Ot=a.stateNode.containerInfo,Ar=!0;break e}a=a.return}if(Ot===null)throw Error(G(160));j$(o,i,s),Ot=null,Ar=!1;var c=s.alternate;c!==null&&(c.return=null),s.return=null}catch(l){dt(s,e,l)}}if(e.subtreeFlags&12854)for(e=e.child;e!==null;)N$(e,t),e=e.sibling}function N$(t,e){var n=t.alternate,r=t.flags;switch(t.tag){case 0:case 11:case 14:case 15:if(Ir(e,t),qr(t),r&4){try{fu(3,t,t.return),Qg(3,t)}catch(m){dt(t,t.return,m)}try{fu(5,t,t.return)}catch(m){dt(t,t.return,m)}}break;case 1:Ir(e,t),qr(t),r&512&&n!==null&&pc(n,n.return);break;case 5:if(Ir(e,t),qr(t),r&512&&n!==null&&pc(n,n.return),t.flags&32){var s=t.stateNode;try{Iu(s,"")}catch(m){dt(t,t.return,m)}}if(r&4&&(s=t.stateNode,s!=null)){var o=t.memoizedProps,i=n!==null?n.memoizedProps:o,a=t.type,c=t.updateQueue;if(t.updateQueue=null,c!==null)try{a==="input"&&o.type==="radio"&&o.name!=null&&oI(s,o),Hv(a,i);var l=Hv(a,o);for(i=0;i<c.length;i+=2){var u=c[i],d=c[i+1];u==="style"?uI(s,d):u==="dangerouslySetInnerHTML"?cI(s,d):u==="children"?Iu(s,d):YS(s,u,d,l)}switch(a){case"input":Nv(s,o);break;case"textarea":iI(s,o);break;case"select":var h=s._wrapperState.wasMultiple;s._wrapperState.wasMultiple=!!o.multiple;var f=o.value;f!=null?bc(s,!!o.multiple,f,!1):h!==!!o.multiple&&(o.defaultValue!=null?bc(s,!!o.multiple,o.defaultValue,!0):bc(s,!!o.multiple,o.multiple?[]:"",!1))}s[ju]=o}catch(m){dt(t,t.return,m)}}break;case 6:if(Ir(e,t),qr(t),r&4){if(t.stateNode===null)throw Error(G(162));s=t.stateNode,o=t.memoizedProps;try{s.nodeValue=o}catch(m){dt(t,t.return,m)}}break;case 3:if(Ir(e,t),qr(t),r&4&&n!==null&&n.memoizedState.isDehydrated)try{Mu(e.containerInfo)}catch(m){dt(t,t.return,m)}break;case 4:Ir(e,t),qr(t);break;case 13:Ir(e,t),qr(t),s=t.child,s.flags&8192&&(o=s.memoizedState!==null,s.stateNode.isHidden=o,!o||s.alternate!==null&&s.alternate.memoizedState!==null||(k1=gt())),r&4&&yC(t);break;case 22:if(u=n!==null&&n.memoizedState!==null,t.mode&1?(qt=(l=qt)||u,Ir(e,t),qt=l):Ir(e,t),qr(t),r&8192){if(l=t.memoizedState!==null,(t.stateNode.isHidden=l)&&!u&&t.mode&1)for(ee=t,u=t.child;u!==null;){for(d=ee=u;ee!==null;){switch(h=ee,f=h.child,h.tag){case 0:case 11:case 14:case 15:fu(4,h,h.return);break;case 1:pc(h,h.return);var p=h.stateNode;if(typeof p.componentWillUnmount=="function"){r=h,n=h.return;try{e=r,p.props=e.memoizedProps,p.state=e.memoizedState,p.componentWillUnmount()}catch(m){dt(r,n,m)}}break;case 5:pc(h,h.return);break;case 22:if(h.memoizedState!==null){wC(d);continue}}f!==null?(f.return=h,ee=f):wC(d)}u=u.sibling}e:for(u=null,d=t;;){if(d.tag===5){if(u===null){u=d;try{s=d.stateNode,l?(o=s.style,typeof o.setProperty=="function"?o.setProperty("display","none","important"):o.display="none"):(a=d.stateNode,c=d.memoizedProps.style,i=c!=null&&c.hasOwnProperty("display")?c.display:null,a.style.display=lI("display",i))}catch(m){dt(t,t.return,m)}}}else if(d.tag===6){if(u===null)try{d.stateNode.nodeValue=l?"":d.memoizedProps}catch(m){dt(t,t.return,m)}}else if((d.tag!==22&&d.tag!==23||d.memoizedState===null||d===t)&&d.child!==null){d.child.return=d,d=d.child;continue}if(d===t)break e;for(;d.sibling===null;){if(d.return===null||d.return===t)break e;u===d&&(u=null),d=d.return}u===d&&(u=null),d.sibling.return=d.return,d=d.sibling}}break;case 19:Ir(e,t),qr(t),r&4&&yC(t);break;case 21:break;default:Ir(e,t),qr(t)}}function qr(t){var e=t.flags;if(e&2){try{e:{for(var n=t.return;n!==null;){if(L$(n)){var r=n;break e}n=n.return}throw Error(G(160))}switch(r.tag){case 5:var s=r.stateNode;r.flags&32&&(Iu(s,""),r.flags&=-33);var o=mC(t);ww(t,o,s);break;case 3:case 4:var i=r.stateNode.containerInfo,a=mC(t);vw(t,a,i);break;default:throw Error(G(161))}}catch(c){dt(t,t.return,c)}t.flags&=-3}e&4096&&(t.flags&=-4097)}function D8(t,e,n){ee=t,z$(t)}function z$(t,e,n){for(var r=(t.mode&1)!==0;ee!==null;){var s=ee,o=s.child;if(s.tag===22&&r){var i=s.memoizedState!==null||Ih;if(!i){var a=s.alternate,c=a!==null&&a.memoizedState!==null||qt;a=Ih;var l=qt;if(Ih=i,(qt=c)&&!l)for(ee=s;ee!==null;)i=ee,c=i.child,i.tag===22&&i.memoizedState!==null?SC(s):c!==null?(c.return=i,ee=c):SC(s);for(;o!==null;)ee=o,z$(o),o=o.sibling;ee=s,Ih=a,qt=l}vC(t)}else s.subtreeFlags&8772&&o!==null?(o.return=s,ee=o):vC(t)}}function vC(t){for(;ee!==null;){var e=ee;if(e.flags&8772){var n=e.alternate;try{if(e.flags&8772)switch(e.tag){case 0:case 11:case 15:qt||Qg(5,e);break;case 1:var r=e.stateNode;if(e.flags&4&&!qt)if(n===null)r.componentDidMount();else{var s=e.elementType===e.type?n.memoizedProps:Tr(e.type,n.memoizedProps);r.componentDidUpdate(s,n.memoizedState,r.__reactInternalSnapshotBeforeUpdate)}var o=e.updateQueue;o!==null&&tC(e,o,r);break;case 3:var i=e.updateQueue;if(i!==null){if(n=null,e.child!==null)switch(e.child.tag){case 5:n=e.child.stateNode;break;case 1:n=e.child.stateNode}tC(e,i,n)}break;case 5:var a=e.stateNode;if(n===null&&e.flags&4){n=a;var c=e.memoizedProps;switch(e.type){case"button":case"input":case"select":case"textarea":c.autoFocus&&n.focus();break;case"img":c.src&&(n.src=c.src)}}break;case 6:break;case 4:break;case 12:break;case 13:if(e.memoizedState===null){var l=e.alternate;if(l!==null){var u=l.memoizedState;if(u!==null){var d=u.dehydrated;d!==null&&Mu(d)}}}break;case 19:case 17:case 21:case 22:case 23:case 25:break;default:throw Error(G(163))}qt||e.flags&512&&yw(e)}catch(h){dt(e,e.return,h)}}if(e===t){ee=null;break}if(n=e.sibling,n!==null){n.return=e.return,ee=n;break}ee=e.return}}function wC(t){for(;ee!==null;){var e=ee;if(e===t){ee=null;break}var n=e.sibling;if(n!==null){n.return=e.return,ee=n;break}ee=e.return}}function SC(t){for(;ee!==null;){var e=ee;try{switch(e.tag){case 0:case 11:case 15:var n=e.return;try{Qg(4,e)}catch(c){dt(e,n,c)}break;case 1:var r=e.stateNode;if(typeof r.componentDidMount=="function"){var s=e.return;try{r.componentDidMount()}catch(c){dt(e,s,c)}}var o=e.return;try{yw(e)}catch(c){dt(e,o,c)}break;case 5:var i=e.return;try{yw(e)}catch(c){dt(e,i,c)}}}catch(c){dt(e,e.return,c)}if(e===t){ee=null;break}var a=e.sibling;if(a!==null){a.return=e.return,ee=a;break}ee=e.return}}var R8=Math.ceil,Np=ro.ReactCurrentDispatcher,E1=ro.ReactCurrentOwner,yr=ro.ReactCurrentBatchConfig,_e=0,kt=null,yt=null,Bt=0,Nn=0,gc=yi(0),wt=0,Hu=null,ca=0,Zg=0,P1=0,pu=null,xn=null,k1=0,Uc=1/0,Ts=null,zp=!1,Sw=null,Xo=null,$h=!1,No=null,Fp=0,gu=0,xw=null,Pf=-1,kf=0;function fn(){return _e&6?gt():Pf!==-1?Pf:Pf=gt()}function qo(t){return t.mode&1?_e&2&&Bt!==0?Bt&-Bt:v8.transition!==null?(kf===0&&(kf=bI()),kf):(t=De,t!==0||(t=window.event,t=t===void 0?16:$I(t.type)),t):1}function Br(t,e,n,r){if(50<gu)throw gu=0,xw=null,Error(G(185));Ed(t,n,r),(!(_e&2)||t!==kt)&&(t===kt&&(!(_e&2)&&(Zg|=n),wt===4&&Do(t,Bt)),Pn(t,r),n===1&&_e===0&&!(e.mode&1)&&(Uc=gt()+500,Yg&&vi()))}function Pn(t,e){var n=t.callbackNode;vR(t,e);var r=Cp(t,t===kt?Bt:0);if(r===0)n!==null&&$2(n),t.callbackNode=null,t.callbackPriority=0;else if(e=r&-r,t.callbackPriority!==e){if(n!=null&&$2(n),e===1)t.tag===0?y8(xC.bind(null,t)):YI(xC.bind(null,t)),f8(function(){!(_e&6)&&vi()}),n=null;else{switch(CI(r)){case 1:n=JS;break;case 4:n=SI;break;case 16:n=bp;break;case 536870912:n=xI;break;default:n=bp}n=G$(n,F$.bind(null,t))}t.callbackPriority=e,t.callbackNode=n}}function F$(t,e){if(Pf=-1,kf=0,_e&6)throw Error(G(327));var n=t.callbackNode;if(kc()&&t.callbackNode!==n)return null;var r=Cp(t,t===kt?Bt:0);if(r===0)return null;if(r&30||r&t.expiredLanes||e)e=Bp(t,r);else{e=r;var s=_e;_e|=2;var o=U$();(kt!==t||Bt!==e)&&(Ts=null,Uc=gt()+500,Xi(t,e));do try{N8();break}catch(a){B$(t,a)}while(1);h1(),Np.current=o,_e=s,yt!==null?e=0:(kt=null,Bt=0,e=wt)}if(e!==0){if(e===2&&(s=Yv(t),s!==0&&(r=s,e=bw(t,s))),e===1)throw n=Hu,Xi(t,0),Do(t,r),Pn(t,gt()),n;if(e===6)Do(t,r);else{if(s=t.current.alternate,!(r&30)&&!L8(s)&&(e=Bp(t,r),e===2&&(o=Yv(t),o!==0&&(r=o,e=bw(t,o))),e===1))throw n=Hu,Xi(t,0),Do(t,r),Pn(t,gt()),n;switch(t.finishedWork=s,t.finishedLanes=r,e){case 0:case 1:throw Error(G(345));case 2:Li(t,xn,Ts);break;case 3:if(Do(t,r),(r&130023424)===r&&(e=k1+500-gt(),10<e)){if(Cp(t,0)!==0)break;if(s=t.suspendedLanes,(s&r)!==r){fn(),t.pingedLanes|=t.suspendedLanes&s;break}t.timeoutHandle=nw(Li.bind(null,t,xn,Ts),e);break}Li(t,xn,Ts);break;case 4:if(Do(t,r),(r&4194240)===r)break;for(e=t.eventTimes,s=-1;0<r;){var i=31-Fr(r);o=1<<i,i=e[i],i>s&&(s=i),r&=~o}if(r=s,r=gt()-r,r=(120>r?120:480>r?480:1080>r?1080:1920>r?1920:3e3>r?3e3:4320>r?4320:1960*R8(r/1960))-r,10<r){t.timeoutHandle=nw(Li.bind(null,t,xn,Ts),r);break}Li(t,xn,Ts);break;case 5:Li(t,xn,Ts);break;default:throw Error(G(329))}}}return Pn(t,gt()),t.callbackNode===n?F$.bind(null,t):null}function bw(t,e){var n=pu;return t.current.memoizedState.isDehydrated&&(Xi(t,e).flags|=256),t=Bp(t,e),t!==2&&(e=xn,xn=n,e!==null&&Cw(e)),t}function Cw(t){xn===null?xn=t:xn.push.apply(xn,t)}function L8(t){for(var e=t;;){if(e.flags&16384){var n=e.updateQueue;if(n!==null&&(n=n.stores,n!==null))for(var r=0;r<n.length;r++){var s=n[r],o=s.getSnapshot;s=s.value;try{if(!Wr(o(),s))return!1}catch{return!1}}}if(n=e.child,e.subtreeFlags&16384&&n!==null)n.return=e,e=n;else{if(e===t)break;for(;e.sibling===null;){if(e.return===null||e.return===t)return!0;e=e.return}e.sibling.return=e.return,e=e.sibling}}return!0}function Do(t,e){for(e&=~P1,e&=~Zg,t.suspendedLanes|=e,t.pingedLanes&=~e,t=t.expirationTimes;0<e;){var n=31-Fr(e),r=1<<n;t[n]=-1,e&=~r}}function xC(t){if(_e&6)throw Error(G(327));kc();var e=Cp(t,0);if(!(e&1))return Pn(t,gt()),null;var n=Bp(t,e);if(t.tag!==0&&n===2){var r=Yv(t);r!==0&&(e=r,n=bw(t,r))}if(n===1)throw n=Hu,Xi(t,0),Do(t,e),Pn(t,gt()),n;if(n===6)throw Error(G(345));return t.finishedWork=t.current.alternate,t.finishedLanes=e,Li(t,xn,Ts),Pn(t,gt()),null}function I1(t,e){var n=_e;_e|=1;try{return t(e)}finally{_e=n,_e===0&&(Uc=gt()+500,Yg&&vi())}}function la(t){No!==null&&No.tag===0&&!(_e&6)&&kc();var e=_e;_e|=1;var n=yr.transition,r=De;try{if(yr.transition=null,De=1,t)return t()}finally{De=r,yr.transition=n,_e=e,!(_e&6)&&vi()}}function $1(){Nn=gc.current,Ge(gc)}function Xi(t,e){t.finishedWork=null,t.finishedLanes=0;var n=t.timeoutHandle;if(n!==-1&&(t.timeoutHandle=-1,h8(n)),yt!==null)for(n=yt.return;n!==null;){var r=n;switch(l1(r),r.tag){case 1:r=r.type.childContextTypes,r!=null&&Ip();break;case 3:Fc(),Ge(_n),Ge(nn),v1();break;case 5:y1(r);break;case 4:Fc();break;case 13:Ge(st);break;case 19:Ge(st);break;case 10:f1(r.type._context);break;case 22:case 23:$1()}n=n.return}if(kt=t,yt=t=Qo(t.current,null),Bt=Nn=e,wt=0,Hu=null,P1=Zg=ca=0,xn=pu=null,Fi!==null){for(e=0;e<Fi.length;e++)if(n=Fi[e],r=n.interleaved,r!==null){n.interleaved=null;var s=r.next,o=n.pending;if(o!==null){var i=o.next;o.next=s,r.next=i}n.pending=r}Fi=null}return t}function B$(t,e){do{var n=yt;try{if(h1(),Cf.current=jp,Lp){for(var r=it.memoizedState;r!==null;){var s=r.queue;s!==null&&(s.pending=null),r=r.next}Lp=!1}if(aa=0,Et=vt=it=null,hu=!1,Fu=0,E1.current=null,n===null||n.return===null){wt=1,Hu=e,yt=null;break}e:{var o=t,i=n.return,a=n,c=e;if(e=Bt,a.flags|=32768,c!==null&&typeof c=="object"&&typeof c.then=="function"){var l=c,u=a,d=u.tag;if(!(u.mode&1)&&(d===0||d===11||d===15)){var h=u.alternate;h?(u.updateQueue=h.updateQueue,u.memoizedState=h.memoizedState,u.lanes=h.lanes):(u.updateQueue=null,u.memoizedState=null)}var f=cC(i);if(f!==null){f.flags&=-257,lC(f,i,a,o,e),f.mode&1&&aC(o,l,e),e=f,c=l;var p=e.updateQueue;if(p===null){var m=new Set;m.add(c),e.updateQueue=m}else p.add(c);break e}else{if(!(e&1)){aC(o,l,e),T1();break e}c=Error(G(426))}}else if(Qe&&a.mode&1){var v=cC(i);if(v!==null){!(v.flags&65536)&&(v.flags|=256),lC(v,i,a,o,e),u1(Bc(c,a));break e}}o=c=Bc(c,a),wt!==4&&(wt=2),pu===null?pu=[o]:pu.push(o),o=i;do{switch(o.tag){case 3:o.flags|=65536,e&=-e,o.lanes|=e;var w=_$(o,c,e);eC(o,w);break e;case 1:a=c;var x=o.type,b=o.stateNode;if(!(o.flags&128)&&(typeof x.getDerivedStateFromError=="function"||b!==null&&typeof b.componentDidCatch=="function"&&(Xo===null||!Xo.has(b)))){o.flags|=65536,e&=-e,o.lanes|=e;var C=E$(o,a,e);eC(o,C);break e}}o=o.return}while(o!==null)}K$(n)}catch(E){e=E,yt===n&&n!==null&&(yt=n=n.return);continue}break}while(1)}function U$(){var t=Np.current;return Np.current=jp,t===null?jp:t}function T1(){(wt===0||wt===3||wt===2)&&(wt=4),kt===null||!(ca&268435455)&&!(Zg&268435455)||Do(kt,Bt)}function Bp(t,e){var n=_e;_e|=2;var r=U$();(kt!==t||Bt!==e)&&(Ts=null,Xi(t,e));do try{j8();break}catch(s){B$(t,s)}while(1);if(h1(),_e=n,Np.current=r,yt!==null)throw Error(G(261));return kt=null,Bt=0,wt}function j8(){for(;yt!==null;)H$(yt)}function N8(){for(;yt!==null&&!lR();)H$(yt)}function H$(t){var e=W$(t.alternate,t,Nn);t.memoizedProps=t.pendingProps,e===null?K$(t):yt=e,E1.current=null}function K$(t){var e=t;do{var n=e.alternate;if(t=e.return,e.flags&32768){if(n=A8(n,e),n!==null){n.flags&=32767,yt=n;return}if(t!==null)t.flags|=32768,t.subtreeFlags=0,t.deletions=null;else{wt=6,yt=null;return}}else if(n=T8(n,e,Nn),n!==null){yt=n;return}if(e=e.sibling,e!==null){yt=e;return}yt=e=t}while(e!==null);wt===0&&(wt=5)}function Li(t,e,n){var r=De,s=yr.transition;try{yr.transition=null,De=1,z8(t,e,n,r)}finally{yr.transition=s,De=r}return null}function z8(t,e,n,r){do kc();while(No!==null);if(_e&6)throw Error(G(327));n=t.finishedWork;var s=t.finishedLanes;if(n===null)return null;if(t.finishedWork=null,t.finishedLanes=0,n===t.current)throw Error(G(177));t.callbackNode=null,t.callbackPriority=0;var o=n.lanes|n.childLanes;if(wR(t,o),t===kt&&(yt=kt=null,Bt=0),!(n.subtreeFlags&2064)&&!(n.flags&2064)||$h||($h=!0,G$(bp,function(){return kc(),null})),o=(n.flags&15990)!==0,n.subtreeFlags&15990||o){o=yr.transition,yr.transition=null;var i=De;De=1;var a=_e;_e|=4,E1.current=null,O8(t,n),N$(n,t),o8(ew),_p=!!Jv,ew=Jv=null,t.current=n,D8(n),uR(),_e=a,De=i,yr.transition=o}else t.current=n;if($h&&($h=!1,No=t,Fp=s),o=t.pendingLanes,o===0&&(Xo=null),fR(n.stateNode),Pn(t,gt()),e!==null)for(r=t.onRecoverableError,n=0;n<e.length;n++)s=e[n],r(s.value,{componentStack:s.stack,digest:s.digest});if(zp)throw zp=!1,t=Sw,Sw=null,t;return Fp&1&&t.tag!==0&&kc(),o=t.pendingLanes,o&1?t===xw?gu++:(gu=0,xw=t):gu=0,vi(),null}function kc(){if(No!==null){var t=CI(Fp),e=yr.transition,n=De;try{if(yr.transition=null,De=16>t?16:t,No===null)var r=!1;else{if(t=No,No=null,Fp=0,_e&6)throw Error(G(331));var s=_e;for(_e|=4,ee=t.current;ee!==null;){var o=ee,i=o.child;if(ee.flags&16){var a=o.deletions;if(a!==null){for(var c=0;c<a.length;c++){var l=a[c];for(ee=l;ee!==null;){var u=ee;switch(u.tag){case 0:case 11:case 15:fu(8,u,o)}var d=u.child;if(d!==null)d.return=u,ee=d;else for(;ee!==null;){u=ee;var h=u.sibling,f=u.return;if(R$(u),u===l){ee=null;break}if(h!==null){h.return=f,ee=h;break}ee=f}}}var p=o.alternate;if(p!==null){var m=p.child;if(m!==null){p.child=null;do{var v=m.sibling;m.sibling=null,m=v}while(m!==null)}}ee=o}}if(o.subtreeFlags&2064&&i!==null)i.return=o,ee=i;else e:for(;ee!==null;){if(o=ee,o.flags&2048)switch(o.tag){case 0:case 11:case 15:fu(9,o,o.return)}var w=o.sibling;if(w!==null){w.return=o.return,ee=w;break e}ee=o.return}}var x=t.current;for(ee=x;ee!==null;){i=ee;var b=i.child;if(i.subtreeFlags&2064&&b!==null)b.return=i,ee=b;else e:for(i=x;ee!==null;){if(a=ee,a.flags&2048)try{switch(a.tag){case 0:case 11:case 15:Qg(9,a)}}catch(E){dt(a,a.return,E)}if(a===i){ee=null;break e}var C=a.sibling;if(C!==null){C.return=a.return,ee=C;break e}ee=a.return}}if(_e=s,vi(),is&&typeof is.onPostCommitFiberRoot=="function")try{is.onPostCommitFiberRoot(Hg,t)}catch{}r=!0}return r}finally{De=n,yr.transition=e}}return!1}function bC(t,e,n){e=Bc(n,e),e=_$(t,e,1),t=Yo(t,e,1),e=fn(),t!==null&&(Ed(t,1,e),Pn(t,e))}function dt(t,e,n){if(t.tag===3)bC(t,t,n);else for(;e!==null;){if(e.tag===3){bC(e,t,n);break}else if(e.tag===1){var r=e.stateNode;if(typeof e.type.getDerivedStateFromError=="function"||typeof r.componentDidCatch=="function"&&(Xo===null||!Xo.has(r))){t=Bc(n,t),t=E$(e,t,1),e=Yo(e,t,1),t=fn(),e!==null&&(Ed(e,1,t),Pn(e,t));break}}e=e.return}}function F8(t,e,n){var r=t.pingCache;r!==null&&r.delete(e),e=fn(),t.pingedLanes|=t.suspendedLanes&n,kt===t&&(Bt&n)===n&&(wt===4||wt===3&&(Bt&130023424)===Bt&&500>gt()-k1?Xi(t,0):P1|=n),Pn(t,e)}function V$(t,e){e===0&&(t.mode&1?(e=wh,wh<<=1,!(wh&130023424)&&(wh=4194304)):e=1);var n=fn();t=Qs(t,e),t!==null&&(Ed(t,e,n),Pn(t,n))}function B8(t){var e=t.memoizedState,n=0;e!==null&&(n=e.retryLane),V$(t,n)}function U8(t,e){var n=0;switch(t.tag){case 13:var r=t.stateNode,s=t.memoizedState;s!==null&&(n=s.retryLane);break;case 19:r=t.stateNode;break;default:throw Error(G(314))}r!==null&&r.delete(e),V$(t,n)}var W$;W$=function(t,e,n){if(t!==null)if(t.memoizedProps!==e.pendingProps||_n.current)bn=!0;else{if(!(t.lanes&n)&&!(e.flags&128))return bn=!1,$8(t,e,n);bn=!!(t.flags&131072)}else bn=!1,Qe&&e.flags&1048576&&XI(e,Ap,e.index);switch(e.lanes=0,e.tag){case 2:var r=e.type;Ef(t,e),t=e.pendingProps;var s=jc(e,nn.current);Pc(e,n),s=S1(null,e,r,t,s,n);var o=x1();return e.flags|=1,typeof s=="object"&&s!==null&&typeof s.render=="function"&&s.$$typeof===void 0?(e.tag=1,e.memoizedState=null,e.updateQueue=null,En(r)?(o=!0,$p(e)):o=!1,e.memoizedState=s.state!==null&&s.state!==void 0?s.state:null,g1(e),s.updater=Xg,e.stateNode=s,s._reactInternals=e,lw(e,r,t,n),e=hw(null,e,r,!0,o,n)):(e.tag=0,Qe&&o&&c1(e),dn(null,e,s,n),e=e.child),e;case 16:r=e.elementType;e:{switch(Ef(t,e),t=e.pendingProps,s=r._init,r=s(r._payload),e.type=r,s=e.tag=K8(r),t=Tr(r,t),s){case 0:e=dw(null,e,r,t,n);break e;case 1:e=hC(null,e,r,t,n);break e;case 11:e=uC(null,e,r,t,n);break e;case 14:e=dC(null,e,r,Tr(r.type,t),n);break e}throw Error(G(306,r,""))}return e;case 0:return r=e.type,s=e.pendingProps,s=e.elementType===r?s:Tr(r,s),dw(t,e,r,s,n);case 1:return r=e.type,s=e.pendingProps,s=e.elementType===r?s:Tr(r,s),hC(t,e,r,s,n);case 3:e:{if($$(e),t===null)throw Error(G(387));r=e.pendingProps,o=e.memoizedState,s=o.element,JI(t,e),Dp(e,r,null,n);var i=e.memoizedState;if(r=i.element,o.isDehydrated)if(o={element:r,isDehydrated:!1,cache:i.cache,pendingSuspenseBoundaries:i.pendingSuspenseBoundaries,transitions:i.transitions},e.updateQueue.baseState=o,e.memoizedState=o,e.flags&256){s=Bc(Error(G(423)),e),e=fC(t,e,r,n,s);break e}else if(r!==s){s=Bc(Error(G(424)),e),e=fC(t,e,r,n,s);break e}else for(Kn=Go(e.stateNode.containerInfo.firstChild),Wn=e,Qe=!0,Dr=null,n=r$(e,null,r,n),e.child=n;n;)n.flags=n.flags&-3|4096,n=n.sibling;else{if(Nc(),r===s){e=Zs(t,e,n);break e}dn(t,e,r,n)}e=e.child}return e;case 5:return s$(e),t===null&&iw(e),r=e.type,s=e.pendingProps,o=t!==null?t.memoizedProps:null,i=s.children,tw(r,s)?i=null:o!==null&&tw(r,o)&&(e.flags|=32),I$(t,e),dn(t,e,i,n),e.child;case 6:return t===null&&iw(e),null;case 13:return T$(t,e,n);case 4:return m1(e,e.stateNode.containerInfo),r=e.pendingProps,t===null?e.child=zc(e,null,r,n):dn(t,e,r,n),e.child;case 11:return r=e.type,s=e.pendingProps,s=e.elementType===r?s:Tr(r,s),uC(t,e,r,s,n);case 7:return dn(t,e,e.pendingProps,n),e.child;case 8:return dn(t,e,e.pendingProps.children,n),e.child;case 12:return dn(t,e,e.pendingProps.children,n),e.child;case 10:e:{if(r=e.type._context,s=e.pendingProps,o=e.memoizedProps,i=s.value,He(Mp,r._currentValue),r._currentValue=i,o!==null)if(Wr(o.value,i)){if(o.children===s.children&&!_n.current){e=Zs(t,e,n);break e}}else for(o=e.child,o!==null&&(o.return=e);o!==null;){var a=o.dependencies;if(a!==null){i=o.child;for(var c=a.firstContext;c!==null;){if(c.context===r){if(o.tag===1){c=zs(-1,n&-n),c.tag=2;var l=o.updateQueue;if(l!==null){l=l.shared;var u=l.pending;u===null?c.next=c:(c.next=u.next,u.next=c),l.pending=c}}o.lanes|=n,c=o.alternate,c!==null&&(c.lanes|=n),aw(o.return,n,e),a.lanes|=n;break}c=c.next}}else if(o.tag===10)i=o.type===e.type?null:o.child;else if(o.tag===18){if(i=o.return,i===null)throw Error(G(341));i.lanes|=n,a=i.alternate,a!==null&&(a.lanes|=n),aw(i,n,e),i=o.sibling}else i=o.child;if(i!==null)i.return=o;else for(i=o;i!==null;){if(i===e){i=null;break}if(o=i.sibling,o!==null){o.return=i.return,i=o;break}i=i.return}o=i}dn(t,e,s.children,n),e=e.child}return e;case 9:return s=e.type,r=e.pendingProps.children,Pc(e,n),s=wr(s),r=r(s),e.flags|=1,dn(t,e,r,n),e.child;case 14:return r=e.type,s=Tr(r,e.pendingProps),s=Tr(r.type,s),dC(t,e,r,s,n);case 15:return P$(t,e,e.type,e.pendingProps,n);case 17:return r=e.type,s=e.pendingProps,s=e.elementType===r?s:Tr(r,s),Ef(t,e),e.tag=1,En(r)?(t=!0,$p(e)):t=!1,Pc(e,n),t$(e,r,s),lw(e,r,s,n),hw(null,e,r,!0,t,n);case 19:return A$(t,e,n);case 22:return k$(t,e,n)}throw Error(G(156,e.tag))};function G$(t,e){return wI(t,e)}function H8(t,e,n,r){this.tag=t,this.key=n,this.sibling=this.child=this.return=this.stateNode=this.type=this.elementType=null,this.index=0,this.ref=null,this.pendingProps=e,this.dependencies=this.memoizedState=this.updateQueue=this.memoizedProps=null,this.mode=r,this.subtreeFlags=this.flags=0,this.deletions=null,this.childLanes=this.lanes=0,this.alternate=null}function mr(t,e,n,r){return new H8(t,e,n,r)}function A1(t){return t=t.prototype,!(!t||!t.isReactComponent)}function K8(t){if(typeof t=="function")return A1(t)?1:0;if(t!=null){if(t=t.$$typeof,t===qS)return 11;if(t===QS)return 14}return 2}function Qo(t,e){var n=t.alternate;return n===null?(n=mr(t.tag,e,t.key,t.mode),n.elementType=t.elementType,n.type=t.type,n.stateNode=t.stateNode,n.alternate=t,t.alternate=n):(n.pendingProps=e,n.type=t.type,n.flags=0,n.subtreeFlags=0,n.deletions=null),n.flags=t.flags&14680064,n.childLanes=t.childLanes,n.lanes=t.lanes,n.child=t.child,n.memoizedProps=t.memoizedProps,n.memoizedState=t.memoizedState,n.updateQueue=t.updateQueue,e=t.dependencies,n.dependencies=e===null?null:{lanes:e.lanes,firstContext:e.firstContext},n.sibling=t.sibling,n.index=t.index,n.ref=t.ref,n}function If(t,e,n,r,s,o){var i=2;if(r=t,typeof t=="function")A1(t)&&(i=1);else if(typeof t=="string")i=5;else e:switch(t){case oc:return qi(n.children,s,o,e);case XS:i=8,s|=8;break;case Ov:return t=mr(12,n,e,s|2),t.elementType=Ov,t.lanes=o,t;case Dv:return t=mr(13,n,e,s),t.elementType=Dv,t.lanes=o,t;case Rv:return t=mr(19,n,e,s),t.elementType=Rv,t.lanes=o,t;case nI:return Jg(n,s,o,e);default:if(typeof t=="object"&&t!==null)switch(t.$$typeof){case eI:i=10;break e;case tI:i=9;break e;case qS:i=11;break e;case QS:i=14;break e;case $o:i=16,r=null;break e}throw Error(G(130,t==null?t:typeof t,""))}return e=mr(i,n,e,s),e.elementType=t,e.type=r,e.lanes=o,e}function qi(t,e,n,r){return t=mr(7,t,r,e),t.lanes=n,t}function Jg(t,e,n,r){return t=mr(22,t,r,e),t.elementType=nI,t.lanes=n,t.stateNode={isHidden:!1},t}function $y(t,e,n){return t=mr(6,t,null,e),t.lanes=n,t}function Ty(t,e,n){return e=mr(4,t.children!==null?t.children:[],t.key,e),e.lanes=n,e.stateNode={containerInfo:t.containerInfo,pendingChildren:null,implementation:t.implementation},e}function V8(t,e,n,r,s){this.tag=e,this.containerInfo=t,this.finishedWork=this.pingCache=this.current=this.pendingChildren=null,this.timeoutHandle=-1,this.callbackNode=this.pendingContext=this.context=null,this.callbackPriority=0,this.eventTimes=uy(0),this.expirationTimes=uy(-1),this.entangledLanes=this.finishedLanes=this.mutableReadLanes=this.expiredLanes=this.pingedLanes=this.suspendedLanes=this.pendingLanes=0,this.entanglements=uy(0),this.identifierPrefix=r,this.onRecoverableError=s,this.mutableSourceEagerHydrationData=null}function M1(t,e,n,r,s,o,i,a,c){return t=new V8(t,e,n,a,c),e===1?(e=1,o===!0&&(e|=8)):e=0,o=mr(3,null,null,e),t.current=o,o.stateNode=t,o.memoizedState={element:r,isDehydrated:n,cache:null,transitions:null,pendingSuspenseBoundaries:null},g1(o),t}function W8(t,e,n){var r=3<arguments.length&&arguments[3]!==void 0?arguments[3]:null;return{$$typeof:sc,key:r==null?null:""+r,children:t,containerInfo:e,implementation:n}}function Y$(t){if(!t)return si;t=t._reactInternals;e:{if(ba(t)!==t||t.tag!==1)throw Error(G(170));var e=t;do{switch(e.tag){case 3:e=e.stateNode.context;break e;case 1:if(En(e.type)){e=e.stateNode.__reactInternalMemoizedMergedChildContext;break e}}e=e.return}while(e!==null);throw Error(G(171))}if(t.tag===1){var n=t.type;if(En(n))return GI(t,n,e)}return e}function X$(t,e,n,r,s,o,i,a,c){return t=M1(n,r,!0,t,s,o,i,a,c),t.context=Y$(null),n=t.current,r=fn(),s=qo(n),o=zs(r,s),o.callback=e??null,Yo(n,o,s),t.current.lanes=s,Ed(t,s,r),Pn(t,r),t}function em(t,e,n,r){var s=e.current,o=fn(),i=qo(s);return n=Y$(n),e.context===null?e.context=n:e.pendingContext=n,e=zs(o,i),e.payload={element:t},r=r===void 0?null:r,r!==null&&(e.callback=r),t=Yo(s,e,i),t!==null&&(Br(t,s,i,o),bf(t,s,i)),i}function Up(t){if(t=t.current,!t.child)return null;switch(t.child.tag){case 5:return t.child.stateNode;default:return t.child.stateNode}}function CC(t,e){if(t=t.memoizedState,t!==null&&t.dehydrated!==null){var n=t.retryLane;t.retryLane=n!==0&&n<e?n:e}}function O1(t,e){CC(t,e),(t=t.alternate)&&CC(t,e)}function G8(){return null}var q$=typeof reportError=="function"?reportError:function(t){console.error(t)};function D1(t){this._internalRoot=t}tm.prototype.render=D1.prototype.render=function(t){var e=this._internalRoot;if(e===null)throw Error(G(409));em(t,e,null,null)};tm.prototype.unmount=D1.prototype.unmount=function(){var t=this._internalRoot;if(t!==null){this._internalRoot=null;var e=t.containerInfo;la(function(){em(null,t,null,null)}),e[qs]=null}};function tm(t){this._internalRoot=t}tm.prototype.unstable_scheduleHydration=function(t){if(t){var e=PI();t={blockedOn:null,target:t,priority:e};for(var n=0;n<Oo.length&&e!==0&&e<Oo[n].priority;n++);Oo.splice(n,0,t),n===0&&II(t)}};function R1(t){return!(!t||t.nodeType!==1&&t.nodeType!==9&&t.nodeType!==11)}function nm(t){return!(!t||t.nodeType!==1&&t.nodeType!==9&&t.nodeType!==11&&(t.nodeType!==8||t.nodeValue!==" react-mount-point-unstable "))}function _C(){}function Y8(t,e,n,r,s){if(s){if(typeof r=="function"){var o=r;r=function(){var l=Up(i);o.call(l)}}var i=X$(e,r,t,0,null,!1,!1,"",_C);return t._reactRootContainer=i,t[qs]=i.current,Ru(t.nodeType===8?t.parentNode:t),la(),i}for(;s=t.lastChild;)t.removeChild(s);if(typeof r=="function"){var a=r;r=function(){var l=Up(c);a.call(l)}}var c=M1(t,0,!1,null,null,!1,!1,"",_C);return t._reactRootContainer=c,t[qs]=c.current,Ru(t.nodeType===8?t.parentNode:t),la(function(){em(e,c,n,r)}),c}function rm(t,e,n,r,s){var o=n._reactRootContainer;if(o){var i=o;if(typeof s=="function"){var a=s;s=function(){var c=Up(i);a.call(c)}}em(e,i,t,s)}else i=Y8(n,e,t,s,r);return Up(i)}_I=function(t){switch(t.tag){case 3:var e=t.stateNode;if(e.current.memoizedState.isDehydrated){var n=tu(e.pendingLanes);n!==0&&(e1(e,n|1),Pn(e,gt()),!(_e&6)&&(Uc=gt()+500,vi()))}break;case 13:la(function(){var r=Qs(t,1);if(r!==null){var s=fn();Br(r,t,1,s)}}),O1(t,1)}};t1=function(t){if(t.tag===13){var e=Qs(t,134217728);if(e!==null){var n=fn();Br(e,t,134217728,n)}O1(t,134217728)}};EI=function(t){if(t.tag===13){var e=qo(t),n=Qs(t,e);if(n!==null){var r=fn();Br(n,t,e,r)}O1(t,e)}};PI=function(){return De};kI=function(t,e){var n=De;try{return De=t,e()}finally{De=n}};Vv=function(t,e,n){switch(e){case"input":if(Nv(t,n),e=n.name,n.type==="radio"&&e!=null){for(n=t;n.parentNode;)n=n.parentNode;for(n=n.querySelectorAll("input[name="+JSON.stringify(""+e)+'][type="radio"]'),e=0;e<n.length;e++){var r=n[e];if(r!==t&&r.form===t.form){var s=Gg(r);if(!s)throw Error(G(90));sI(r),Nv(r,s)}}}break;case"textarea":iI(t,n);break;case"select":e=n.value,e!=null&&bc(t,!!n.multiple,e,!1)}};fI=I1;pI=la;var X8={usingClientEntryPoint:!1,Events:[kd,lc,Gg,dI,hI,I1]},Dl={findFiberByHostInstance:zi,bundleType:0,version:"18.2.0",rendererPackageName:"react-dom"},q8={bundleType:Dl.bundleType,version:Dl.version,rendererPackageName:Dl.rendererPackageName,rendererConfig:Dl.rendererConfig,overrideHookState:null,overrideHookStateDeletePath:null,overrideHookStateRenamePath:null,overrideProps:null,overridePropsDeletePath:null,overridePropsRenamePath:null,setErrorHandler:null,setSuspenseHandler:null,scheduleUpdate:null,currentDispatcherRef:ro.ReactCurrentDispatcher,findHostInstanceByFiber:function(t){return t=yI(t),t===null?null:t.stateNode},findFiberByHostInstance:Dl.findFiberByHostInstance||G8,findHostInstancesForRefresh:null,scheduleRefresh:null,scheduleRoot:null,setRefreshHandler:null,getCurrentFiber:null,reconcilerVersion:"18.2.0-next-9e3b772b8-20220608"};if(typeof __REACT_DEVTOOLS_GLOBAL_HOOK__<"u"){var Th=__REACT_DEVTOOLS_GLOBAL_HOOK__;if(!Th.isDisabled&&Th.supportsFiber)try{Hg=Th.inject(q8),is=Th}catch{}}Zn.__SECRET_INTERNALS_DO_NOT_USE_OR_YOU_WILL_BE_FIRED=X8;Zn.createPortal=function(t,e){var n=2<arguments.length&&arguments[2]!==void 0?arguments[2]:null;if(!R1(e))throw Error(G(200));return W8(t,e,null,n)};Zn.createRoot=function(t,e){if(!R1(t))throw Error(G(299));var n=!1,r="",s=q$;return e!=null&&(e.unstable_strictMode===!0&&(n=!0),e.identifierPrefix!==void 0&&(r=e.identifierPrefix),e.onRecoverableError!==void 0&&(s=e.onRecoverableError)),e=M1(t,1,!1,null,null,n,!1,r,s),t[qs]=e.current,Ru(t.nodeType===8?t.parentNode:t),new D1(e)};Zn.findDOMNode=function(t){if(t==null)return null;if(t.nodeType===1)return t;var e=t._reactInternals;if(e===void 0)throw typeof t.render=="function"?Error(G(188)):(t=Object.keys(t).join(","),Error(G(268,t)));return t=yI(e),t=t===null?null:t.stateNode,t};Zn.flushSync=function(t){return la(t)};Zn.hydrate=function(t,e,n){if(!nm(e))throw Error(G(200));return rm(null,t,e,!0,n)};Zn.hydrateRoot=function(t,e,n){if(!R1(t))throw Error(G(405));var r=n!=null&&n.hydratedSources||null,s=!1,o="",i=q$;if(n!=null&&(n.unstable_strictMode===!0&&(s=!0),n.identifierPrefix!==void 0&&(o=n.identifierPrefix),n.onRecoverableError!==void 0&&(i=n.onRecoverableError)),e=X$(e,null,t,1,n??null,s,!1,o,i),t[qs]=e.current,Ru(t),r)for(t=0;t<r.length;t++)n=r[t],s=n._getVersion,s=s(n._source),e.mutableSourceEagerHydrationData==null?e.mutableSourceEagerHydrationData=[n,s]:e.mutableSourceEagerHydrationData.push(n,s);return new tm(e)};Zn.render=function(t,e,n){if(!nm(e))throw Error(G(200));return rm(null,t,e,!1,n)};Zn.unmountComponentAtNode=function(t){if(!nm(t))throw Error(G(40));return t._reactRootContainer?(la(function(){rm(null,null,t,!1,function(){t._reactRootContainer=null,t[qs]=null})}),!0):!1};Zn.unstable_batchedUpdates=I1;Zn.unstable_renderSubtreeIntoContainer=function(t,e,n,r){if(!nm(n))throw Error(G(200));if(t==null||t._reactInternals===void 0)throw Error(G(38));return rm(t,e,n,!1,r)};Zn.version="18.2.0-next-9e3b772b8-20220608";function Q$(){if(!(typeof __REACT_DEVTOOLS_GLOBAL_HOOK__>"u"||typeof __REACT_DEVTOOLS_GLOBAL_HOOK__.checkDCE!="function"))try{__REACT_DEVTOOLS_GLOBAL_HOOK__.checkDCE(Q$)}catch(t){console.error(t)}}Q$(),Xk.exports=Zn;var so=Xk.exports;const Z$=Sa(so);var EC=so;Av.createRoot=EC.createRoot,Av.hydrateRoot=EC.hydrateRoot;function W(){return W=Object.assign?Object.assign.bind():function(t){for(var e=1;e<arguments.length;e++){var n=arguments[e];for(var r in n)Object.prototype.hasOwnProperty.call(n,r)&&(t[r]=n[r])}return t},W.apply(this,arguments)}function oe(t,e,{checkForDefaultPrevented:n=!0}={}){return function(s){if(t==null||t(s),n===!1||!s.defaultPrevented)return e==null?void 0:e(s)}}function Q8(t,e){typeof t=="function"?t(e):t!=null&&(t.current=e)}function sm(...t){return e=>t.forEach(n=>Q8(n,e))}function et(...t){return S.useCallback(sm(...t),t)}function oo(t,e=[]){let n=[];function r(o,i){const a=S.createContext(i),c=n.length;n=[...n,i];function l(d){const{scope:h,children:f,...p}=d,m=(h==null?void 0:h[t][c])||a,v=S.useMemo(()=>p,Object.values(p));return S.createElement(m.Provider,{value:v},f)}function u(d,h){const f=(h==null?void 0:h[t][c])||a,p=S.useContext(f);if(p)return p;if(i!==void 0)return i;throw new Error(`\`${d}\` must be used within \`${o}\``)}return l.displayName=o+"Provider",[l,u]}const s=()=>{const o=n.map(i=>S.createContext(i));return function(a){const c=(a==null?void 0:a[t])||o;return S.useMemo(()=>({[`__scope${t}`]:{...a,[t]:c}}),[a,c])}};return s.scopeName=t,[r,Z8(s,...e)]}function Z8(...t){const e=t[0];if(t.length===1)return e;const n=()=>{const r=t.map(s=>({useScope:s(),scopeName:s.scopeName}));return function(o){const i=r.reduce((a,{useScope:c,scopeName:l})=>{const d=c(o)[`__scope${l}`];return{...a,...d}},{});return S.useMemo(()=>({[`__scope${e.scopeName}`]:i}),[i])}};return n.scopeName=e.scopeName,n}const ua=globalThis!=null&&globalThis.document?S.useLayoutEffect:()=>{},J8=Gk["useId".toString()]||(()=>{});let eL=0;function Zo(t){const[e,n]=S.useState(J8());return ua(()=>{t||n(r=>r??String(eL++))},[t]),t||(e?`radix-${e}`:"")}function rn(t){const e=S.useRef(t);return S.useEffect(()=>{e.current=t}),S.useMemo(()=>(...n)=>{var r;return(r=e.current)===null||r===void 0?void 0:r.call(e,...n)},[])}function Ca({prop:t,defaultProp:e,onChange:n=()=>{}}){const[r,s]=tL({defaultProp:e,onChange:n}),o=t!==void 0,i=o?t:r,a=rn(n),c=S.useCallback(l=>{if(o){const d=typeof l=="function"?l(t):l;d!==t&&a(d)}else s(l)},[o,t,s,a]);return[i,c]}function tL({defaultProp:t,onChange:e}){const n=S.useState(t),[r]=n,s=S.useRef(r),o=rn(e);return S.useEffect(()=>{s.current!==r&&(o(r),s.current=r)},[r,s,o]),n}const Hc=S.forwardRef((t,e)=>{const{children:n,...r}=t,s=S.Children.toArray(n),o=s.find(rL);if(o){const i=o.props.children,a=s.map(c=>c===o?S.Children.count(i)>1?S.Children.only(null):S.isValidElement(i)?i.props.children:null:c);return S.createElement(_w,W({},r,{ref:e}),S.isValidElement(i)?S.cloneElement(i,void 0,a):null)}return S.createElement(_w,W({},r,{ref:e}),n)});Hc.displayName="Slot";const _w=S.forwardRef((t,e)=>{const{children:n,...r}=t;return S.isValidElement(n)?S.cloneElement(n,{...sL(r,n.props),ref:e?sm(e,n.ref):n.ref}):S.Children.count(n)>1?S.Children.only(null):null});_w.displayName="SlotClone";const nL=({children:t})=>S.createElement(S.Fragment,null,t);function rL(t){return S.isValidElement(t)&&t.type===nL}function sL(t,e){const n={...e};for(const r in e){const s=t[r],o=e[r];/^on[A-Z]/.test(r)?s&&o?n[r]=(...a)=>{o(...a),s(...a)}:s&&(n[r]=s):r==="style"?n[r]={...s,...o}:r==="className"&&(n[r]=[s,o].filter(Boolean).join(" "))}return{...t,...n}}const oL=["a","button","div","form","h2","h3","img","input","label","li","nav","ol","p","span","svg","ul"],Fe=oL.reduce((t,e)=>{const n=S.forwardRef((r,s)=>{const{asChild:o,...i}=r,a=o?Hc:e;return S.useEffect(()=>{window[Symbol.for("radix-ui")]=!0},[]),S.createElement(a,W({},i,{ref:s}))});return n.displayName=`Primitive.${e}`,{...t,[e]:n}},{});function L1(t,e){t&&so.flushSync(()=>t.dispatchEvent(e))}function iL(t,e=globalThis==null?void 0:globalThis.document){const n=rn(t);S.useEffect(()=>{const r=s=>{s.key==="Escape"&&n(s)};return e.addEventListener("keydown",r),()=>e.removeEventListener("keydown",r)},[n,e])}const Ew="dismissableLayer.update",aL="dismissableLayer.pointerDownOutside",cL="dismissableLayer.focusOutside";let PC;const J$=S.createContext({layers:new Set,layersWithOutsidePointerEventsDisabled:new Set,branches:new Set}),j1=S.forwardRef((t,e)=>{var n;const{disableOutsidePointerEvents:r=!1,onEscapeKeyDown:s,onPointerDownOutside:o,onFocusOutside:i,onInteractOutside:a,onDismiss:c,...l}=t,u=S.useContext(J$),[d,h]=S.useState(null),f=(n=d==null?void 0:d.ownerDocument)!==null&&n!==void 0?n:globalThis==null?void 0:globalThis.document,[,p]=S.useState({}),m=et(e,I=>h(I)),v=Array.from(u.layers),[w]=[...u.layersWithOutsidePointerEventsDisabled].slice(-1),x=v.indexOf(w),b=d?v.indexOf(d):-1,C=u.layersWithOutsidePointerEventsDisabled.size>0,E=b>=x,_=uL(I=>{const $=I.target,A=[...u.branches].some(D=>D.contains($));!E||A||(o==null||o(I),a==null||a(I),I.defaultPrevented||c==null||c())},f),k=dL(I=>{const $=I.target;[...u.branches].some(D=>D.contains($))||(i==null||i(I),a==null||a(I),I.defaultPrevented||c==null||c())},f);return iL(I=>{b===u.layers.size-1&&(s==null||s(I),!I.defaultPrevented&&c&&(I.preventDefault(),c()))},f),S.useEffect(()=>{if(d)return r&&(u.layersWithOutsidePointerEventsDisabled.size===0&&(PC=f.body.style.pointerEvents,f.body.style.pointerEvents="none"),u.layersWithOutsidePointerEventsDisabled.add(d)),u.layers.add(d),kC(),()=>{r&&u.layersWithOutsidePointerEventsDisabled.size===1&&(f.body.style.pointerEvents=PC)}},[d,f,r,u]),S.useEffect(()=>()=>{d&&(u.layers.delete(d),u.layersWithOutsidePointerEventsDisabled.delete(d),kC())},[d,u]),S.useEffect(()=>{const I=()=>p({});return document.addEventListener(Ew,I),()=>document.removeEventListener(Ew,I)},[]),S.createElement(Fe.div,W({},l,{ref:m,style:{pointerEvents:C?E?"auto":"none":void 0,...t.style},onFocusCapture:oe(t.onFocusCapture,k.onFocusCapture),onBlurCapture:oe(t.onBlurCapture,k.onBlurCapture),onPointerDownCapture:oe(t.onPointerDownCapture,_.onPointerDownCapture)}))}),lL=S.forwardRef((t,e)=>{const n=S.useContext(J$),r=S.useRef(null),s=et(e,r);return S.useEffect(()=>{const o=r.current;if(o)return n.branches.add(o),()=>{n.branches.delete(o)}},[n.branches]),S.createElement(Fe.div,W({},t,{ref:s}))});function uL(t,e=globalThis==null?void 0:globalThis.document){const n=rn(t),r=S.useRef(!1),s=S.useRef(()=>{});return S.useEffect(()=>{const o=a=>{if(a.target&&!r.current){let u=function(){eT(aL,n,l,{discrete:!0})};var c=u;const l={originalEvent:a};a.pointerType==="touch"?(e.removeEventListener("click",s.current),s.current=u,e.addEventListener("click",s.current,{once:!0})):u()}r.current=!1},i=window.setTimeout(()=>{e.addEventListener("pointerdown",o)},0);return()=>{window.clearTimeout(i),e.removeEventListener("pointerdown",o),e.removeEventListener("click",s.current)}},[e,n]),{onPointerDownCapture:()=>r.current=!0}}function dL(t,e=globalThis==null?void 0:globalThis.document){const n=rn(t),r=S.useRef(!1);return S.useEffect(()=>{const s=o=>{o.target&&!r.current&&eT(cL,n,{originalEvent:o},{discrete:!1})};return e.addEventListener("focusin",s),()=>e.removeEventListener("focusin",s)},[e,n]),{onFocusCapture:()=>r.current=!0,onBlurCapture:()=>r.current=!1}}function kC(){const t=new CustomEvent(Ew);document.dispatchEvent(t)}function eT(t,e,n,{discrete:r}){const s=n.originalEvent.target,o=new CustomEvent(t,{bubbles:!1,cancelable:!0,detail:n});e&&s.addEventListener(t,e,{once:!0}),r?L1(s,o):s.dispatchEvent(o)}const hL=j1,fL=lL,Ay="focusScope.autoFocusOnMount",My="focusScope.autoFocusOnUnmount",IC={bubbles:!1,cancelable:!0},tT=S.forwardRef((t,e)=>{const{loop:n=!1,trapped:r=!1,onMountAutoFocus:s,onUnmountAutoFocus:o,...i}=t,[a,c]=S.useState(null),l=rn(s),u=rn(o),d=S.useRef(null),h=et(e,m=>c(m)),f=S.useRef({paused:!1,pause(){this.paused=!0},resume(){this.paused=!1}}).current;S.useEffect(()=>{if(r){let x=function(_){if(f.paused||!a)return;const k=_.target;a.contains(k)?d.current=k:ko(d.current,{select:!0})},b=function(_){if(f.paused||!a)return;const k=_.relatedTarget;k!==null&&(a.contains(k)||ko(d.current,{select:!0}))},C=function(_){const k=document.activeElement;for(const I of _)I.removedNodes.length>0&&(a!=null&&a.contains(k)||ko(a))};var m=x,v=b,w=C;document.addEventListener("focusin",x),document.addEventListener("focusout",b);const E=new MutationObserver(C);return a&&E.observe(a,{childList:!0,subtree:!0}),()=>{document.removeEventListener("focusin",x),document.removeEventListener("focusout",b),E.disconnect()}}},[r,a,f.paused]),S.useEffect(()=>{if(a){TC.add(f);const m=document.activeElement;if(!a.contains(m)){const w=new CustomEvent(Ay,IC);a.addEventListener(Ay,l),a.dispatchEvent(w),w.defaultPrevented||(pL(wL(nT(a)),{select:!0}),document.activeElement===m&&ko(a))}return()=>{a.removeEventListener(Ay,l),setTimeout(()=>{const w=new CustomEvent(My,IC);a.addEventListener(My,u),a.dispatchEvent(w),w.defaultPrevented||ko(m??document.body,{select:!0}),a.removeEventListener(My,u),TC.remove(f)},0)}}},[a,l,u,f]);const p=S.useCallback(m=>{if(!n&&!r||f.paused)return;const v=m.key==="Tab"&&!m.altKey&&!m.ctrlKey&&!m.metaKey,w=document.activeElement;if(v&&w){const x=m.currentTarget,[b,C]=gL(x);b&&C?!m.shiftKey&&w===C?(m.preventDefault(),n&&ko(b,{select:!0})):m.shiftKey&&w===b&&(m.preventDefault(),n&&ko(C,{select:!0})):w===x&&m.preventDefault()}},[n,r,f.paused]);return S.createElement(Fe.div,W({tabIndex:-1},i,{ref:h,onKeyDown:p}))});function pL(t,{select:e=!1}={}){const n=document.activeElement;for(const r of t)if(ko(r,{select:e}),document.activeElement!==n)return}function gL(t){const e=nT(t),n=$C(e,t),r=$C(e.reverse(),t);return[n,r]}function nT(t){const e=[],n=document.createTreeWalker(t,NodeFilter.SHOW_ELEMENT,{acceptNode:r=>{const s=r.tagName==="INPUT"&&r.type==="hidden";return r.disabled||r.hidden||s?NodeFilter.FILTER_SKIP:r.tabIndex>=0?NodeFilter.FILTER_ACCEPT:NodeFilter.FILTER_SKIP}});for(;n.nextNode();)e.push(n.currentNode);return e}function $C(t,e){for(const n of t)if(!mL(n,{upTo:e}))return n}function mL(t,{upTo:e}){if(getComputedStyle(t).visibility==="hidden")return!0;for(;t;){if(e!==void 0&&t===e)return!1;if(getComputedStyle(t).display==="none")return!0;t=t.parentElement}return!1}function yL(t){return t instanceof HTMLInputElement&&"select"in t}function ko(t,{select:e=!1}={}){if(t&&t.focus){const n=document.activeElement;t.focus({preventScroll:!0}),t!==n&&yL(t)&&e&&t.select()}}const TC=vL();function vL(){let t=[];return{add(e){const n=t[0];e!==n&&(n==null||n.pause()),t=AC(t,e),t.unshift(e)},remove(e){var n;t=AC(t,e),(n=t[0])===null||n===void 0||n.resume()}}}function AC(t,e){const n=[...t],r=n.indexOf(e);return r!==-1&&n.splice(r,1),n}function wL(t){return t.filter(e=>e.tagName!=="A")}const N1=S.forwardRef((t,e)=>{var n;const{container:r=globalThis==null||(n=globalThis.document)===null||n===void 0?void 0:n.body,...s}=t;return r?Z$.createPortal(S.createElement(Fe.div,W({},s,{ref:e})),r):null});function SL(t,e){return S.useReducer((n,r)=>{const s=e[n][r];return s??n},t)}const io=t=>{const{present:e,children:n}=t,r=xL(e),s=typeof n=="function"?n({present:r.isPresent}):S.Children.only(n),o=et(r.ref,s.ref);return typeof n=="function"||r.isPresent?S.cloneElement(s,{ref:o}):null};io.displayName="Presence";function xL(t){const[e,n]=S.useState(),r=S.useRef({}),s=S.useRef(t),o=S.useRef("none"),i=t?"mounted":"unmounted",[a,c]=SL(i,{mounted:{UNMOUNT:"unmounted",ANIMATION_OUT:"unmountSuspended"},unmountSuspended:{MOUNT:"mounted",ANIMATION_END:"unmounted"},unmounted:{MOUNT:"mounted"}});return S.useEffect(()=>{const l=Ah(r.current);o.current=a==="mounted"?l:"none"},[a]),ua(()=>{const l=r.current,u=s.current;if(u!==t){const h=o.current,f=Ah(l);t?c("MOUNT"):f==="none"||(l==null?void 0:l.display)==="none"?c("UNMOUNT"):c(u&&h!==f?"ANIMATION_OUT":"UNMOUNT"),s.current=t}},[t,c]),ua(()=>{if(e){const l=d=>{const f=Ah(r.current).includes(d.animationName);d.target===e&&f&&so.flushSync(()=>c("ANIMATION_END"))},u=d=>{d.target===e&&(o.current=Ah(r.current))};return e.addEventListener("animationstart",u),e.addEventListener("animationcancel",l),e.addEventListener("animationend",l),()=>{e.removeEventListener("animationstart",u),e.removeEventListener("animationcancel",l),e.removeEventListener("animationend",l)}}else c("ANIMATION_END")},[e,c]),{isPresent:["mounted","unmountSuspended"].includes(a),ref:S.useCallback(l=>{l&&(r.current=getComputedStyle(l)),n(l)},[])}}function Ah(t){return(t==null?void 0:t.animationName)||"none"}let Oy=0;function rT(){S.useEffect(()=>{var t,e;const n=document.querySelectorAll("[data-radix-focus-guard]");return document.body.insertAdjacentElement("afterbegin",(t=n[0])!==null&&t!==void 0?t:MC()),document.body.insertAdjacentElement("beforeend",(e=n[1])!==null&&e!==void 0?e:MC()),Oy++,()=>{Oy===1&&document.querySelectorAll("[data-radix-focus-guard]").forEach(r=>r.remove()),Oy--}},[])}function MC(){const t=document.createElement("span");return t.setAttribute("data-radix-focus-guard",""),t.tabIndex=0,t.style.cssText="outline: none; opacity: 0; position: fixed; pointer-events: none",t}var rs=function(){return rs=Object.assign||function(e){for(var n,r=1,s=arguments.length;r<s;r++){n=arguments[r];for(var o in n)Object.prototype.hasOwnProperty.call(n,o)&&(e[o]=n[o])}return e},rs.apply(this,arguments)};function sT(t,e){var n={};for(var r in t)Object.prototype.hasOwnProperty.call(t,r)&&e.indexOf(r)<0&&(n[r]=t[r]);if(t!=null&&typeof Object.getOwnPropertySymbols=="function")for(var s=0,r=Object.getOwnPropertySymbols(t);s<r.length;s++)e.indexOf(r[s])<0&&Object.prototype.propertyIsEnumerable.call(t,r[s])&&(n[r[s]]=t[r[s]]);return n}function bL(t,e,n){if(n||arguments.length===2)for(var r=0,s=e.length,o;r<s;r++)(o||!(r in e))&&(o||(o=Array.prototype.slice.call(e,0,r)),o[r]=e[r]);return t.concat(o||Array.prototype.slice.call(e))}var $f="right-scroll-bar-position",Tf="width-before-scroll-bar",CL="with-scroll-bars-hidden",_L="--removed-body-scroll-bar-size";function EL(t,e){return typeof t=="function"?t(e):t&&(t.current=e),t}function PL(t,e){var n=S.useState(function(){return{value:t,callback:e,facade:{get current(){return n.value},set current(r){var s=n.value;s!==r&&(n.value=r,n.callback(r,s))}}}})[0];return n.callback=e,n.facade}function kL(t,e){return PL(e||null,function(n){return t.forEach(function(r){return EL(r,n)})})}function IL(t){return t}function $L(t,e){e===void 0&&(e=IL);var n=[],r=!1,s={read:function(){if(r)throw new Error("Sidecar: could not `read` from an `assigned` medium. `read` could be used only with `useMedium`.");return n.length?n[n.length-1]:t},useMedium:function(o){var i=e(o,r);return n.push(i),function(){n=n.filter(function(a){return a!==i})}},assignSyncMedium:function(o){for(r=!0;n.length;){var i=n;n=[],i.forEach(o)}n={push:function(a){return o(a)},filter:function(){return n}}},assignMedium:function(o){r=!0;var i=[];if(n.length){var a=n;n=[],a.forEach(o),i=n}var c=function(){var u=i;i=[],u.forEach(o)},l=function(){return Promise.resolve().then(c)};l(),n={push:function(u){i.push(u),l()},filter:function(u){return i=i.filter(u),n}}}};return s}function TL(t){t===void 0&&(t={});var e=$L(null);return e.options=rs({async:!0,ssr:!1},t),e}var oT=function(t){var e=t.sideCar,n=sT(t,["sideCar"]);if(!e)throw new Error("Sidecar: please provide `sideCar` property to import the right car");var r=e.read();if(!r)throw new Error("Sidecar medium not found");return S.createElement(r,rs({},n))};oT.isSideCarExport=!0;function AL(t,e){return t.useMedium(e),oT}var iT=TL(),Dy=function(){},om=S.forwardRef(function(t,e){var n=S.useRef(null),r=S.useState({onScrollCapture:Dy,onWheelCapture:Dy,onTouchMoveCapture:Dy}),s=r[0],o=r[1],i=t.forwardProps,a=t.children,c=t.className,l=t.removeScrollBar,u=t.enabled,d=t.shards,h=t.sideCar,f=t.noIsolation,p=t.inert,m=t.allowPinchZoom,v=t.as,w=v===void 0?"div":v,x=sT(t,["forwardProps","children","className","removeScrollBar","enabled","shards","sideCar","noIsolation","inert","allowPinchZoom","as"]),b=h,C=kL([n,e]),E=rs(rs({},x),s);return S.createElement(S.Fragment,null,u&&S.createElement(b,{sideCar:iT,removeScrollBar:l,shards:d,noIsolation:f,inert:p,setCallbacks:o,allowPinchZoom:!!m,lockRef:n}),i?S.cloneElement(S.Children.only(a),rs(rs({},E),{ref:C})):S.createElement(w,rs({},E,{className:c,ref:C}),a))});om.defaultProps={enabled:!0,removeScrollBar:!0,inert:!1};om.classNames={fullWidth:Tf,zeroRight:$f};var OC,ML=function(){if(OC)return OC;if(typeof __webpack_nonce__<"u")return __webpack_nonce__};function OL(){if(!document)return null;var t=document.createElement("style");t.type="text/css";var e=ML();return e&&t.setAttribute("nonce",e),t}function DL(t,e){t.styleSheet?t.styleSheet.cssText=e:t.appendChild(document.createTextNode(e))}function RL(t){var e=document.head||document.getElementsByTagName("head")[0];e.appendChild(t)}var LL=function(){var t=0,e=null;return{add:function(n){t==0&&(e=OL())&&(DL(e,n),RL(e)),t++},remove:function(){t--,!t&&e&&(e.parentNode&&e.parentNode.removeChild(e),e=null)}}},jL=function(){var t=LL();return function(e,n){S.useEffect(function(){return t.add(e),function(){t.remove()}},[e&&n])}},aT=function(){var t=jL(),e=function(n){var r=n.styles,s=n.dynamic;return t(r,s),null};return e},NL={left:0,top:0,right:0,gap:0},Ry=function(t){return parseInt(t||"",10)||0},zL=function(t){var e=window.getComputedStyle(document.body),n=e[t==="padding"?"paddingLeft":"marginLeft"],r=e[t==="padding"?"paddingTop":"marginTop"],s=e[t==="padding"?"paddingRight":"marginRight"];return[Ry(n),Ry(r),Ry(s)]},FL=function(t){if(t===void 0&&(t="margin"),typeof window>"u")return NL;var e=zL(t),n=document.documentElement.clientWidth,r=window.innerWidth;return{left:e[0],top:e[1],right:e[2],gap:Math.max(0,r-n+e[2]-e[0])}},BL=aT(),UL=function(t,e,n,r){var s=t.left,o=t.top,i=t.right,a=t.gap;return n===void 0&&(n="margin"),`
  .`.concat(CL,` {
   overflow: hidden `).concat(r,`;
   padding-right: `).concat(a,"px ").concat(r,`;
  }
  body {
    overflow: hidden `).concat(r,`;
    overscroll-behavior: contain;
    `).concat([e&&"position: relative ".concat(r,";"),n==="margin"&&`
    padding-left: `.concat(s,`px;
    padding-top: `).concat(o,`px;
    padding-right: `).concat(i,`px;
    margin-left:0;
    margin-top:0;
    margin-right: `).concat(a,"px ").concat(r,`;
    `),n==="padding"&&"padding-right: ".concat(a,"px ").concat(r,";")].filter(Boolean).join(""),`
  }
  
  .`).concat($f,` {
    right: `).concat(a,"px ").concat(r,`;
  }
  
  .`).concat(Tf,` {
    margin-right: `).concat(a,"px ").concat(r,`;
  }
  
  .`).concat($f," .").concat($f,` {
    right: 0 `).concat(r,`;
  }
  
  .`).concat(Tf," .").concat(Tf,` {
    margin-right: 0 `).concat(r,`;
  }
  
  body {
    `).concat(_L,": ").concat(a,`px;
  }
`)},HL=function(t){var e=t.noRelative,n=t.noImportant,r=t.gapMode,s=r===void 0?"margin":r,o=S.useMemo(function(){return FL(s)},[s]);return S.createElement(BL,{styles:UL(o,!e,s,n?"":"!important")})},Pw=!1;if(typeof window<"u")try{var Mh=Object.defineProperty({},"passive",{get:function(){return Pw=!0,!0}});window.addEventListener("test",Mh,Mh),window.removeEventListener("test",Mh,Mh)}catch{Pw=!1}var Fa=Pw?{passive:!1}:!1,KL=function(t){return t.tagName==="TEXTAREA"},cT=function(t,e){var n=window.getComputedStyle(t);return n[e]!=="hidden"&&!(n.overflowY===n.overflowX&&!KL(t)&&n[e]==="visible")},VL=function(t){return cT(t,"overflowY")},WL=function(t){return cT(t,"overflowX")},DC=function(t,e){var n=e;do{typeof ShadowRoot<"u"&&n instanceof ShadowRoot&&(n=n.host);var r=lT(t,n);if(r){var s=uT(t,n),o=s[1],i=s[2];if(o>i)return!0}n=n.parentNode}while(n&&n!==document.body);return!1},GL=function(t){var e=t.scrollTop,n=t.scrollHeight,r=t.clientHeight;return[e,n,r]},YL=function(t){var e=t.scrollLeft,n=t.scrollWidth,r=t.clientWidth;return[e,n,r]},lT=function(t,e){return t==="v"?VL(e):WL(e)},uT=function(t,e){return t==="v"?GL(e):YL(e)},XL=function(t,e){return t==="h"&&e==="rtl"?-1:1},qL=function(t,e,n,r,s){var o=XL(t,window.getComputedStyle(e).direction),i=o*r,a=n.target,c=e.contains(a),l=!1,u=i>0,d=0,h=0;do{var f=uT(t,a),p=f[0],m=f[1],v=f[2],w=m-v-o*p;(p||w)&&lT(t,a)&&(d+=w,h+=p),a=a.parentNode}while(!c&&a!==document.body||c&&(e.contains(a)||e===a));return(u&&(s&&d===0||!s&&i>d)||!u&&(s&&h===0||!s&&-i>h))&&(l=!0),l},Oh=function(t){return"changedTouches"in t?[t.changedTouches[0].clientX,t.changedTouches[0].clientY]:[0,0]},RC=function(t){return[t.deltaX,t.deltaY]},LC=function(t){return t&&"current"in t?t.current:t},QL=function(t,e){return t[0]===e[0]&&t[1]===e[1]},ZL=function(t){return`
  .block-interactivity-`.concat(t,` {pointer-events: none;}
  .allow-interactivity-`).concat(t,` {pointer-events: all;}
`)},JL=0,Ba=[];function e7(t){var e=S.useRef([]),n=S.useRef([0,0]),r=S.useRef(),s=S.useState(JL++)[0],o=S.useState(function(){return aT()})[0],i=S.useRef(t);S.useEffect(function(){i.current=t},[t]),S.useEffect(function(){if(t.inert){document.body.classList.add("block-interactivity-".concat(s));var m=bL([t.lockRef.current],(t.shards||[]).map(LC),!0).filter(Boolean);return m.forEach(function(v){return v.classList.add("allow-interactivity-".concat(s))}),function(){document.body.classList.remove("block-interactivity-".concat(s)),m.forEach(function(v){return v.classList.remove("allow-interactivity-".concat(s))})}}},[t.inert,t.lockRef.current,t.shards]);var a=S.useCallback(function(m,v){if("touches"in m&&m.touches.length===2)return!i.current.allowPinchZoom;var w=Oh(m),x=n.current,b="deltaX"in m?m.deltaX:x[0]-w[0],C="deltaY"in m?m.deltaY:x[1]-w[1],E,_=m.target,k=Math.abs(b)>Math.abs(C)?"h":"v";if("touches"in m&&k==="h"&&_.type==="range")return!1;var I=DC(k,_);if(!I)return!0;if(I?E=k:(E=k==="v"?"h":"v",I=DC(k,_)),!I)return!1;if(!r.current&&"changedTouches"in m&&(b||C)&&(r.current=E),!E)return!0;var $=r.current||E;return qL($,v,m,$==="h"?b:C,!0)},[]),c=S.useCallback(function(m){var v=m;if(!(!Ba.length||Ba[Ba.length-1]!==o)){var w="deltaY"in v?RC(v):Oh(v),x=e.current.filter(function(E){return E.name===v.type&&E.target===v.target&&QL(E.delta,w)})[0];if(x&&x.should){v.cancelable&&v.preventDefault();return}if(!x){var b=(i.current.shards||[]).map(LC).filter(Boolean).filter(function(E){return E.contains(v.target)}),C=b.length>0?a(v,b[0]):!i.current.noIsolation;C&&v.cancelable&&v.preventDefault()}}},[]),l=S.useCallback(function(m,v,w,x){var b={name:m,delta:v,target:w,should:x};e.current.push(b),setTimeout(function(){e.current=e.current.filter(function(C){return C!==b})},1)},[]),u=S.useCallback(function(m){n.current=Oh(m),r.current=void 0},[]),d=S.useCallback(function(m){l(m.type,RC(m),m.target,a(m,t.lockRef.current))},[]),h=S.useCallback(function(m){l(m.type,Oh(m),m.target,a(m,t.lockRef.current))},[]);S.useEffect(function(){return Ba.push(o),t.setCallbacks({onScrollCapture:d,onWheelCapture:d,onTouchMoveCapture:h}),document.addEventListener("wheel",c,Fa),document.addEventListener("touchmove",c,Fa),document.addEventListener("touchstart",u,Fa),function(){Ba=Ba.filter(function(m){return m!==o}),document.removeEventListener("wheel",c,Fa),document.removeEventListener("touchmove",c,Fa),document.removeEventListener("touchstart",u,Fa)}},[]);var f=t.removeScrollBar,p=t.inert;return S.createElement(S.Fragment,null,p?S.createElement(o,{styles:ZL(s)}):null,f?S.createElement(HL,{gapMode:"margin"}):null)}const t7=AL(iT,e7);var dT=S.forwardRef(function(t,e){return S.createElement(om,rs({},t,{ref:e,sideCar:t7}))});dT.classNames=om.classNames;const z1=dT;var n7=function(t){if(typeof document>"u")return null;var e=Array.isArray(t)?t[0]:t;return e.ownerDocument.body},Ua=new WeakMap,Dh=new WeakMap,Rh={},Ly=0,hT=function(t){return t&&(t.host||hT(t.parentNode))},r7=function(t,e){return e.map(function(n){if(t.contains(n))return n;var r=hT(n);return r&&t.contains(r)?r:(console.error("aria-hidden",n,"in not contained inside",t,". Doing nothing"),null)}).filter(function(n){return!!n})},s7=function(t,e,n,r){var s=r7(e,Array.isArray(t)?t:[t]);Rh[n]||(Rh[n]=new WeakMap);var o=Rh[n],i=[],a=new Set,c=new Set(s),l=function(d){!d||a.has(d)||(a.add(d),l(d.parentNode))};s.forEach(l);var u=function(d){!d||c.has(d)||Array.prototype.forEach.call(d.children,function(h){if(a.has(h))u(h);else{var f=h.getAttribute(r),p=f!==null&&f!=="false",m=(Ua.get(h)||0)+1,v=(o.get(h)||0)+1;Ua.set(h,m),o.set(h,v),i.push(h),m===1&&p&&Dh.set(h,!0),v===1&&h.setAttribute(n,"true"),p||h.setAttribute(r,"true")}})};return u(e),a.clear(),Ly++,function(){i.forEach(function(d){var h=Ua.get(d)-1,f=o.get(d)-1;Ua.set(d,h),o.set(d,f),h||(Dh.has(d)||d.removeAttribute(r),Dh.delete(d)),f||d.removeAttribute(n)}),Ly--,Ly||(Ua=new WeakMap,Ua=new WeakMap,Dh=new WeakMap,Rh={})}},F1=function(t,e,n){n===void 0&&(n="data-aria-hidden");var r=Array.from(Array.isArray(t)?t:[t]),s=e||n7(t);return s?(r.push.apply(r,Array.from(s.querySelectorAll("[aria-live]"))),s7(r,s,n,"aria-hidden")):function(){return null}};const fT="Dialog",[pT,$le]=oo(fT),[o7,ao]=pT(fT),i7=t=>{const{__scopeDialog:e,children:n,open:r,defaultOpen:s,onOpenChange:o,modal:i=!0}=t,a=S.useRef(null),c=S.useRef(null),[l=!1,u]=Ca({prop:r,defaultProp:s,onChange:o});return S.createElement(o7,{scope:e,triggerRef:a,contentRef:c,contentId:Zo(),titleId:Zo(),descriptionId:Zo(),open:l,onOpenChange:u,onOpenToggle:S.useCallback(()=>u(d=>!d),[u]),modal:i},n)},gT="DialogPortal",[a7,mT]=pT(gT,{forceMount:void 0}),c7=t=>{const{__scopeDialog:e,forceMount:n,children:r,container:s}=t,o=ao(gT,e);return S.createElement(a7,{scope:e,forceMount:n},S.Children.map(r,i=>S.createElement(io,{present:n||o.open},S.createElement(N1,{asChild:!0,container:s},i))))},kw="DialogOverlay",l7=S.forwardRef((t,e)=>{const n=mT(kw,t.__scopeDialog),{forceMount:r=n.forceMount,...s}=t,o=ao(kw,t.__scopeDialog);return o.modal?S.createElement(io,{present:r||o.open},S.createElement(u7,W({},s,{ref:e}))):null}),u7=S.forwardRef((t,e)=>{const{__scopeDialog:n,...r}=t,s=ao(kw,n);return S.createElement(z1,{as:Hc,allowPinchZoom:!0,shards:[s.contentRef]},S.createElement(Fe.div,W({"data-state":vT(s.open)},r,{ref:e,style:{pointerEvents:"auto",...r.style}})))}),Ku="DialogContent",d7=S.forwardRef((t,e)=>{const n=mT(Ku,t.__scopeDialog),{forceMount:r=n.forceMount,...s}=t,o=ao(Ku,t.__scopeDialog);return S.createElement(io,{present:r||o.open},o.modal?S.createElement(h7,W({},s,{ref:e})):S.createElement(f7,W({},s,{ref:e})))}),h7=S.forwardRef((t,e)=>{const n=ao(Ku,t.__scopeDialog),r=S.useRef(null),s=et(e,n.contentRef,r);return S.useEffect(()=>{const o=r.current;if(o)return F1(o)},[]),S.createElement(yT,W({},t,{ref:s,trapFocus:n.open,disableOutsidePointerEvents:!0,onCloseAutoFocus:oe(t.onCloseAutoFocus,o=>{var i;o.preventDefault(),(i=n.triggerRef.current)===null||i===void 0||i.focus()}),onPointerDownOutside:oe(t.onPointerDownOutside,o=>{const i=o.detail.originalEvent,a=i.button===0&&i.ctrlKey===!0;(i.button===2||a)&&o.preventDefault()}),onFocusOutside:oe(t.onFocusOutside,o=>o.preventDefault())}))}),f7=S.forwardRef((t,e)=>{const n=ao(Ku,t.__scopeDialog),r=S.useRef(!1),s=S.useRef(!1);return S.createElement(yT,W({},t,{ref:e,trapFocus:!1,disableOutsidePointerEvents:!1,onCloseAutoFocus:o=>{var i;if((i=t.onCloseAutoFocus)===null||i===void 0||i.call(t,o),!o.defaultPrevented){var a;r.current||(a=n.triggerRef.current)===null||a===void 0||a.focus(),o.preventDefault()}r.current=!1,s.current=!1},onInteractOutside:o=>{var i,a;(i=t.onInteractOutside)===null||i===void 0||i.call(t,o),o.defaultPrevented||(r.current=!0,o.detail.originalEvent.type==="pointerdown"&&(s.current=!0));const c=o.target;((a=n.triggerRef.current)===null||a===void 0?void 0:a.contains(c))&&o.preventDefault(),o.detail.originalEvent.type==="focusin"&&s.current&&o.preventDefault()}}))}),yT=S.forwardRef((t,e)=>{const{__scopeDialog:n,trapFocus:r,onOpenAutoFocus:s,onCloseAutoFocus:o,...i}=t,a=ao(Ku,n),c=S.useRef(null),l=et(e,c);return rT(),S.createElement(S.Fragment,null,S.createElement(tT,{asChild:!0,loop:!0,trapped:r,onMountAutoFocus:s,onUnmountAutoFocus:o},S.createElement(j1,W({role:"dialog",id:a.contentId,"aria-describedby":a.descriptionId,"aria-labelledby":a.titleId,"data-state":vT(a.open)},i,{ref:l,onDismiss:()=>a.onOpenChange(!1)}))),!1)}),p7="DialogTitle",g7=S.forwardRef((t,e)=>{const{__scopeDialog:n,...r}=t,s=ao(p7,n);return S.createElement(Fe.h2,W({id:s.titleId},r,{ref:e}))}),m7="DialogClose",y7=S.forwardRef((t,e)=>{const{__scopeDialog:n,...r}=t,s=ao(m7,n);return S.createElement(Fe.button,W({type:"button"},r,{ref:e,onClick:oe(t.onClick,()=>s.onOpenChange(!1))}))});function vT(t){return t?"open":"closed"}const v7=i7,w7=c7,S7=l7,x7=d7;var wT={exports:{}};/*!
	Copyright (c) 2018 Jed Watson.
	Licensed under the MIT License (MIT), see
	http://jedwatson.github.io/classnames
*/(function(t){(function(){var e={}.hasOwnProperty;function n(){for(var r=[],s=0;s<arguments.length;s++){var o=arguments[s];if(o){var i=typeof o;if(i==="string"||i==="number")r.push(o);else if(Array.isArray(o)){if(o.length){var a=n.apply(null,o);a&&r.push(a)}}else if(i==="object"){if(o.toString!==Object.prototype.toString&&!o.toString.toString().includes("[native code]")){r.push(o.toString());continue}for(var c in o)e.call(o,c)&&o[c]&&r.push(c)}}}return r.join(" ")}t.exports?(n.default=n,t.exports=n):window.classNames=n})()})(wT);var b7=wT.exports;const le=Sa(b7),jC=8;class ST{constructor(){y(this,"arraySize",0);y(this,"array",Array(jC));y(this,"set",null)}get isEmpty(){if(this.array)return this.arraySize===0;if(this.set)return this.set.size===0;throw new Error("no set or array")}add(e){if(this.array)return this.array.indexOf(e)!==-1?!1:this.arraySize<jC?(this.array[this.arraySize]=e,this.arraySize++,!0):(this.set=new Set(this.array),this.array=null,this.set.add(e),!0);if(this.set)return this.set.has(e)?!1:(this.set.add(e),!0);throw new Error("no set or array")}remove(e){if(this.array){const n=this.array.indexOf(e);return n===-1?!1:(this.array[n]=void 0,this.arraySize--,n!==this.arraySize&&(this.array[n]=this.array[this.arraySize],this.array[this.arraySize]=void 0),!0)}if(this.set)return this.set.has(e)?(this.set.delete(e),!0):!1;throw new Error("no set or array")}visit(e){if(this.array){for(let n=0;n<this.arraySize;n++){const r=this.array[n];typeof r<"u"&&e(r)}return}if(this.set){this.set.forEach(e);return}throw new Error("no set or array")}}function xT(t){return t&&typeof t=="object"&&"parents"in t}function bT(t){for(let e=0,n=t.parents.length;e<n;e++)if(t.parents[e].__unsafe__getWithoutCapture(),t.parents[e].lastChangedEpoch!==t.parentEpochs[e])return!0;return!1}const Hp=(t,e)=>{if(t.children.remove(e)&&t.children.isEmpty&&xT(t))for(let n=0,r=t.parents.length;n<r;n++)Hp(t.parents[n],t)},B1=(t,e)=>{if(t.children.add(e)&&xT(t))for(let n=0,r=t.parents.length;n<r;n++)B1(t.parents[n],t)};function CT(t,e){return t===e||Object.is(t,e)||!!(t&&e&&typeof t.equals=="function"&&t.equals(e))}const Fs=Object.freeze([]),NC=Symbol.for("__@tldraw/state__"),zC=globalThis;zC[NC]?console.error('Multiple versions of @tldraw/state detected. This will cause unexpected behavior. Please add "resolutions" (yarn/pnpm) or "overrides" (npm) in your package.json to ensure only one version of @tldraw/state is loaded.'):zC[NC]=!0;class C7{constructor(e,n){y(this,"offset",0);y(this,"numNewParents",0);y(this,"maybeRemoved");this.below=e,this.child=n}}let ze=null;function _T(t){ze=new C7(ze,t)}function ET(){const t=ze;if(ze=t.below,t.numNewParents>0||t.offset!==t.child.parents.length){for(let n=t.offset;n<t.child.parents.length;n++){const r=t.child.parents[n];t.child.parents.indexOf(r)>=t.offset&&Hp(r,t.child)}if(t.child.parents.length=t.offset,t.child.parentEpochs.length=t.offset,ze!=null&&ze.maybeRemoved)for(let n=0;n<ze.maybeRemoved.length;n++){const r=ze.maybeRemoved[n];t.child.parents.indexOf(r)===-1&&Hp(r,t.child)}}}function Iw(t){if(ze){const e=ze.child.parents.indexOf(t);if(e<0&&(ze.numNewParents++,ze.child.isActivelyListening&&B1(t,ze.child)),e<0||e>=ze.offset){if(e!==ze.offset&&e>0){const n=ze.child.parents[ze.offset];ze.maybeRemoved?ze.maybeRemoved.indexOf(n)===-1&&ze.maybeRemoved.push(n):ze.maybeRemoved=[n]}ze.child.parents[ze.offset]=t,ze.child.parentEpochs[ze.offset]=t.lastChangedEpoch,ze.offset++}}}const Gn=Symbol("RESET_VALUE");class PT{constructor(e){y(this,"index",0);y(this,"buffer");this.capacity=e,this.buffer=new Array(e)}pushEntry(e,n,r){if(r!==void 0){if(r===Gn){this.clear();return}this.buffer[this.index]=[e,n,r],this.index=(this.index+1)%this.capacity}}clear(){this.index=0,this.buffer.fill(void 0)}getChangesSince(e){const{index:n,capacity:r,buffer:s}=this;for(let o=0;o<r;o++){const i=(n-1+r-o)%r,a=s[i];if(!a)return Gn;const[c,l]=a;if(o===0&&e>=l)return[];if(c<=e&&e<l){const u=o+1,d=new Array(u);for(let h=0;h<u;h++)d[h]=s[(i+h)%r][2];return d}}return Gn}}const Ui=-1;let jt=Ui+1,jy=!1;function _7(){jt++}let E7=class{constructor(e){y(this,"initialAtomValues",new Map);this.parent=e}get isRoot(){return this.parent===null}commit(){if(this.isRoot){const e=this.initialAtomValues;this.initialAtomValues=new Map,kT(e.keys())}else this.initialAtomValues.forEach((e,n)=>{this.parent.initialAtomValues.has(n)||this.parent.initialAtomValues.set(n,e)})}abort(){jt++,this.initialAtomValues.forEach((e,n)=>{var r;n.set(e),(r=n.historyBuffer)==null||r.clear()}),this.commit()}};function kT(t){if(jy)throw new Error("cannot change atoms during reaction cycle");try{jy=!0;const e=new Set,n=r=>{r.lastTraversedEpoch!==jt&&(r.lastTraversedEpoch=jt,"maybeScheduleEffect"in r?e.add(r):r.children.visit(n))};for(const r of t)r.children.visit(n);for(const r of e)r.maybeScheduleEffect()}finally{jy=!1}}function P7(t,e){zo?zo.initialAtomValues.has(t)||zo.initialAtomValues.set(t,e):kT([t])}let zo=null;function k7(t){const e=new E7(zo);zo=e;try{let n=!1;const r=t(()=>n=!0);return n?e.abort():e.commit(),r}catch(n){throw e.abort(),n}finally{zo=zo.parent}}function ur(t){return zo?t():k7(t)}class I7{constructor(e,n,r){y(this,"isEqual");y(this,"computeDiff");y(this,"lastChangedEpoch",jt);y(this,"children",new ST);y(this,"historyBuffer");this.name=e,this.current=n,this.isEqual=(r==null?void 0:r.isEqual)??null,r&&(r.historyLength&&(this.historyBuffer=new PT(r.historyLength)),this.computeDiff=r.computeDiff)}__unsafe__getWithoutCapture(){return this.current}get value(){return Iw(this),this.current}set(e,n){var s,o;if(((s=this.isEqual)==null?void 0:s.call(this,this.current,e))??CT(this.current,e))return this.current;_7(),this.historyBuffer&&this.historyBuffer.pushEntry(this.lastChangedEpoch,jt,n??((o=this.computeDiff)==null?void 0:o.call(this,this.current,e,this.lastChangedEpoch,jt))??Gn),this.lastChangedEpoch=jt;const r=this.current;return this.current=e,P7(this,r),e}update(e){return this.set(e(this.current))}getDiffSince(e){var n;return Iw(this),e>=this.lastChangedEpoch?Fs:((n=this.historyBuffer)==null?void 0:n.getChangesSince(e))??Gn}}function Cn(t,e,n){return new I7(t,e,n)}const $w=Symbol("UNINITIALIZED"),Ic=t=>t===$w;class Tw{constructor(e,n){this.value=e,this.diff=n}}function ru(t,e){return new Tw(t,e)}class IT{constructor(e,n,r){y(this,"lastChangedEpoch",Ui);y(this,"lastTraversedEpoch",Ui);y(this,"lastCheckedEpoch",Ui);y(this,"parents",[]);y(this,"parentEpochs",[]);y(this,"children",new ST);y(this,"historyBuffer");y(this,"state",$w);y(this,"computeDiff");y(this,"isEqual");this.name=e,this.derive=n,r!=null&&r.historyLength&&(this.historyBuffer=new PT(r.historyLength)),this.computeDiff=r==null?void 0:r.computeDiff,this.isEqual=(r==null?void 0:r.isEqual)??CT}get isActivelyListening(){return!this.children.isEmpty}__unsafe__getWithoutCapture(){var n;const e=this.lastChangedEpoch===Ui;if(!e&&(this.lastCheckedEpoch===jt||!bT(this)))return this.lastCheckedEpoch=jt,this.state;try{_T(this);const r=this.derive(this.state,this.lastCheckedEpoch),s=r instanceof Tw?r.value:r;if(this.state===$w||!this.isEqual(s,this.state)){if(this.historyBuffer&&!e){const o=r instanceof Tw?r.diff:void 0;this.historyBuffer.pushEntry(this.lastChangedEpoch,jt,o??((n=this.computeDiff)==null?void 0:n.call(this,this.state,s,this.lastCheckedEpoch,jt))??Gn)}this.lastChangedEpoch=jt,this.state=s}return this.lastCheckedEpoch=jt,this.state}finally{ET()}}get value(){const e=this.__unsafe__getWithoutCapture();return Iw(this),e}getDiffSince(e){var n;return this.value,e>=this.lastChangedEpoch?Fs:((n=this.historyBuffer)==null?void 0:n.getChangesSince(e))??Gn}}function FC(t={},e,n,r){const s=r.get,o=Symbol.for("__@tldraw/state__computed__"+n);return r.get=function(){let i=this[o];return i||(i=new IT(n,s.bind(this),t),Object.defineProperty(this,o,{enumerable:!1,configurable:!1,writable:!1,value:i})),i.value},r}function X(){if(arguments.length===1){const t=arguments[0];return(e,n,r)=>FC(t,e,n,r)}else return typeof arguments[0]=="string"?new IT(arguments[0],arguments[1],arguments[2]):FC(void 0,arguments[0],arguments[1],arguments[2])}class $d{constructor(e,n,r){y(this,"_isActivelyListening",!1);y(this,"lastTraversedEpoch",Ui);y(this,"lastReactedEpoch",Ui);y(this,"_scheduleCount",0);y(this,"parentEpochs",[]);y(this,"parents",[]);y(this,"_scheduleEffect");y(this,"maybeExecute",()=>{this._isActivelyListening&&this.execute()});this.name=e,this.runEffect=n,this._scheduleEffect=r==null?void 0:r.scheduleEffect}get isActivelyListening(){return this._isActivelyListening}get scheduleCount(){return this._scheduleCount}maybeScheduleEffect(){if(this._isActivelyListening&&this.lastReactedEpoch!==jt){if(this.parents.length&&!bT(this)){this.lastReactedEpoch=jt;return}this.scheduleEffect()}}scheduleEffect(){this._scheduleCount++,this._scheduleEffect?this._scheduleEffect(this.maybeExecute):this.execute()}attach(){this._isActivelyListening=!0;for(let e=0,n=this.parents.length;e<n;e++)B1(this.parents[e],this)}detach(){this._isActivelyListening=!1;for(let e=0,n=this.parents.length;e<n;e++)Hp(this.parents[e],this)}execute(){try{_T(this);const e=this.runEffect(this.lastReactedEpoch);return this.lastReactedEpoch=jt,e}finally{ET()}}}function Td(t,e,n){const r=new $d(t,e,n);return r.attach(),r.scheduleEffect(),()=>{r.detach()}}function $7(t,e,n){const r=new $d(t,e,n);return{scheduler:r,start:s=>{const o=(s==null?void 0:s.force)??!1;r.attach(),o?r.scheduleEffect():r.maybeScheduleEffect()},stop:()=>{r.detach()}}}function im(t,e){const n=Z.useRef(e);n.current=e;const[r,s,o]=Z.useMemo(()=>{let i=null;const a=u=>(i=u,()=>{i=null}),c=new $d(`useStateTracking(${t})`,()=>{var u;return(u=n.current)==null?void 0:u.call(n)},{scheduleEffect(){i==null||i()}});return[c,a,()=>c.scheduleCount]},[t]);return Z.useSyncExternalStore(s,o,o),Z.useEffect(()=>(r.attach(),r.maybeScheduleEffect(),()=>{r.detach()}),[r]),r.execute()}const BC={apply(t,e,n){return im(t.displayName??t.name??"tracked(???)",()=>t.apply(e,n))}},T7=Symbol.for("react.memo"),A7=Symbol.for("react.forward_ref");function Ee(t){let e=null;const n=t.$$typeof;return n===T7&&(t=t.type,e=t.compare),n===A7?S.memo(S.forwardRef(new Proxy(t.render,BC))):S.memo(new Proxy(t,BC),e)}function $T(){const t=arguments[0],e=arguments[1],n=arguments.length===3?void 0:arguments[2],r=arguments.length===3?arguments[2]:arguments[3];return S.useMemo(()=>X(`useComputed(${t})`,e,n),r)}function Qi(t,e,n=Fs){S.useEffect(()=>{const r=new $d(t,e);return r.attach(),r.execute(),()=>{r.detach()}},n)}function Y(){const t=arguments,e=t.length===3?t[2]:[t[0]],n=t.length===3?t[0]:`useValue(${t[0].name})`,r=S.useRef(!0);r.current=!0;const s=S.useMemo(()=>t.length===1?t[0]:X(n,()=>{if(r.current)return t[1]();try{return t[1]()}catch{return{}}}),e);try{const{subscribe:o,getSnapshot:i}=S.useMemo(()=>({subscribe:a=>Td(`useValue(${n})`,()=>{s.value,a()}),getSnapshot:()=>s.value}),[s]);return S.useSyncExternalStore(o,i,i)}finally{r.current=!1}}class Af{constructor(e){y(this,"nextValue");y(this,"diff");this.previousValue=e}get(){var r,s,o,i;const e=((s=(r=this.diff)==null?void 0:r.removed)==null?void 0:s.size)??0,n=((i=(o=this.diff)==null?void 0:o.added)==null?void 0:i.size)??0;if(!(e===0&&n===0))return{value:this.nextValue,diff:this.diff}}_add(e,n){var r,s;this.nextValue??(this.nextValue=new Set(this.previousValue)),this.nextValue.add(e),this.diff??(this.diff={}),n?(r=this.diff.removed)==null||r.delete(e):((s=this.diff).added??(s.added=new Set),this.diff.added.add(e))}add(e){var s,o,i;const n=this.previousValue.has(e);if(n)return((o=(s=this.diff)==null?void 0:s.removed)==null?void 0:o.has(e))?this._add(e,n):void 0;(i=this.nextValue)!=null&&i.has(e)||this._add(e,n)}_remove(e,n){var r,s;this.nextValue??(this.nextValue=new Set(this.previousValue)),this.nextValue.delete(e),this.diff??(this.diff={}),n?((r=this.diff).removed??(r.removed=new Set),this.diff.removed.add(e)):(s=this.diff.added)==null||s.delete(e)}remove(e){var s,o,i,a;const n=this.previousValue.has(e);if(!n)return((o=(s=this.diff)==null?void 0:s.added)==null?void 0:o.has(e))?this._remove(e,n):void 0;(a=(i=this.diff)==null?void 0:i.removed)!=null&&a.has(e)||this._remove(e,n)}}function Kp(t,e){const n=[];e:for(const r of t){for(const s of n)if(e?e(r,s):r===s)continue e;n.push(r)}return n}function me(t){return t.filter(e=>e!=null)}function Sn(t){return t[t.length-1]}function M7(t,e){let n,r=1/0;for(const s of t){const o=e(s);o<r&&(n=s,r=o)}return n}function TT(t){const e=(...n)=>{try{return t(...n)}catch(r){throw r instanceof Error&&Error.captureStackTrace&&Error.captureStackTrace(r,e),r}};return e}function U1(t,e){const n=e&&t&&typeof t=="object"&&e in t?t[e]:t;throw new Error(`Unknown switch case ${n}`)}const H1=TT((t,e)=>{if(!t)throw new Error(e||"Assertion Error")}),O7=TT((t,e)=>{if(t==null)throw new Error(e??"value must be defined");return t});function K1(t,e){let n;const r=(...s)=>(n||(n={},n.promise=new Promise((o,i)=>{n.resolve=o,n.reject=i})),clearTimeout(n.timeout),n.latestArgs=s,n.timeout=setTimeout(()=>{const o=n;n=void 0;try{o.resolve(t(...o.latestArgs))}catch(i){o.reject(i)}},e),n.promise);return r.cancel=()=>{n&&clearTimeout(n.timeout)},r}const UC=new WeakMap;function V1(t,e){if(typeof t!="object"||t===null)return;let n=UC.get(t);n||(n={tags:{},extras:{}},UC.set(t,n)),e.tags&&(n.tags={...n.tags,...e.tags}),e.extras&&(n.extras={...n.extras,...e.extras})}class D7{static async base64ToFile(e){return fetch(e).then(function(n){return n.arrayBuffer()})}static async fileToBase64(e){return await new Promise((n,r)=>{if(e){const s=new FileReader;s.readAsDataURL(e),s.onload=()=>n(s.result),s.onerror=o=>r(o),s.onabort=o=>r(o)}})}}function Mf(t){let e=0;for(let n=0;n<t.length;n++)e=(e<<5)-e+t.charCodeAt(n),e|=0;return e+""}let Aw=[0,1996959894,3993919788,2567524794,124634137,1886057615,3915621685,2657392035,249268274,2044508324,3772115230,2547177864,162941995,2125561021,3887607047,2428444049,498536548,1789927666,4089016648,2227061214,450548861,1843258603,4107580753,2211677639,325883990,1684777152,4251122042,2321926636,335633487,1661365465,4195302755,2366115317,997073096,1281953886,3579855332,2724688242,1006888145,1258607687,3524101629,2768942443,901097722,1119000684,3686517206,2898065728,853044451,1172266101,3705015759,2882616665,651767980,1373503546,3369554304,3218104598,565507253,1454621731,3485111705,3099436303,671266974,1594198024,3322730930,2970347812,795835527,1483230225,3244367275,3060149565,1994146192,31158534,2563907772,4023717930,1907459465,112637215,2680153253,3904427059,2013776290,251722036,2517215374,3775830040,2137656763,141376813,2439277719,3865271297,1802195444,476864866,2238001368,4066508878,1812370925,453092731,2181625025,4111451223,1706088902,314042704,2344532202,4240017532,1658658271,366619977,2362670323,4224994405,1303535960,984961486,2747007092,3569037538,1256170817,1037604311,2765210733,3554079995,1131014506,879679996,2909243462,3663771856,1141124467,855842277,2852801631,3708648649,1342533948,654459306,3188396048,3373015174,1466479909,544179635,3110523913,3462522015,1591671054,702138776,2966460450,3352799412,1504918807,783551873,3082640443,3233442989,3988292384,2596254646,62317068,1957810842,3939845945,2647816111,81470997,1943803523,3814918930,2489596804,225274430,2053790376,3826175755,2466906013,167816743,2097651377,4027552580,2265490386,503444072,1762050814,4150417245,2154129355,426522225,1852507879,4275313526,2312317920,282753626,1742555852,4189708143,2394877945,397917763,1622183637,3604390888,2714866558,953729732,1340076626,3518719985,2797360999,1068828381,1219638859,3624741850,2936675148,906185462,1090812512,3747672003,2825379669,829329135,1181335161,3412177804,3160834842,628085408,1382605366,3423369109,3138078467,570562233,1426400815,3317316542,2998733608,733239954,1555261956,3268935591,3050360625,752459403,1541320221,2607071920,3965973030,1969922972,40735498,2617837225,3943577151,1913087877,83908371,2512341634,3803740692,2075208622,213261112,2463272603,3855990285,2094854071,198958881,2262029012,4057260610,1759359992,534414190,2176718541,4139329115,1873836001,414664567,2282248934,4279200368,1711684554,285281116,2405801727,4167216745,1634467795,376229701,2685067896,3608007406,1308918612,956543938,2808555105,3495958263,1231636301,1047427035,2932959818,3654703836,1088359270,936918e3,2847714899,3736837829,1202900863,817233897,3183342108,3401237130,1404277552,615818150,3134207493,3453421203,1423857449,601450431,3009837614,3294710456,1567103746,711928724,3020668471,3272380065,1510334235,755167117];typeof Int32Array<"u"&&(Aw=new Int32Array(Aw));const R7=(t,e)=>{let n=e===0?0:~~e^-1;for(let r=0;r<t.length;r++)n=Aw[(n^t[r])&255]^n>>>8;return n^-1},HC=4,KC=4;class ss{static isPng(e,n){return e.getUint8(n+0)===137&&e.getUint8(n+1)===80&&e.getUint8(n+2)===78&&e.getUint8(n+3)===71&&e.getUint8(n+4)===13&&e.getUint8(n+5)===10&&e.getUint8(n+6)===26&&e.getUint8(n+7)===10}static getChunkType(e,n){return[String.fromCharCode(e.getUint8(n)),String.fromCharCode(e.getUint8(n+1)),String.fromCharCode(e.getUint8(n+2)),String.fromCharCode(e.getUint8(n+3))].join("")}static readChunks(e,n=0){const r={};if(!ss.isPng(e,n))throw new Error("Not a PNG");for(n+=8;n<=e.buffer.byteLength;){const s=n,o=e.getInt32(n);n+=4;const i=ss.getChunkType(e,n);if(i==="IDAT"&&r[i]){n+=o+HC+KC;continue}if(i==="IEND")break;r[i]={start:s,dataOffset:n+4,size:o},n+=o+HC+KC}return r}static parsePhys(e,n){return{ppux:e.getUint32(n),ppuy:e.getUint32(n+4),unit:e.getUint8(n+4)}}static findChunk(e,n){return ss.readChunks(e)[n]}static setPhysChunk(e,n=1,r){let s=46,o=0;const i=ss.findChunk(e,"pHYs");i&&(s=i.start,o=i.size);const a=ss.findChunk(e,"IDAT");a&&(s=a.start,o=0);const c=new ArrayBuffer(21),l=new DataView(c);l.setUint32(0,9),l.setUint8(4,"p".charCodeAt(0)),l.setUint8(5,"H".charCodeAt(0)),l.setUint8(6,"Y".charCodeAt(0)),l.setUint8(7,"s".charCodeAt(0));const u=2835.5;l.setInt32(8,u*n),l.setInt32(12,u*n),l.setInt8(16,1);const d=new Uint8Array(c.slice(4,17));l.setInt32(17,R7(d));const h=e.buffer.slice(0,s),f=e.buffer.slice(s+o);return new Blob([h,c,f],r)}}class VC{static async getVideoSizeFromSrc(e){return await new Promise((n,r)=>{const s=document.createElement("video");s.onloadeddata=()=>n({w:s.videoWidth,h:s.videoHeight}),s.onerror=o=>{console.error(o),r(new Error("Could not get video size"))},s.crossOrigin="anonymous",s.src=e})}static async getImageSizeFromSrc(e){return await new Promise((n,r)=>{const s=new Image;s.onload=async()=>{try{const o=await D7.base64ToFile(e),i=new DataView(o);if(ss.isPng(i,0)){const a=ss.findChunk(i,"pHYs");if(a){const c=ss.parsePhys(i,a.dataOffset);if(c.unit===0&&c.ppux===c.ppuy){const l=Math.round(c.ppux/2834.5);n({w:s.width/l,h:s.height/l});return}}}n({w:s.width,h:s.height})}catch(o){console.error(o),n({w:s.width,h:s.height})}},s.onerror=o=>{console.error(o),r(new Error("Could not get image size"))},s.crossOrigin="anonymous",s.src=e})}}function Jo(t=""){let e=0,n=0,r=0,s=0;function o(){const i=e^e<<11;return e=n,n=r,r=s,s^=(s>>>19^i^i>>>8)>>>0,s/4294967296*2}for(let i=0;i<t.length+64;i++)e^=t.charCodeAt(i)|0,o();return o}function Mw(t,e,n,r=!1){const[s,o]=e,[i,a]=n,c=i+(t-s)/(o-s)*(a-i);return r?i<a?Math.max(Math.min(c,a),i):Math.max(Math.min(c,i),a):c}function am(t,e){return Object.prototype.hasOwnProperty.call(t,e)}function Zi(t,e){if(am(t,e))return t[e]}function kn(t){if(!t)return t;if(Array.isArray(t)){const e=[],n=t.length;for(let r=0;r<n;r++)e.push(kn(t[r]));return e}else if(typeof t=="object"){const e=Object.keys(t),n=e.length,r={};for(let s=0;s<n;s++){const o=e[s];r[o]=kn(t[o])}return r}return t}function WC(t){return Object.keys(t)}function ut(t){return Object.values(t)}function Bs(t){return Object.entries(t)}function AT(t){return Object.fromEntries(t)}function Ny(t,e){const n={};let r=!1;for(const[s,o]of Bs(t))e(s,o)?n[s]=o:r=!0;return r?n:t}function GC(t,e){const n={};for(const[r,s]of Bs(t)){const o=e(r,s);n[r]=o}return n}const L7=()=>typeof process<"u"&&!1,Vp=[],j7=()=>{const t=Vp.splice(0,Vp.length);for(const e of t)e()};let zy;function N7(){zy||(zy=requestAnimationFrame(()=>{zy=void 0,j7()}))}function z7(t){if(L7())return t();Vp.includes(t)||(Vp.push(t),N7())}function F7(t,e){return t.id>e.id?1:-1}const B7=new RegExp(/^(?:(?:(?:https?|ftp):)?\/\/)(?:\S+(?::\S*)?@)?(?:(?!(?:10|127)(?:\.\d{1,3}){3})(?!(?:169\.254|192\.168)(?:\.\d{1,3}){2})(?!172\.(?:1[6-9]|2\d|3[0-1])(?:\.\d{1,3}){2})(?:[1-9]\d?|1\d\d|2[01]\d|22[0-3])(?:\.(?:1?\d{1,2}|2[0-4]\d|25[0-5])){2}(?:\.(?:[1-9]\d?|1\d\d|2[0-4]\d|25[0-4]))|(?:(?:[a-z\u00a1-\uffff0-9]-*)*[a-z\u00a1-\uffff0-9]+)(?:\.(?:[a-z\u00a1-\uffff0-9]-*)*[a-z\u00a1-\uffff0-9]+)*(?:\.(?:[a-z\u00a1-\uffff]{2,})))(?::\d{2,5})?(?:[/?#]\S*)?$/i);function Ow(t){return B7.test(t)}function U7(t){return t!==null}const ei=typeof window<"u"&&window.structuredClone?window.structuredClone:t=>t&&JSON.parse(JSON.stringify(t));let cm=(t=21)=>crypto.getRandomValues(new Uint8Array(t)).reduce((e,n)=>(n&=63,n<36?e+=n.toString(36):n<62?e+=(n-26).toString(36).toUpperCase():n>62?e+="-":e+="_",e),"");class W1{constructor(e,n){y(this,"createDefaultProperties");y(this,"migrations");y(this,"validator");y(this,"scope");y(this,"isInstance",e=>(e==null?void 0:e.typeName)===this.typeName);this.typeName=e,this.createDefaultProperties=n.createDefaultProperties,this.migrations=n.migrations,this.validator=n.validator??{validate:r=>r},this.scope=n.scope??"document"}create(e){const n={...this.createDefaultProperties(),id:this.createId()};for(const[r,s]of Object.entries(e))s!==void 0&&(n[r]=s);return n.typeName=this.typeName,n}clone(e){return{...ei(e),id:this.createId()}}createId(e){return this.typeName+":"+(e??cm())}createCustomId(e){return this.typeName+":"+e}parseId(e){if(!this.isId(e))throw new Error(`ID "${e}" is not a valid ID for type "${this.typeName}"`);return e.slice(this.typeName.length+1)}isId(e){if(!e)return!1;for(let n=0;n<this.typeName.length;n++)if(e[n]!==this.typeName[n])return!1;return e[this.typeName.length]===":"}withDefaultProperties(e){return new W1(this.typeName,{createDefaultProperties:e,migrations:this.migrations,validator:this.validator,scope:this.scope})}validate(e){return this.validator.validate(e)}}function co(t,e){return new W1(t,{createDefaultProperties:()=>({}),migrations:e.migrations??{currentVersion:0,firstVersion:0,migrators:{}},validator:e.validator,scope:e.scope})}class YC{constructor(){y(this,"items",new WeakMap)}get(e,n){return this.items.has(e)||this.items.set(e,n(e)),this.items.get(e)}}var Wp={exports:{}};Wp.exports;(function(t,e){var n=200,r="__lodash_hash_undefined__",s=1,o=2,i=9007199254740991,a="[object Arguments]",c="[object Array]",l="[object AsyncFunction]",u="[object Boolean]",d="[object Date]",h="[object Error]",f="[object Function]",p="[object GeneratorFunction]",m="[object Map]",v="[object Number]",w="[object Null]",x="[object Object]",b="[object Promise]",C="[object Proxy]",E="[object RegExp]",_="[object Set]",k="[object String]",I="[object Symbol]",$="[object Undefined]",A="[object WeakMap]",D="[object ArrayBuffer]",L="[object DataView]",j="[object Float32Array]",M="[object Float64Array]",B="[object Int8Array]",U="[object Int16Array]",q="[object Int32Array]",N="[object Uint8Array]",F="[object Uint8ClampedArray]",K="[object Uint16Array]",Q="[object Uint32Array]",ne=/[\\^$.*+?()[\]{}|]/g,we=/^\[object .+?Constructor\]$/,ke=/^(?:0|[1-9]\d*)$/,de={};de[j]=de[M]=de[B]=de[U]=de[q]=de[N]=de[F]=de[K]=de[Q]=!0,de[a]=de[c]=de[D]=de[u]=de[L]=de[d]=de[h]=de[f]=de[m]=de[v]=de[x]=de[E]=de[_]=de[k]=de[A]=!1;var Ye=typeof hn=="object"&&hn&&hn.Object===Object&&hn,Xe=typeof self=="object"&&self&&self.Object===Object&&self,qe=Ye||Xe||Function("return this")(),Be=e&&!e.nodeType&&e,cn=Be&&!0&&t&&!t.nodeType&&t,vo=cn&&cn.exports===Be,Dn=vo&&Ye.process,_s=function(){try{return Dn&&Dn.binding&&Dn.binding("util")}catch{}}(),Er=_s&&_s.isTypedArray;function wo(T,O){for(var V=-1,J=T==null?0:T.length,Ve=0,ye=[];++V<J;){var ct=T[V];O(ct,V,T)&&(ye[Ve++]=ct)}return ye}function Es(T,O){for(var V=-1,J=O.length,Ve=T.length;++V<J;)T[Ve+V]=O[V];return T}function tr(T,O){for(var V=-1,J=T==null?0:T.length;++V<J;)if(O(T[V],V,T))return!0;return!1}function Pr(T,O){for(var V=-1,J=Array(T);++V<T;)J[V]=O(V);return J}function nr(T){return function(O){return T(O)}}function ln(T,O){return T.has(O)}function ih(T,O){return T==null?void 0:T[O]}function ki(T){var O=-1,V=Array(T.size);return T.forEach(function(J,Ve){V[++O]=[Ve,J]}),V}function Xm(T,O){return function(V){return T(O(V))}}function qm(T){var O=-1,V=Array(T.size);return T.forEach(function(J){V[++O]=J}),V}var Qm=Array.prototype,Zm=Function.prototype,ja=Object.prototype,So=qe["__core-js_shared__"],Jb=Zm.toString,Xr=ja.hasOwnProperty,e2=function(){var T=/[^.]+$/.exec(So&&So.keys&&So.keys.IE_PROTO||"");return T?"Symbol(src)_1."+T:""}(),t2=ja.toString,P6=RegExp("^"+Jb.call(Xr).replace(ne,"\\$&").replace(/hasOwnProperty|(function).*?(?=\\\()| for .+?(?=\\\])/g,"$1.*?")+"$"),n2=vo?qe.Buffer:void 0,ah=qe.Symbol,r2=qe.Uint8Array,s2=ja.propertyIsEnumerable,k6=Qm.splice,Ii=ah?ah.toStringTag:void 0,o2=Object.getOwnPropertySymbols,I6=n2?n2.isBuffer:void 0,$6=Xm(Object.keys,Object),Jm=Na(qe,"DataView"),Cl=Na(qe,"Map"),ey=Na(qe,"Promise"),ty=Na(qe,"Set"),ny=Na(qe,"WeakMap"),_l=Na(Object,"create"),T6=Ai(Jm),A6=Ai(Cl),M6=Ai(ey),O6=Ai(ty),D6=Ai(ny),i2=ah?ah.prototype:void 0,ry=i2?i2.valueOf:void 0;function $i(T){var O=-1,V=T==null?0:T.length;for(this.clear();++O<V;){var J=T[O];this.set(J[0],J[1])}}function R6(){this.__data__=_l?_l(null):{},this.size=0}function L6(T){var O=this.has(T)&&delete this.__data__[T];return this.size-=O?1:0,O}function j6(T){var O=this.__data__;if(_l){var V=O[T];return V===r?void 0:V}return Xr.call(O,T)?O[T]:void 0}function N6(T){var O=this.__data__;return _l?O[T]!==void 0:Xr.call(O,T)}function z6(T,O){var V=this.__data__;return this.size+=this.has(T)?0:1,V[T]=_l&&O===void 0?r:O,this}$i.prototype.clear=R6,$i.prototype.delete=L6,$i.prototype.get=j6,$i.prototype.has=N6,$i.prototype.set=z6;function Ps(T){var O=-1,V=T==null?0:T.length;for(this.clear();++O<V;){var J=T[O];this.set(J[0],J[1])}}function F6(){this.__data__=[],this.size=0}function B6(T){var O=this.__data__,V=lh(O,T);if(V<0)return!1;var J=O.length-1;return V==J?O.pop():k6.call(O,V,1),--this.size,!0}function U6(T){var O=this.__data__,V=lh(O,T);return V<0?void 0:O[V][1]}function H6(T){return lh(this.__data__,T)>-1}function K6(T,O){var V=this.__data__,J=lh(V,T);return J<0?(++this.size,V.push([T,O])):V[J][1]=O,this}Ps.prototype.clear=F6,Ps.prototype.delete=B6,Ps.prototype.get=U6,Ps.prototype.has=H6,Ps.prototype.set=K6;function Ti(T){var O=-1,V=T==null?0:T.length;for(this.clear();++O<V;){var J=T[O];this.set(J[0],J[1])}}function V6(){this.size=0,this.__data__={hash:new $i,map:new(Cl||Ps),string:new $i}}function W6(T){var O=uh(this,T).delete(T);return this.size-=O?1:0,O}function G6(T){return uh(this,T).get(T)}function Y6(T){return uh(this,T).has(T)}function X6(T,O){var V=uh(this,T),J=V.size;return V.set(T,O),this.size+=V.size==J?0:1,this}Ti.prototype.clear=V6,Ti.prototype.delete=W6,Ti.prototype.get=G6,Ti.prototype.has=Y6,Ti.prototype.set=X6;function ch(T){var O=-1,V=T==null?0:T.length;for(this.__data__=new Ti;++O<V;)this.add(T[O])}function q6(T){return this.__data__.set(T,r),this}function Q6(T){return this.__data__.has(T)}ch.prototype.add=ch.prototype.push=q6,ch.prototype.has=Q6;function xo(T){var O=this.__data__=new Ps(T);this.size=O.size}function Z6(){this.__data__=new Ps,this.size=0}function J6(T){var O=this.__data__,V=O.delete(T);return this.size=O.size,V}function eD(T){return this.__data__.get(T)}function tD(T){return this.__data__.has(T)}function nD(T,O){var V=this.__data__;if(V instanceof Ps){var J=V.__data__;if(!Cl||J.length<n-1)return J.push([T,O]),this.size=++V.size,this;V=this.__data__=new Ti(J)}return V.set(T,O),this.size=V.size,this}xo.prototype.clear=Z6,xo.prototype.delete=J6,xo.prototype.get=eD,xo.prototype.has=tD,xo.prototype.set=nD;function rD(T,O){var V=dh(T),J=!V&&vD(T),Ve=!V&&!J&&sy(T),ye=!V&&!J&&!Ve&&g2(T),ct=V||J||Ve||ye,Ct=ct?Pr(T.length,String):[],Tt=Ct.length;for(var tt in T)(O||Xr.call(T,tt))&&!(ct&&(tt=="length"||Ve&&(tt=="offset"||tt=="parent")||ye&&(tt=="buffer"||tt=="byteLength"||tt=="byteOffset")||fD(tt,Tt)))&&Ct.push(tt);return Ct}function lh(T,O){for(var V=T.length;V--;)if(d2(T[V][0],O))return V;return-1}function sD(T,O,V){var J=O(T);return dh(T)?J:Es(J,V(T))}function El(T){return T==null?T===void 0?$:w:Ii&&Ii in Object(T)?dD(T):yD(T)}function a2(T){return Pl(T)&&El(T)==a}function c2(T,O,V,J,Ve){return T===O?!0:T==null||O==null||!Pl(T)&&!Pl(O)?T!==T&&O!==O:oD(T,O,V,J,c2,Ve)}function oD(T,O,V,J,Ve,ye){var ct=dh(T),Ct=dh(O),Tt=ct?c:bo(T),tt=Ct?c:bo(O);Tt=Tt==a?x:Tt,tt=tt==a?x:tt;var Rn=Tt==x,kr=tt==x,Kt=Tt==tt;if(Kt&&sy(T)){if(!sy(O))return!1;ct=!0,Rn=!1}if(Kt&&!Rn)return ye||(ye=new xo),ct||g2(T)?l2(T,O,V,J,Ve,ye):lD(T,O,Tt,V,J,Ve,ye);if(!(V&s)){var rr=Rn&&Xr.call(T,"__wrapped__"),sr=kr&&Xr.call(O,"__wrapped__");if(rr||sr){var Co=rr?T.value():T,ks=sr?O.value():O;return ye||(ye=new xo),Ve(Co,ks,V,J,ye)}}return Kt?(ye||(ye=new xo),uD(T,O,V,J,Ve,ye)):!1}function iD(T){if(!p2(T)||gD(T))return!1;var O=h2(T)?P6:we;return O.test(Ai(T))}function aD(T){return Pl(T)&&f2(T.length)&&!!de[El(T)]}function cD(T){if(!mD(T))return $6(T);var O=[];for(var V in Object(T))Xr.call(T,V)&&V!="constructor"&&O.push(V);return O}function l2(T,O,V,J,Ve,ye){var ct=V&s,Ct=T.length,Tt=O.length;if(Ct!=Tt&&!(ct&&Tt>Ct))return!1;var tt=ye.get(T);if(tt&&ye.get(O))return tt==O;var Rn=-1,kr=!0,Kt=V&o?new ch:void 0;for(ye.set(T,O),ye.set(O,T);++Rn<Ct;){var rr=T[Rn],sr=O[Rn];if(J)var Co=ct?J(sr,rr,Rn,O,T,ye):J(rr,sr,Rn,T,O,ye);if(Co!==void 0){if(Co)continue;kr=!1;break}if(Kt){if(!tr(O,function(ks,Mi){if(!ln(Kt,Mi)&&(rr===ks||Ve(rr,ks,V,J,ye)))return Kt.push(Mi)})){kr=!1;break}}else if(!(rr===sr||Ve(rr,sr,V,J,ye))){kr=!1;break}}return ye.delete(T),ye.delete(O),kr}function lD(T,O,V,J,Ve,ye,ct){switch(V){case L:if(T.byteLength!=O.byteLength||T.byteOffset!=O.byteOffset)return!1;T=T.buffer,O=O.buffer;case D:return!(T.byteLength!=O.byteLength||!ye(new r2(T),new r2(O)));case u:case d:case v:return d2(+T,+O);case h:return T.name==O.name&&T.message==O.message;case E:case k:return T==O+"";case m:var Ct=ki;case _:var Tt=J&s;if(Ct||(Ct=qm),T.size!=O.size&&!Tt)return!1;var tt=ct.get(T);if(tt)return tt==O;J|=o,ct.set(T,O);var Rn=l2(Ct(T),Ct(O),J,Ve,ye,ct);return ct.delete(T),Rn;case I:if(ry)return ry.call(T)==ry.call(O)}return!1}function uD(T,O,V,J,Ve,ye){var ct=V&s,Ct=u2(T),Tt=Ct.length,tt=u2(O),Rn=tt.length;if(Tt!=Rn&&!ct)return!1;for(var kr=Tt;kr--;){var Kt=Ct[kr];if(!(ct?Kt in O:Xr.call(O,Kt)))return!1}var rr=ye.get(T);if(rr&&ye.get(O))return rr==O;var sr=!0;ye.set(T,O),ye.set(O,T);for(var Co=ct;++kr<Tt;){Kt=Ct[kr];var ks=T[Kt],Mi=O[Kt];if(J)var m2=ct?J(Mi,ks,Kt,O,T,ye):J(ks,Mi,Kt,T,O,ye);if(!(m2===void 0?ks===Mi||Ve(ks,Mi,V,J,ye):m2)){sr=!1;break}Co||(Co=Kt=="constructor")}if(sr&&!Co){var hh=T.constructor,fh=O.constructor;hh!=fh&&"constructor"in T&&"constructor"in O&&!(typeof hh=="function"&&hh instanceof hh&&typeof fh=="function"&&fh instanceof fh)&&(sr=!1)}return ye.delete(T),ye.delete(O),sr}function u2(T){return sD(T,xD,hD)}function uh(T,O){var V=T.__data__;return pD(O)?V[typeof O=="string"?"string":"hash"]:V.map}function Na(T,O){var V=ih(T,O);return iD(V)?V:void 0}function dD(T){var O=Xr.call(T,Ii),V=T[Ii];try{T[Ii]=void 0;var J=!0}catch{}var Ve=t2.call(T);return J&&(O?T[Ii]=V:delete T[Ii]),Ve}var hD=o2?function(T){return T==null?[]:(T=Object(T),wo(o2(T),function(O){return s2.call(T,O)}))}:bD,bo=El;(Jm&&bo(new Jm(new ArrayBuffer(1)))!=L||Cl&&bo(new Cl)!=m||ey&&bo(ey.resolve())!=b||ty&&bo(new ty)!=_||ny&&bo(new ny)!=A)&&(bo=function(T){var O=El(T),V=O==x?T.constructor:void 0,J=V?Ai(V):"";if(J)switch(J){case T6:return L;case A6:return m;case M6:return b;case O6:return _;case D6:return A}return O});function fD(T,O){return O=O??i,!!O&&(typeof T=="number"||ke.test(T))&&T>-1&&T%1==0&&T<O}function pD(T){var O=typeof T;return O=="string"||O=="number"||O=="symbol"||O=="boolean"?T!=="__proto__":T===null}function gD(T){return!!e2&&e2 in T}function mD(T){var O=T&&T.constructor,V=typeof O=="function"&&O.prototype||ja;return T===V}function yD(T){return t2.call(T)}function Ai(T){if(T!=null){try{return Jb.call(T)}catch{}try{return T+""}catch{}}return""}function d2(T,O){return T===O||T!==T&&O!==O}var vD=a2(function(){return arguments}())?a2:function(T){return Pl(T)&&Xr.call(T,"callee")&&!s2.call(T,"callee")},dh=Array.isArray;function wD(T){return T!=null&&f2(T.length)&&!h2(T)}var sy=I6||CD;function SD(T,O){return c2(T,O)}function h2(T){if(!p2(T))return!1;var O=El(T);return O==f||O==p||O==l||O==C}function f2(T){return typeof T=="number"&&T>-1&&T%1==0&&T<=i}function p2(T){var O=typeof T;return T!=null&&(O=="object"||O=="function")}function Pl(T){return T!=null&&typeof T=="object"}var g2=Er?nr(Er):aD;function xD(T){return wD(T)?rD(T):cD(T)}function bD(){return[]}function CD(){return!1}t.exports=SD})(Wp,Wp.exports);var H7=Wp.exports;const K7=Sa(H7);function V7(t){if(t.length===0)return new Set;const e=t[0],n=t.slice(1),r=new Set;for(const s of e)n.every(o=>o.has(s))&&r.add(s);return r}function W7(t,e){const n={};for(const r of e)t.has(r)||(n.added??(n.added=new Set),n.added.add(r));for(const r of t)e.has(r)||(n.removed??(n.removed=new Set),n.removed.add(r));return n.added||n.removed?n:void 0}function XC(t,e){for(const[n,r]of Object.entries(t)){const s=r,o=e[n];if("eq"in s&&o!==s.eq||"neq"in s&&o===s.neq||"gt"in s&&(typeof o!="number"||o<=s.gt))return!1}return!0}function qC(t,e,n){const r=Object.fromEntries(Object.keys(n).map(s=>[s,new Set]));for(const[s,o]of Object.entries(n))if("eq"in o){const a=t.index(e,s).value.get(o.eq);if(a)for(const c of a)r[s].add(c)}else if("neq"in o){const i=t.index(e,s);for(const[a,c]of i.value)if(a!==o.neq)for(const l of c)r[s].add(l)}else if("gt"in o){const i=t.index(e,s);for(const[a,c]of i.value)if(a>o.gt)for(const l of c)r[s].add(l)}return V7(Object.values(r))}class G7{constructor(e,n){y(this,"indexCache",new Map);y(this,"historyCache",new Map);this.atoms=e,this.history=n}filterHistory(e){if(this.historyCache.has(e))return this.historyCache.get(e);const n=X("filterHistory:"+e,(r,s)=>{if(Ic(r))return this.history.value;const o=this.history.getDiffSince(s);if(o===Gn)return this.history.value;const i={added:{},removed:{},updated:{}};let a=0,c=0,l=0;for(const u of o){for(const d of ut(u.added))if(d.typeName===e)if(i.removed[d.id]){const h=i.removed[d.id];delete i.removed[d.id],c--,h!==d&&(i.updated[d.id]=[h,d],l++)}else i.added[d.id]=d,a++;for(const[d,h]of ut(u.updated))h.typeName===e&&(i.added[h.id]?i.added[h.id]=h:i.updated[h.id]?i.updated[h.id]=[i.updated[h.id][0],h]:(i.updated[h.id]=[d,h],l++));for(const d of ut(u.removed))d.typeName===e&&(i.added[d.id]?(delete i.added[d.id],a--):i.updated[d.id]?(i.removed[d.id]=i.updated[d.id][0],delete i.updated[d.id],l--,c++):(i.removed[d.id]=d,c++))}return a||c||l?ru(this.history.value,i):r},{historyLength:100});return this.historyCache.set(e,n),n}index(e,n){const r=e+":"+n;if(this.indexCache.has(r))return this.indexCache.get(r);const s=this.__uncached_createIndex(e,n);return this.indexCache.set(r,s),s}__uncached_createIndex(e,n){const r=this.filterHistory(e),s=()=>{r.value;const o=new Map;for(const i of ut(this.atoms.value)){const a=i.value;if(a.typeName===e){const c=a[n];o.has(c)||o.set(c,new Set),o.get(c).add(a.id)}}return o};return X("index:"+e+":"+n,(o,i)=>{if(Ic(o))return s();const a=r.getDiffSince(i);if(a===Gn)return s();const c=new Map,l=(f,p)=>{let m=c.get(f);m||(m=new Af(o.get(f)??new Set)),m.add(p),c.set(f,m)},u=(f,p)=>{let m=c.get(f);m||(m=new Af(o.get(f)??new Set)),m.remove(p),c.set(f,m)};for(const f of a){for(const p of ut(f.added))if(p.typeName===e){const m=p[n];l(m,p.id)}for(const[p,m]of ut(f.updated))if(m.typeName===e){const v=p[n],w=m[n];v!==w&&(u(v,m.id),l(w,m.id))}for(const p of ut(f.removed))if(p.typeName===e){const m=p[n];u(m,p.id)}}let d,h;for(const[f,p]of c){const m=p.get();m&&(d||(d=new Map(o)),h||(h=new Map),m.value.size===0?d.delete(f):d.set(f,m.value),h.set(f,m.diff))}return d&&h?ru(d,h):o},{historyLength:100})}record(e,n=()=>({}),r="record:"+e+(n?":"+n.toString():"")){const s=this.ids(e,n,r);return X(r,()=>{var o;for(const i of s.value)return(o=this.atoms.value[i])==null?void 0:o.value})}records(e,n=()=>({}),r="records:"+e+(n?":"+n.toString():"")){const s=this.ids(e,n,"ids:"+r);return X(r,()=>[...s.value].map(o=>{const i=this.atoms.value[o];if(!i)throw new Error("no atom found for record id: "+o);return i.value}))}ids(e,n=()=>({}),r="ids:"+e+(n?":"+n.toString():"")){const s=this.filterHistory(e),o=()=>{s.value;const c=n();return Object.keys(c).length===0?new Set(ut(this.atoms.value).flatMap(l=>{const u=l.value;return u.typeName===e?u.id:[]})):qC(this,e,c)},i=c=>{const l=o(),u=W7(c,l);return u?ru(l,u):c},a=X("ids_query:"+r,n,{isEqual:K7});return X("query:"+r,(c,l)=>{const u=a.value;if(Ic(c))return o();if(l<a.lastChangedEpoch)return i(c);const d=s.getDiffSince(l);if(d===Gn)return i(c);const h=new Af(c);for(const p of d){for(const m of ut(p.added))m.typeName===e&&XC(u,m)&&h.add(m.id);for(const[m,v]of ut(p.updated))v.typeName===e&&(XC(u,v)?h.add(v.id):h.remove(v.id));for(const m of ut(p.removed))m.typeName===e&&h.remove(m.id)}const f=h.get();return f?ru(f.value,f.diff):c},{historyLength:50})}exec(e,n){const r=qC(this,e,n);if(r.size===0)return Fs;const s=this.atoms.value;return[...r].map(o=>s[o].value)}}class MT{constructor(e){y(this,"id",cm());y(this,"atoms",Cn("store_atoms",{}));y(this,"history",Cn("history",0,{historyLength:1e3}));y(this,"query",new G7(this.atoms,this.history));y(this,"listeners",new Set);y(this,"historyAccumulator",new X7);y(this,"historyReactor");y(this,"schema");y(this,"props");y(this,"scopedTypes");y(this,"onBeforeCreate");y(this,"onAfterCreate");y(this,"onBeforeChange");y(this,"onAfterChange");y(this,"onBeforeDelete");y(this,"onAfterDelete");y(this,"_runCallbacks",!0);y(this,"put",(e,n)=>{ur(()=>{const r={},s={},o=this.atoms.__unsafe__getWithoutCapture();let i=null,a,c=!1;const l=this.onBeforeCreate&&this._runCallbacks?this.onBeforeCreate:null,u=this.onBeforeChange&&this._runCallbacks?this.onBeforeChange:null,d=this.isMergingRemoteChanges?"remote":"user";for(let h=0,f=e.length;h<f;h++){a=e[h];const p=(i??o)[a.id];if(p){u&&(a=u(p.value,a,d));const m=p.__unsafe__getWithoutCapture();a=this.schema.validateRecord(this,a,n??"updateRecord",m),p.set(a);const v=p.__unsafe__getWithoutCapture();m!==v&&(c=!0,r[a.id]=[m,v])}else l&&(a=l(a,d)),c=!0,a=this.schema.validateRecord(this,a,n??"createRecord",null),s[a.id]=a,i||(i={...o}),i[a.id]=Cn("atom:"+a.id,a)}if(i&&this.atoms.set(i),!!c&&(this.updateHistory({added:s,updated:r,removed:{}}),this._runCallbacks)){const{onAfterCreate:h,onAfterChange:f}=this;h&&Object.values(s).forEach(p=>{h(p,d)}),f&&Object.values(r).forEach(([p,m])=>{f(p,m,d)})}})});y(this,"remove",e=>{ur(()=>{const n=[],r=this.isMergingRemoteChanges?"remote":"user";if(this.onBeforeDelete&&this._runCallbacks)for(const o of e){const i=this.atoms.__unsafe__getWithoutCapture()[o];i&&this.onBeforeDelete(i.value,r)===!1&&n.push(o)}let s;if(this.atoms.update(o=>{let i;for(const a of e)n.includes(a)||a in o&&(i||(i={...o}),s||(s={}),delete i[a],s[a]=o[a].value);return i??o}),!!s&&(this.updateHistory({added:{},updated:{},removed:s}),this.onAfterDelete&&this._runCallbacks)){let o;for(let i=0,a=e.length;i<a;i++)o=s[e[i]],o&&this.onAfterDelete(o,r)}})});y(this,"get",e=>{var n;return(n=this.atoms.value[e])==null?void 0:n.value});y(this,"unsafeGetWithoutCapture",e=>{var n;return(n=this.atoms.value[e])==null?void 0:n.__unsafe__getWithoutCapture()});y(this,"serialize",(e="document")=>{const n={};for(const[r,s]of Bs(this.atoms.value)){const o=s.value;(e==="all"||this.scopedTypes[e].has(o.typeName))&&(n[r]=o)}return n});y(this,"allRecords",()=>ut(this.atoms.value).map(e=>e.value));y(this,"clear",()=>{this.remove(WC(this.atoms.value))});y(this,"update",(e,n)=>{const r=this.atoms.value[e];if(!r){console.error(`Record ${e} not found. This is probably an error`);return}this.put([n(r.__unsafe__getWithoutCapture())])});y(this,"has",e=>!!this.atoms.value[e]);y(this,"listen",(e,n)=>{this._flushHistory();const r={onHistory:e,filters:{source:(n==null?void 0:n.source)??"all",scope:(n==null?void 0:n.scope)??"all"}};return this.listeners.add(r),this.historyReactor.scheduler.isActivelyListening||this.historyReactor.start(),()=>{this.listeners.delete(r),this.listeners.size===0&&this.historyReactor.stop()}});y(this,"isMergingRemoteChanges",!1);y(this,"mergeRemoteChanges",e=>{if(this.isMergingRemoteChanges)return e();try{this.isMergingRemoteChanges=!0,ur(e)}finally{this.isMergingRemoteChanges=!1}});y(this,"createComputedCache",(e,n)=>{const r=new YC;return{get:s=>{const o=this.atoms.value[s];if(o)return r.get(o,()=>X(e+":"+s,()=>n(o.value))).value}}});y(this,"createSelectedComputedCache",(e,n,r)=>{const s=new YC;return{get:o=>{const i=this.atoms.value[o];if(!i)return;const a=X(e+":"+o+":selector",()=>n(i.value));return s.get(i,()=>X(e+":"+o,()=>r(a.value))).value}}});y(this,"getRecordType",e=>{const n=this.schema.types[e.typeName];if(!n)throw new Error(`Record type ${e.typeName} not found`);return n});y(this,"_integrityChecker");y(this,"_isPossiblyCorrupted",!1);const{initialData:n,schema:r}=e;this.schema=r,this.props=e.props,n&&this.atoms.set(AT(Bs(n).map(([s,o])=>[s,Cn("atom:"+s,this.schema.validateRecord(this,o,"initialize",null))]))),this.historyReactor=$7("Store.historyReactor",()=>{this.history.value,this._flushHistory()},{scheduleEffect:s=>z7(s)}),this.scopedTypes={document:new Set(ut(this.schema.types).filter(s=>s.scope==="document").map(s=>s.typeName)),session:new Set(ut(this.schema.types).filter(s=>s.scope==="session").map(s=>s.typeName)),presence:new Set(ut(this.schema.types).filter(s=>s.scope==="presence").map(s=>s.typeName))}}_flushHistory(){if(this.historyAccumulator.hasChanges()){const e=this.historyAccumulator.flush();for(const{changes:n,source:r}of e){let s=null,o=null,i=null;for(const{onHistory:a,filters:c}of this.listeners)if(!(c.source!=="all"&&c.source!==r))if(c.scope!=="all")if(c.scope==="document"){if(o??(o=this.filterChangesByScope(n,"document")),!o)continue;a({changes:o,source:r})}else if(c.scope==="session"){if(s??(s=this.filterChangesByScope(n,"session")),!s)continue;a({changes:s,source:r})}else{if(i??(i=this.filterChangesByScope(n,"presence")),!i)continue;a({changes:i,source:r})}else a({changes:n,source:r})}}}filterChangesByScope(e,n){const r={added:Ny(e.added,(s,o)=>this.scopedTypes[n].has(o.typeName)),updated:Ny(e.updated,(s,o)=>this.scopedTypes[n].has(o[1].typeName)),removed:Ny(e.removed,(s,o)=>this.scopedTypes[n].has(o.typeName))};return Object.keys(r.added).length===0&&Object.keys(r.updated).length===0&&Object.keys(r.removed).length===0?null:r}updateHistory(e){this.historyAccumulator.add({changes:e,source:this.isMergingRemoteChanges?"remote":"user"}),this.listeners.size===0&&this.historyAccumulator.clear(),this.history.set(this.history.value+1,e)}validate(e){this.allRecords().forEach(n=>this.schema.validateRecord(this,n,e,null))}getSnapshot(e="document"){return{store:this.serialize(e),schema:this.schema.serialize()}}loadSnapshot(e){const n=this.schema.migrateStoreSnapshot(e);if(n.type==="error")throw new Error(`Failed to migrate snapshot: ${n.reason}`);ur(()=>{this.clear(),this.put(Object.values(n.value)),this.ensureStoreIsUsable()})}extractingChanges(e){const n=[],r=this.historyAccumulator.intercepting(s=>n.push(s.changes));try{return ur(e),lm(n)}finally{r()}}applyDiff(e,n=!0){const r=this._runCallbacks;try{this._runCallbacks=n,ur(()=>{const s=ut(e.added).concat(ut(e.updated).map(([i,a])=>a)),o=WC(e.removed);s.length&&this.put(s),o.length&&this.remove(o)})}finally{this._runCallbacks=r}}ensureStoreIsUsable(){var e;this._integrityChecker??(this._integrityChecker=this.schema.createIntegrityChecker(this)),(e=this._integrityChecker)==null||e.call(this)}markAsPossiblyCorrupted(){this._isPossiblyCorrupted=!0}isPossiblyCorrupted(){return this._isPossiblyCorrupted}}function lm(t){const e={added:{},removed:{},updated:{}};for(const n of t){for(const[r,s]of Bs(n.added))if(e.removed[r]){const o=e.removed[r];delete e.removed[r],o!==s&&(e.updated[r]=[o,s])}else e.added[r]=s;for(const[r,[s,o]]of Bs(n.updated)){if(e.added[r]){e.added[r]=o,delete e.updated[r],delete e.removed[r];continue}if(e.updated[r]){e.updated[r][1]=o,delete e.removed[r];continue}e.updated[r]=n.updated[r],delete e.removed[r]}for(const[r,s]of Bs(n.removed))e.added[r]?delete e.added[r]:e.updated[r]?(e.removed[r]=e.updated[r][0],delete e.updated[r]):e.removed[r]=s}return e}function Y7(t){const e=[];let n=t[0],r;for(let s=1,o=t.length;s<o;s++)r=t[s],n.source!==r.source?(e.push(n),n=r):n={source:n.source,changes:lm([n.changes,r.changes])};return e.push(n),e}class X7{constructor(){y(this,"_history",[]);y(this,"_interceptors",new Set)}intercepting(e){return this._interceptors.add(e),()=>{this._interceptors.delete(e)}}add(e){this._history.push(e);for(const n of this._interceptors)n(e)}flush(){const e=Y7(this._history);return this._history=[],e}clear(){this._history=[]}hasChanges(){return this._history.length>0}}function q7(t){return typeof t=="object"&&t!==null&&"id"in t&&"typeName"in t}function Ae(t){const{currentVersion:e,firstVersion:n,migrators:r={},subTypeKey:s,subTypeMigrations:o}=t;if(typeof e=="number"&&typeof n=="number"){if(e===n)throw Error("Current version is equal to initial version.");if(e<n)throw Error("Current version is lower than initial version.")}return{firstVersion:n??0,currentVersion:e??0,migrators:r,subTypeKey:s,subTypeMigrations:o}}var su=(t=>(t.IncompatibleSubtype="incompatible-subtype",t.UnknownType="unknown-type",t.TargetVersionTooNew="target-version-too-new",t.TargetVersionTooOld="target-version-too-old",t.MigrationError="migration-error",t.UnrecognizedSubtype="unrecognized-subtype",t))(su||{});function Lh({record:t,migrations:e,fromVersion:n,toVersion:r}){let s=n;if(!q7(t))throw new Error("[migrateRecord] object is not a record");const{typeName:o,id:i,...a}=t;let c=a;for(;s<r;){const l=s+1,u=e.migrators[l];if(!u)return{type:"error",reason:"target-version-too-new"};c=u.up(c),s=l}for(;s>r;){const l=s-1,u=e.migrators[s];if(!u)return{type:"error",reason:"target-version-too-old"};c=u.down(c),s=l}return{type:"success",value:{...c,id:i,typeName:o}}}function G1({value:t,migrations:e,fromVersion:n,toVersion:r}){let s=n;for(;s<r;){const o=s+1,i=e.migrators[o];if(!i)return{type:"error",reason:"target-version-too-new"};t=i.up(t),s=o}for(;s>r;){const o=s-1,i=e.migrators[s];if(!i)return{type:"error",reason:"target-version-too-old"};t=i.down(t),s=o}return{type:"success",value:t}}class Y1{constructor(e,n){this.types=e,this.options=n}static create(e,n){return new Y1(e,n??{})}get currentStoreVersion(){var e;return((e=this.options.snapshotMigrations)==null?void 0:e.currentVersion)??0}validateRecord(e,n,r,s){try{const o=Zi(this.types,n.typeName);if(!o)throw new Error(`Missing definition for record type ${n.typeName}`);return o.validate(n)}catch(o){if(this.options.onValidationFailure)return this.options.onValidationFailure({store:e,record:n,phase:r,recordBefore:s,error:o});throw o}}migratePersistedRecord(e,n,r="up"){var d;const s=Zi(this.types,e.typeName),o=n.recordVersions[e.typeName];if(!o||!s)return{type:"error",reason:su.UnknownType};const i=s.migrations.currentVersion,a=o.version;if(i!==a){const h=Lh(r==="up"?{record:e,migrations:s.migrations,fromVersion:a,toVersion:i}:{record:e,migrations:s.migrations,fromVersion:i,toVersion:a});if(h.type==="error")return h;e=h.value}if(!s.migrations.subTypeKey)return{type:"success",value:e};const c=(d=s.migrations.subTypeMigrations)==null?void 0:d[e[s.migrations.subTypeKey]],l="subTypeVersions"in o?o.subTypeVersions[e[s.migrations.subTypeKey]]:void 0;if(c===void 0)return{type:"error",reason:su.UnrecognizedSubtype};if(l===void 0)return{type:"error",reason:su.IncompatibleSubtype};const u=Lh(r==="up"?{record:e,migrations:c,fromVersion:l,toVersion:c.currentVersion}:{record:e,migrations:c,fromVersion:c.currentVersion,toVersion:l});return u.type==="error"?u:{type:"success",value:u.value}}migrateStoreSnapshot(e){let{store:n}=e;const r=this.options.snapshotMigrations;if(!r)return{type:"success",value:n};const s=r.currentVersion,o=e.schema.storeVersion??0;if(s<o)return{type:"error",reason:su.TargetVersionTooOld};if(s>o){const a=G1({value:n,migrations:r,fromVersion:o,toVersion:s});if(a.type==="error")return a;n=a.value}const i=[];for(const a of ut(n)){const c=this.migratePersistedRecord(a,e.schema);if(c.type==="error")return c;c.value&&c.value!==a&&i.push(c.value)}if(i.length){n={...n};for(const a of i)n[a.id]=a}return{type:"success",value:n}}createIntegrityChecker(e){var n,r;return((r=(n=this.options).createIntegrityChecker)==null?void 0:r.call(n,e))??void 0}serialize(){var e;return{schemaVersion:1,storeVersion:((e=this.options.snapshotMigrations)==null?void 0:e.currentVersion)??0,recordVersions:Object.fromEntries(ut(this.types).map(n=>[n.typeName,n.migrations.subTypeKey&&n.migrations.subTypeMigrations?{version:n.migrations.currentVersion,subTypeKey:n.migrations.subTypeKey,subTypeVersions:n.migrations.subTypeMigrations?Object.fromEntries(Object.entries(n.migrations.subTypeMigrations).map(([r,s])=>[r,s.currentVersion])):void 0}:{version:n.migrations.currentVersion}]))}}serializeEarliestVersion(){var e;return{schemaVersion:1,storeVersion:((e=this.options.snapshotMigrations)==null?void 0:e.firstVersion)??0,recordVersions:Object.fromEntries(ut(this.types).map(n=>[n.typeName,n.migrations.subTypeKey&&n.migrations.subTypeMigrations?{version:n.migrations.firstVersion,subTypeKey:n.migrations.subTypeKey,subTypeVersions:n.migrations.subTypeMigrations?Object.fromEntries(Object.entries(n.migrations.subTypeMigrations).map(([r,s])=>[r,s.firstVersion])):void 0}:{version:n.migrations.firstVersion}]))}}}const Q7=(t,e)=>{if(t.schemaVersion>e.schemaVersion)return 1;if(t.schemaVersion<e.schemaVersion)return-1;if(t.storeVersion>e.storeVersion)return 1;if(t.storeVersion<e.storeVersion)return-1;for(const n of Object.keys(t.recordVersions)){const r=t.recordVersions[n],s=e.recordVersions[n];if(r.version>s.version)return 1;if(r.version<s.version)return-1;if("subTypeVersions"in r&&!("subTypeVersions"in s))return 1;if(!("subTypeVersions"in r)&&"subTypeVersions"in s)return-1;if(!(!("subTypeVersions"in r)||!("subTypeVersions"in s)))for(const o of Object.keys(r.subTypeVersions)){const i=r.subTypeVersions[o],a=s.subTypeVersions[o];if(i>a)return 1;if(i<a)return-1}}return 0};function Z7(t){if(!t.length)return null;let e="";for(const n of t)typeof n=="number"?e+=`.${n}`:n.startsWith("(")?e.endsWith(")")?e=`${e.slice(0,-1)}, ${n.slice(1)}`:e+=n:e+=`.${n}`;return e.startsWith(".")?e.slice(1):e}class Je extends Error{constructor(n,r=[]){const s=Z7(r),o=n.split(`
`).map((i,a)=>a===0?i:`  ${i}`).join(`
`);super(r?`At ${s}: ${o}`:o);y(this,"name","ValidationError");this.rawMessage=n,this.path=r}}function il(t,e){try{return e()}catch(n){throw n instanceof Je?new Je(n.rawMessage,[t,...n.path]):new Je(n.toString(),[t])}}function Kc(t){if(t===null)return"null";if(Array.isArray(t))return"an array";const e=typeof t;switch(e){case"bigint":case"boolean":case"function":case"number":case"string":case"symbol":return`a ${e}`;case"object":return`an ${e}`;case"undefined":return"undefined";default:U1(e)}}class mn{constructor(e){this.validationFn=e}validate(e){return this.validationFn(e)}nullable(){return sj(this)}optional(){return DT(this)}refine(e){return new mn(n=>e(this.validate(n)))}check(e,n){return typeof e=="string"?this.refine(r=>(il(`(check ${e})`,()=>n(r)),r)):this.refine(r=>(e(r),r))}}class J7 extends mn{constructor(e){super(n=>{const r=rj.validate(n);for(let s=0;s<r.length;s++)il(s,()=>e.validate(r[s]));return r}),this.itemValidator=e}nonEmpty(){return this.check(e=>{if(e.length===0)throw new Je("Expected a non-empty array")})}lengthGreaterThan1(){return this.check(e=>{if(e.length<=1)throw new Je("Expected an array with length greater than 1")})}}class Gp extends mn{constructor(e,n=!1){super(r=>{if(typeof r!="object"||r===null)throw new Je(`Expected object, got ${Kc(r)}`);for(const[s,o]of Object.entries(e))il(s,()=>{o.validate(Zi(r,s))});if(!n){for(const s of Object.keys(r))if(!am(e,s))throw new Je("Unexpected property",[s])}return r}),this.config=e,this.shouldAllowUnknownProperties=n}allowUnknownProperties(){return new Gp(this.config,!0)}extend(e){return new Gp({...this.config,...e})}}class X1 extends mn{constructor(e,n,r){super(s=>{if(typeof s!="object"||s===null)throw new Je(`Expected an object, got ${Kc(s)}`,[]);const o=Zi(s,e);if(typeof o!="string")throw new Je(`Expected a string for key "${e}", got ${Kc(o)}`);const i=am(n,o)?n[o]:void 0;return i===void 0?this.unknownValueValidation(s,o):il(`(${e} = ${o})`,()=>i.validate(s))}),this.key=e,this.config=n,this.unknownValueValidation=r}validateUnknownVariants(e){return new X1(this.key,this.config,e)}}class ej extends mn{constructor(e,n){super(r=>{if(typeof r!="object"||r===null)throw new Je(`Expected object, got ${Kc(r)}`);for(const[s,o]of Object.entries(r))il(s,()=>{e.validate(s),n.validate(o)});return r}),this.keyValidator=e,this.valueValidator=n}}function q1(t){return new mn(e=>{if(typeof e!==t)throw new Je(`Expected ${t}, got ${Kc(e)}`);return e})}const tj=new mn(t=>t),fe=q1("string"),pe=q1("number").check(t=>{if(Number.isNaN(t))throw new Je("Expected a number, got NaN");if(!Number.isFinite(t))throw new Je(`Expected a finite number, got ${t}`)}),Q1=pe.check(t=>{if(t<0)throw new Je(`Expected a positive number, got ${t}`)}),$n=pe.check(t=>{if(t<=0)throw new Je(`Expected a non-zero positive number, got ${t}`)}),OT=pe.check(t=>{if(!Number.isInteger(t))throw new Je(`Expected an integer, got ${t}`)}),jh=OT.check(t=>{if(t<0)throw new Je(`Expected a positive integer, got ${t}`)}),nj=OT.check(t=>{if(t<=0)throw new Je(`Expected a non-zero positive integer, got ${t}`)}),Pe=q1("boolean");function Tn(t){return new mn(e=>{if(e!==t)throw new Je(`Expected ${t}, got ${JSON.stringify(e)}`);return t})}const rj=new mn(t=>{if(!Array.isArray(t))throw new Je(`Expected an array, got ${Kc(t)}`);return t});function Yn(t){return new J7(t)}function Ce(t){return new Gp(t)}function Dw(t){return t===null||typeof t=="number"||typeof t=="string"||typeof t=="boolean"?!0:Array.isArray(t)?t.every(Dw):typeof t=="object"?Object.values(t).every(Dw):!1}const us=new mn(t=>{if(Dw(t))return t;throw new Je(`Expected json serializable value, got ${typeof t}`)});function Rw(t,e){return new ej(t,e)}function Z1(t,e){return new X1(t,e,(n,r)=>{throw new Je(`Expected one of ${Object.keys(e).map(s=>JSON.stringify(s)).join(" or ")}, got ${JSON.stringify(r)}`,[t])})}function lo(t,e){return new mn(n=>{const r=n&&typeof n=="object"&&"id"in n&&typeof n.id=="string"?`${t}(id = ${n.id})`:t;return il(r,()=>e.validate(n))})}function Ad(t){return new mn(e=>{if(!t.has(e)){const n=Array.from(t,r=>JSON.stringify(r)).join(" or ");throw new Je(`Expected ${n}, got ${e}`)}return e})}function DT(t){return new mn(e=>{if(e!==void 0)return t.validate(e)})}function sj(t){return new mn(e=>e===null?null:t.validate(e))}function RT(...t){return Ad(new Set(t))}function Ur(t){return fe.refine(e=>{if(!e.startsWith(`${t}:`))throw new Error(`${t} ID must start with "${t}:"`);return e})}const um=Ur("asset");function J1(t,e){return Ce({id:um,typeName:Tn("asset"),type:Tn(t),props:e,meta:us})}const oj=lo("camera",Ce({typeName:Tn("camera"),id:Ur("camera"),x:pe,y:pe,z:pe,meta:us})),QC={AddMeta:1},ij=Ae({currentVersion:QC.AddMeta,migrators:{[QC.AddMeta]:{up:t=>({...t,meta:{}}),down:({meta:t,...e})=>({...e})}}}),Dt=co("camera",{validator:oj,migrations:ij,scope:"session"}).withDefaultProperties(()=>({x:0,y:0,z:1,meta:{}})),Vu=Ce({x:pe,y:pe,z:pe.optional()}),mu=Ce({x:pe,y:pe,w:pe,h:pe}),aj=new Set(["none","default","pointer","cross","grab","rotate","grabbing","resize-edge","resize-corner","text","move","ew-resize","ns-resize","nesw-resize","nwse-resize","nesw-rotate","nwse-rotate","swne-rotate","senw-rotate","zoom-in","zoom-out"]),LT=Ad(aj),cj=Ce({type:LT,rotation:pe}),jT=pe.check(t=>{if(t<0||t>1)throw new Je("Opacity must be between 0 and 1")}),lj=new Set(["accent","white","black","selection-stroke","selection-fill","laser","muted-1"]),uj=Ad(lj),dj=new Set(["starting","paused","active","stopping"]),NT=Ce({points:Yn(Vu),size:Q1,color:uj,opacity:pe,state:Ad(dj),delay:pe}),Wu=Ur("page"),hj=lo("page",Ce({typeName:Tn("page"),id:Wu,name:fe,index:fe,meta:us})),ZC={AddMeta:1},fj=Ae({currentVersion:ZC.AddMeta,migrators:{[ZC.AddMeta]:{up:t=>({...t,meta:{}}),down:({meta:t,...e})=>({...e})}}}),Un=co("page",{validator:hj,migrations:fj,scope:"document"}).withDefaultProperties(()=>({meta:{}}));function wn(t){return Un.isId(t)}Ur("instance");function pj(t){const e={};for(const[r,s]of t)e[r]=DT(s);const n=lo("instance",Ce({typeName:Tn("instance"),id:Ur("instance"),currentPageId:Wu,followingUserId:fe.nullable(),brush:mu.nullable(),opacityForNextShape:jT,stylesForNextShape:Ce(e),cursor:cj,scribble:NT.nullable(),isFocusMode:Pe,isDebugMode:Pe,isToolLocked:Pe,exportBackground:Pe,screenBounds:mu,zoomBrush:mu.nullable(),isPenMode:Pe,isGridMode:Pe,chatMessage:fe,isChatting:Pe,highlightedUserIds:Yn(fe),canMoveCamera:Pe,isFocused:Pe,devicePixelRatio:pe,isCoarsePointer:Pe,openMenus:Yn(fe),isChangingStyle:Pe,isReadonly:Pe,meta:us}));return co("instance",{migrations:gj,validator:n,scope:"session"}).withDefaultProperties(()=>({followingUserId:null,opacityForNextShape:1,stylesForNextShape:{},brush:null,scribble:null,cursor:{type:"default",rotation:0},isFocusMode:!1,exportBackground:!1,isDebugMode:!1,isToolLocked:!1,screenBounds:{x:0,y:0,w:1080,h:720},zoomBrush:null,isGridMode:!1,isPenMode:!1,chatMessage:"",isChatting:!1,highlightedUserIds:[],canMoveCamera:!0,isFocused:!1,devicePixelRatio:typeof window>"u"?1:window.devicePixelRatio,isCoarsePointer:!1,openMenus:[],isChangingStyle:!1,isReadonly:!1,meta:{}}))}const ft={AddTransparentExportBgs:1,RemoveDialog:2,AddToolLockMode:3,RemoveExtraPropsForNextShape:4,AddLabelColor:5,AddFollowingUserId:6,RemoveAlignJustify:7,AddZoom:8,AddVerticalAlign:9,AddScribbleDelay:10,RemoveUserId:11,AddIsPenModeAndIsGridMode:12,HoistOpacity:13,AddChat:14,AddHighlightedUserIds:15,ReplacePropsForNextShapeWithStylesForNextShape:16,AddMeta:17,RemoveCursorColor:18,AddLonelyProperties:19,ReadOnlyReadonly:20},gj=Ae({currentVersion:ft.ReadOnlyReadonly,migrators:{[ft.AddTransparentExportBgs]:{up:t=>({...t,exportBackground:!0}),down:({exportBackground:t,...e})=>e},[ft.RemoveDialog]:{up:({dialog:t,...e})=>e,down:t=>({...t,dialog:null})},[ft.AddToolLockMode]:{up:t=>({...t,isToolLocked:!1}),down:({isToolLocked:t,...e})=>e},[ft.RemoveExtraPropsForNextShape]:{up:({propsForNextShape:t,...e})=>({...e,propsForNextShape:Object.fromEntries(Object.entries(t).filter(([n])=>["color","labelColor","dash","fill","size","font","align","verticalAlign","icon","geo","arrowheadStart","arrowheadEnd","spline"].includes(n)))}),down:t=>t},[ft.AddLabelColor]:{up:({propsForNextShape:t,...e})=>({...e,propsForNextShape:{...t,labelColor:"black"}}),down:t=>{const{labelColor:e,...n}=t.propsForNextShape;return{...t,propsForNextShape:{...n}}}},[ft.AddFollowingUserId]:{up:t=>({...t,followingUserId:null}),down:({followingUserId:t,...e})=>e},[ft.RemoveAlignJustify]:{up:t=>{let e=t.propsForNextShape.align;return e==="justify"&&(e="start"),{...t,propsForNextShape:{...t.propsForNextShape,align:e}}},down:t=>({...t})},[ft.AddZoom]:{up:t=>({...t,zoomBrush:null}),down:({zoomBrush:t,...e})=>e},[ft.AddVerticalAlign]:{up:t=>({...t,propsForNextShape:{...t.propsForNextShape,verticalAlign:"middle"}}),down:t=>{const{verticalAlign:e,...n}=t.propsForNextShape;return{...t,propsForNextShape:n}}},[ft.AddScribbleDelay]:{up:t=>t.scribble!==null?{...t,scribble:{...t.scribble,delay:0}}:{...t},down:t=>{if(t.scribble!==null){const{delay:e,...n}=t.scribble;return{...t,scribble:n}}return{...t}}},[ft.RemoveUserId]:{up:({userId:t,...e})=>e,down:t=>({...t,userId:"user:none"})},[ft.AddIsPenModeAndIsGridMode]:{up:t=>({...t,isPenMode:!1,isGridMode:!1}),down:({isPenMode:t,isGridMode:e,...n})=>n},[ft.HoistOpacity]:{up:({propsForNextShape:{opacity:t,...e},...n})=>({...n,opacityForNextShape:Number(t??"1"),propsForNextShape:e}),down:({opacityForNextShape:t,...e})=>({...e,propsForNextShape:{...e.propsForNextShape,opacity:t<.175?"0.1":t<.375?"0.25":t<.625?"0.5":t<.875?"0.75":"1"}})},[ft.AddChat]:{up:t=>({...t,chatMessage:"",isChatting:!1}),down:({chatMessage:t,isChatting:e,...n})=>n},[ft.AddHighlightedUserIds]:{up:t=>({...t,highlightedUserIds:[]}),down:({highlightedUserIds:t,...e})=>e},[ft.ReplacePropsForNextShapeWithStylesForNextShape]:{up:({propsForNextShape:t,...e})=>({...e,stylesForNextShape:{}}),down:({stylesForNextShape:t,...e})=>({...e,propsForNextShape:{color:"black",labelColor:"black",dash:"draw",fill:"none",size:"m",icon:"file",font:"draw",align:"middle",verticalAlign:"middle",geo:"rectangle",arrowheadStart:"none",arrowheadEnd:"arrow",spline:"line"}})},[ft.AddMeta]:{up:t=>({...t,meta:{}}),down:({meta:t,...e})=>({...e})},[ft.RemoveCursorColor]:{up:t=>{const{color:e,...n}=t.cursor;return{...t,cursor:n}},down:t=>({...t,cursor:{...t.cursor,color:"black"}})},[ft.AddLonelyProperties]:{up:t=>({...t,canMoveCamera:!0,isFocused:!1,devicePixelRatio:1,isCoarsePointer:!1,openMenus:[],isChangingStyle:!1,isReadOnly:!1}),down:({canMoveCamera:t,isFocused:e,devicePixelRatio:n,isCoarsePointer:r,openMenus:s,isChangingStyle:o,isReadOnly:i,...a})=>({...a})},[ft.ReadOnlyReadonly]:{up:({isReadOnly:t,...e})=>({...e,isReadonly:t}),down:({isReadonly:t,...e})=>({...e,isReadOnly:t})}}}),Zt="instance:instance",mj=fe.refine(t=>{if(!t.startsWith("page:")&&!t.startsWith("shape:"))throw new Error('Parent ID must start with "page:" or "shape:"');return t}),Mr=Ur("shape");function yj(t,e,n){return Ce({id:Mr,typeName:Tn("shape"),x:pe,y:pe,rotation:pe,index:fe,parentId:mj,type:Tn(t),isLocked:Pe,opacity:jT,props:e?Ce(e):us,meta:n?Ce(n):us})}const vj=lo("instance_page_state",Ce({typeName:Tn("instance_page_state"),id:Ur("instance_page_state"),pageId:Wu,selectedShapeIds:Yn(Mr),hintingShapeIds:Yn(Mr),erasingShapeIds:Yn(Mr),hoveredShapeId:Mr.nullable(),editingShapeId:Mr.nullable(),croppingShapeId:Mr.nullable(),focusedGroupId:Mr.nullable(),meta:us})),Rl={AddCroppingId:1,RemoveInstanceIdAndCameraId:2,AddMeta:3,RenameProperties:4},wj=Ae({currentVersion:Rl.RenameProperties,migrators:{[Rl.AddCroppingId]:{up(t){return{...t,croppingShapeId:null}},down({croppingShapeId:t,...e}){return e}},[Rl.RemoveInstanceIdAndCameraId]:{up({instanceId:t,cameraId:e,...n}){return n},down(t){return{...t,instanceId:Zt,cameraId:Dt.createId("void")}}},[Rl.AddMeta]:{up:t=>({...t,meta:{}}),down:({meta:t,...e})=>({...e})},[Rl.RenameProperties]:{up:t=>{const{selectedShapeIds:e,hintingShapeIds:n,erasingShapeIds:r,hoveredShapeId:s,editingShapeId:o,croppingShapeId:i,focusedGroupId:a,...c}=t;return{selectedShapeIds:e,hintingShapeIds:n,erasingShapeIds:r,hoveredShapeId:s,editingShapeId:o,croppingShapeId:i,focusedGroupId:a,...c}},down:t=>{const{selectedShapeIds:e,hintingShapeIds:n,erasingShapeIds:r,hoveredShapeId:s,editingShapeId:o,croppingShapeId:i,focusedGroupId:a,...c}=t;return{selectedShapeIds:e,hintingShapeIds:n,erasingShapeIds:r,hoveredShapeId:s,editingShapeId:o,croppingShapeId:i,focusedGroupId:a,...c}}}}}),Rt=co("instance_page_state",{migrations:wj,validator:vj,scope:"session"}).withDefaultProperties(()=>({editingShapeId:null,croppingShapeId:null,selectedShapeIds:[],hoveredShapeId:null,erasingShapeIds:[],hintingShapeIds:[],focusedGroupId:null,meta:{}})),Sj=lo("pointer",Ce({typeName:Tn("pointer"),id:Ur("pointer"),x:pe,y:pe,lastActivityTimestamp:pe,meta:us})),JC={AddMeta:1},xj=Ae({currentVersion:JC.AddMeta,migrators:{[JC.AddMeta]:{up:t=>({...t,meta:{}}),down:({meta:t,...e})=>({...e})}}}),ex=co("pointer",{validator:Sj,migrations:xj,scope:"session"}).withDefaultProperties(()=>({x:0,y:0,lastActivityTimestamp:0,meta:{}})),Gu=ex.createId("pointer"),bj=lo("instance_presence",Ce({typeName:Tn("instance_presence"),id:Ur("instance_presence"),userId:fe,userName:fe,lastActivityTimestamp:pe,followingUserId:fe.nullable(),cursor:Ce({x:pe,y:pe,type:LT,rotation:pe}),color:fe,camera:Ce({x:pe,y:pe,z:pe}),screenBounds:mu,selectedShapeIds:Yn(Ur("shape")),currentPageId:Ur("page"),brush:mu.nullable(),scribble:NT.nullable(),chatMessage:fe,meta:us})),Ha={AddScribbleDelay:1,RemoveInstanceId:2,AddChatMessage:3,AddMeta:4,RenameSelectedShapeIds:5},Cj=Ae({currentVersion:Ha.RenameSelectedShapeIds,migrators:{[Ha.AddScribbleDelay]:{up:t=>t.scribble!==null?{...t,scribble:{...t.scribble,delay:0}}:{...t},down:t=>{if(t.scribble!==null){const{delay:e,...n}=t.scribble;return{...t,scribble:n}}return{...t}}},[Ha.RemoveInstanceId]:{up:({instanceId:t,...e})=>e,down:t=>({...t,instanceId:Zt})},[Ha.AddChatMessage]:{up:t=>({...t,chatMessage:""}),down:({chatMessage:t,...e})=>e},[Ha.AddMeta]:{up:t=>({...t,meta:{}}),down:({meta:t,...e})=>({...e})},[Ha.RenameSelectedShapeIds]:{up:t=>{const{selectedShapeIds:e,...n}=t;return{selectedShapeIds:e,...n}},down:t=>{const{selectedShapeIds:e,...n}=t;return{selectedShapeIds:e,...n}}}}}),Yu=co("instance_presence",{migrations:Cj,validator:bj,scope:"presence"}).withDefaultProperties(()=>({lastActivityTimestamp:0,followingUserId:null,color:"#FF0000",camera:{x:0,y:0,z:1},cursor:{x:0,y:0,type:"default",rotation:0},screenBounds:{x:0,y:0,w:1,h:1},selectedShapeIds:[],brush:null,scribble:null,chatMessage:"",meta:{}})),_j=(t,e)=>n=>X("instancePresence",()=>{const r=n.get(Zt),s=n.get(Rt.createId(r==null?void 0:r.currentPageId)),o=n.get(Dt.createId(r==null?void 0:r.currentPageId)),i=n.get(Gu),a=t.value;return!s||!r||!o||!i||!a?null:Yu.create({id:e??Yu.createId(n.id),selectedShapeIds:s.selectedShapeIds,brush:r.brush,scribble:r.scribble,userId:a.id,userName:a.name,followingUserId:r.followingUserId,camera:{x:o.x,y:o.y,z:o.z},color:a.color,currentPageId:r.currentPageId,cursor:{x:i.x,y:i.y,rotation:r.cursor.rotation,type:r.cursor.type},lastActivityTimestamp:i.lastActivityTimestamp,screenBounds:r.screenBounds,chatMessage:r.chatMessage,meta:{}})}),Ej=lo("document",Ce({typeName:Tn("document"),id:Tn("document:document"),gridSize:pe,name:fe,meta:us})),Fy={AddName:1,AddMeta:2},Pj=Ae({currentVersion:Fy.AddMeta,migrators:{[Fy.AddName]:{up:t=>({...t,name:""}),down:({name:t,...e})=>e},[Fy.AddMeta]:{up:t=>({...t,meta:{}}),down:({meta:t,...e})=>({...e})}}}),dm=co("document",{migrations:Pj,validator:Ej,scope:"document"}).withDefaultProperties(()=>({gridSize:10,name:"",meta:{}})),Lw=dm.createId("document");function kj(t,e){return t.index<e.index?-1:t.index>e.index?1:0}function e_(t){t.typeName==="asset"&&("src"in t&&(t.src="<redacted>"),"src"in t.props&&(t.props.src="<redacted>"))}const Ij=({error:t,phase:e,record:n,recordBefore:r})=>{throw V1(t,{tags:{origin:"store.validateRecord",storePhase:e,isExistingValidationIssue:e==="initialize"},extras:{recordBefore:r?e_(ei(r)):void 0,recordAfter:e_(ei(n))}}),t};function $j(){return[Un.create({name:"Page 1",index:"a1",meta:{}})]}function Tj(t){const e=t.query.ids("page"),n=()=>{if(!t.has(Lw))return t.put([dm.create({id:Lw,name:t.props.defaultName})]),n();if(!t.has(Gu))return t.put([ex.create({id:Gu})]),n();const r=e.value;if(r.size===0)return t.put($j()),n();const s=()=>[...r].map(c=>t.get(c)).sort(kj)[0].id,o=t.get(Zt);if(o){if(!r.has(o.currentPageId))return t.put([{...o,currentPageId:s()}]),n()}else return t.put([t.schema.types.instance.create({id:Zt,currentPageId:s(),exportBackground:!0})]),n();const i=new Set,a=new Set;for(const c of r){const l=Rt.createId(c);t.has(l)||i.add(l);const u=Dt.createId(c);t.has(u)||a.add(u)}i.size>0&&t.put([...i].map(c=>Rt.create({id:c,pageId:Rt.parseId(c)}))),a.size>0&&t.put([...a].map(c=>Dt.create({id:c})))};return n}const Aj=J1("bookmark",Ce({title:fe,description:fe,image:fe,src:fe.nullable()})),Mj=Ae({}),Oj=J1("image",Ce({w:pe,h:pe,name:fe,isAnimated:Pe,mimeType:fe.nullable(),src:fe.nullable()})),By={AddIsAnimated:1,RenameWidthHeight:2},Dj=Ae({currentVersion:By.RenameWidthHeight,migrators:{[By.AddIsAnimated]:{up:t=>({...t,props:{...t.props,isAnimated:!1}}),down:t=>{const{isAnimated:e,...n}=t.props;return{...t,props:n}}},[By.RenameWidthHeight]:{up:t=>{const{width:e,height:n,...r}=t.props;return{...t,props:{w:e,h:n,...r}}},down:t=>{const{w:e,h:n,...r}=t.props;return{...t,props:{width:e,height:n,...r}}}}}}),Rj=J1("video",Ce({w:pe,h:pe,name:fe,isAnimated:Pe,mimeType:fe.nullable(),src:fe.nullable()})),Uy={AddIsAnimated:1,RenameWidthHeight:2},Lj=Ae({currentVersion:Uy.RenameWidthHeight,migrators:{[Uy.AddIsAnimated]:{up:t=>({...t,props:{...t.props,isAnimated:!1}}),down:t=>{const{isAnimated:e,...n}=t.props;return{...t,props:n}}},[Uy.RenameWidthHeight]:{up:t=>{const{width:e,height:n,...r}=t.props;return{...t,props:{w:e,h:n,...r}}},down:t=>{const{w:e,h:n,...r}=t.props;return{...t,props:{width:e,height:n,...r}}}}}}),jj=lo("asset",Z1("type",{image:Oj,video:Rj,bookmark:Aj})),t_={AddMeta:1},Nj=Ae({subTypeKey:"type",subTypeMigrations:{image:Dj,video:Lj,bookmark:Mj},currentVersion:t_.AddMeta,migrators:{[t_.AddMeta]:{up:t=>({...t,meta:{}}),down:({meta:t,...e})=>({...e})}}}),$c=co("asset",{migrations:Nj,validator:jj,scope:"document"}).withDefaultProperties(()=>({meta:{}}));class sn{constructor(e,n,r){this.id=e,this.defaultValue=n,this.type=r}static define(e,n){const{defaultValue:r,type:s=tj}=n;return new sn(e,r,s)}static defineEnum(e,n){const{defaultValue:r,values:s}=n;return new zj(e,r,s)}validate(e){return this.type.validate(e)}}class zj extends sn{constructor(e,n,r){super(e,n,RT(...r)),this.values=r}}const Nh={AddIsLocked:1,HoistOpacity:2,AddMeta:3},Hy=Ae({currentVersion:Nh.AddMeta,migrators:{[Nh.AddIsLocked]:{up:t=>({...t,isLocked:!1}),down:t=>{const{isLocked:e,...n}=t;return{...n}}},[Nh.HoistOpacity]:{up:({props:{opacity:t,...e},...n})=>({...n,opacity:Number(t??"1"),props:e}),down:({opacity:t,...e})=>({...e,props:{...e.props,opacity:t<.175?"0.1":t<.375?"0.25":t<.625?"0.5":t<.875?"0.75":"1"}})},[Nh.AddMeta]:{up:t=>({...t,meta:{}}),down:({meta:t,...e})=>({...e})}}});function Hi(t){return t?t.typeName==="shape":!1}function ar(t){return t?t.startsWith("shape:"):!1}function Ke(t){return`shape:${t??cm()}`}function zT(t){const e=new Map;for(const[n,r]of Object.entries(t))if(r instanceof sn){if(e.has(r))throw new Error(`Duplicate style prop ${r.id}. Each style prop can only be used once within a shape.`);e.set(r,n)}return e}function Fj(t){return co("shape",{migrations:Ae({currentVersion:Hy.currentVersion,firstVersion:Hy.firstVersion,migrators:Hy.migrators,subTypeKey:"type",subTypeMigrations:GC(t,(e,n)=>n.migrations??Ae({}))}),scope:"document",validator:lo("shape",Z1("type",GC(t,(e,{props:n,meta:r})=>yj(e,n,r))))}).withDefaultProperties(()=>({x:0,y:0,rotation:0,isLocked:!1,opacity:1,meta:{}}))}const Ll={RemoveCodeAndIconShapeTypes:1,AddInstancePresenceType:2,RemoveTLUserAndPresenceAndAddPointer:3,RemoveUserDocument:4},Bj=Ae({currentVersion:Ll.RemoveUserDocument,migrators:{[Ll.RemoveCodeAndIconShapeTypes]:{up:t=>Object.fromEntries(Object.entries(t).filter(([e,n])=>n.typeName!=="shape"||n.type!=="icon"&&n.type!=="code")),down:t=>t},[Ll.AddInstancePresenceType]:{up:t=>t,down:t=>Object.fromEntries(Object.entries(t).filter(([e,n])=>n.typeName!=="instance_presence"))},[Ll.RemoveTLUserAndPresenceAndAddPointer]:{up:t=>Object.fromEntries(Object.entries(t).filter(([e,n])=>!n.typeName.match(/^(user|user_presence)$/))),down:t=>Object.fromEntries(Object.entries(t).filter(([e,n])=>n.typeName!=="pointer"))},[Ll.RemoveUserDocument]:{up:t=>Object.fromEntries(Object.entries(t).filter(([e,n])=>!n.typeName.match("user_document"))),down:t=>t}}});function Uj({shapes:t}){const e=new Map;for(const s of ut(t))for(const o of zT(s.props??{}).keys()){if(e.has(o.id)&&e.get(o.id)!==o)throw new Error(`Multiple StyleProp instances with the same id: ${o.id}`);e.set(o.id,o)}const n=Fj(t),r=pj(e);return Y1.create({asset:$c,camera:Dt,document:dm,instance:r,instance_page_state:Rt,page:Un,shape:n,instance_presence:Yu,pointer:ex},{snapshotMigrations:Bj,onValidationFailure:Ij,createIntegrityChecker:Tj})}const FT=["black","grey","light-violet","violet","blue","light-blue","yellow","orange","green","light-green","light-red","red"],Yp={lightMode:{id:"light",text:"#000000",background:"rgb(249, 250, 251)",solid:"#fcfffe",black:{solid:"#1d1d1d",semi:"#e8e8e8",pattern:"#494949",highlight:{srgb:"#fddd00",p3:"color(display-p3 0.972 0.8705 0.05)"}},blue:{solid:"#4263eb",semi:"#dce1f8",pattern:"#6681ee",highlight:{srgb:"#10acff",p3:"color(display-p3 0.308 0.6632 0.9996)"}},green:{solid:"#099268",semi:"#d3e9e3",pattern:"#39a785",highlight:{srgb:"#00ffc8",p3:"color(display-p3 0.2536 0.984 0.7981)"}},grey:{solid:"#adb5bd",semi:"#eceef0",pattern:"#bcc3c9",highlight:{srgb:"#cbe7f1",p3:"color(display-p3 0.8163 0.9023 0.9416)"}},"light-blue":{solid:"#4dabf7",semi:"#ddedfa",pattern:"#6fbbf8",highlight:{srgb:"#00f4ff",p3:"color(display-p3 0.1512 0.9414 0.9996)"}},"light-green":{solid:"#40c057",semi:"#dbf0e0",pattern:"#65cb78",highlight:{srgb:"#65f641",p3:"color(display-p3 0.563 0.9495 0.3857)"}},"light-red":{solid:"#ff8787",semi:"#f4dadb",pattern:"#fe9e9e",highlight:{srgb:"#ff7fa3",p3:"color(display-p3 0.9988 0.5301 0.6397)"}},"light-violet":{solid:"#e599f7",semi:"#f5eafa",pattern:"#e9acf8",highlight:{srgb:"#ff88ff",p3:"color(display-p3 0.9676 0.5652 0.9999)"}},orange:{solid:"#f76707",semi:"#f8e2d4",pattern:"#f78438",highlight:{srgb:"#ffa500",p3:"color(display-p3 0.9988 0.6905 0.266)"}},red:{solid:"#e03131",semi:"#f4dadb",pattern:"#e55959",highlight:{srgb:"#ff636e",p3:"color(display-p3 0.9992 0.4376 0.45)"}},violet:{solid:"#ae3ec9",semi:"#ecdcf2",pattern:"#bd63d3",highlight:{srgb:"#c77cff",p3:"color(display-p3 0.7469 0.5089 0.9995)"}},yellow:{solid:"#ffc078",semi:"#f9f0e6",pattern:"#fecb92",highlight:{srgb:"#fddd00",p3:"color(display-p3 0.972 0.8705 0.05)"}}},darkMode:{id:"dark",text:"#f8f9fa",background:"#212529",solid:"#28292e",black:{solid:"#e1e1e1",semi:"#2c3036",pattern:"#989898",highlight:{srgb:"#d2b700",p3:"color(display-p3 0.8078 0.7225 0.0312)"}},blue:{solid:"#4156be",semi:"#262d40",pattern:"#3a4b9e",highlight:{srgb:"#0079d2",p3:"color(display-p3 0.0032 0.4655 0.7991)"}},green:{solid:"#3b7b5e",semi:"#253231",pattern:"#366a53",highlight:{srgb:"#009774",p3:"color(display-p3 0.0085 0.582 0.4604)"}},grey:{solid:"#93989f",semi:"#33373c",pattern:"#7c8187",highlight:{srgb:"#9cb4cb",p3:"color(display-p3 0.6299 0.7012 0.7856)"}},"light-blue":{solid:"#588fc9",semi:"#2a3642",pattern:"#4d7aa9",highlight:{srgb:"#00bdc8",p3:"color(display-p3 0.0023 0.7259 0.7735)"}},"light-green":{solid:"#599f57",semi:"#2a3830",pattern:"#4e874e",highlight:{srgb:"#00a000",p3:"color(display-p3 0.2711 0.6172 0.0195)"}},"light-red":{solid:"#c67877",semi:"#3b3235",pattern:"#a56767",highlight:{srgb:"#db005b",p3:"color(display-p3 0.7849 0.0585 0.3589)"}},"light-violet":{solid:"#b583c9",semi:"#383442",pattern:"#9770a9",highlight:{srgb:"#c400c7",p3:"color(display-p3 0.7024 0.0403 0.753)"}},orange:{solid:"#bf612e",semi:"#3a2e2a",pattern:"#9f552d",highlight:{srgb:"#d07a00",p3:"color(display-p3 0.7699 0.4937 0.0085)"}},red:{solid:"#aa3c37",semi:"#36292b",pattern:"#8f3734",highlight:{srgb:"#de002c",p3:"color(display-p3 0.7978 0.0509 0.2035)"}},violet:{solid:"#873fa3",semi:"#31293c",pattern:"#763a8b",highlight:{srgb:"#9e00ee",p3:"color(display-p3 0.5651 0.0079 0.8986)"}},yellow:{solid:"#cba371",semi:"#3c3934",pattern:"#fecb92",highlight:{srgb:"#d2b700",p3:"color(display-p3 0.8078 0.7225 0.0312)"}}}};function An(t){return t.isDarkMode?Yp.darkMode:Yp.lightMode}const xr=sn.defineEnum("tldraw:color",{defaultValue:"black",values:FT}),BT=sn.defineEnum("tldraw:labelColor",{defaultValue:"black",values:FT}),da=sn.defineEnum("tldraw:dash",{defaultValue:"draw",values:["draw","solid","dashed","dotted"]}),Vc=sn.defineEnum("tldraw:fill",{defaultValue:"none",values:["none","semi","solid","pattern"]}),ds=sn.defineEnum("tldraw:font",{defaultValue:"draw",values:["draw","sans","serif","mono"]}),Md={draw:"'tldraw_draw', sans-serif",sans:"'tldraw_sans', sans-serif",serif:"'tldraw_serif', serif",mono:"'tldraw_mono', monospace"},hs=sn.defineEnum("tldraw:size",{defaultValue:"m",values:["s","m","l","xl"]}),UT=["arrow","triangle","square","dot","pipe","diamond","inverted","bar","none"],Xp=sn.defineEnum("tldraw:arrowheadStart",{defaultValue:"none",values:UT}),qp=sn.defineEnum("tldraw:arrowheadEnd",{defaultValue:"arrow",values:UT}),n_=Z1("type",{binding:Ce({type:Tn("binding"),boundShapeId:Mr,normalizedAnchor:Vu,isExact:Pe}),point:Ce({type:Tn("point"),x:pe,y:pe})}),Hj={labelColor:BT,color:xr,fill:Vc,dash:da,size:hs,arrowheadStart:Xp,arrowheadEnd:qp,font:ds,start:n_,end:n_,bend:pe,text:fe},r_={AddLabelColor:1},Kj=Ae({currentVersion:r_.AddLabelColor,migrators:{[r_.AddLabelColor]:{up:t=>({...t,props:{...t.props,labelColor:"black"}}),down:t=>{const{labelColor:e,...n}=t.props;return{...t,props:n}}}}}),Vj={w:$n,h:$n,assetId:um.nullable(),url:fe},s_={NullAssetId:1},Wj=Ae({currentVersion:s_.NullAssetId,migrators:{[s_.NullAssetId]:{up:t=>t.props.assetId===void 0?{...t,props:{...t.props,assetId:null}}:t,down:t=>{if(t.props.assetId===null){const{assetId:e,...n}=t.props;return{...t,props:n}}return t}}}}),HT=Ce({type:RT("free","straight"),points:Yn(Vu)}),Gj={color:xr,fill:Vc,dash:da,size:hs,segments:Yn(HT),isComplete:Pe,isClosed:Pe,isPen:Pe},o_={AddInPen:1},Yj=Ae({currentVersion:o_.AddInPen,migrators:{[o_.AddInPen]:{up:t=>{const{points:e}=t.props.segments[0];if(e.length===0)return{...t,props:{...t.props,isPen:!1}};let n=!(e[0].z===0||e[0].z===.5);return e[1]&&(n=n&&!(e[1].z===0||e[1].z===.5)),{...t,props:{...t.props,isPen:n}}},down:t=>{const{isPen:e,...n}=t.props;return{...t,props:{...n}}}}}}),i_=/(^\/r\/[^/]+\/?$)/,Re=t=>{try{return new URL(t)}catch{return}},Wc=[{type:"tldraw",title:"tldraw",hostnames:["beta.tldraw.com","tldraw.com"],minWidth:300,minHeight:300,width:720,height:500,doesResize:!0,canUnmount:!0,toEmbedUrl:t=>{const e=Re(t);if(e&&e.pathname.match(i_))return t},fromEmbedUrl:t=>{const e=Re(t);if(e&&e.pathname.match(i_))return t}},{type:"figma",title:"Figma",hostnames:["figma.com"],width:720,height:500,doesResize:!0,canUnmount:!0,toEmbedUrl:t=>{if(t.match(/https:\/\/([\w\.-]+\.)?figma.com\/(file|proto)\/([0-9a-zA-Z]{22,128})(?:\/.*)?$/)&&!t.includes("figma.com/embed"))return`https://www.figma.com/embed?embed_host=share&url=${t}`},fromEmbedUrl:t=>{const e=Re(t);if(e&&e.pathname.match(/^\/embed\/?$/)){const n=e.searchParams.get("url");if(n)return n}}},{type:"google_maps",title:"Google Maps",hostnames:["google.*"],width:720,height:500,doesResize:!0,canUnmount:!1,toEmbedUrl:t=>{if(t.includes("/maps/")){const e=t.match(/@(.*),(.*),(.*)z/);let n;if(e){const[,r,s,o]=e;n=`https://${new URL(t).host.replace("www.","")}/maps/embed/v1/view?key=${{}.NEXT_PUBLIC_GC_API_KEY}&center=${r},${s}&zoom=${o}`}else n="";return n}},fromEmbedUrl:t=>{const e=Re(t);if(!e)return;if(e.pathname.match(/^\/maps\/embed\/v1\/view\/?$/)&&e.searchParams.has("center")&&e.searchParams.get("zoom")){const r=e.searchParams.get("zoom"),[s,o]=e.searchParams.get("center").split(",");return`https://www.google.com/maps/@${s},${o},${r}z`}}},{type:"val_town",title:"Val Town",hostnames:["val.town"],minWidth:260,minHeight:100,width:720,height:500,doesResize:!0,canUnmount:!1,toEmbedUrl:t=>{const e=Re(t),n=e&&e.pathname.match(/\/v\/([^/]+)\/?/);if(n)return`https://www.val.town/embed/${n[1]}`},fromEmbedUrl:t=>{const e=Re(t),n=e&&e.pathname.match(/\/embed\/([^/]+)\/?/);if(n)return`https://www.val.town/v/${n[1]}`}},{type:"codesandbox",title:"CodeSandbox",hostnames:["codesandbox.io"],minWidth:300,minHeight:300,width:720,height:500,doesResize:!0,canUnmount:!1,toEmbedUrl:t=>{const e=Re(t),n=e&&e.pathname.match(/\/s\/([^/]+)\/?/);if(n)return`https://codesandbox.io/embed/${n[1]}`},fromEmbedUrl:t=>{const e=Re(t),n=e&&e.pathname.match(/\/embed\/([^/]+)\/?/);if(n)return`https://codesandbox.io/s/${n[1]}`}},{type:"codepen",title:"Codepen",hostnames:["codepen.io"],minWidth:300,minHeight:300,width:520,height:400,doesResize:!0,canUnmount:!1,toEmbedUrl:t=>{const e=/https:\/\/codepen.io\/([^/]+)\/pen\/([^/]+)/,n=t.match(e);if(n){const[r,s,o]=n;return`https://codepen.io/${s}/embed/${o}`}},fromEmbedUrl:t=>{const e=/https:\/\/codepen.io\/([^/]+)\/embed\/([^/]+)/,n=t.match(e);if(n){const[r,s,o]=n;return`https://codepen.io/${s}/pen/${o}`}}},{type:"scratch",title:"Scratch",hostnames:["scratch.mit.edu"],width:520,height:400,doesResize:!1,canUnmount:!1,toEmbedUrl:t=>{const e=/https?:\/\/scratch.mit.edu\/projects\/([^/]+)/,n=t.match(e);if(n){const[r,s]=n;return`https://scratch.mit.edu/projects/embed/${s}`}},fromEmbedUrl:t=>{const e=/https:\/\/scratch.mit.edu\/projects\/embed\/([^/]+)/,n=t.match(e);if(n){const[r,s]=n;return`https://scratch.mit.edu/projects/${s}`}}},{type:"youtube",title:"YouTube",hostnames:["*.youtube.com","youtube.com","youtu.be"],width:800,height:450,doesResize:!0,canUnmount:!1,overridePermissions:{"allow-presentation":!0},isAspectRatioLocked:!0,toEmbedUrl:t=>{const e=Re(t);if(!e)return;const n=e.hostname.replace(/^www./,"");if(n==="youtu.be")return`https://www.youtube.com/embed/${e.pathname.split("/").filter(Boolean)[0]}`;if((n==="youtube.com"||n==="m.youtube.com")&&e.pathname.match(/^\/watch/))return`https://www.youtube.com/embed/${e.searchParams.get("v")}`},fromEmbedUrl:t=>{const e=Re(t);if(!e)return;if(e.hostname.replace(/^www./,"")==="youtube.com"){const r=e.pathname.match(/^\/embed\/([^/]+)\/?/);if(r)return`https://www.youtube.com/watch?v=${r[1]}`}}},{type:"google_calendar",title:"Google Calendar",hostnames:["calendar.google.*"],width:720,height:500,minWidth:460,minHeight:360,doesResize:!0,canUnmount:!1,instructionLink:"https://support.google.com/calendar/answer/41207?hl=en",toEmbedUrl:t=>{const e=Re(t),n=e==null?void 0:e.searchParams.get("cid");if(e!=null&&e.pathname.match(/\/calendar\/u\/0/)&&n){e.pathname="/calendar/embed";const r=Array.from(e.searchParams.keys());for(const s of r)e.searchParams.delete(s);return e.searchParams.set("src",n),e.href}},fromEmbedUrl:t=>{const e=Re(t),n=e==null?void 0:e.searchParams.get("src");if(e!=null&&e.pathname.match(/\/calendar\/embed/)&&n){e.pathname="/calendar/u/0";const r=Array.from(e.searchParams.keys());for(const s of r)e.searchParams.delete(s);return e.searchParams.set("cid",n),e.href}}},{type:"google_slides",title:"Google Slides",hostnames:["docs.google.*"],width:720,height:500,minWidth:460,minHeight:360,doesResize:!0,canUnmount:!1,toEmbedUrl:t=>{const e=Re(t);if(e!=null&&e.pathname.match(/^\/presentation/)&&(e!=null&&e.pathname.match(/\/pub\/?$/))){e.pathname=e.pathname.replace(/\/pub$/,"/embed");const n=Array.from(e.searchParams.keys());for(const r of n)e.searchParams.delete(r);return e.href}},fromEmbedUrl:t=>{const e=Re(t);if(e!=null&&e.pathname.match(/^\/presentation/)&&(e!=null&&e.pathname.match(/\/embed\/?$/))){e.pathname=e.pathname.replace(/\/embed$/,"/pub");const n=Array.from(e.searchParams.keys());for(const r of n)e.searchParams.delete(r);return e.href}}},{type:"github_gist",title:"GitHub Gist",hostnames:["gist.github.com"],width:720,height:500,doesResize:!0,canUnmount:!0,toEmbedUrl:t=>{const e=Re(t);if(e&&e.pathname.match(/\/([^/]+)\/([^/]+)/))return t.split("/").pop()?t:void 0},fromEmbedUrl:t=>{const e=Re(t);if(e&&e.pathname.match(/\/([^/]+)\/([^/]+)/))return t.split("/").pop()?t:void 0}},{type:"replit",title:"Replit",hostnames:["replit.com"],width:720,height:500,doesResize:!0,canUnmount:!1,toEmbedUrl:t=>{const e=Re(t);if(e&&e.pathname.match(/\/@([^/]+)\/([^/]+)/))return`${t}?embed=true`},fromEmbedUrl:t=>{const e=Re(t);if(e&&e.pathname.match(/\/@([^/]+)\/([^/]+)/)&&e.searchParams.has("embed"))return e.searchParams.delete("embed"),e.href}},{type:"felt",title:"Felt",hostnames:["felt.com"],width:720,height:500,doesResize:!0,canUnmount:!1,toEmbedUrl:t=>{const e=Re(t);if(e&&e.pathname.match(/^\/map\//))return e.origin+"/embed"+e.pathname},fromEmbedUrl:t=>{const e=Re(t);if(e&&e.pathname.match(/^\/embed\/map\//))return e.pathname=e.pathname.replace(/^\/embed/,""),e.href}},{type:"spotify",title:"Spotify",hostnames:["open.spotify.com"],width:720,height:500,minHeight:500,overrideOutlineRadius:12,doesResize:!0,canUnmount:!1,toEmbedUrl:t=>{const e=Re(t);if(e&&e.pathname.match(/^\/(artist|album)\//))return e.origin+"/embed"+e.pathname},fromEmbedUrl:t=>{const e=Re(t);if(e&&e.pathname.match(/^\/embed\/(artist|album)\//))return e.origin+e.pathname.replace(/^\/embed/,"")}},{type:"vimeo",title:"Vimeo",hostnames:["vimeo.com","player.vimeo.com"],width:640,height:360,doesResize:!0,canUnmount:!1,isAspectRatioLocked:!0,toEmbedUrl:t=>{const e=Re(t);if(e&&e.hostname==="vimeo.com"&&e.pathname.match(/^\/[0-9]+/))return"https://player.vimeo.com/video/"+e.pathname.split("/")[1]+"?title=0&byline=0"},fromEmbedUrl:t=>{const e=Re(t);if(e&&e.hostname==="player.vimeo.com"){const n=e.pathname.match(/^\/video\/([^/]+)\/?$/);if(n)return"https://vimeo.com/"+n[1]}}},{type:"excalidraw",title:"Excalidraw",hostnames:["excalidraw.com"],width:720,height:500,doesResize:!0,canUnmount:!1,isAspectRatioLocked:!0,toEmbedUrl:t=>{const e=Re(t);if(e&&e.hash.match(/#room=/))return t},fromEmbedUrl:t=>{const e=Re(t);if(e&&e.hash.match(/#room=/))return t}},{type:"observable",title:"Observable",hostnames:["observablehq.com"],width:720,height:500,doesResize:!0,canUnmount:!1,isAspectRatioLocked:!1,backgroundColor:"#fff",toEmbedUrl:t=>{const e=Re(t);if(e&&e.pathname.match(/^\/@([^/]+)\/([^/]+)\/?$/))return`${e.origin}/embed${e.pathname}?cell=*`;if(e&&e.pathname.match(/^\/d\/([^/]+)\/?$/)){const n=e.pathname.replace(/^\/d/,"");return`${e.origin}/embed${n}?cell=*`}},fromEmbedUrl:t=>{const e=Re(t);if(e&&e.pathname.match(/^\/embed\/@([^/]+)\/([^/]+)\/?$/))return`${e.origin}${e.pathname.replace("/embed","")}#cell-*`;if(e&&e.pathname.match(/^\/embed\/([^/]+)\/?$/))return`${e.origin}${e.pathname.replace("/embed","/d")}#cell-*`}}],Xj={"allow-downloads-without-user-activation":!1,"allow-downloads":!1,"allow-modals":!1,"allow-orientation-lock":!1,"allow-pointer-lock":!1,"allow-popups":!0,"allow-popups-to-escape-sandbox":!1,"allow-presentation":!1,"allow-storage-access-by-user-activation":!1,"allow-top-navigation":!1,"allow-top-navigation-by-user-activation":!1,"allow-scripts":!0,"allow-same-origin":!0,"allow-forms":!0},qj={w:$n,h:$n,url:fe},jl={GenOriginalUrlInEmbed:1,RemoveDoesResize:2,RemoveTmpOldUrl:3,RemovePermissionOverrides:4},Qj=Ae({currentVersion:jl.RemovePermissionOverrides,migrators:{[jl.GenOriginalUrlInEmbed]:{up:t=>{const e=t.props.url,n=new URL(e).host.replace("www.","");let r;for(const s of Wc)if(s.hostnames.includes(n))try{r=s.fromEmbedUrl(e)}catch(o){console.warn(o)}return{...t,props:{...t.props,tmpOldUrl:t.props.url,url:r??""}}},down:t=>{let e=t.props.tmpOldUrl;if(!e||e===""){const s=t.props.url,o=new URL(s).host.replace("www.","");for(const i of Wc)if(i.hostnames.includes(o))try{e=i.toEmbedUrl(s)}catch(a){console.warn(a)}}const{tmpOldUrl:n,...r}=t.props;return{...t,props:{...r,url:e??""}}}},[jl.RemoveDoesResize]:{up:t=>{const{doesResize:e,...n}=t.props;return{...t,props:{...n}}},down:t=>({...t,props:{...t.props,doesResize:!0}})},[jl.RemoveTmpOldUrl]:{up:t=>{const{tmpOldUrl:e,...n}=t.props;return{...t,props:{...n}}},down:t=>({...t,props:{...t.props}})},[jl.RemovePermissionOverrides]:{up:t=>{const{overridePermissions:e,...n}=t.props;return{...t,props:{...n}}},down:t=>({...t,props:{...t.props}})}}}),Zj={w:$n,h:$n,name:fe},Jj=Ae({}),Xu=sn.defineEnum("tldraw:horizontalAlign",{defaultValue:"middle",values:["start","middle","end","start-legacy","end-legacy","middle-legacy"]}),Qp=sn.defineEnum("tldraw:verticalAlign",{defaultValue:"middle",values:["start","middle","end"]}),cs=sn.defineEnum("tldraw:geo",{defaultValue:"rectangle",values:["cloud","rectangle","ellipse","triangle","diamond","pentagon","hexagon","octagon","star","rhombus","rhombus-2","oval","trapezoid","arrow-right","arrow-left","arrow-up","arrow-down","x-box","check-box"]}),eN={geo:cs,labelColor:BT,color:xr,fill:Vc,dash:da,size:hs,font:ds,align:Xu,verticalAlign:Qp,url:fe,w:$n,h:$n,growY:Q1,text:fe},Eo={AddUrlProp:1,AddLabelColor:2,RemoveJustify:3,AddCheckBox:4,AddVerticalAlign:5,MigrateLegacyAlign:6,AddCloud:7},tN=Ae({currentVersion:Eo.AddCloud,migrators:{[Eo.AddUrlProp]:{up:t=>({...t,props:{...t.props,url:""}}),down:t=>{const{url:e,...n}=t.props;return{...t,props:n}}},[Eo.AddLabelColor]:{up:t=>({...t,props:{...t.props,labelColor:"black"}}),down:t=>{const{labelColor:e,...n}=t.props;return{...t,props:n}}},[Eo.RemoveJustify]:{up:t=>{let e=t.props.align;return e==="justify"&&(e="start"),{...t,props:{...t.props,align:e}}},down:t=>({...t})},[Eo.AddCheckBox]:{up:t=>({...t}),down:t=>({...t,props:{...t.props,geo:t.props.geo==="check-box"?"rectangle":t.props.geo}})},[Eo.AddVerticalAlign]:{up:t=>({...t,props:{...t.props,verticalAlign:"middle"}}),down:t=>{const{verticalAlign:e,...n}=t.props;return{...t,props:n}}},[Eo.MigrateLegacyAlign]:{up:t=>{let e;switch(t.props.align){case"start":e="start-legacy";break;case"end":e="end-legacy";break;default:e="middle-legacy";break}return{...t,props:{...t.props,align:e}}},down:t=>{let e;switch(t.props.align){case"start-legacy":e="start";break;case"end-legacy":e="end";break;case"middle-legacy":e="middle";break;default:e=t.props.align}return{...t,props:{...t.props,align:e}}}},[Eo.AddCloud]:{up:t=>t,down:t=>{if(t.props.geo==="cloud")return{...t,props:{...t.props,geo:"rectangle"}}}}}}),nN={},rN=Ae({}),sN={color:xr,size:hs,segments:Yn(HT),isComplete:Pe,isPen:Pe},oN=Ae({}),iN=Ce({topLeft:Vu,bottomRight:Vu}),aN={w:$n,h:$n,playing:Pe,url:fe,assetId:um.nullable(),crop:iN.nullable()},Ky={AddUrlProp:1,AddCropProp:2},cN=Ae({currentVersion:Ky.AddCropProp,migrators:{[Ky.AddUrlProp]:{up:t=>({...t,props:{...t.props,url:""}}),down:t=>{const{url:e,...n}=t.props;return{...t,props:n}}},[Ky.AddCropProp]:{up:t=>({...t,props:{...t.props,crop:null}}),down:t=>{const{crop:e,...n}=t.props;return{...t,props:n}}}}}),lN=new Set(["vertex","virtual","create"]),uN=Ce({id:fe,type:Ad(lN),canBind:Pe.optional(),index:fe,x:pe,y:pe}),Zp=sn.defineEnum("tldraw:spline",{defaultValue:"line",values:["cubic","line"]}),dN={color:xr,dash:da,size:hs,spline:Zp,handles:Rw(fe,uN)},hN=Ae({}),fN={color:xr,size:hs,font:ds,align:Xu,verticalAlign:Qp,growY:Q1,url:fe,text:fe},Nl={AddUrlProp:1,RemoveJustify:2,MigrateLegacyAlign:3,AddVerticalAlign:4},pN=Ae({currentVersion:Nl.AddVerticalAlign,migrators:{[Nl.AddUrlProp]:{up:t=>({...t,props:{...t.props,url:""}}),down:t=>{const{url:e,...n}=t.props;return{...t,props:n}}},[Nl.RemoveJustify]:{up:t=>{let e=t.props.align;return e==="justify"&&(e="start"),{...t,props:{...t.props,align:e}}},down:t=>({...t})},[Nl.MigrateLegacyAlign]:{up:t=>{let e;switch(t.props.align){case"start":e="start-legacy";break;case"end":e="end-legacy";break;default:e="middle-legacy";break}return{...t,props:{...t.props,align:e}}},down:t=>{let e;switch(t.props.align){case"start-legacy":e="start";break;case"end-legacy":e="end";break;case"middle-legacy":e="middle";break;default:e=t.props.align}return{...t,props:{...t.props,align:e}}}},[Nl.AddVerticalAlign]:{up:t=>({...t,props:{...t.props,verticalAlign:"middle"}}),down:t=>{const{verticalAlign:e,...n}=t.props;return{...t,props:n}}}}}),gN={color:xr,size:hs,font:ds,align:Xu,w:$n,text:fe,scale:$n,autoSize:Pe},a_={RemoveJustify:1},mN=Ae({currentVersion:a_.RemoveJustify,migrators:{[a_.RemoveJustify]:{up:t=>{let e=t.props.align;return e==="justify"&&(e="start"),{...t,props:{...t.props,align:e}}},down:t=>({...t})}}}),yN={w:$n,h:$n,time:pe,playing:Pe,url:fe,assetId:um.nullable()},c_={AddUrlProp:1},vN=Ae({currentVersion:c_.AddUrlProp,migrators:{[c_.AddUrlProp]:{up:t=>({...t,props:{...t.props,url:""}}),down:t=>{const{url:e,...n}=t.props;return{...t,props:n}}}}}),qu=[{locale:"ar",label:""},{locale:"ca",label:"Catal"},{locale:"da",label:"Danish"},{locale:"de",label:"Deutsch"},{locale:"en",label:"English"},{locale:"es",label:"Espaol"},{locale:"fa",label:""},{locale:"fi",label:"Suomi"},{locale:"fr",label:"Franais"},{locale:"gl",label:"Galego"},{locale:"he",label:""},{locale:"it",label:"Italiano"},{locale:"ja",label:""},{locale:"ko-kr",label:""},{locale:"ku",label:""},{locale:"hi-in",label:""},{locale:"hu",label:"Magyar"},{locale:"my",label:""},{locale:"ne",label:""},{locale:"no",label:"Norwegian"},{locale:"pl",label:"Polski"},{locale:"pt-br",label:"Portugus - Brasil"},{locale:"pt-pt",label:"Portugus - Europeu"},{locale:"ro",label:"Romn"},{locale:"ru",label:"Russian"},{locale:"sv",label:"Svenska"},{locale:"te",label:""},{locale:"th",label:""},{locale:"tr",label:"Trke"},{locale:"uk",label:"Ukrainian"},{locale:"vi",label:"Ting Vit"},{locale:"zh-cn",label:"Chinese - Simplified"},{locale:"zh-tw",label:" ()"}];function wN(){const t=typeof window<"u"?window.navigator.languages??["en"]:["en"];return SN(t)}function SN(t){for(const e of t){const n=xN(e);if(n)return n}return"en"}const l_={zh:"zh-cn",pt:"pt-br",ko:"ko-kr",hi:"hi-in"};function xN(t){const e=qu.find(s=>s.locale===t.toLowerCase());if(e)return e.locale;const[n,r]=t.split(/[-_]/).map(s=>s.toLowerCase());if(r){const s=qu.find(o=>o.locale===n);if(s)return s.locale}return n in l_?l_[n]:null}const tx={peopleMenu:u_("peopleMenu"),highlighterTool:u_("highlighterTool",{all:!0})},xt={preventDefaultLogging:$r("preventDefaultLogging",{defaults:{all:!1}}),pointerCaptureLogging:$r("pointerCaptureLogging",{defaults:{all:!1}}),pointerCaptureTracking:$r("pointerCaptureTracking",{defaults:{all:!1}}),pointerCaptureTrackingObject:$r("pointerCaptureTrackingObject",{defaults:{all:new Map},shouldStoreForSession:!1}),elementRemovalLogging:$r("elementRemovalLogging",{defaults:{all:!1}}),debugSvg:$r("debugSvg",{defaults:{all:!1}}),throwToBlob:$r("throwToBlob",{defaults:{all:!1}}),logMessages:$r("uiLog",{defaults:{all:[]}}),resetConnectionEveryPing:$r("resetConnectionEveryPing",{defaults:{all:!1}}),debugCursors:$r("debugCursors",{defaults:{all:!1}}),forceSrgb:$r("forceSrgbColors",{defaults:{all:!1}})};typeof window<"u"&&(window.tldrawLog=t=>{xt.logMessages.set(xt.logMessages.value.concat(t))});if(typeof Element<"u"){const t=Element.prototype.removeChild;Td("element removal logging",()=>{xt.elementRemovalLogging.value?Element.prototype.removeChild=function(e){return console.warn("[tldraw] removing child:",e),t.call(this,e)}:Element.prototype.removeChild=t})}function $r(t,{defaults:e,shouldStoreForSession:n=!0}){return KT({name:t,defaults:e,shouldStoreForSession:n})}function u_(t,e={all:!0,production:!1}){return KT({name:t,defaults:e,shouldStoreForSession:!0})}function KT(t){const e=CN(t),n=t.shouldStoreForSession?bN(t.name):null,r=Cn(`debug:${t.name}`,n??e);return typeof window<"u"&&(t.shouldStoreForSession&&Td(`debug:${t.name}`,()=>{const s=r.value;try{s===e?window.sessionStorage.removeItem(`tldraw_debug:${t.name}`):window.sessionStorage.setItem(`tldraw_debug:${t.name}`,JSON.stringify(s))}catch{}}),Object.defineProperty(window,`tldraw${t.name.replace(/^[a-z]/,s=>s.toUpperCase())}`,{get(){return r.value},set(s){r.set(s)},configurable:!0})),Object.assign(r,t)}function bN(t){try{return JSON.parse((window==null?void 0:window.sessionStorage.getItem(`tldraw_debug:${t}`))??"null")}catch{return null}}function Vy(t){try{return t()}catch{return null}}function CN(t){switch(Vy(()=>({}).TLDRAW_ENV)??Vy(()=>({}).VERCEL_PUBLIC_TLDRAW_ENV)??Vy(()=>({}).NEXT_PUBLIC_TLDRAW_ENV)??"production"){case"production":return t.defaults.production??t.defaults.all;case"preview":case"staging":return t.defaults.staging??t.defaults.all;default:return t.defaults.development??t.defaults.all}}function Jp(t){if(t instanceof HTMLElement)return t;if(t.parentElement)return Jp(t.parentElement);throw Error("Could not find a parent element of an HTML type!")}function je(t){t.preventDefault(),xt.preventDefaultLogging.value&&console.warn("preventDefault called on event:",t)}function Od(t,e){if(t.setPointerCapture(e.pointerId),xt.pointerCaptureTracking.value){const n=xt.pointerCaptureTrackingObject.value;n.set(t,(n.get(t)??0)+1)}xt.pointerCaptureLogging.value&&console.warn("setPointerCapture called on element:",t,e)}function hm(t,e){if(t.hasPointerCapture(e.pointerId)){if(t.releasePointerCapture(e.pointerId),xt.pointerCaptureTracking.value){const n=xt.pointerCaptureTrackingObject.value;n.get(t)===1?n.delete(t):n.has(t)?n.set(t,n.get(t)-1):console.warn("Release without capture")}xt.pointerCaptureLogging.value&&console.warn("releasePointerCapture called on element:",t,e)}}const Vn=t=>t.stopPropagation();function vr(t){return t.isKilled=!0,{point:{x:t.clientX,y:t.clientY,z:t.pressure},shiftKey:t.shiftKey,altKey:t.altKey,ctrlKey:t.metaKey||t.ctrlKey,pointerId:t.pointerId,button:t.button,isPen:t.pointerType==="pen"}}const nx=Z.createContext({}),H=()=>Z.useContext(nx);function _N(){const t=H();return S.useMemo(function(){let r,s;function o(h){h.isKilled||h.button!==0&&h.button!==1&&h.button!==5||(Od(h.currentTarget,h),t.dispatch({type:"pointer",target:"canvas",name:"pointer_down",...vr(h)}))}function i(h){h.isKilled||h.clientX===r&&h.clientY===s||(r=h.clientX,s=h.clientY,t.dispatch({type:"pointer",target:"canvas",name:"pointer_move",...vr(h)}))}function a(h){h.isKilled||h.button!==0&&h.button!==1&&h.button!==2&&h.button!==5||(r=h.clientX,s=h.clientY,hm(h.currentTarget,h),t.dispatch({type:"pointer",target:"canvas",name:"pointer_up",...vr(h)}))}function c(h){h.isKilled=!0,document.body.click(),je(h)}function l(h){h.isKilled=!0,h.target.tagName!=="A"&&h.target.tagName!=="TEXTAREA"&&je(h)}function u(h){je(h)}async function d(h){var p,m;if(je(h),!((m=(p=h.dataTransfer)==null?void 0:p.files)!=null&&m.length))return;const f=Array.from(h.dataTransfer.files);await t.putExternalContent({type:"files",files:f,point:t.screenToPage({x:h.clientX,y:h.clientY}),ignoreParent:!1})}return{onPointerDown:o,onPointerMove:i,onPointerUp:a,onDragOver:u,onDrop:d,onTouchStart:c,onTouchEnd:l}},[t])}function EN(){const t=H();S.useEffect(()=>{if(t.environment.isFirefox&&!t.environment.isAndroid&&!t.environment.isIos){t.updateInstanceState({isCoarsePointer:!1});return}if(window.matchMedia){const e=window.matchMedia("(pointer: coarse)"),n=()=>{t.updateInstanceState({isCoarsePointer:!!e.matches})};if(n(),e)return e.addEventListener("change",n),()=>e.removeEventListener("change",n)}},[t])}const VT=S.createContext(null);function PN({container:t,children:e}){return g.jsx(VT.Provider,{value:t,children:e})}function Mn(){return O7(S.useContext(VT),"useContainer used outside of <Tldraw />")}function kN(){const t=H(),e=Mn(),n=Y("isFocused",()=>t.instanceState.isFocused,[t]);S.useEffect(()=>{if(typeof matchMedia!==void 0)return;function r(){t.updateInstanceState({devicePixelRatio:window.devicePixelRatio})}const s=matchMedia(`(resolution: ${window.devicePixelRatio}dppx)`);return s.addEventListener("change",r),()=>{s.removeEventListener("change",r)}},[t]),S.useEffect(()=>{if(!n)return;const r=l=>{if(l.altKey&&(t.isIn("zoom")||!t.root.path.value.endsWith(".idle"))&&!zl()&&je(l),l.isKilled)return;switch(l.isKilled=!0,l.key){case"=":case"-":case"0":{if(l.metaKey||l.ctrlKey){je(l);return}break}case"Tab":{if(zl()||t.isMenuOpen)return;break}case",":{if(!zl()&&(je(l),!t.inputs.keys.has("Comma"))){const{x:d,y:h,z:f}=t.inputs.currentScreenPoint;t.inputs.keys.add("Comma");const p={type:"pointer",name:"pointer_down",point:{x:d,y:h,z:f},shiftKey:l.shiftKey,altKey:l.altKey,ctrlKey:l.metaKey||l.ctrlKey,pointerId:0,button:0,isPen:t.instanceState.isPenMode,target:"canvas"};t.dispatch(p);return}break}case"Escape":{t.inputs.keys.has("Escape")||(t.inputs.keys.add("Escape"),t.cancel(),e.focus());return}default:if(zl()||t.isMenuOpen)return}const u={type:"keyboard",name:t.inputs.keys.has(l.code)?"key_repeat":"key_down",key:l.key,code:l.code,shiftKey:l.shiftKey,altKey:l.altKey,ctrlKey:l.metaKey||l.ctrlKey};t.dispatch(u)},s=l=>{var d;if(l.isKilled||(l.isKilled=!0,zl()||t.isMenuOpen))return;if(l.key===","&&((d=document.activeElement)!=null&&d.ELEMENT_NODE&&je(l),t.inputs.keys.has(l.code))){const{x:h,y:f,z:p}=t.inputs.currentScreenPoint;t.inputs.keys.delete(l.code);const m={type:"pointer",name:"pointer_up",point:{x:h,y:f,z:p},shiftKey:l.shiftKey,altKey:l.altKey,ctrlKey:l.metaKey||l.ctrlKey,pointerId:0,button:0,isPen:t.instanceState.isPenMode,target:"canvas"};t.dispatch(m);return}const u={type:"keyboard",name:"key_up",key:l.key,code:l.code,shiftKey:l.shiftKey,altKey:l.altKey,ctrlKey:l.metaKey||l.ctrlKey};t.dispatch(u)};function o(l){var u,d;if(e.contains(l.target)){const h=l.touches[0].pageX,f=l.touches[0].radiusX||0;(h-f<10||h+f>t.viewportScreenBounds.width-10)&&(((u=l.target)==null?void 0:u.tagName)==="BUTTON"&&((d=l.target)==null||d.click()),je(l))}}const i=l=>{e.contains(l.target)&&(l.ctrlKey||l.metaKey)&&je(l)};function a(){t.complete()}function c(){t.updateViewportScreenBounds()}return e.addEventListener("touchstart",o,{passive:!1}),e.addEventListener("wheel",i,{passive:!1}),document.addEventListener("gesturestart",je),document.addEventListener("gesturechange",je),document.addEventListener("gestureend",je),e.addEventListener("keydown",r),e.addEventListener("keyup",s),window.addEventListener("blur",a),window.addEventListener("focus",c),()=>{e.removeEventListener("touchstart",o),e.removeEventListener("wheel",i),document.removeEventListener("gesturestart",je),document.removeEventListener("gesturechange",je),document.removeEventListener("gestureend",je),e.removeEventListener("keydown",r),e.removeEventListener("keyup",s),window.removeEventListener("blur",a),window.removeEventListener("focus",c)}},[t,e,n])}const IN=["input","select","button","textarea"];function zl(){const{activeElement:t}=document;return!!(t&&(t.getAttribute("contenteditable")||IN.indexOf(t.tagName.toLowerCase())>-1))}const $N={error:null};class WT extends S.Component{constructor(){super(...arguments);y(this,"state",$N)}static getDerivedStateFromError(n){return{error:n}}componentDidCatch(n){var r,s;(s=(r=this.props).onError)==null||s.call(r,n)}render(){const{error:n}=this.state;if(n!==null){const{fallback:r}=this.props;return g.jsx(r,{error:n})}return this.props.children}}function Qu({children:t,fallback:e,...n}){return e===null?g.jsx(g.Fragment,{children:t}):g.jsx(WT,{fallback:e,...n,children:t})}class TN{constructor(e){this.shape=e}equals(e){var n,r,s,o;return((n=this.shape)==null?void 0:n.props)===((r=e==null?void 0:e.shape)==null?void 0:r.props)&&((s=this.shape)==null?void 0:s.meta)===((o=e==null?void 0:e.shape)==null?void 0:o.meta)}}const AN=({shape:t,util:e})=>im("Indicator:"+t.type,()=>e.indicator(t)),MN=({editor:t,id:e})=>{const n=Y("shape",()=>new TN(t.store.get(e)),[t,e]),{ShapeIndicatorErrorFallback:r}=on();return!n.shape||n.shape.isLocked?null:g.jsx(Qu,{fallback:r,onError:s=>t.annotateError(s,{origin:"react.shapeIndicator",willCrashApp:!1}),children:g.jsx(AN,{shape:n.shape,util:t.getShapeUtil(n.shape)},n.shape.id)})},ON=({id:t,className:e,color:n,opacity:r})=>{const s=H(),o=Y("transform",()=>{const i=s.getShapePageTransform(t);return i?i.toCssString():""},[s,t]);return g.jsx("svg",{className:le("tl-overlays__item",e),children:g.jsx("g",{className:"tl-shape-indicator",transform:o,stroke:n??"var(--color-selected)",opacity:r,children:g.jsx(MN,{editor:s,id:t})})})},Dd=S.memo(ON);function DN(){return g.jsx("div",{className:"tl-background"})}function al(t,e,n,r,s,o){S.useLayoutEffect(()=>{const i=t.current;if(!i||e===void 0)return;let a=`translate(${e}px, ${n}px)`;r!==void 0&&(a+=` scale(${r})`),s!==void 0&&(a+=` rotate(${s}rad)`),o&&(a+=` translate(${o.x}px, ${o.y}px)`),i.style.transform=a})}const en={linear:t=>t,easeInQuad:t=>t*t,easeOutQuad:t=>t*(2-t),easeInOutQuad:t=>t<.5?2*t*t:-1+(4-2*t)*t,easeInCubic:t=>t*t*t,easeOutCubic:t=>--t*t*t+1,easeInOutCubic:t=>t<.5?4*t*t*t:(t-1)*(2*t-2)*(2*t-2)+1,easeInQuart:t=>t*t*t*t,easeOutQuart:t=>1- --t*t*t*t,easeInOutQuart:t=>t<.5?8*t*t*t*t:1-8*--t*t*t*t,easeInQuint:t=>t*t*t*t*t,easeOutQuint:t=>1+--t*t*t*t*t,easeInOutQuint:t=>t<.5?16*t*t*t*t*t:1+16*--t*t*t*t*t,easeInSine:t=>1-Math.cos(t*Math.PI/2),easeOutSine:t=>Math.sin(t*Math.PI/2),easeInOutSine:t=>-(Math.cos(Math.PI*t)-1)/2,easeInExpo:t=>t<=0?0:Math.pow(2,10*t-10),easeOutExpo:t=>t>=1?1:1-Math.pow(2,-10*t),easeInOutExpo:t=>t<=0?0:t>=1?1:t<.5?Math.pow(2,20*t-10)/2:(2-Math.pow(2,-20*t+10))/2};class P{constructor(e=0,n=0,r=1){this.x=e,this.y=n,this.z=r}get pressure(){return this.z}set(e=this.x,n=this.y,r=this.z){return this.x=e,this.y=n,this.z=r,this}setTo({x:e=0,y:n=0,z:r=1}){return this.x=e,this.y=n,this.z=r,this}rot(e){if(e===0)return this;const{x:n,y:r}=this,s=Math.sin(e),o=Math.cos(e);return this.x=n*o-r*s,this.y=n*s+r*o,this}rotWith(e,n){if(n===0)return this;const r=this.x-e.x,s=this.y-e.y,o=Math.sin(n),i=Math.cos(n);return this.x=e.x+(r*i-s*o),this.y=e.y+(r*o+s*i),this}clone(){const{x:e,y:n,z:r}=this;return new P(e,n,r)}sub(e){return this.x-=e.x,this.y-=e.y,this}subXY(e,n){return this.x-=e,this.y-=n,this}subScalar(e){return this.x-=e,this.y-=e,this}add(e){return this.x+=e.x,this.y+=e.y,this}addXY(e,n){return this.x+=e,this.y+=n,this}addScalar(e){return this.x+=e,this.y+=e,this}clamp(e,n){return this.x=Math.max(this.x,e),this.y=Math.max(this.y,e),n!==void 0&&(this.x=Math.min(this.x,n),this.y=Math.min(this.y,n)),this}div(e){return this.x/=e,this.y/=e,this}divV(e){return this.x/=e.x,this.y/=e.y,this}mul(e){return this.x*=e,this.y*=e,this}mulV(e){return this.x*=e.x,this.y*=e.y,this}abs(){return this.x=Math.abs(this.x),this.y=Math.abs(this.y),this}nudge(e,n){const r=P.Tan(e,this);return this.add(r.mul(n))}neg(){return this.x*=-1,this.y*=-1,this}cross(e){return this.x=this.y*e.z-this.z*e.y,this.y=this.z*e.x-this.x*e.z,this}dpr(e){return P.Dpr(this,e)}cpr(e){return P.Cpr(this,e)}len2(){return P.Len2(this)}len(){return P.Len(this)}pry(e){return P.Pry(this,e)}per(){const{x:e,y:n}=this;return this.x=n,this.y=-e,this}uni(){return P.Uni(this)}tan(e){return P.Tan(this,e)}dist(e){return P.Dist(this,e)}distanceToLineSegment(e,n){return P.DistanceToLineSegment(e,n,this)}slope(e){return P.Slope(this,e)}snapToGrid(e){return this.x=Math.round(this.x/e)*e,this.y=Math.round(this.y/e)*e,this}angle(e){return P.Angle(this,e)}toAngle(){return P.ToAngle(this)}lrp(e,n){return this.x=this.x+(e.x-this.x)*n,this.y=this.y+(e.y-this.y)*n,this}equals(e){return P.Equals(this,e)}equalsXY(e,n){return P.EqualsXY(this,e,n)}norm(){const e=this.len();return this.x=e===0?0:this.x/e,this.y=e===0?0:this.y/e,this}toFixed(){return P.ToFixed(this)}toString(){return P.ToString(P.ToFixed(this))}toJson(){return P.ToJson(this)}toArray(){return P.ToArray(this)}static Add(e,n){return new P(e.x+n.x,e.y+n.y)}static AddXY(e,n,r){return new P(e.x+n,e.y+r)}static Sub(e,n){return new P(e.x-n.x,e.y-n.y)}static SubXY(e,n,r){return new P(e.x-n,e.y-r)}static AddScalar(e,n){return new P(e.x+n,e.y+n)}static SubScalar(e,n){return new P(e.x-n,e.y-n)}static Div(e,n){return new P(e.x/n,e.y/n)}static Mul(e,n){return new P(e.x*n,e.y*n)}static DivV(e,n){return new P(e.x/n.x,e.y/n.y)}static MulV(e,n){return new P(e.x*n.x,e.y*n.y)}static Neg(e){return new P(-e.x,-e.y)}static Per(e){return new P(e.y,-e.x)}static Dist2(e,n){return P.Sub(e,n).len2()}static Abs(e){return new P(Math.abs(e.x),Math.abs(e.y))}static Dist(e,n){return Math.hypot(e.y-n.y,e.x-n.x)}static Dpr(e,n){return e.x*n.x+e.y*n.y}static Cross(e,n){return new P(e.y*n.z-e.z*n.y,e.z*n.x-e.x*n.z)}static Cpr(e,n){return e.x*n.y-n.x*e.y}static Len2(e){return e.x*e.x+e.y*e.y}static Len(e){return Math.sqrt(P.Len2(e))}static Pry(e,n){return P.Dpr(e,n)/P.Len(n)}static Uni(e){return P.Div(e,P.Len(e))}static Tan(e,n){return P.Uni(P.Sub(e,n))}static Min(e,n){return new P(Math.min(e.x,n.x),Math.min(e.y,n.y))}static Max(e,n){return new P(Math.max(e.x,n.x),Math.max(e.y,n.y))}static From({x:e,y:n,z:r=1}){return new P(e,n,r)}static FromArray(e){return new P(e[0],e[1])}static Rot(e,n=0){const r=Math.sin(n),s=Math.cos(n);return new P(e.x*s-e.y*r,e.x*r+e.y*s)}static RotWith(e,n,r){const s=e.x-n.x,o=e.y-n.y,i=Math.sin(r),a=Math.cos(r);return new P(n.x+(s*a-o*i),n.y+(s*i+o*a))}static NearestPointOnLineThroughPoint(e,n,r){return P.Mul(n,P.Sub(r,e).pry(n)).add(e)}static NearestPointOnLineSegment(e,n,r,s=!0){const o=P.Tan(n,e),i=P.Add(e,P.Mul(o,P.Sub(r,e).pry(o)));if(s){if(i.x<Math.min(e.x,n.x))return P.Cast(e.x<n.x?e:n);if(i.x>Math.max(e.x,n.x))return P.Cast(e.x>n.x?e:n);if(i.y<Math.min(e.y,n.y))return P.Cast(e.y<n.y?e:n);if(i.y>Math.max(e.y,n.y))return P.Cast(e.y>n.y?e:n)}return i}static DistanceToLineThroughPoint(e,n,r){return P.Dist(r,P.NearestPointOnLineThroughPoint(e,n,r))}static DistanceToLineSegment(e,n,r,s=!0){return P.Dist(r,P.NearestPointOnLineSegment(e,n,r,s))}static Snap(e,n=1){return new P(Math.round(e.x/n)*n,Math.round(e.y/n)*n)}static Cast(e){return e instanceof P?e:P.From(e)}static Slope(e,n){return e.x===n.y?NaN:(e.y-n.y)/(e.x-n.x)}static Angle(e,n){return Math.atan2(n.y-e.y,n.x-e.x)}static Lrp(e,n,r){return P.Sub(n,e).mul(r).add(e)}static Med(e,n){return new P((e.x+n.x)/2,(e.y+n.y)/2)}static Equals(e,n){return Math.abs(e.x-n.x)<1e-4&&Math.abs(e.y-n.y)<1e-4}static EqualsXY(e,n,r){return e.x===n&&e.y===r}static Clockwise(e,n,r){return(r.x-e.x)*(n.y-e.y)-(n.x-e.x)*(r.y-e.y)<0}static Rescale(e,n){const r=P.Len(e);return new P(n*e.x/r,n*e.y/r)}static ScaleWithOrigin(e,n,r){return P.Sub(e,r).mul(n).add(r)}static ToFixed(e,n=2){return new P(+e.x.toFixed(n),+e.y.toFixed(n),+e.z.toFixed(n))}static Nudge(e,n,r){return P.Add(e,P.Tan(n,e).mul(r))}static ToString(e){return`${e.x}, ${e.y}`}static ToAngle(e){let n=Math.atan2(e.y,e.x);return n<0&&(n+=Math.PI*2),n}static FromAngle(e,n=1){return new P(Math.cos(e)*n,Math.sin(e)*n)}static ToArray(e){return[e.x,e.y,e.z]}static ToJson(e){const{x:n,y:r,z:s}=e;return{x:n,y:r,z:s}}static Average(e){const n=e.length,r=new P(0,0);for(let s=0;s<n;s++)r.add(e[s]);return r.div(n)}static Clamp(e,n,r){return r===void 0?new P(Math.min(Math.max(e.x,n)),Math.min(Math.max(e.y,n))):new P(Math.min(Math.max(e.x,n),r),Math.min(Math.max(e.y,n),r))}static PointsBetween(e,n,r=6){const s=[];for(let o=0;o<r;o++){const i=en.easeInQuad(o/(r-1)),a=P.Lrp(e,n,i);a.z=Math.min(1,.5+Math.abs(.5-RN(i))*.65),s.push(a)}return s}static SnapToGrid(e,n=8){return new P(Math.round(e.x/n)*n,Math.round(e.y/n)*n)}}const RN=t=>t<.5?2*t*t:-1+(4-2*t)*t,nt=class nt{constructor(e=0,n=0,r=0,s=0){y(this,"x",0);y(this,"y",0);y(this,"w",0);y(this,"h",0);this.x=e,this.y=n,this.w=r,this.h=s}get point(){return new P(this.x,this.y)}set point(e){this.x=e.x,this.y=e.y}get minX(){return this.x}set minX(e){this.x=e}get midX(){return this.x+this.w/2}get maxX(){return this.x+this.w}get minY(){return this.y}set minY(e){this.y=e}get midY(){return this.y+this.h/2}get maxY(){return this.y+this.h}get width(){return this.w}set width(e){this.w=e}get height(){return this.h}set height(e){this.h=e}get aspectRatio(){return this.width/this.height}get center(){return new P(this.midX,this.midY)}set center(e){this.minX=e.x-this.width/2,this.minY=e.y-this.height/2}get corners(){return[new P(this.minX,this.minY),new P(this.maxX,this.minY),new P(this.maxX,this.maxY),new P(this.minX,this.maxY)]}get snapPoints(){return[new P(this.minX,this.minY),new P(this.maxX,this.minY),new P(this.maxX,this.maxY),new P(this.minX,this.maxY),this.center]}get sides(){const{corners:e}=this;return[[e[0],e[1]],[e[1],e[2]],[e[2],e[3]],[e[3],e[0]]]}get size(){return new P(this.w,this.h)}toFixed(){return this.x=zh(this.x),this.y=zh(this.y),this.w=zh(this.w),this.h=zh(this.h),this}setTo(e){return this.x=e.x,this.y=e.y,this.w=e.w,this.h=e.h,this}set(e=0,n=0,r=0,s=0){return this.x=e,this.y=n,this.w=r,this.h=s,this}expand(e){const n=Math.min(this.minX,e.minX),r=Math.min(this.minY,e.minY),s=Math.max(this.maxX,e.maxX),o=Math.max(this.maxY,e.maxY);return this.x=n,this.y=r,this.w=s-n,this.h=o-r,this}expandBy(e){return this.x-=e,this.y-=e,this.w+=e*2,this.h+=e*2,this}scale(e){return this.x/=e,this.y/=e,this.w/=e,this.h/=e,this}clone(){const{x:e,y:n,w:r,h:s}=this;return new nt(e,n,r,s)}translate(e){return this.x+=e.x,this.y+=e.y,this}snapToGrid(e){const n=Math.round(this.minX/e)*e,r=Math.round(this.minY/e)*e,s=Math.round(this.maxX/e)*e,o=Math.round(this.maxY/e)*e;this.minX=n,this.minY=r,this.width=Math.max(1,s-n),this.height=Math.max(1,o-r)}collides(e){return nt.Collides(this,e)}contains(e){return nt.Contains(this,e)}includes(e){return nt.Includes(this,e)}containsPoint(e,n=0){return nt.ContainsPoint(this,e,n)}getHandlePoint(e){switch(e){case"top_left":return new P(this.minX,this.minY);case"top_right":return new P(this.maxX,this.minY);case"bottom_left":return new P(this.minX,this.maxY);case"bottom_right":return new P(this.maxX,this.maxY);case"top":return new P(this.midX,this.minY);case"right":return new P(this.maxX,this.midY);case"bottom":return new P(this.midX,this.maxY);case"left":return new P(this.minX,this.midY)}}toJson(){return{x:this.minX,y:this.minY,w:this.w,h:this.h}}resize(e,n,r){const{minX:s,minY:o,maxX:i,maxY:a}=this;let{minX:c,minY:l,maxX:u,maxY:d}=this;switch(e){case"left":case"top_left":case"bottom_left":{c+=n;break}case"right":case"top_right":case"bottom_right":{u+=n;break}}switch(e){case"top":case"top_left":case"top_right":{l+=r;break}case"bottom":case"bottom_left":case"bottom_right":{d+=r;break}}const h=(u-c)/(i-s),f=(d-l)/(a-o),p=h<0,m=f<0;if(p){const v=u;u=c,c=v}if(m){const v=d;d=l,l=v}this.minX=c,this.minY=l,this.width=Math.abs(u-c),this.height=Math.abs(d-l)}union(e){const n=Math.min(this.minX,e.x),r=Math.min(this.minY,e.y),s=Math.max(this.maxX,e.w+e.x),o=Math.max(this.maxY,e.h+e.y);return this.x=n,this.y=r,this.width=s-n,this.height=o-r,this}static From(e){return new nt(e.x,e.y,e.w,e.h)}static FromPoints(e){if(e.length===0)return new nt;let n=1/0,r=1/0,s=-1/0,o=-1/0,i;for(let a=0,c=e.length;a<c;a++)i=e[a],n=Math.min(i.x,n),r=Math.min(i.y,r),s=Math.max(i.x,s),o=Math.max(i.y,o);return new nt(n,r,s-n,o-r)}static Expand(e,n){const r=Math.min(n.minX,e.minX),s=Math.min(n.minY,e.minY),o=Math.max(n.maxX,e.maxX),i=Math.max(n.maxY,e.maxY);return new nt(r,s,o-r,i-s)}static ExpandBy(e,n){return new nt(e.minX-n,e.minY-n,e.width+n*2,e.height+n*2)}static Resize(e,n,r,s,o=!1){const{minX:i,minY:a,maxX:c,maxY:l}=e;let{minX:u,minY:d,maxX:h,maxY:f}=e;switch(n){case"left":case"top_left":case"bottom_left":{u+=r;break}case"right":case"top_right":case"bottom_right":{h+=r;break}}switch(n){case"top":case"top_left":case"top_right":{d+=s;break}case"bottom":case"bottom_left":case"bottom_right":{f+=s;break}}const p=(h-u)/(c-i),m=(f-d)/(l-a),v=p<0,w=m<0;if(o){const b=(c-i)/(l-a),C=Math.abs(h-u),E=Math.abs(f-d),_=C*(m<0?1:-1)*(1/b),k=E*(p<0?1:-1)*b,I=b<C/E;switch(n){case"top_left":{I?d=f+_:u=h+k;break}case"top_right":{I?d=f+_:h=u-k;break}case"bottom_right":{I?f=d-_:h=u-k;break}case"bottom_left":{I?f=d-_:u=h+k;break}case"bottom":case"top":{const $=(u+h)/2,A=E*b;u=$-A/2,h=$+A/2;break}case"left":case"right":{const $=(d+f)/2,A=C/b;d=$-A/2,f=$+A/2;break}}}if(v){const b=h;h=u,u=b}if(w){const b=f;f=d,d=b}const x=new nt(u,d,Math.abs(h-u),Math.abs(f-d));return{box:x,scaleX:+(x.width/e.width*(p>0?1:-1)).toFixed(5),scaleY:+(x.height/e.height*(m>0?1:-1)).toFixed(5)}}equals(e){return nt.Equals(this,e)}static Equals(e,n){return n.x===e.x&&n.y===e.y&&n.w===e.w&&n.h===e.h}};y(nt,"Collides",(e,n)=>!(e.maxX<n.minX||e.minX>n.maxX||e.maxY<n.minY||e.minY>n.maxY)),y(nt,"Contains",(e,n)=>e.minX<n.minX&&e.minY<n.minY&&e.maxY>n.maxY&&e.maxX>n.maxX),y(nt,"Includes",(e,n)=>nt.Collides(e,n)||nt.Contains(e,n)),y(nt,"ContainsPoint",(e,n,r=0)=>!(n.x<e.minX-r||n.y<e.minY-r||n.x>e.maxX+r||n.y>e.maxY+r)),y(nt,"Common",e=>{let n=1/0,r=1/0,s=-1/0,o=-1/0;for(let i=0;i<e.length;i++){const a=e[i];n=Math.min(n,a.minX),r=Math.min(r,a.minY),s=Math.max(s,a.maxX),o=Math.max(o,a.maxY)}return new nt(n,r,s-n,o-r)}),y(nt,"Sides",(e,n=0)=>{const{corners:r}=e;return[[r[0],r[1]],[r[1],r[2]],[r[2],r[3]],[r[3],r[0]]]});let ae=nt;function LN(t){switch(t){case"top":return"bottom";case"bottom":return"top";case"top_left":return"bottom_left";case"top_right":return"bottom_right";case"bottom_left":return"top_left";case"bottom_right":return"top_right";default:return t}}function jN(t){switch(t){case"left":return"right";case"right":return"left";case"top_left":return"top_right";case"top_right":return"top_left";case"bottom_left":return"bottom_right";case"bottom_right":return"bottom_left";default:return t}}function NN(t){return t==="top_left"||t==="top_right"||t==="bottom_right"||t==="bottom_left"}function dr(t){return`${R(t.x)},${R(t.y)} `}function hr(t,e){return`${R((t.x+e.x)/2)},${R((t.y+e.y)/2)} `}const $e=Math.PI,Te=$e/2,Oe=$e*2,d_=Math.PI/180,zN=Math.sin;function Rr(t,e,n){return Math.max(e,typeof n<"u"?Math.min(t,n):t)}function zh(t,e=1e10){return t?Math.round(t*e)/e:0}function yu(t,e,n=1e-6){return Math.abs(t-e)<=n}function Zu(t,e){const n=Math.pow(t-e,2)/Math.pow(t+e,2);return $e*(t+e)*(1+3*n/(10+Math.sqrt(4-3*n)))}function Us(t){return t=t%Oe,t<0?t=t+Oe:t===0&&(t=0),t}function os(t,e){const n=(e-t)%Oe;return 2*n%Oe-n}function Oi(t,e,n){return t+os(t,e)*n}function GT(t,e){return os(t,e)}function FN(t,e,n){return GT(P.Angle(t,e),P.Angle(t,n))}function jw(t){return(Oe+t)%Oe}function eg(t,e){const n=Oe/e;let r=Math.floor((jw(t)+n/2)/n)*n%Oe;return r<$e&&(r+=Oe),r>$e&&(r-=Oe),r}function YT(t,e){return t===e||yu(t%(Math.PI/2)-e%(Math.PI/2),0)}function BN(t){return t*$e/180}function UN(t){return t*180/$e}function Fh(t,e,n,r){const s=FN(t,n,r);return e*Oe*(s/Oe)}function Ao(t,e,n,r){return new P(t+n*Math.cos(r),e+n*Math.sin(r))}function Wy(t,e,n){const r=t/2,s=e/2,o=[];for(let i=0;i<n;i++){const a=Oe/n,c=-Te+i*a;o.push(new P(r+r*Math.cos(c),s+s*Math.sin(c)))}return o}function Fl(t,e,n,r){return t<r&&n<e}function Or(t,e,n,r){const s=Math.max(t,n),o=Math.min(e,r);return s<=o?[s,o]:null}const HN=(t,e,n)=>{const r=Oe/t/2,s=Math.floor(t/4)*2,o=t*2-s,i=0,a=Math.floor(t/2)*2,c=Math.cos(-Te+s*r)*e/2,l=Math.cos(-Te+o*r)*e/2,u=Math.sin(-Te+i*r)*n/2,d=Math.sin(-Te+a*r)*n/2;return new ae(0,0,c-l,d-u)};function h_(t,e,n){return(e.x-t.x)*(n.y-t.y)-(n.x-t.x)*(e.y-t.y)}function fs(t,e){let n=0,r,s;for(let o=0;o<e.length;o++)r=e[o],s=e[(o+1)%e.length],r.y<=t.y?s.y>t.y&&h_(r,s,t)>0&&(n+=1):s.y<=t.y&&h_(r,s,t)<0&&(n-=1);return n!==0}function R(t){return+t.toFixed(4)}function tg(t){return+t.toFixed(2)}const f_=t=>Math.abs(t)<Number.MAX_SAFE_INTEGER,Gy=({brush:t,color:e,opacity:n})=>{const r=S.useRef(null);return al(r,t.x,t.y),g.jsx("svg",{className:"tl-overlays__item",ref:r,children:e?g.jsxs("g",{className:"tl-brush",opacity:n,children:[g.jsx("rect",{width:R(Math.max(1,t.w)),height:R(Math.max(1,t.h)),fill:e,opacity:.75}),g.jsx("rect",{width:R(Math.max(1,t.w)),height:R(Math.max(1,t.h)),fill:"none",stroke:e,opacity:.1})]}):g.jsx("rect",{className:"tl-brush tl-brush__default",width:R(Math.max(1,t.w)),height:R(Math.max(1,t.h))})})},KN=({className:t,zoom:e,point:n,color:r,viewport:s,opacity:o=1})=>{const i=S.useRef(null);return al(i,Rr(n.x,s.minX+5/e,s.maxX-5/e),Rr(n.y,s.minY+5/e,s.maxY-5/e),1/e,P.Angle(s.center,n)),g.jsxs("svg",{ref:i,className:le("tl-overlays__item",t),children:[g.jsx("use",{href:"#cursor_hint",color:r,strokeWidth:3,stroke:"var(--color-background)"}),g.jsx("use",{href:"#cursor_hint",color:r,opacity:o})]})},VN=({className:t,zoom:e,point:n,color:r,name:s,chatMessage:o})=>{const i=S.useRef(null);return al(i,n==null?void 0:n.x,n==null?void 0:n.y,1/e),n?g.jsxs("div",{ref:i,className:le("tl-overlays__item",t),children:[g.jsx("svg",{className:"tl-cursor",children:g.jsx("use",{href:"#cursor",color:r})}),o?g.jsxs(g.Fragment,{children:[s&&g.jsx("div",{className:"tl-nametag-title",style:{color:r},children:s}),g.jsx("div",{className:"tl-nametag-chat",style:{backgroundColor:r},children:o})]}):s&&g.jsx("div",{className:"tl-nametag",style:{backgroundColor:r},children:s})]}):null},p_=S.memo(VN),rx={openWindow:(t,e)=>window.open(t,e,"noopener noreferrer"),refreshPage:()=>window.location.reload(),hardReset:async()=>{var t;return await((t=window.__tldraw__hardReset)==null?void 0:t.call(window))}};function XT(){rx.hardReset()}function WN(){rx.refreshPage()}const GN="https://github.com/tldraw/tldraw/issues/new";function YN(){}const qT=({error:t,editor:e})=>{const n=S.useRef(null),[r,s]=S.useState(!1),[o,i]=S.useState(!1),[a,c]=S.useState(!1),l=t instanceof Error?t.message:String(t),u=t instanceof Error?t.stack:null,d=Y("isDarkMode",()=>{try{if(e)return e.user.isDarkMode}catch{}return null},[e]),[h,f]=S.useState(null);S.useLayoutEffect(()=>{var C;d!==null&&f(d);let x=(C=n.current)==null?void 0:C.parentElement,b=!1;for(;x;){if(x.classList.contains("tl-theme__dark")||x.classList.contains("tl-theme__light")){b=!0;break}x=x.parentElement}if(b){f(null);return}f(window.matchMedia("(prefers-color-scheme: dark)").matches)},[d]),S.useEffect(()=>{if(o){const x=setTimeout(()=>{i(!1)},2e3);return()=>clearTimeout(x)}},[o]);const p=()=>{const x=document.createElement("textarea");x.value=u??l,document.body.appendChild(x),x.select(),document.execCommand("copy"),x.remove(),i(!0)},m=()=>{WN()},v=async()=>{XT()},w=new URL(GN);return w.searchParams.set("title",l),w.searchParams.set("labels","bug"),w.searchParams.set("body",`Hey, I ran into an error while using tldraw:

\`\`\`js
${u??l}
\`\`\`

My browser: ${navigator.userAgent}`),g.jsxs("div",{ref:n,className:le("tl-container tl-error-boundary",h===null?"":h?"tl-theme__dark":"tl-theme__light"),children:[g.jsx("div",{className:"tl-error-boundary__overlay"}),e&&g.jsx(WT,{onError:YN,fallback:()=>null,children:g.jsx(nx.Provider,{value:e,children:g.jsx("div",{className:"tl-overlay tl-error-boundary__canvas",children:g.jsx(lx,{})})})}),g.jsx("div",{className:le("tl-modal","tl-error-boundary__content",{"tl-error-boundary__content__expanded":r&&!a}),children:a?g.jsxs(g.Fragment,{children:[g.jsx("h2",{children:"Are you sure?"}),g.jsx("p",{children:"Resetting your data will delete your drawing and cannot be undone."}),g.jsxs("div",{className:"tl-error-boundary__content__actions",children:[g.jsx("button",{onClick:()=>c(!1),children:"Cancel"}),g.jsx("button",{className:"tl-error-boundary__reset",onClick:v,children:"Reset data"})]})]}):g.jsxs(g.Fragment,{children:[g.jsx("h2",{children:"Something's gone wrong."}),g.jsxs("p",{children:["Sorry, we encountered an error. Please refresh the page to continue. If you keep seeing this error, you can ",g.jsx("a",{href:w.toString(),children:"create a GitHub issue"})," or"," ",g.jsx("a",{href:"https://discord.gg/Cq6cPsTfNy",children:"ask for help on Discord"}),"."]}),r&&g.jsxs("div",{className:"tl-error-boundary__content__error",children:[g.jsx("pre",{children:g.jsx("code",{children:u??l})}),g.jsx("button",{onClick:p,children:o?"Copied!":"Copy"})]}),g.jsxs("div",{className:"tl-error-boundary__content__actions",children:[g.jsx("button",{onClick:()=>s(!r),children:r?"Hide details":"Show details"}),g.jsxs("div",{className:"tl-error-boundary__content__actions__group",children:[g.jsx("button",{className:"tl-error-boundary__reset",onClick:()=>c(!0),children:"Reset data"}),g.jsx("button",{className:"tl-error-boundary__refresh",onClick:m,children:"Refresh Page"})]})]})]})})]})},Io=2e3,ng=40,Ds=320,Ka=[.1,.25,.5,1,2,4,8],Bl=.1,Ro=8,XN=.5,qN=.1,QN=.2,ZN=.005,JN=.05,e9=450,t9=200,Nw=6,Ju=4,n9=32,rg={};for(let t=1;t<=Math.ceil(Ro);t++)rg[t+"_dark"]=`hash_pattern_zoom_${t}_dark`,rg[t+"_light"]=`hash_pattern_zoom_${t}_light`;const r9={duration:0,easing:en.easeInOutCubic},Of=.09,g_=[{min:-1,mid:.15,step:64},{min:.05,mid:.375,step:16},{min:.15,mid:1,step:4},{min:.7,mid:2.5,step:1}],s9=6e4,QT=3e3,o9=1200,m_={CAMERA_MOVE:-10},i9=64,a9=620,xs=8,c9=({x:t,y:e,z:n,size:r})=>g.jsxs("svg",{className:"tl-grid",version:"1.1",xmlns:"http://www.w3.org/2000/svg",children:[g.jsx("defs",{children:g_.map(({min:s,mid:o,step:i},a)=>{const c=i*r*n,l=.5+t*n,u=.5+e*n,d=l>0?l%c:c+l%c,h=u>0?u%c:c+u%c,f=n<o?Mw(n,[s,o],[0,1]):1;return g.jsx("pattern",{id:`grid-${i}`,width:c,height:c,patternUnits:"userSpaceOnUse",children:g.jsx("circle",{className:"tl-grid-dot",cx:d,cy:h,r:1,opacity:f})},`grid-pattern-${a}`)})}),g_.map(({step:s},o)=>g.jsx("rect",{width:"100%",height:"100%",fill:`url(#grid-${s})`},`grid-rect-${o}`))]}),l9=({handle:t,className:e})=>g.jsxs("g",{className:le("tl-handle",{"tl-handle__virtual":t.type==="virtual","tl-handle__create":t.type==="create"},e),children:[g.jsx("circle",{className:"tl-handle__bg"}),g.jsx("circle",{className:"tl-handle__fg"})]}),u9=({children:t})=>g.jsx("svg",{className:"tl-user-handles tl-overlays__item",children:t}),d9=({shapeId:t})=>g.jsx(Dd,{className:"tl-user-indicator__hovered",id:t});function Gc(t,e=!0){const n=t.length;if(n<2)return"";let r=t[0],s=t[1];if(n===2)return`M${dr(r)}L${dr(s)}`;let o="";for(let i=2,a=n-1;i<a;i++)r=t[i],s=t[i+1],o+=hr(r,s);return e?`M${hr(t[0],t[1])}Q${dr(t[1])}${hr(t[1],t[2])}T${o}${hr(t[n-1],t[0])}${hr(t[0],t[1])}Z`:`M${dr(t[0])}Q${dr(t[1])}${hr(t[1],t[2])}${t.length>3?"T":""}${o}L${dr(t[n-1])}`}const y_=({scribble:t,zoom:e,color:n,opacity:r,className:s})=>t.points.length?g.jsx("svg",{className:s&&le("tl-overlays__item",s),children:g.jsx("path",{className:"tl-scribble",d:Gc(t.points,!1),stroke:n??`var(--color-${t.color})`,fill:"none",strokeWidth:8/e,opacity:r??t.opacity})}):null,ZT=({bounds:t,rotation:e})=>{const n=S.useRef(null);return al(n,t.x,t.y,1,e),S.useLayoutEffect(()=>{const r=n.current;r&&(r.style.width=R(Math.max(1,t.width))+"px",r.style.height=R(Math.max(1,t.height))+"px")},[t.width,t.height]),g.jsx("div",{ref:n,className:"tl-selection__bg",draggable:!1})},h9=({bounds:t,rotation:e})=>{const n=H(),r=S.useRef(null),s=Y("only selected shape",()=>n.onlySelectedShape,[n]),o=s?n.getShapeUtil(s).expandSelectionOutlinePx(s):0;al(r,t==null?void 0:t.x,t==null?void 0:t.y,1,e,{x:-o,y:-o}),t=t.clone().expandBy(o);const i=Math.max(1,t.width),a=Math.max(1,t.height);return g.jsx("svg",{ref:r,className:"tl-overlays__item tl-selection__fg","data-testid":"selection-foreground",children:g.jsx("rect",{className:le("tl-selection__fg__outline"),width:R(i),height:R(a)})})},f9=()=>g.jsx("div",{className:"tl-shape-error-boundary"}),p9=()=>g.jsx("circle",{cx:4,cy:4,r:8,strokeWidth:"1",stroke:"red"});function g9({points:t,zoom:e}){const n=2.5/e,r=t.reduce((h,f)=>Math.min(h,f.x),1/0),s=t.reduce((h,f)=>Math.max(h,f.x),-1/0),o=t.reduce((h,f)=>Math.min(h,f.y),1/0),i=t.reduce((h,f)=>Math.max(h,f.y),-1/0),a=t.some(h=>h.x===r&&h.y===o);let c,l,u,d;return a?(c=r,l=o,u=s,d=i):(c=r,l=i,u=s,d=o),g.jsxs("g",{className:"tl-snap-line",children:[g.jsx("line",{x1:c,y1:l,x2:u,y2:d}),t.map((h,f)=>g.jsx("g",{transform:`translate(${h.x},${h.y})`,children:g.jsx("path",{className:"tl-snap-point",d:`M ${-n},${-n} L ${n},${n} M ${-n},${n} L ${n},${-n}`})},f))]})}function m9({gaps:t,direction:e,zoom:n}){const r=3.5/n;let s=[-1/0,1/0],o=null;const i=e==="horizontal";for(const c of t){if(o=Or(s[0],s[1],i?c.startEdge[0].y:c.startEdge[0].x,i?c.startEdge[1].y:c.startEdge[1].x),o)s=o;else continue;if(o=Or(s[0],s[1],i?c.endEdge[0].y:c.endEdge[0].x,i?c.endEdge[1].y:c.endEdge[1].x),o)s=o;else continue}if(s===null)return null;const a=(s[0]+s[1])/2;return g.jsx("g",{className:"tl-snap-line",children:t.map(({startEdge:c,endEdge:l},u)=>g.jsx(S.Fragment,{children:i?g.jsxs(g.Fragment,{children:[g.jsx("line",{x1:c[0].x,y1:a-2*r,x2:c[1].x,y2:a+2*r}),g.jsx("line",{x1:l[0].x,y1:a-2*r,x2:l[1].x,y2:a+2*r}),g.jsx("line",{x1:c[0].x,y1:a,x2:l[0].x,y2:a}),g.jsx("line",{x1:(c[0].x+l[0].x)/2,y1:a-r,x2:(c[0].x+l[0].x)/2,y2:a+r})]}):g.jsxs(g.Fragment,{children:[g.jsx("line",{x1:a-2*r,y1:c[0].y,x2:a+2*r,y2:c[1].y}),g.jsx("line",{x1:a-2*r,y1:l[0].y,x2:a+2*r,y2:l[1].y}),g.jsx("line",{x1:a,y1:c[0].y,x2:a,y2:l[0].y}),g.jsx("line",{x1:a-r,y1:(c[0].y+l[0].y)/2,x2:a+r,y2:(c[0].y+l[0].y)/2})]})},u))})}const y9=({className:t,line:e,zoom:n})=>g.jsx("svg",{className:le("tl-overlays__item",t),children:e.type==="points"?g.jsx(g9,{...e,zoom:n}):e.type==="gaps"?g.jsx(m9,{...e,zoom:n}):null}),v9=()=>g.jsx("svg",{width:16,height:16,viewBox:"0 0 16 16",children:g.jsxs("g",{strokeWidth:2,fill:"none",fillRule:"evenodd",children:[g.jsx("circle",{strokeOpacity:.25,cx:8,cy:8,r:7,stroke:"var(--color-text-1)"}),g.jsx("path",{strokeLinecap:"round",d:"M15 8c0-4.5-4.5-7-7-7",stroke:"var(--color-text-1)",children:g.jsx("animateTransform",{attributeName:"transform",type:"rotate",from:"0 8 8",to:"360 8 8",dur:"1s",repeatCount:"indefinite"})})]})}),w9=()=>null,JT=S.createContext({});function S9({overrides:t,children:e}){return g.jsx(JT.Provider,{value:S.useMemo(()=>({Background:DN,SvgDefs:w9,Brush:Gy,ZoomBrush:Gy,CollaboratorBrush:Gy,Cursor:p_,CollaboratorCursor:p_,CollaboratorHint:KN,CollaboratorShapeIndicator:Dd,Grid:c9,Scribble:y_,SnapLine:y9,Handles:u9,Handle:l9,CollaboratorScribble:y_,ErrorFallback:qT,ShapeErrorFallback:f9,ShapeIndicatorErrorFallback:p9,Spinner:v9,SelectionBackground:ZT,SelectionForeground:h9,HoveredShapeIndicator:d9,...t}),[t]),children:e})}function on(){return S.useContext(JT)}const x9=["textarea","input"];function b9(t){const e=H();S.useEffect(()=>{const n=t.current;if(!n)return;const r=s=>{var o;if(s instanceof PointerEvent&&s.pointerType==="pen"){s.isKilled=!0;const{target:i}=s;if(x9.includes((o=i.tagName)==null?void 0:o.toLocaleLowerCase())||e.isIn("select.editing_shape"))return;je(s)}};return n.addEventListener("touchstart",r),n.addEventListener("touchend",r),()=>{n.removeEventListener("touchstart",r),n.addEventListener("touchend",r)}},[e,t])}function C9(t,e,n){return Math.max(e,Math.min(t,n))}const zt={toVector(t,e){return t===void 0&&(t=e),Array.isArray(t)?t:[t,t]},add(t,e){return[t[0]+e[0],t[1]+e[1]]},sub(t,e){return[t[0]-e[0],t[1]-e[1]]},addTo(t,e){t[0]+=e[0],t[1]+=e[1]},subTo(t,e){t[0]-=e[0],t[1]-=e[1]}};function v_(t,e,n){return e===0||Math.abs(e)===1/0?Math.pow(t,n*5):t*e*n/(e+n*t)}function w_(t,e,n,r=.15){return r===0?C9(t,e,n):t<e?-v_(e-t,n-e,r)+e:t>n?+v_(t-n,n-e,r)+n:t}function _9(t,[e,n],[r,s]){const[[o,i],[a,c]]=t;return[w_(e,o,i,r),w_(n,a,c,s)]}function E9(t,e){if(typeof t!="object"||t===null)return t;var n=t[Symbol.toPrimitive];if(n!==void 0){var r=n.call(t,e||"default");if(typeof r!="object")return r;throw new TypeError("@@toPrimitive must return a primitive value.")}return(e==="string"?String:Number)(t)}function P9(t){var e=E9(t,"string");return typeof e=="symbol"?e:String(e)}function Yt(t,e,n){return e=P9(e),e in t?Object.defineProperty(t,e,{value:n,enumerable:!0,configurable:!0,writable:!0}):t[e]=n,t}function S_(t,e){var n=Object.keys(t);if(Object.getOwnPropertySymbols){var r=Object.getOwnPropertySymbols(t);e&&(r=r.filter(function(s){return Object.getOwnPropertyDescriptor(t,s).enumerable})),n.push.apply(n,r)}return n}function ot(t){for(var e=1;e<arguments.length;e++){var n=arguments[e]!=null?arguments[e]:{};e%2?S_(Object(n),!0).forEach(function(r){Yt(t,r,n[r])}):Object.getOwnPropertyDescriptors?Object.defineProperties(t,Object.getOwnPropertyDescriptors(n)):S_(Object(n)).forEach(function(r){Object.defineProperty(t,r,Object.getOwnPropertyDescriptor(n,r))})}return t}const e3={pointer:{start:"down",change:"move",end:"up"},mouse:{start:"down",change:"move",end:"up"},touch:{start:"start",change:"move",end:"end"},gesture:{start:"start",change:"change",end:"end"}};function x_(t){return t?t[0].toUpperCase()+t.slice(1):""}const k9=["enter","leave"];function I9(t=!1,e){return t&&!k9.includes(e)}function $9(t,e="",n=!1){const r=e3[t],s=r&&r[e]||e;return"on"+x_(t)+x_(s)+(I9(n,s)?"Capture":"")}const T9=["gotpointercapture","lostpointercapture"];function A9(t){let e=t.substring(2).toLowerCase();const n=!!~e.indexOf("passive");n&&(e=e.replace("passive",""));const r=T9.includes(e)?"capturecapture":"capture",s=!!~e.indexOf(r);return s&&(e=e.replace("capture","")),{device:e,capture:s,passive:n}}function M9(t,e=""){const n=e3[t],r=n&&n[e]||e;return t+r}function t3(t){return"touches"in t}function O9(t){return t3(t)?"touch":"pointerType"in t?t.pointerType:"mouse"}function D9(t){return Array.from(t.touches).filter(e=>{var n,r;return e.target===t.currentTarget||((n=t.currentTarget)===null||n===void 0||(r=n.contains)===null||r===void 0?void 0:r.call(n,e.target))})}function zw(t,e){try{const n=e.clientX-t.clientX,r=e.clientY-t.clientY,s=(e.clientX+t.clientX)/2,o=(e.clientY+t.clientY)/2,i=Math.hypot(n,r);return{angle:-(Math.atan2(n,r)*180)/Math.PI,distance:i,origin:[s,o]}}catch{}return null}function R9(t){return D9(t).map(e=>e.identifier)}function b_(t,e){const[n,r]=Array.from(t.touches).filter(s=>e.includes(s.identifier));return zw(n,r)}const C_=40,__=800;function n3(t){let{deltaX:e,deltaY:n,deltaMode:r}=t;return r===1?(e*=C_,n*=C_):r===2&&(e*=__,n*=__),[e,n]}function L9(t){const e={};if("buttons"in t&&(e.buttons=t.buttons),"shiftKey"in t){const{shiftKey:n,altKey:r,metaKey:s,ctrlKey:o}=t;Object.assign(e,{shiftKey:n,altKey:r,metaKey:s,ctrlKey:o})}return e}function sg(t,...e){return typeof t=="function"?t(...e):t}function j9(){}function N9(...t){return t.length===0?j9:t.length===1?t[0]:function(){let e;for(const n of t)e=n.apply(this,arguments)||e;return e}}function E_(t,e){return Object.assign({},e,t||{})}const z9=32;class r3{constructor(e,n,r){this.ctrl=e,this.args=n,this.key=r,this.state||(this.state={},this.computeValues([0,0]),this.computeInitial(),this.init&&this.init(),this.reset())}get state(){return this.ctrl.state[this.key]}set state(e){this.ctrl.state[this.key]=e}get shared(){return this.ctrl.state.shared}get eventStore(){return this.ctrl.gestureEventStores[this.key]}get timeoutStore(){return this.ctrl.gestureTimeoutStores[this.key]}get config(){return this.ctrl.config[this.key]}get sharedConfig(){return this.ctrl.config.shared}get handler(){return this.ctrl.handlers[this.key]}reset(){const{state:e,shared:n,ingKey:r,args:s}=this;n[r]=e._active=e.active=e._blocked=e._force=!1,e._step=[!1,!1],e.intentional=!1,e._movement=[0,0],e._distance=[0,0],e._direction=[0,0],e._delta=[0,0],e._bounds=[[-1/0,1/0],[-1/0,1/0]],e.args=s,e.axis=void 0,e.memo=void 0,e.elapsedTime=e.timeDelta=0,e.direction=[0,0],e.distance=[0,0],e.overflow=[0,0],e._movementBound=[!1,!1],e.velocity=[0,0],e.movement=[0,0],e.delta=[0,0],e.timeStamp=0}start(e){const n=this.state,r=this.config;n._active||(this.reset(),this.computeInitial(),n._active=!0,n.target=e.target,n.currentTarget=e.currentTarget,n.lastOffset=r.from?sg(r.from,n):n.offset,n.offset=n.lastOffset,n.startTime=n.timeStamp=e.timeStamp)}computeValues(e){const n=this.state;n._values=e,n.values=this.config.transform(e)}computeInitial(){const e=this.state;e._initial=e._values,e.initial=e.values}compute(e){const{state:n,config:r,shared:s}=this;n.args=this.args;let o=0;if(e&&(n.event=e,r.preventDefault&&e.cancelable&&n.event.preventDefault(),n.type=e.type,s.touches=this.ctrl.pointerIds.size||this.ctrl.touchIds.size,s.locked=!!document.pointerLockElement,Object.assign(s,L9(e)),s.down=s.pressed=s.buttons%2===1||s.touches>0,o=e.timeStamp-n.timeStamp,n.timeStamp=e.timeStamp,n.elapsedTime=n.timeStamp-n.startTime),n._active){const _=n._delta.map(Math.abs);zt.addTo(n._distance,_)}this.axisIntent&&this.axisIntent(e);const[i,a]=n._movement,[c,l]=r.threshold,{_step:u,values:d}=n;if(r.hasCustomTransform?(u[0]===!1&&(u[0]=Math.abs(i)>=c&&d[0]),u[1]===!1&&(u[1]=Math.abs(a)>=l&&d[1])):(u[0]===!1&&(u[0]=Math.abs(i)>=c&&Math.sign(i)*c),u[1]===!1&&(u[1]=Math.abs(a)>=l&&Math.sign(a)*l)),n.intentional=u[0]!==!1||u[1]!==!1,!n.intentional)return;const h=[0,0];if(r.hasCustomTransform){const[_,k]=d;h[0]=u[0]!==!1?_-u[0]:0,h[1]=u[1]!==!1?k-u[1]:0}else h[0]=u[0]!==!1?i-u[0]:0,h[1]=u[1]!==!1?a-u[1]:0;this.restrictToAxis&&!n._blocked&&this.restrictToAxis(h);const f=n.offset,p=n._active&&!n._blocked||n.active;p&&(n.first=n._active&&!n.active,n.last=!n._active&&n.active,n.active=s[this.ingKey]=n._active,e&&(n.first&&("bounds"in r&&(n._bounds=sg(r.bounds,n)),this.setup&&this.setup()),n.movement=h,this.computeOffset()));const[m,v]=n.offset,[[w,x],[b,C]]=n._bounds;n.overflow=[m<w?-1:m>x?1:0,v<b?-1:v>C?1:0],n._movementBound[0]=n.overflow[0]?n._movementBound[0]===!1?n._movement[0]:n._movementBound[0]:!1,n._movementBound[1]=n.overflow[1]?n._movementBound[1]===!1?n._movement[1]:n._movementBound[1]:!1;const E=n._active?r.rubberband||[0,0]:[0,0];if(n.offset=_9(n._bounds,n.offset,E),n.delta=zt.sub(n.offset,f),this.computeMovement(),p&&(!n.last||o>z9)){n.delta=zt.sub(n.offset,f);const _=n.delta.map(Math.abs);zt.addTo(n.distance,_),n.direction=n.delta.map(Math.sign),n._direction=n._delta.map(Math.sign),!n.first&&o>0&&(n.velocity=[_[0]/o,_[1]/o],n.timeDelta=o)}}emit(){const e=this.state,n=this.shared,r=this.config;if(e._active||this.clean(),(e._blocked||!e.intentional)&&!e._force&&!r.triggerAllEvents)return;const s=this.handler(ot(ot(ot({},n),e),{},{[this.aliasKey]:e.values}));s!==void 0&&(e.memo=s)}clean(){this.eventStore.clean(),this.timeoutStore.clean()}}function F9([t,e],n){const r=Math.abs(t),s=Math.abs(e);if(r>s&&r>n)return"x";if(s>r&&s>n)return"y"}class B9 extends r3{constructor(...e){super(...e),Yt(this,"aliasKey","xy")}reset(){super.reset(),this.state.axis=void 0}init(){this.state.offset=[0,0],this.state.lastOffset=[0,0]}computeOffset(){this.state.offset=zt.add(this.state.lastOffset,this.state.movement)}computeMovement(){this.state.movement=zt.sub(this.state.offset,this.state.lastOffset)}axisIntent(e){const n=this.state,r=this.config;if(!n.axis&&e){const s=typeof r.axisThreshold=="object"?r.axisThreshold[O9(e)]:r.axisThreshold;n.axis=F9(n._movement,s)}n._blocked=(r.lockDirection||!!r.axis)&&!n.axis||!!r.axis&&r.axis!==n.axis}restrictToAxis(e){if(this.config.axis||this.config.lockDirection)switch(this.state.axis){case"x":e[1]=0;break;case"y":e[0]=0;break}}}const U9=t=>t,P_=.15,s3={enabled(t=!0){return t},eventOptions(t,e,n){return ot(ot({},n.shared.eventOptions),t)},preventDefault(t=!1){return t},triggerAllEvents(t=!1){return t},rubberband(t=0){switch(t){case!0:return[P_,P_];case!1:return[0,0];default:return zt.toVector(t)}},from(t){if(typeof t=="function")return t;if(t!=null)return zt.toVector(t)},transform(t,e,n){const r=t||n.shared.transform;return this.hasCustomTransform=!!r,r||U9},threshold(t){return zt.toVector(t,0)}},H9=0,Rd=ot(ot({},s3),{},{axis(t,e,{axis:n}){if(this.lockDirection=n==="lock",!this.lockDirection)return n},axisThreshold(t=H9){return t},bounds(t={}){if(typeof t=="function")return o=>Rd.bounds(t(o));if("current"in t)return()=>t.current;if(typeof HTMLElement=="function"&&t instanceof HTMLElement)return t;const{left:e=-1/0,right:n=1/0,top:r=-1/0,bottom:s=1/0}=t;return[[e,n],[r,s]]}}),Ld=typeof window<"u"&&window.document&&window.document.createElement;function K9(){return Ld&&"ontouchstart"in window}function k_(){return K9()||Ld&&window.navigator.maxTouchPoints>1}function V9(){return Ld&&"onpointerdown"in window}function W9(){return Ld&&"exitPointerLock"in window.document}function G9(){try{return"constructor"in GestureEvent}catch{return!1}}const fr={isBrowser:Ld,gesture:G9(),touch:k_(),touchscreen:k_(),pointer:V9(),pointerLock:W9()},Y9=250,X9=180,q9=.5,Q9=50,Z9=250,J9=10,I_={mouse:0,touch:0,pen:8};ot(ot({},Rd),{},{device(t,e,{pointer:{touch:n=!1,lock:r=!1,mouse:s=!1}={}}){return this.pointerLock=r&&fr.pointerLock,fr.touch&&n?"touch":this.pointerLock?"mouse":fr.pointer&&!s?"pointer":fr.touch?"touch":"mouse"},preventScrollAxis(t,e,{preventScroll:n}){if(this.preventScrollDelay=typeof n=="number"?n:n||n===void 0&&t?Y9:void 0,!(!fr.touchscreen||n===!1))return t||(n!==void 0?"y":void 0)},pointerCapture(t,e,{pointer:{capture:n=!0,buttons:r=1,keys:s=!0}={}}){return this.pointerButtons=r,this.keys=s,!this.pointerLock&&this.device==="pointer"&&n},threshold(t,e,{filterTaps:n=!1,tapsThreshold:r=3,axis:s=void 0}){const o=zt.toVector(t,n?r:s?1:0);return this.filterTaps=n,this.tapsThreshold=r,o},swipe({velocity:t=q9,distance:e=Q9,duration:n=Z9}={}){return{velocity:this.transform(zt.toVector(t)),distance:this.transform(zt.toVector(e)),duration:n}},delay(t=0){switch(t){case!0:return X9;case!1:return 0;default:return t}},axisThreshold(t){return t?ot(ot({},I_),t):I_},keyboardDisplacement(t=J9){return t}});function o3(t){const[e,n]=t.overflow,[r,s]=t._delta,[o,i]=t._direction;(e<0&&r>0&&o<0||e>0&&r<0&&o>0)&&(t._movement[0]=t._movementBound[0]),(n<0&&s>0&&i<0||n>0&&s<0&&i>0)&&(t._movement[1]=t._movementBound[1])}const ez=30,tz=100;class nz extends r3{constructor(...e){super(...e),Yt(this,"ingKey","pinching"),Yt(this,"aliasKey","da")}init(){this.state.offset=[1,0],this.state.lastOffset=[1,0],this.state._pointerEvents=new Map}reset(){super.reset();const e=this.state;e._touchIds=[],e.canceled=!1,e.cancel=this.cancel.bind(this),e.turns=0}computeOffset(){const{type:e,movement:n,lastOffset:r}=this.state;e==="wheel"?this.state.offset=zt.add(n,r):this.state.offset=[(1+n[0])*r[0],n[1]+r[1]]}computeMovement(){const{offset:e,lastOffset:n}=this.state;this.state.movement=[e[0]/n[0],e[1]-n[1]]}axisIntent(){const e=this.state,[n,r]=e._movement;if(!e.axis){const s=Math.abs(n)*ez-Math.abs(r);s<0?e.axis="angle":s>0&&(e.axis="scale")}}restrictToAxis(e){this.config.lockDirection&&(this.state.axis==="scale"?e[1]=0:this.state.axis==="angle"&&(e[0]=0))}cancel(){const e=this.state;e.canceled||setTimeout(()=>{e.canceled=!0,e._active=!1,this.compute(),this.emit()},0)}touchStart(e){this.ctrl.setEventIds(e);const n=this.state,r=this.ctrl.touchIds;if(n._active&&n._touchIds.every(o=>r.has(o))||r.size<2)return;this.start(e),n._touchIds=Array.from(r).slice(0,2);const s=b_(e,n._touchIds);s&&this.pinchStart(e,s)}pointerStart(e){if(e.buttons!=null&&e.buttons%2!==1)return;this.ctrl.setEventIds(e),e.target.setPointerCapture(e.pointerId);const n=this.state,r=n._pointerEvents,s=this.ctrl.pointerIds;if(n._active&&Array.from(r.keys()).every(i=>s.has(i))||(r.size<2&&r.set(e.pointerId,e),n._pointerEvents.size<2))return;this.start(e);const o=zw(...Array.from(r.values()));o&&this.pinchStart(e,o)}pinchStart(e,n){const r=this.state;r.origin=n.origin,this.computeValues([n.distance,n.angle]),this.computeInitial(),this.compute(e),this.emit()}touchMove(e){if(!this.state._active)return;const n=b_(e,this.state._touchIds);n&&this.pinchMove(e,n)}pointerMove(e){const n=this.state._pointerEvents;if(n.has(e.pointerId)&&n.set(e.pointerId,e),!this.state._active)return;const r=zw(...Array.from(n.values()));r&&this.pinchMove(e,r)}pinchMove(e,n){const r=this.state,s=r._values[1],o=n.angle-s;let i=0;Math.abs(o)>270&&(i+=Math.sign(o)),this.computeValues([n.distance,n.angle-360*i]),r.origin=n.origin,r.turns=i,r._movement=[r._values[0]/r._initial[0]-1,r._values[1]-r._initial[1]],this.compute(e),this.emit()}touchEnd(e){this.ctrl.setEventIds(e),this.state._active&&this.state._touchIds.some(n=>!this.ctrl.touchIds.has(n))&&(this.state._active=!1,this.compute(e),this.emit())}pointerEnd(e){const n=this.state;this.ctrl.setEventIds(e);try{e.target.releasePointerCapture(e.pointerId)}catch{}n._pointerEvents.has(e.pointerId)&&n._pointerEvents.delete(e.pointerId),n._active&&n._pointerEvents.size<2&&(n._active=!1,this.compute(e),this.emit())}gestureStart(e){e.cancelable&&e.preventDefault();const n=this.state;n._active||(this.start(e),this.computeValues([e.scale,e.rotation]),n.origin=[e.clientX,e.clientY],this.compute(e),this.emit())}gestureMove(e){if(e.cancelable&&e.preventDefault(),!this.state._active)return;const n=this.state;this.computeValues([e.scale,e.rotation]),n.origin=[e.clientX,e.clientY];const r=n._movement;n._movement=[e.scale-1,e.rotation],n._delta=zt.sub(n._movement,r),this.compute(e),this.emit()}gestureEnd(e){this.state._active&&(this.state._active=!1,this.compute(e),this.emit())}wheel(e){const n=this.config.modifierKey;n&&!e[n]||(this.state._active?this.wheelChange(e):this.wheelStart(e),this.timeoutStore.add("wheelEnd",this.wheelEnd.bind(this)))}wheelStart(e){this.start(e),this.wheelChange(e)}wheelChange(e){"uv"in e||e.cancelable&&e.preventDefault();const r=this.state;r._delta=[-n3(e)[1]/tz*r.offset[0],0],zt.addTo(r._movement,r._delta),o3(r),this.state.origin=[e.clientX,e.clientY],this.compute(e),this.emit()}wheelEnd(){this.state._active&&(this.state._active=!1,this.compute(),this.emit())}bind(e){const n=this.config.device;n&&(e(n,"start",this[n+"Start"].bind(this)),e(n,"change",this[n+"Move"].bind(this)),e(n,"end",this[n+"End"].bind(this)),e(n,"cancel",this[n+"End"].bind(this)),e("lostPointerCapture","",this[n+"End"].bind(this))),this.config.pinchOnWheel&&e("wheel","",this.wheel.bind(this),{passive:!1})}}const rz=ot(ot({},s3),{},{device(t,e,{shared:n,pointer:{touch:r=!1}={}}){if(n.target&&!fr.touch&&fr.gesture)return"gesture";if(fr.touch&&r)return"touch";if(fr.touchscreen){if(fr.pointer)return"pointer";if(fr.touch)return"touch"}},bounds(t,e,{scaleBounds:n={},angleBounds:r={}}){const s=i=>{const a=E_(sg(n,i),{min:-1/0,max:1/0});return[a.min,a.max]},o=i=>{const a=E_(sg(r,i),{min:-1/0,max:1/0});return[a.min,a.max]};return typeof n!="function"&&typeof r!="function"?[s(),o()]:i=>[s(i),o(i)]},threshold(t,e,n){return this.lockDirection=n.axis==="lock",zt.toVector(t,this.lockDirection?[.1,3]:0)},modifierKey(t){return t===void 0?"ctrlKey":t},pinchOnWheel(t=!0){return t}});ot(ot({},Rd),{},{mouseOnly:(t=!0)=>t});class sz extends B9{constructor(...e){super(...e),Yt(this,"ingKey","wheeling")}wheel(e){this.state._active||this.start(e),this.wheelChange(e),this.timeoutStore.add("wheelEnd",this.wheelEnd.bind(this))}wheelChange(e){const n=this.state;n._delta=n3(e),zt.addTo(n._movement,n._delta),o3(n),this.compute(e),this.emit()}wheelEnd(){this.state._active&&(this.state._active=!1,this.compute(),this.emit())}bind(e){e("wheel","",this.wheel.bind(this))}}const oz=Rd;ot(ot({},Rd),{},{mouseOnly:(t=!0)=>t});const sx=new Map,Fw=new Map;function iz(t){sx.set(t.key,t.engine),Fw.set(t.key,t.resolver)}const az={key:"pinch",engine:nz,resolver:rz},cz={key:"wheel",engine:sz,resolver:oz};function lz(t,e){if(t==null)return{};var n={},r=Object.keys(t),s,o;for(o=0;o<r.length;o++)s=r[o],!(e.indexOf(s)>=0)&&(n[s]=t[s]);return n}function uz(t,e){if(t==null)return{};var n=lz(t,e),r,s;if(Object.getOwnPropertySymbols){var o=Object.getOwnPropertySymbols(t);for(s=0;s<o.length;s++)r=o[s],!(e.indexOf(r)>=0)&&Object.prototype.propertyIsEnumerable.call(t,r)&&(n[r]=t[r])}return n}const dz={target(t){if(t)return()=>"current"in t?t.current:t},enabled(t=!0){return t},window(t=fr.isBrowser?window:void 0){return t},eventOptions({passive:t=!0,capture:e=!1}={}){return{passive:t,capture:e}},transform(t){return t}},hz=["target","eventOptions","window","enabled","transform"];function Df(t={},e){const n={};for(const[r,s]of Object.entries(e))switch(typeof s){case"function":n[r]=s.call(n,t[r],r,t);break;case"object":n[r]=Df(t[r],s);break;case"boolean":s&&(n[r]=t[r]);break}return n}function fz(t,e,n={}){const r=t,{target:s,eventOptions:o,window:i,enabled:a,transform:c}=r,l=uz(r,hz);if(n.shared=Df({target:s,eventOptions:o,window:i,enabled:a,transform:c},dz),e){const u=Fw.get(e);n[e]=Df(ot({shared:n.shared},l),u)}else for(const u in l){const d=Fw.get(u);d&&(n[u]=Df(ot({shared:n.shared},l[u]),d))}return n}class i3{constructor(e,n){Yt(this,"_listeners",new Set),this._ctrl=e,this._gestureKey=n}add(e,n,r,s,o){const i=this._listeners,a=M9(n,r),c=this._gestureKey?this._ctrl.config[this._gestureKey].eventOptions:{},l=ot(ot({},c),o);e.addEventListener(a,s,l);const u=()=>{e.removeEventListener(a,s,l),i.delete(u)};return i.add(u),u}clean(){this._listeners.forEach(e=>e()),this._listeners.clear()}}class pz{constructor(){Yt(this,"_timeouts",new Map)}add(e,n,r=140,...s){this.remove(e),this._timeouts.set(e,window.setTimeout(n,r,...s))}remove(e){const n=this._timeouts.get(e);n&&window.clearTimeout(n)}clean(){this._timeouts.forEach(e=>void window.clearTimeout(e)),this._timeouts.clear()}}class gz{constructor(e){Yt(this,"gestures",new Set),Yt(this,"_targetEventStore",new i3(this)),Yt(this,"gestureEventStores",{}),Yt(this,"gestureTimeoutStores",{}),Yt(this,"handlers",{}),Yt(this,"config",{}),Yt(this,"pointerIds",new Set),Yt(this,"touchIds",new Set),Yt(this,"state",{shared:{shiftKey:!1,metaKey:!1,ctrlKey:!1,altKey:!1}}),mz(this,e)}setEventIds(e){if(t3(e))return this.touchIds=new Set(R9(e)),this.touchIds;if("pointerId"in e)return e.type==="pointerup"||e.type==="pointercancel"?this.pointerIds.delete(e.pointerId):e.type==="pointerdown"&&this.pointerIds.add(e.pointerId),this.pointerIds}applyHandlers(e,n){this.handlers=e,this.nativeHandlers=n}applyConfig(e,n){this.config=fz(e,n,this.config)}clean(){this._targetEventStore.clean();for(const e of this.gestures)this.gestureEventStores[e].clean(),this.gestureTimeoutStores[e].clean()}effect(){return this.config.shared.target&&this.bind(),()=>this._targetEventStore.clean()}bind(...e){const n=this.config.shared,r={};let s;if(!(n.target&&(s=n.target(),!s))){if(n.enabled){for(const i of this.gestures){const a=this.config[i],c=$_(r,a.eventOptions,!!s);if(a.enabled){const l=sx.get(i);new l(this,e,i).bind(c)}}const o=$_(r,n.eventOptions,!!s);for(const i in this.nativeHandlers)o(i,"",a=>this.nativeHandlers[i](ot(ot({},this.state.shared),{},{event:a,args:e})),void 0,!0)}for(const o in r)r[o]=N9(...r[o]);if(!s)return r;for(const o in r){const{device:i,capture:a,passive:c}=A9(o);this._targetEventStore.add(s,i,"",r[o],{capture:a,passive:c})}}}}function Va(t,e){t.gestures.add(e),t.gestureEventStores[e]=new i3(t,e),t.gestureTimeoutStores[e]=new pz}function mz(t,e){e.drag&&Va(t,"drag"),e.wheel&&Va(t,"wheel"),e.scroll&&Va(t,"scroll"),e.move&&Va(t,"move"),e.pinch&&Va(t,"pinch"),e.hover&&Va(t,"hover")}const $_=(t,e,n)=>(r,s,o,i={},a=!1)=>{var c,l;const u=(c=i.capture)!==null&&c!==void 0?c:e.capture,d=(l=i.passive)!==null&&l!==void 0?l:e.passive;let h=a?r:$9(r,s,u);n&&d&&(h+="Passive"),t[h]=t[h]||[],t[h].push(o)},yz=/^on(Drag|Wheel|Scroll|Move|Pinch|Hover)/;function vz(t){const e={},n={},r=new Set;for(let s in t)yz.test(s)?(r.add(RegExp.lastMatch),n[s]=t[s]):e[s]=t[s];return[n,e,r]}function Wa(t,e,n,r,s,o){if(!t.has(n)||!sx.has(r))return;const i=n+"Start",a=n+"End",c=l=>{let u;return l.first&&i in e&&e[i](l),n in e&&(u=e[n](l)),l.last&&a in e&&e[a](l),u};s[r]=c,o[r]=o[r]||{}}function wz(t,e){const[n,r,s]=vz(t),o={};return Wa(s,n,"onDrag","drag",o,e),Wa(s,n,"onWheel","wheel",o,e),Wa(s,n,"onScroll","scroll",o,e),Wa(s,n,"onPinch","pinch",o,e),Wa(s,n,"onMove","move",o,e),Wa(s,n,"onHover","hover",o,e),{handlers:o,config:e,nativeHandlers:r}}function Sz(t,e={},n,r){const s=Z.useMemo(()=>new gz(t),[]);if(s.applyHandlers(t,r),s.applyConfig(e,n),Z.useEffect(s.effect.bind(s)),Z.useEffect(()=>s.clean.bind(s),[]),e.target===void 0)return s.bind.bind(s)}function xz(t){return t.forEach(iz),function(n,r){const{handlers:s,nativeHandlers:o,config:i}=wz(n,r||{});return Sz(s,i,void 0,o)}}var a3="Expected a function",T_=0/0,bz="[object Symbol]",Cz=/^\s+|\s+$/g,_z=/^[-+]0x[0-9a-f]+$/i,Ez=/^0b[01]+$/i,Pz=/^0o[0-7]+$/i,kz=parseInt,Iz=typeof hn=="object"&&hn&&hn.Object===Object&&hn,$z=typeof self=="object"&&self&&self.Object===Object&&self,Tz=Iz||$z||Function("return this")(),Az=Object.prototype,Mz=Az.toString,Oz=Math.max,Dz=Math.min,Yy=function(){return Tz.Date.now()};function Rz(t,e,n){var r,s,o,i,a,c,l=0,u=!1,d=!1,h=!0;if(typeof t!="function")throw new TypeError(a3);e=A_(e)||0,og(n)&&(u=!!n.leading,d="maxWait"in n,o=d?Oz(A_(n.maxWait)||0,e):o,h="trailing"in n?!!n.trailing:h);function f(_){var k=r,I=s;return r=s=void 0,l=_,i=t.apply(I,k),i}function p(_){return l=_,a=setTimeout(w,e),u?f(_):i}function m(_){var k=_-c,I=_-l,$=e-k;return d?Dz($,o-I):$}function v(_){var k=_-c,I=_-l;return c===void 0||k>=e||k<0||d&&I>=o}function w(){var _=Yy();if(v(_))return x(_);a=setTimeout(w,m(_))}function x(_){return a=void 0,h&&r?f(_):(r=s=void 0,i)}function b(){a!==void 0&&clearTimeout(a),l=0,r=c=s=a=void 0}function C(){return a===void 0?i:x(Yy())}function E(){var _=Yy(),k=v(_);if(r=arguments,s=this,c=_,k){if(a===void 0)return p(c);if(d)return a=setTimeout(w,e),f(c)}return a===void 0&&(a=setTimeout(w,e)),i}return E.cancel=b,E.flush=C,E}function Lz(t,e,n){var r=!0,s=!0;if(typeof t!="function")throw new TypeError(a3);return og(n)&&(r="leading"in n?!!n.leading:r,s="trailing"in n?!!n.trailing:s),Rz(t,e,{leading:r,maxWait:e,trailing:s})}function og(t){var e=typeof t;return!!t&&(e=="object"||e=="function")}function jz(t){return!!t&&typeof t=="object"}function Nz(t){return typeof t=="symbol"||jz(t)&&Mz.call(t)==bz}function A_(t){if(typeof t=="number")return t;if(Nz(t))return T_;if(og(t)){var e=typeof t.valueOf=="function"?t.valueOf():t;t=og(e)?e+"":e}if(typeof t!="string")return t===0?t:+t;t=t.replace(Cz,"");var n=Ez.test(t);return n||Pz.test(t)?kz(t.slice(2),n?2:8):_z.test(t)?T_:+t}var zz=Lz;const c3=Sa(zz),M_=10,Fz=/Mac|iPod|iPhone|iPad/.test(typeof window>"u"?"node":window.navigator.platform);function l3(t){let{deltaY:e,deltaX:n}=t,r=0;if(t.ctrlKey||t.altKey||t.metaKey){const s=Math.sign(t.deltaY),o=Math.abs(t.deltaY);let i=e;o>M_&&(i=M_*s),r=i/100}else t.shiftKey&&!Fz&&(n=e,e=0);return{x:-n,y:-e,z:-r}}const Bz=xz([cz,az]);let Ga;const Uz=t=>Ga===void 0?(Ga=t,!1):t-Ga>120&&t-Ga<160?(Ga=t,!0):(Ga=t,!1);function Hz(t){const e=H(),n=S.useMemo(()=>{let r=null;const s=({event:m})=>{if(!e.instanceState.isFocused||(r=null,Uz(Date.now())))return;if(e.editingShapeId){const x=e.getShape(e.editingShapeId);if(x&&e.getShapeUtil(x).canScroll(x)){const C=e.getShapePageBounds(e.editingShapeId);if(C!=null&&C.containsPoint(e.inputs.currentPagePoint))return}}je(m);const v=l3(m);if(v.x===0&&v.y===0)return;const w={type:"wheel",name:"wheel",delta:v,shiftKey:m.shiftKey,altKey:m.altKey,ctrlKey:m.metaKey||m.ctrlKey};e.dispatch(w)};let o=1,i=1,a=1,c=0;const l=new P,u=new P,d=m=>{const v=t.current;r=null;const{event:w,origin:x,da:b}=m;w instanceof WheelEvent||(w.target===v||v!=null&&v.contains(w.target))&&(u.x=x[0],u.y=x[1],l.x=x[0],l.y=x[1],o=b[0],i=e.zoomLevel,e.dispatch({type:"pinch",name:"pinch_start",point:{x:x[0],y:x[1],z:e.zoomLevel},delta:{x:0,y:0},shiftKey:w.shiftKey,altKey:w.altKey,ctrlKey:w.metaKey||w.ctrlKey}))},h=c3(m=>{if(r===null){const v=Math.abs(c-o),w=P.Dist(l,u);m==="gesture"&&v||m==="touch"&&v>16?r="zooming":w>16&&(r="panning")}},32);return{onWheel:s,onPinchStart:d,onPinchEnd:m=>{const v=t.current,{event:w,origin:x,offset:b}=m;if(w instanceof WheelEvent||!(w.target===v||v!=null&&v.contains(w.target)))return;const C=b[0];r=null,requestAnimationFrame(()=>{e.dispatch({type:"pinch",name:"pinch_end",point:{x:x[0],y:x[1],z:C},delta:{x:x[0],y:x[1]},shiftKey:w.shiftKey,altKey:w.altKey,ctrlKey:w.metaKey||w.ctrlKey})})},onPinch:m=>{const v=t.current,{event:w,origin:x,offset:b,da:C}=m;if(w instanceof WheelEvent||!(w.target===v||v!=null&&v.contains(w.target)))return;const E=!("touches"in w);c=C[0],(E||c>64)&&(a=b[0]);const _=x[0]-u.x,k=x[1]-u.y;switch(u.x=x[0],u.y=x[1],h(E?"gesture":"touch"),r){case"zooming":{e.dispatch({type:"pinch",name:"pinch",point:{x:x[0],y:x[1],z:a},delta:{x:_,y:k},shiftKey:w.shiftKey,altKey:w.altKey,ctrlKey:w.metaKey||w.ctrlKey});break}case"panning":{e.dispatch({type:"pinch",name:"pinch",point:{x:x[0],y:x[1],z:i},delta:{x:_,y:k},shiftKey:w.shiftKey,altKey:w.altKey,ctrlKey:w.metaKey||w.ctrlKey});break}}}}},[e,t]);Bz(n,{target:t,eventOptions:{passive:!1},pinch:{from:()=>[e.zoomLevel,0],scaleBounds:()=>({from:e.zoomLevel,max:8,min:.05})}})}function Xy(t,e,n){const r=t.getShape(e),s=t.getShapeHandles(r);return{shape:r,handle:s.find(o=>o.id===n)}}function Kz(t,e){const n=H();return S.useMemo(()=>{const r=c=>{if(c.isKilled)return;const l=Jp(c.currentTarget);Od(l,c);const{shape:u,handle:d}=Xy(n,t,e);d&&n.dispatch({type:"pointer",target:"handle",handle:d,shape:u,name:"pointer_down",...vr(c)})};let s,o;return{onPointerDown:r,onPointerMove:c=>{if(c.isKilled||c.clientX===s&&c.clientY===o)return;s=c.clientX,o=c.clientY;const{shape:l,handle:u}=Xy(n,t,e);u&&n.dispatch({type:"pointer",target:"handle",handle:u,shape:l,name:"pointer_move",...vr(c)})},onPointerUp:c=>{if(c.isKilled)return;const l=Jp(c.currentTarget);hm(l,c);const{shape:u,handle:d}=Xy(n,t,e);d&&n.dispatch({type:"pointer",target:"handle",handle:d,shape:u,name:"pointer_up",...vr(c)})}}},[n,t,e])}function Vz(){const t=H();S.useLayoutEffect(()=>{const e=c3(()=>{t.instanceState.isFocused&&t.updateViewportScreenBounds()},200,{trailing:!0});e();const n=setInterval(e,1e3);return window.addEventListener("resize",e),window.addEventListener("scroll",e),()=>{clearInterval(n),window.removeEventListener("resize",e),window.removeEventListener("scroll",e)}})}const Ie=class Ie{constructor(e,n,r,s,o,i){y(this,"a",1);y(this,"b",0);y(this,"c",0);y(this,"d",1);y(this,"e",0);y(this,"f",0);this.a=e,this.b=n,this.c=r,this.d=s,this.e=o,this.f=i}equals(e){return this.a===e.a&&this.b===e.b&&this.c===e.c&&this.d===e.d&&this.e===e.e&&this.f===e.f}identity(){return this.a=1,this.b=0,this.c=0,this.d=1,this.e=0,this.f=0,this}multiply(e){const n=e,{a:r,b:s,c:o,d:i,e:a,f:c}=this;return this.a=r*n.a+o*n.b,this.c=r*n.c+o*n.d,this.e=r*n.e+o*n.f+a,this.b=s*n.a+i*n.b,this.d=s*n.c+i*n.d,this.f=s*n.e+i*n.f+c,this}rotate(e,n,r){return e===0?this:n===void 0?this.multiply(Ie.Rotate(e)):this.translate(n,r).multiply(Ie.Rotate(e)).translate(-n,-r)}translate(e,n){return this.multiply(Ie.Translate(e,n))}scale(e,n){return this.multiply(Ie.Scale(e,n))}invert(){const{a:e,b:n,c:r,d:s,e:o,f:i}=this,a=e*s-n*r;return this.a=s/a,this.b=n/-a,this.c=r/-a,this.d=e/a,this.e=(s*o-r*i)/-a,this.f=(n*o-e*i)/a,this}applyToPoint(e){return Ie.applyToPoint(this,e)}applyToPoints(e){return Ie.applyToPoints(this,e)}rotation(){return Ie.Rotation(this)}point(){return Ie.Point(this)}decomposed(){return Ie.Decompose(this)}toCssString(){return Ie.toCssString(this)}setTo(e){return Object.assign(this,e),this}decompose(){return Ie.Decompose(this)}clone(){return new Ie(this.a,this.b,this.c,this.d,this.e,this.f)}static Identity(){return new Ie(1,0,0,1,0,0)}static Translate(e,n){return new Ie(1,0,0,1,e,n)}static Rotate(e,n,r){if(e===0)return Ie.Identity();const s=Math.cos(e),o=Math.sin(e),i=new Ie(s,o,-o,s,0,0);return n===void 0?i:Ie.Compose(Ie.Translate(n,r),i,Ie.Translate(-n,-r))}static Multiply(e,n){return{a:e.a*n.a+e.c*n.b,c:e.a*n.c+e.c*n.d,e:e.a*n.e+e.c*n.f+e.e,b:e.b*n.a+e.d*n.b,d:e.b*n.c+e.d*n.d,f:e.b*n.e+e.d*n.f+e.f}}static Inverse(e){const n=e.a*e.d-e.b*e.c;return{a:e.d/n,b:e.b/-n,c:e.c/-n,d:e.a/n,e:(e.d*e.e-e.c*e.f)/-n,f:(e.b*e.e-e.a*e.f)/n}}static Absolute(e){const n=e.a*e.d-e.b*e.c;return{a:e.d/n,b:e.b/-n,c:e.c/-n,d:e.a/n,e:(e.d*e.e-e.c*e.f)/n,f:(e.b*e.e-e.a*e.f)/-n}}static Compose(...e){const n=Ie.Identity();for(let r=0,s=e.length;r<s;r++)n.multiply(e[r]);return n}static Point(e){return new P(e.e,e.f)}static Rotation(e){let n;if(e.a!==0||e.c!==0){const r=Math.hypot(e.a,e.c);n=Math.acos(e.a/r)*(e.c>0?-1:1)}else if(e.b!==0||e.d!==0){const r=Math.hypot(e.b,e.d);n=Te+Math.acos(e.b/r)*(e.d>0?-1:1)}else n=0;return jw(n)}static Decompose(e){let n,r,s;if(e.a!==0||e.c!==0){const o=Math.hypot(e.a,e.c);n=o,r=(e.a*e.d-e.b*e.c)/o,s=Math.acos(e.a/o)*(e.c>0?-1:1)}else if(e.b!==0||e.d!==0){const o=Math.hypot(e.b,e.d);n=(e.a*e.d-e.b*e.c)/o,r=o,s=Te+Math.acos(e.b/o)*(e.d>0?-1:1)}else n=0,r=0,s=0;return{x:e.e,y:e.f,scaleX:n,scaleY:r,rotation:jw(s)}}static Smooth(e,n=1e10){return e.a=Math.round(e.a*n)/n,e.b=Math.round(e.b*n)/n,e.c=Math.round(e.c*n)/n,e.d=Math.round(e.d*n)/n,e.e=Math.round(e.e*n)/n,e.f=Math.round(e.f*n)/n,e}static toCssString(e){return`matrix(${R(e.a)}, ${R(e.b)}, ${R(e.c)}, ${R(e.d)}, ${R(e.e)}, ${R(e.f)})`}static applyToPoint(e,n){return new P(e.a*n.x+e.c*n.y+e.e,e.b*n.x+e.d*n.y+e.f,n.z)}static applyToXY(e,n,r){return[e.a*n+e.c*r+e.e,e.b*n+e.d*r+e.f]}static applyToPoints(e,n){return n.map(r=>new P(e.a*r.x+e.c*r.y+e.e,e.b*r.x+e.d*r.y+e.f,r.z))}static applyToBounds(e,n){return new ae(e.e+n.minX,e.f+n.minY,n.width,n.height)}static From(e){return new Ie(e.a,e.b,e.c,e.d,e.e,e.f)}static Cast(e){return e instanceof Ie?e:Ie.From(e)}};y(Ie,"Scale",(e,n,r,s)=>{const o=new Ie(e,0,0,0,n,0);return r===void 0?o:Ie.Compose(Ie.Translate(r,s),o,Ie.Translate(-r,-s))});let te=Ie;var Wz=200,ox="__lodash_hash_undefined__",Gz=1/0,Yz="[object Function]",Xz="[object GeneratorFunction]",qz=/[\\^$.*+?()[\]{}|]/g,Qz=/^\[object .+?Constructor\]$/,Zz=typeof hn=="object"&&hn&&hn.Object===Object&&hn,Jz=typeof self=="object"&&self&&self.Object===Object&&self,ix=Zz||Jz||Function("return this")();function eF(t,e){var n=t?t.length:0;return!!n&&rF(t,e,0)>-1}function tF(t,e,n){for(var r=-1,s=t?t.length:0;++r<s;)if(n(e,t[r]))return!0;return!1}function nF(t,e,n,r){for(var s=t.length,o=n+(r?1:-1);r?o--:++o<s;)if(e(t[o],o,t))return o;return-1}function rF(t,e,n){if(e!==e)return nF(t,sF,n);for(var r=n-1,s=t.length;++r<s;)if(t[r]===e)return r;return-1}function sF(t){return t!==t}function oF(t,e){return t.has(e)}function iF(t,e){return t==null?void 0:t[e]}function aF(t){var e=!1;if(t!=null&&typeof t.toString!="function")try{e=!!(t+"")}catch{}return e}function u3(t){var e=-1,n=Array(t.size);return t.forEach(function(r){n[++e]=r}),n}var cF=Array.prototype,lF=Function.prototype,d3=Object.prototype,qy=ix["__core-js_shared__"],O_=function(){var t=/[^.]+$/.exec(qy&&qy.keys&&qy.keys.IE_PROTO||"");return t?"Symbol(src)_1."+t:""}(),h3=lF.toString,ax=d3.hasOwnProperty,uF=d3.toString,dF=RegExp("^"+h3.call(ax).replace(qz,"\\$&").replace(/hasOwnProperty|(function).*?(?=\\\()| for .+?(?=\\\])/g,"$1.*?")+"$"),hF=cF.splice,fF=cx(ix,"Map"),Qy=cx(ix,"Set"),ed=cx(Object,"create");function ha(t){var e=-1,n=t?t.length:0;for(this.clear();++e<n;){var r=t[e];this.set(r[0],r[1])}}function pF(){this.__data__=ed?ed(null):{}}function gF(t){return this.has(t)&&delete this.__data__[t]}function mF(t){var e=this.__data__;if(ed){var n=e[t];return n===ox?void 0:n}return ax.call(e,t)?e[t]:void 0}function yF(t){var e=this.__data__;return ed?e[t]!==void 0:ax.call(e,t)}function vF(t,e){var n=this.__data__;return n[t]=ed&&e===void 0?ox:e,this}ha.prototype.clear=pF;ha.prototype.delete=gF;ha.prototype.get=mF;ha.prototype.has=yF;ha.prototype.set=vF;function cl(t){var e=-1,n=t?t.length:0;for(this.clear();++e<n;){var r=t[e];this.set(r[0],r[1])}}function wF(){this.__data__=[]}function SF(t){var e=this.__data__,n=fm(e,t);if(n<0)return!1;var r=e.length-1;return n==r?e.pop():hF.call(e,n,1),!0}function xF(t){var e=this.__data__,n=fm(e,t);return n<0?void 0:e[n][1]}function bF(t){return fm(this.__data__,t)>-1}function CF(t,e){var n=this.__data__,r=fm(n,t);return r<0?n.push([t,e]):n[r][1]=e,this}cl.prototype.clear=wF;cl.prototype.delete=SF;cl.prototype.get=xF;cl.prototype.has=bF;cl.prototype.set=CF;function ll(t){var e=-1,n=t?t.length:0;for(this.clear();++e<n;){var r=t[e];this.set(r[0],r[1])}}function _F(){this.__data__={hash:new ha,map:new(fF||cl),string:new ha}}function EF(t){return pm(this,t).delete(t)}function PF(t){return pm(this,t).get(t)}function kF(t){return pm(this,t).has(t)}function IF(t,e){return pm(this,t).set(t,e),this}ll.prototype.clear=_F;ll.prototype.delete=EF;ll.prototype.get=PF;ll.prototype.has=kF;ll.prototype.set=IF;function ig(t){var e=-1,n=t?t.length:0;for(this.__data__=new ll;++e<n;)this.add(t[e])}function $F(t){return this.__data__.set(t,ox),this}function TF(t){return this.__data__.has(t)}ig.prototype.add=ig.prototype.push=$F;ig.prototype.has=TF;function fm(t,e){for(var n=t.length;n--;)if(NF(t[n][0],e))return n;return-1}function AF(t){if(!f3(t)||RF(t))return!1;var e=zF(t)||aF(t)?dF:Qz;return e.test(LF(t))}function MF(t,e,n){var r=-1,s=eF,o=t.length,i=!0,a=[],c=a;if(n)i=!1,s=tF;else if(o>=Wz){var l=e?null:OF(t);if(l)return u3(l);i=!1,s=oF,c=new ig}else c=e?[]:a;e:for(;++r<o;){var u=t[r],d=e?e(u):u;if(u=n||u!==0?u:0,i&&d===d){for(var h=c.length;h--;)if(c[h]===d)continue e;e&&c.push(d),a.push(u)}else s(c,d,n)||(c!==a&&c.push(d),a.push(u))}return a}var OF=Qy&&1/u3(new Qy([,-0]))[1]==Gz?function(t){return new Qy(t)}:FF;function pm(t,e){var n=t.__data__;return DF(e)?n[typeof e=="string"?"string":"hash"]:n.map}function cx(t,e){var n=iF(t,e);return AF(n)?n:void 0}function DF(t){var e=typeof t;return e=="string"||e=="number"||e=="symbol"||e=="boolean"?t!=="__proto__":t===null}function RF(t){return!!O_&&O_ in t}function LF(t){if(t!=null){try{return h3.call(t)}catch{}try{return t+""}catch{}}return""}function jF(t){return t&&t.length?MF(t):[]}function NF(t,e){return t===e||t!==t&&e!==e}function zF(t){var e=f3(t)?uF.call(t):"";return e==Yz||e==Xz}function f3(t){var e=typeof t;return!!t&&(e=="object"||e=="function")}function FF(){}var BF=jF;const UF=Sa(BF);function p3(t){return UF(t)}function HF(){const t=H(),e=S.useMemo(()=>t.store.query.records("instance_presence",()=>({userId:{neq:t.user.id}})),[t]),n=$T("userIds",()=>p3(e.value.map(r=>r.userId)).sort(),{isEqual:(r,s)=>{var o;return r.join(",")===((o=s.join)==null?void 0:o.call(s,","))}},[e]);return Y(n)}function g3(t){const e=H(),n=S.useMemo(()=>e.store.query.records("instance_presence",()=>({userId:{eq:t}})),[e,t]);return Y(`latestPresence:${t}`,()=>n.value.slice().sort((s,o)=>o.lastActivityTimestamp-s.lastActivityTimestamp)[0],[])??null}const KF=Ee(function(){const e=HF();return g.jsx(g.Fragment,{children:e.map(n=>g.jsx(VF,{collaboratorId:n},n))})}),VF=Ee(function({collaboratorId:e}){const n=H(),r=g3(e),s=GF(r);if(!(r&&r.currentPageId===n.currentPageId))return null;switch(s){case"inactive":{const{followingUserId:o,highlightedUserIds:i}=n.instanceState;if(!(o===r.userId||i.includes(r.userId)))return null;break}case"idle":{const{highlightedUserIds:o}=n.instanceState;if(r.followingUserId===n.user.id&&!(r.chatMessage||o.includes(r.userId)))return null;break}}return g.jsx(WF,{latestPresence:r})}),WF=Ee(function({latestPresence:e}){const n=H(),{CollaboratorBrush:r,CollaboratorScribble:s,CollaboratorCursor:o,CollaboratorHint:i,CollaboratorShapeIndicator:a}=on(),{viewportPageBounds:c,zoomLevel:l}=n,{userId:u,chatMessage:d,brush:h,scribble:f,selectedShapeIds:p,userName:m,cursor:v,color:w}=e,x=!(v.x<c.minX-12/l||v.y<c.minY-16/l||v.x>c.maxX-12/l||v.y>c.maxY-16/l);return g.jsxs(g.Fragment,{children:[h&&r?g.jsx(r,{className:"tl-collaborator__brush",brush:h,color:w,opacity:.1},u+"_brush"):null,x&&o?g.jsx(o,{className:"tl-collaborator__cursor",point:v,color:w,zoom:l,name:m!=="New User"?m:null,chatMessage:d},u+"_cursor"):i?g.jsx(i,{className:"tl-collaborator__cursor-hint",point:v,color:w,zoom:l,viewport:c},u+"_cursor_hint"):null,f&&s?g.jsx(s,{className:"tl-collaborator__scribble",scribble:f,color:w,zoom:l,opacity:f.color==="laser"?.5:.1},u+"_scribble"):null,a&&p.map(b=>g.jsx(a,{className:"tl-collaborator__shape-indicator",id:b,color:w,opacity:.5},u+"_"+b))]})});function D_(t){return t>s9?"inactive":t>QT?"idle":"active"}function GF(t){const e=S.useRef((t==null?void 0:t.lastActivityTimestamp)??-1),[n,r]=S.useState(()=>D_(Date.now()-e.current));return S.useEffect(()=>{const s=setInterval(()=>{r(D_(Date.now()-e.current))},o9);return()=>clearInterval(s)},[]),t&&(e.current=t.lastActivityTimestamp),n}const R_=Ee(function({id:e,shape:n,util:r,index:s,backgroundIndex:o,opacity:i,isCulled:a}){const c=H(),{ShapeErrorFallback:l}=on(),u=S.useRef(null),d=S.useRef(null),h=S.useCallback((p,m)=>{var v,w;(v=u.current)==null||v.style.setProperty(p,m),(w=d.current)==null||w.style.setProperty(p,m)},[]);Qi("set shape container transform position",()=>{if(!c.getShape(e))return;const m=c.getShapePageTransform(e),v=te.toCssString(m);h("transform",v)},[c,h]),Qi("set shape container clip path",()=>{if(!c.getShape(e))return null;const m=c.getShapeClipPath(e);h("clip-path",m??"none")},[c,h]),Qi("set shape height and width",()=>{const p=c.getShape(e);if(!p)return null;const m=c.getShapeGeometry(p).bounds;h("width",Math.max(1,Math.ceil(m.width))+"px"),h("height",Math.max(1,Math.ceil(m.height))+"px")},[c]),S.useLayoutEffect(()=>{var p,m;h("opacity",i+""),(p=u.current)==null||p.style.setProperty("z-index",s+""),(m=d.current)==null||m.style.setProperty("z-index",o+"")},[i,s,o,h]);const f=S.useCallback(p=>{c.annotateError(p,{origin:"react.shape",willCrashApp:!1})},[c]);return n?g.jsxs(g.Fragment,{children:[r.backgroundComponent&&g.jsx("div",{ref:d,className:"tl-shape tl-shape-background","data-shape-type":n.type,draggable:!1,children:!a&&g.jsx(Qu,{fallback:l,onError:f,children:g.jsx(XF,{shape:n,util:r})})}),g.jsx("div",{ref:u,className:"tl-shape","data-shape-type":n.type,draggable:!1,children:a?g.jsx(qF,{shape:n}):g.jsx(Qu,{fallback:l,onError:f,children:g.jsx(YF,{shape:n,util:r})})})]}):null}),YF=S.memo(function({shape:e,util:n}){return im("InnerShape:"+e.type,()=>n.component(e))},(t,e)=>t.shape.props===e.shape.props&&t.shape.meta===e.shape.meta),XF=S.memo(function({shape:e,util:n}){return im("InnerShape:"+e.type,()=>{var r;return(r=n.backgroundComponent)==null?void 0:r.call(n,e)})},(t,e)=>t.shape.props===e.shape.props&&t.shape.meta===e.shape.meta),qF=S.memo(function({shape:e}){const r=H().getShapeGeometry(e).bounds;return g.jsx("div",{className:"tl-shape__culled",style:{transform:`translate(${r.minX}px, ${r.minY}px)`,width:Math.max(1,r.width),height:Math.max(1,r.height)}})},()=>!0),lx=Ee(function(){const e=H(),{Background:n,SvgDefs:r}=on(),s=Z.useRef(null),o=Z.useRef(null);Vz(),kN(),EN(),Hz(s),b9(s),Qi("position layers",()=>{const c=o.current;if(!c)return;const{x:l,y:u,z:d}=e.camera,h=d>=1?Mw(d,[1,8],[.125,.5],!0):Mw(d,[.1,1],[-2,.125],!0);c.style.setProperty("transform",`scale(${R(d)}) translate(${R(l+h)}px,${R(u+h)}px)`)},[e]);const i=_N(),a=Y("shapeSvgDefs",()=>{const c=new Map;for(const l of ut(e.shapeUtils)){if(!l)return;const u=l.getCanvasSvgDefs();for(const{key:d,component:h}of u)c.has(d)||c.set(d,g.jsx(h,{},d))}return[...c.values()]},[e]);return Z.useEffect(()=>{var c;(c=s.current)==null||c.focus()},[]),g.jsxs("div",{ref:s,draggable:!1,className:"tl-canvas","data-testid":"canvas",...i,children:[n&&g.jsx(n,{}),g.jsx(QF,{}),g.jsx(fB,{}),g.jsxs("div",{ref:o,className:"tl-html-layer",draggable:!1,children:[g.jsx("svg",{className:"tl-svg-context",children:g.jsxs("defs",{children:[a,L_&&g.jsx(L_,{}),g.jsx(lB,{}),g.jsx(uB,{}),g.jsx(dB,{}),r&&g.jsx(r,{})]})}),g.jsx(gB,{}),g.jsx("div",{className:"tl-shapes",children:g.jsx(oB,{})}),g.jsxs("div",{className:"tl-overlays",children:[g.jsx(rB,{}),g.jsx(JF,{}),g.jsx(ZF,{}),g.jsx(eB,{}),g.jsx(iB,{}),g.jsx(aB,{}),g.jsx(cB,{}),g.jsx(tB,{}),g.jsx(pB,{}),g.jsx(KF,{})]})]})]})});function QF(){const t=H(),e=Y("gridSize",()=>t.documentSettings.gridSize,[t]),{x:n,y:r,z:s}=Y("camera",()=>t.camera,[t]),o=Y("isGridMode",()=>t.instanceState.isGridMode,[t]),{Grid:i}=on();return i&&o?g.jsx(i,{x:n,y:r,z:s,size:e}):null}function ZF(){const t=H(),e=Y("scribble",()=>t.instanceState.scribble,[t]),n=Y("zoomLevel",()=>t.zoomLevel,[t]),{Scribble:r}=on();return r&&e?g.jsx(r,{className:"tl-user-scribble",scribble:e,zoom:n}):null}function JF(){const t=H(),e=Y("brush",()=>t.instanceState.brush,[t]),{Brush:n}=on();return n&&e?g.jsx(n,{className:"tl-user-brush",brush:e}):null}function eB(){const t=H(),e=Y("zoomBrush",()=>t.instanceState.zoomBrush,[t]),{ZoomBrush:n}=on();return n&&e?g.jsx(n,{className:"tl-user-brush",brush:e}):null}function tB(){const t=H(),e=Y("snapLines",()=>t.snaps.lines,[t]),n=Y("zoomLevel",()=>t.zoomLevel,[t]),{SnapLine:r}=on();return r&&e.length>0?g.jsx(g.Fragment,{children:e.map(s=>g.jsx(r,{className:"tl-user-snapline",line:s,zoom:n},s.id))}):null}const nB=48;function rB(){const t=H(),{Handles:e}=on(),n=Y("zoomLevel",()=>t.zoomLevel,[t]),r=Y("onlySelectedShape",()=>t.onlySelectedShape,[t]),s=Y("isChangingStyle",()=>t.instanceState.isChangingStyle,[t]),o=Y("isChangingStyle",()=>t.instanceState.isReadonly,[t]),i=Y("handles",()=>t.onlySelectedShape?t.getShapeHandles(t.onlySelectedShape):void 0,[t]),a=Y("transform",()=>t.onlySelectedShape?t.getShapePageTransform(t.onlySelectedShape):void 0,[t]);if(!e||!r||s||o||!i||!a)return null;const c=[];for(let l=0,u=i[l];l<i.length;l++,u=i[l]){if(u.type!=="vertex"){const d=i[l-1],h=i[l+1];if(d&&h&&Math.hypot(d.y-h.y,d.x-h.x)<nB/n)continue}c.push(u)}return c.sort(l=>l.type==="vertex"?1:-1),g.jsx(e,{children:g.jsx("g",{transform:te.toCssString(a),children:c.map(l=>g.jsx(sB,{shapeId:r.id,handle:l},l.id))})})}function sB({shapeId:t,handle:e}){const n=Kz(t,e.id),{Handle:r}=on();return r?g.jsx("g",{"aria-label":"handle",transform:`translate(${e.x}, ${e.y})`,...n,children:g.jsx(r,{shapeId:t,handle:e})}):null}const oB=Ee(function(){const e=H(),{renderingShapes:n}=e;return xt.debugSvg.value?g.jsx(g.Fragment,{children:n.map(s=>g.jsxs(Z.Fragment,{children:[g.jsx(R_,{...s}),g.jsx(hB,{id:s.id})]},s.id+"_fragment"))}):g.jsx(g.Fragment,{children:n.map(s=>g.jsx(R_,{...s},s.id+"_shape"))})});function iB(){const t=H(),e=Y("selectedShapeIds",()=>t.currentPageState.selectedShapeIds,[t]);return Y("should display selected ids",()=>t.isInAny("select.idle","select.brushing","select.scribble_brushing","select.pointing_shape","select.pointing_selection","select.pointing_handle")&&!t.instanceState.isChangingStyle,[t])?g.jsx(g.Fragment,{children:e.map(r=>g.jsx(Dd,{className:"tl-user-indicator__selected",id:r},r+"_indicator"))}):null}const aB=function(){const e=H(),{HoveredShapeIndicator:n}=on(),r=Y("hovered id",()=>e.currentPageState.hoveredShapeId,[e]);return!r||!n?null:g.jsx(n,{shapeId:r})},cB=Ee(function(){const e=H(),n=Kp(e.hintingShapeIds);return n.length?g.jsx(g.Fragment,{children:n.map(r=>g.jsx(Dd,{className:"tl-user-indicator__hint",id:r},r+"_hinting"))}):null});function L_(){return g.jsxs("g",{id:"cursor",children:[g.jsxs("g",{fill:"rgba(0,0,0,.2)",transform:"translate(-11,-11)",children:[g.jsx("path",{d:"m12 24.4219v-16.015l11.591 11.619h-6.781l-.411.124z"}),g.jsx("path",{d:"m21.0845 25.0962-3.605 1.535-4.682-11.089 3.686-1.553z"})]}),g.jsxs("g",{fill:"white",transform:"translate(-12,-12)",children:[g.jsx("path",{d:"m12 24.4219v-16.015l11.591 11.619h-6.781l-.411.124z"}),g.jsx("path",{d:"m21.0845 25.0962-3.605 1.535-4.682-11.089 3.686-1.553z"})]}),g.jsxs("g",{fill:"currentColor",transform:"translate(-12,-12)",children:[g.jsx("path",{d:"m19.751 24.4155-1.844.774-3.1-7.374 1.841-.775z"}),g.jsx("path",{d:"m13 10.814v11.188l2.969-2.866.428-.139h4.768z"})]})]})}function lB(){return g.jsx("path",{id:"cursor_hint",fill:"currentColor",d:"M -2,-5 2,0 -2,5 Z"})}function uB(){return g.jsx("marker",{id:"arrowhead-dot",className:"tl-arrow-hint",refX:"3.0",refY:"3.0",orient:"0",children:g.jsx("circle",{cx:"3",cy:"3",r:"2",strokeDasharray:"100%"})})}function dB(){return g.jsxs("marker",{id:"arrowhead-cross",className:"tl-arrow-hint",refX:"3.0",refY:"3.0",orient:"auto",children:[g.jsx("line",{x1:"1.5",y1:"1.5",x2:"4.5",y2:"4.5",strokeDasharray:"100%"}),g.jsx("line",{x1:"1.5",y1:"4.5",x2:"4.5",y2:"1.5",strokeDasharray:"100%"})]})}const hB=Ee(function({id:e}){const n=H(),r=n.getShape(e),[s,o]=Z.useState(""),i=(r==null?void 0:r.parentId)===n.currentPageId;return Z.useEffect(()=>{if(!i)return;let a=null;const c=Td("shape to svg",async()=>{const l=Math.random();a=l;const u=n.getShapePageBounds(e),d=await n.getSvg([e],{padding:0});d&&u&&a===l&&(d.style.setProperty("overflow","visible"),d.setAttribute("preserveAspectRatio","xMidYMin slice"),d.style.setProperty("transform",`translate(${u.x}px, ${u.y+u.h+12}px)`),d.style.setProperty("border","1px solid black"),o(d==null?void 0:d.outerHTML))});return()=>{a=null,c()}},[n,e,i]),i?g.jsx("div",{style:{paddingTop:12,position:"absolute"},children:g.jsx("div",{style:{display:"flex"},dangerouslySetInnerHTML:{__html:s}})}):null}),fB=Ee(()=>{const t=xt.logMessages.value;return g.jsx("div",{className:"debug__ui-logger",children:t.map((e,n)=>{const r=typeof e=="string"?e:JSON.stringify(e);return g.jsx("div",{className:"debug__ui-logger__line",children:r},n)})})});function pB(){const t=H(),e=Y("selection rotation",()=>t.selectionRotation,[t]),n=Y("selection bounds",()=>t.selectionRotatedPageBounds,[t]),{SelectionForeground:r}=on();return!n||!r?null:g.jsx(r,{bounds:n,rotation:e})}function gB(){const t=H(),e=Y("selection rotation",()=>t.selectionRotation,[t]),n=Y("selection bounds",()=>t.selectionRotatedPageBounds,[t]),{SelectionBackground:r}=on();return!n||!r?null:g.jsx(r,{bounds:n,rotation:e})}function Ze(){return cm()}const m3="TLDRAW_USER_DATA_v3",y3=Ce({id:fe,name:fe,locale:fe,color:fe,isDarkMode:Pe,animationSpeed:pe,isSnapMode:Pe}),Zy={AddAnimationSpeed:1,AddIsSnapMode:2},ag=Ae({currentVersion:Zy.AddIsSnapMode,migrators:{[Zy.AddAnimationSpeed]:{up:t=>({...t,animationSpeed:1}),down:({animationSpeed:t,...e})=>e},[Zy.AddIsSnapMode]:{up:t=>({...t,isSnapMode:!1}),down:({isSnapMode:t,...e})=>e}}}),j_=["#FF802B","#EC5E41","#F2555A","#F04F88","#E34BA9","#BD54C6","#9D5BD2","#7B66DC","#02B1CC","#11B3A3","#39B178","#55B467"];function mB(){return j_[Math.floor(Math.random()*j_.length)]}function Bh(){return{id:Ze(),locale:typeof window<"u"?wN():"en",name:"New User",color:mB(),isDarkMode:!1,animationSpeed:1,isSnapMode:!1}}function v3(t){if(t===null||typeof t!="object"||!("version"in t)||!("user"in t)||typeof t.version!="number")return Bh();const e=G1({value:t.user,fromVersion:t.version,toVersion:ag.currentVersion??0,migrations:ag});if(e.type==="error")return Bh();try{y3.validate(e.value)}catch{return Bh()}return e.value}function yB(){var e;const t=typeof window>"u"?null:JSON.parse(((e=window==null?void 0:window.localStorage)==null?void 0:e.getItem(m3))||"null")??null;return v3(t)}const jd=Cn("globalUserData",yB());function vB(){typeof window<"u"&&window.localStorage&&window.localStorage.setItem(m3,JSON.stringify({version:ag.currentVersion,user:jd.value}))}function wB(t){y3.validate(t),jd.set(t),vB(),xB()}const SB=typeof process<"u"&&!1,Tc=typeof BroadcastChannel<"u"&&!SB?new BroadcastChannel("tldraw-user-sync"):null;Tc==null||Tc.addEventListener("message",t=>{const e=t.data;(e==null?void 0:e.type)===S3&&(e==null?void 0:e.origin)!==w3&&jd.set(v3(e.data))});const w3=Ze(),S3="tldraw-user-preferences-change";function xB(){Tc==null||Tc.postMessage({type:S3,origin:w3,data:{user:jd.value,version:ag.currentVersion}})}function x3(){return jd.value}function b3(t={}){return{derivePresenceState:t.derivePresenceState??(()=>X("presence",()=>null)),userPreferences:t.userPreferences??X("userPreferences",()=>x3()),setUserPreferences:t.setUserPreferences??wB}}var C3={exports:{}};(function(t){var e=Object.prototype.hasOwnProperty,n="~";function r(){}Object.create&&(r.prototype=Object.create(null),new r().__proto__||(n=!1));function s(c,l,u){this.fn=c,this.context=l,this.once=u||!1}function o(c,l,u,d,h){if(typeof u!="function")throw new TypeError("The listener must be a function");var f=new s(u,d||c,h),p=n?n+l:l;return c._events[p]?c._events[p].fn?c._events[p]=[c._events[p],f]:c._events[p].push(f):(c._events[p]=f,c._eventsCount++),c}function i(c,l){--c._eventsCount===0?c._events=new r:delete c._events[l]}function a(){this._events=new r,this._eventsCount=0}a.prototype.eventNames=function(){var l=[],u,d;if(this._eventsCount===0)return l;for(d in u=this._events)e.call(u,d)&&l.push(n?d.slice(1):d);return Object.getOwnPropertySymbols?l.concat(Object.getOwnPropertySymbols(u)):l},a.prototype.listeners=function(l){var u=n?n+l:l,d=this._events[u];if(!d)return[];if(d.fn)return[d.fn];for(var h=0,f=d.length,p=new Array(f);h<f;h++)p[h]=d[h].fn;return p},a.prototype.listenerCount=function(l){var u=n?n+l:l,d=this._events[u];return d?d.fn?1:d.length:0},a.prototype.emit=function(l,u,d,h,f,p){var m=n?n+l:l;if(!this._events[m])return!1;var v=this._events[m],w=arguments.length,x,b;if(v.fn){switch(v.once&&this.removeListener(l,v.fn,void 0,!0),w){case 1:return v.fn.call(v.context),!0;case 2:return v.fn.call(v.context,u),!0;case 3:return v.fn.call(v.context,u,d),!0;case 4:return v.fn.call(v.context,u,d,h),!0;case 5:return v.fn.call(v.context,u,d,h,f),!0;case 6:return v.fn.call(v.context,u,d,h,f,p),!0}for(b=1,x=new Array(w-1);b<w;b++)x[b-1]=arguments[b];v.fn.apply(v.context,x)}else{var C=v.length,E;for(b=0;b<C;b++)switch(v[b].once&&this.removeListener(l,v[b].fn,void 0,!0),w){case 1:v[b].fn.call(v[b].context);break;case 2:v[b].fn.call(v[b].context,u);break;case 3:v[b].fn.call(v[b].context,u,d);break;case 4:v[b].fn.call(v[b].context,u,d,h);break;default:if(!x)for(E=1,x=new Array(w-1);E<w;E++)x[E-1]=arguments[E];v[b].fn.apply(v[b].context,x)}}return!0},a.prototype.on=function(l,u,d){return o(this,l,u,d,!1)},a.prototype.once=function(l,u,d){return o(this,l,u,d,!0)},a.prototype.removeListener=function(l,u,d,h){var f=n?n+l:l;if(!this._events[f])return this;if(!u)return i(this,f),this;var p=this._events[f];if(p.fn)p.fn===u&&(!h||p.once)&&(!d||p.context===d)&&i(this,f);else{for(var m=0,v=[],w=p.length;m<w;m++)(p[m].fn!==u||h&&!p[m].once||d&&p[m].context!==d)&&v.push(p[m]);v.length?this._events[f]=v.length===1?v[0]:v:i(this,f)}return this},a.prototype.removeAllListeners=function(l){var u;return l?(u=n?n+l:l,this._events[u]&&i(this,u)):(this._events=new r,this._eventsCount=0),this},a.prototype.off=a.prototype.removeListener,a.prototype.addListener=a.prototype.on,a.prefixed=n,a.EventEmitter=a,t.exports=a})(C3);var bB=C3.exports;const CB=Sa(bB);function zn({children:t,className:e="",...n}){return g.jsx("svg",{...n,className:`tl-svg-container ${e}`,children:t})}class _a{constructor(e){y(this,"isFilled",!1);y(this,"isClosed",!0);y(this,"isSnappable",!0);y(this,"_vertices");y(this,"_bounds");y(this,"_snapPoints");y(this,"_area");this.isFilled=e.isFilled,this.isClosed=e.isClosed,this.isSnappable=e.isSnappable??!1}hitTestPoint(e,n=0,r=!1){return this.bounds.containsPoint(e,n)?this.distanceToPoint(e,r)<=n:!1}distanceToPoint(e,n=!1){const r=e.dist(this.nearestPoint(e));return this.isClosed&&(this.isFilled||n)&&fs(e,this.vertices)?-r:r}distanceToLineSegment(e,n){const r=this.nearestPointOnLineSegment(e,n),s=P.DistanceToLineSegment(e,n,r);return this.isClosed&&this.isFilled&&fs(r,this.vertices)?-s:s}hitTestLineSegment(e,n,r=0){return this.distanceToLineSegment(e,n)<=r}nearestPointOnLineSegment(e,n){let r=1/0,s;for(let o=0;o<this.vertices.length;o++){const i=this.vertices[o],a=P.DistanceToLineSegment(e,n,i);a<r&&(r=a,s=i)}if(!s)throw Error("nearest point not found");return s}isPointInBounds(e,n=0){const{bounds:r}=this;return!(e.x<r.minX-n||e.y<r.minY-n||e.x>r.maxX+n||e.y>r.maxY+n)}get vertices(){return this._vertices||(this._vertices=this.getVertices()),this._vertices}get outerVertices(){return this.vertices}getBounds(){return ae.FromPoints(this.vertices)}get bounds(){return this._bounds||(this._bounds=this.getBounds()),this._bounds}get snapPoints(){return this._snapPoints||(this._snapPoints=this.bounds.snapPoints),this._snapPoints}get center(){return this.bounds.center}get area(){return this._area||(this._area=this.getArea()),this._area}getArea(){if(!this.isClosed)return 0;const{vertices:e}=this;let n=0;for(let r=0,s=e.length;r<s;r++){const o=e[r],i=e[(r+1)%s];n+=o.x*i.y-i.x*o.y}return n/2}toSimpleSvgPath(){let e="";const{vertices:n}=this,r=n.length;if(r===0)return e;e+=`M${n[0].x},${n[0].y}`;for(let s=1;s<r;s++)e+=`L${n[s].x},${n[s].y}`;return this.isClosed&&(e+="Z"),e}}class Ki extends _a{constructor(n){super({...n,isClosed:!0,isFilled:!1});y(this,"children");y(this,"operation");const{children:r,operation:s}=n;if(r.length===0)throw Error("Group2d must have at least one child");this.operation=s,this.children=r}getVertices(){return this.children.flatMap(n=>n.vertices)}nearestPoint(n){let r=1/0,s;const{children:o,operation:i}=this;if(o.length===0)throw Error("no children");switch(i){case"union":{for(const a of o){const c=a.nearestPoint(n),l=c.dist(n);l<r&&(r=l,s=c)}if(!s)throw Error("nearest point not found");return s}case"subtract":throw Error("not implemented");case"exclude":throw Error("not implemented");case"intersect":throw Error("not implemented")}}distanceToPoint(n,r=!1){return Math.min(...this.children.map((s,o)=>s.distanceToPoint(n,r||o>0)))}hitTestPoint(n,r,s){const{operation:o}=this;if(s)return this.bounds.containsPoint(n,r);if(!(this.distanceToPoint(n,s)<=r))return!1;switch(o){case"union":return!0;case"subtract":throw Error("not implemented");case"exclude":throw Error("not implemented");case"intersect":throw Error("not implemented")}}hitTestLineSegment(n,r,s){const{children:o}=this;return o[0].hitTestLineSegment(n,r,s)}get outerVertices(){return this.children[0].vertices}getArea(){return this.children[0].area}toSimpleSvgPath(){let n="";for(const s of this.children)n+=s.toSimpleSvgPath();const r=ae.FromPoints(this.vertices).corners;for(let s=0,o=r.length;s<o;s++){const i=r[s],a=r[(s-1+o)%o],c=i.dist(a),l=r[(s+1)%o],u=i.dist(l),d=i.clone().lrp(a,4/c),h=i,f=i.clone().lrp(l,4/u);n+=`M${d.x},${d.y} L${h.x},${h.y} L${f.x},${f.y} `}return n}}function ux(t,e,n,r){const s=t.x-n.x,o=t.y-n.y,i=r.x-n.x,a=r.y-n.y,c=e.x-t.x,l=e.y-t.y,u=i*o-a*s,d=c*o-l*s,h=a*c-i*l;if(u===0||d===0||h===0)return null;if(h!==0){const f=u/h,p=d/h;if(0<=f&&f<=1&&0<=p&&p<=1)return P.AddXY(t,f*c,f*l)}return null}function gm(t,e,n,r){const s=(e.x-t.x)*(e.x-t.x)+(e.y-t.y)*(e.y-t.y),o=2*((e.x-t.x)*(t.x-n.x)+(e.y-t.y)*(t.y-n.y)),i=n.x*n.x+n.y*n.y+t.x*t.x+t.y*t.y-2*(n.x*t.x+n.y*t.y)-r*r,a=o*o-4*s*i;if(a<0||a===0)return null;const c=Math.sqrt(a),l=(-o+c)/(2*s),u=(-o-c)/(2*s);if((l<0||l>1)&&(u<0||u>1))return null;const d=[];return 0<=l&&l<=1&&d.push(P.Lrp(t,e,l)),0<=u&&u<=1&&d.push(P.Lrp(t,e,u)),d.length===0?null:d}function _3(t,e,n){const r=[];let s;for(let o=0,i=n.length-1;o<i;o++)s=ux(t,e,n[o],n[o+1]),s&&r.push(s);return r.length===0?null:r}function _B(t,e,n){const r=[];let s;for(let o=1,i=n.length;o<i+1;o++)s=ux(t,e,n[o-1],n[o%n.length]),s&&r.push(s);return r.length===0?null:r}function EB(t,e,n,r){let s=n.x-t.x,o=n.y-t.y;const i=Math.sqrt(s*s+o*o),a=(i*i-r*r+e*e)/(2*i),c=Math.sqrt(e*e-a*a);return s/=i,o/=i,[new P(t.x+s*a-o*c,t.y+o*a+s*c),new P(t.x+s*a+o*c,t.y+o*a-s*c)]}function N_(t,e,n){const r=[];let s,o,i;for(let a=0,c=n.length;a<c;a++)s=n[a],o=n[(a+1)%n.length],i=gm(s,o,t,e),i&&r.push(...i);return r.length===0?null:r}function z_(t,e,n){const r=[];let s,o,i;for(let a=1,c=n.length;a<c;a++)s=n[a-1],o=n[a],i=gm(s,o,t,e),i&&r.push(...i);return r.length===0?null:r}function Uh(t,e,n){return(n.y-t.y)*(e.x-t.x)>(e.y-t.y)*(n.x-t.x)}function E3(t,e,n,r){return Uh(t,n,r)!==Uh(e,n,r)&&Uh(t,e,n)!==Uh(t,e,r)}function Bw(t,e){const n=[];let r,s,o,i;for(let a=0,c=t.length;a<c;a++)r=t[a],fs(r,e)&&n.push(r);for(let a=0,c=e.length;a<c;a++)r=e[a],fs(r,t)&&n.push(r);for(let a=0,c=t.length;a<c;a++){r=t[a],s=t[(a+1)%t.length];for(let l=0,u=e.length;l<u;l++){o=e[l],i=e[(l+1)%e.length];const d=ux(r,s,o,i);d!==null&&n.push(d)}}return n.length===0?null:PB(n)}function PB(t){const e=P.Average(t);return t.sort((n,r)=>P.Angle(e,n)-P.Angle(e,r))}function kB(t,e){let n,r,s,o;for(let i=0,a=t.length;i<a;i++){n=t[i],r=t[(i+1)%a];for(let c=0,l=e.length;c<l;c++)if(s=e[c],o=e[(c+1)%l],E3(n,r,s,o))return!0}return!1}class cg extends _a{constructor(n){super({...n,isClosed:!1,isFilled:!1});y(this,"start");y(this,"end");y(this,"d");y(this,"u");y(this,"length");const{start:r,end:s}=n;this.start=r,this.end=s,this.d=r.clone().sub(s),this.u=this.d.clone().uni(),this.length=this.d.len()}midPoint(){return this.start.lrp(this.end,.5)}getVertices(){return[this.start,this.end]}nearestPoint(n){const{start:r,end:s,u:o}=this;if(r.equals(s))return r.clone();const i=r.clone().add(o.clone().mul(n.clone().sub(r).pry(o)));return i.x<Math.min(r.x,s.x)?r.x<s.x?r:s:i.x>Math.max(r.x,s.x)?r.x>s.x?r:s:i.y<Math.min(r.y,s.y)?r.y<s.y?r:s:i.y>Math.max(r.y,s.y)?r.y>s.y?r:s:i}hitTestLineSegment(n,r,s){return E3(n,r,this.start,this.end)}}class wi extends _a{constructor(n){super({isClosed:!1,isFilled:!1,...n});y(this,"points");y(this,"_segments");y(this,"_length");const{points:r}=n;this.points=r}get segments(){if(!this._segments){this._segments=[];const{vertices:n}=this;for(let r=0,s=n.length-1;r<s;r++){const o=n[r],i=n[r+1];this._segments.push(new cg({start:o,end:i}))}this.isClosed&&this._segments.push(new cg({start:n[n.length-1],end:n[0]}))}return this._segments}get length(){return this._length||(this._length=this.segments.reduce((n,r)=>n+r.length,0)),this._length}getVertices(){return this.points}nearestPoint(n){let r,s=1/0;if(this.points.length===1)return this.points[0];for(const o of this.segments){const i=o.nearestPoint(n),a=i.dist(n);a<s&&(r=i,s=a)}if(!r)throw Error("nearest point not found");return r}hitTestLineSegment(n,r,s){return this.segments.some(o=>o.hitTestLineSegment(n,r,s))}}class Mt extends wi{constructor(e){super({...e}),this.isClosed=!0}}class Ea extends Mt{constructor(n){const{x:r=0,y:s=0,width:o,height:i}=n;super({...n,points:[new P(r,s),new P(r+o,s),new P(r+o,s+i),new P(r,s+i)]});y(this,"x");y(this,"y");y(this,"w");y(this,"h");this.x=r,this.y=s,this.w=o,this.h=i}getBounds(){return new ae(this.x,this.y,this.w,this.h)}}class Hr{constructor(e){y(this,"canSnap",()=>!0);y(this,"canScroll",()=>!1);y(this,"canUnmount",()=>!0);y(this,"canBind",(e,n)=>!0);y(this,"canEdit",()=>!1);y(this,"canResize",()=>!0);y(this,"canCrop",()=>!1);y(this,"hideResizeHandles",()=>!1);y(this,"hideRotateHandle",()=>!1);y(this,"hideSelectionBoundsBg",()=>!1);y(this,"hideSelectionBoundsFg",()=>!1);y(this,"isAspectRatioLocked",()=>!1);y(this,"onBeforeCreate");y(this,"onBeforeUpdate");y(this,"onDragShapesOver");y(this,"onDragShapesOut");y(this,"onDropShapesOver");y(this,"onResizeStart");y(this,"onResize");y(this,"onResizeEnd");y(this,"onTranslateStart");y(this,"onTranslate");y(this,"onTranslateEnd");y(this,"onRotateStart");y(this,"onRotate");y(this,"onRotateEnd");y(this,"onHandleChange");y(this,"onBindingChange");y(this,"onChildrenChange");y(this,"onDoubleClickHandle");y(this,"onDoubleClickEdge");y(this,"onDoubleClick");y(this,"onClick");y(this,"onEditEnd");this.editor=e}providesBackgroundForChildren(e){return!1}getOutlineSegments(e){return[this.editor.getShapeGeometry(e).vertices]}canReceiveNewChildrenOfType(e,n){return!1}canDropShapes(e,n){return!1}expandSelectionOutlinePx(e){return 0}getCanvasSvgDefs(){return[]}}y(Hr,"props"),y(Hr,"migrations"),y(Hr,"type");function IB(t,e,n={}){const{closed:r=!1,snap:s=1,start:o="outset",end:i="outset",lengthRatio:a=2,style:c="dashed"}=n;let l=0,u=0,d=1,h=0,f=0;switch(c){case"dashed":{d=1,l=Math.min(e*a,t/4);break}case"dotted":{d=100,l=e/d;break}default:return{strokeDasharray:"none",strokeDashoffset:"none"}}return r||(o==="outset"?(t+=l/2,f+=l/2):o==="skip"&&(t-=l,f-=l),i==="outset"?t+=l/2:i==="skip"&&(t-=l)),u=Math.floor(t/l/(2*d)),u-=u%s,u<3&&c==="dashed"?t/e<5?(l=t,u=1,h=0):(l=t*.333,h=t*.333):(u=Math.max(u,3),l=t/u/(2*d),r?(f=l/2,h=(t-u*l)/u):h=(t-u*l)/Math.max(1,u-1)),{strokeDasharray:[l,h].join(" "),strokeDashoffset:f.toString()}}function F_({bounds:t,zoomLevel:e,className:n}){return g.jsx("g",{className:n,pointerEvents:"none",strokeLinecap:"round",strokeLinejoin:"round",children:t.sides.map((r,s)=>{const{strokeDasharray:o,strokeDashoffset:i}=IB(r[0].dist(r[1]),1/e,{style:"dashed",lengthRatio:4});return g.jsx("line",{x1:r[0].x,y1:r[0].y,x2:r[1].x,y2:r[1].y,strokeDasharray:o,strokeDashoffset:i},s)})})}class Rf extends Hr{constructor(){super(...arguments);y(this,"hideSelectionBoundsFg",()=>!0);y(this,"canBind",()=>!1);y(this,"onChildrenChange",n=>{const r=this.editor.getSortedChildIdsForParent(n.id);if(r.length===0){this.editor.currentPageState.focusedGroupId===n.id&&this.editor.popFocusLayer(),this.editor.deleteShapes([n.id]);return}else if(r.length===1){this.editor.currentPageState.focusedGroupId===n.id&&this.editor.popFocusLayer(),this.editor.reparentShapes(r,n.parentId),this.editor.deleteShapes([n.id]);return}})}getDefaultProps(){return{}}getGeometry(n){const r=this.editor.getSortedChildIdsForParent(n.id);return r.length===0?new Ea({width:1,height:1,isFilled:!1}):new Ki({children:r.map(s=>{const o=this.editor.getShape(s),i=this.editor.getShapeGeometry(s),a=this.editor.getShapeLocalTransform(o).applyToPoints(i.vertices);return i.isClosed?new Mt({points:a,isFilled:!0}):new wi({points:a})}),operation:"union"})}component(n){const{erasingShapeIdsSet:r,currentPageState:{hintingShapeIds:s,focusedGroupId:o},zoomLevel:i}=this.editor,a=r.has(n.id),c=s.length>0&&s.some(u=>u!==n.id&&this.editor.isShapeOfType(this.editor.getShape(u),"group"));if(!a&&(n.id!==o||c))return null;const l=this.editor.getShapeGeometry(n).bounds;return g.jsx(zn,{id:n.id,children:g.jsx(F_,{className:"tl-group",bounds:l,zoomLevel:i})})}indicator(n){const{camera:{z:r}}=this.editor,s=this.editor.getShapeGeometry(n).bounds;return g.jsx(F_,{className:"",bounds:s,zoomLevel:r})}}y(Rf,"type","group"),y(Rf,"props",nN),y(Rf,"migrations",rN);const P3=[Rf],$B=new Set(P3.map(t=>t.type));function k3(t){const e=[...P3],n=new Set;for(const r of t){if($B.has(r.type))throw new Error(`Shape type "${r.type}" is a core shapes type and cannot be overridden`);if(n.has(r.type))throw new Error(`Shape type "${r.type}" is defined more than once`);e.push(r),n.add(r.type)}return e}function B_(t,e){if(!e)return!1;switch(t.type){case"mixed":return e.type==="mixed";case"shared":return e.type==="shared"&&t.value===e.value;default:throw U1(t)}}class TB{constructor(e){y(this,"map");this.map=new Map(e)}get(e){return this.map.get(e)}getAsKnownValue(e){const n=this.get(e);if(n&&n.type!=="mixed")return n.value}get size(){return this.map.size}equals(e){if(this.size!==e.size)return!1;const n=new Set;for(const[r,s]of this){if(!B_(s,e.get(r)))return!1;n.add(r)}for(const[r,s]of e)if(!n.has(r)&&!B_(s,this.get(r)))return!1;return!0}keys(){return this.map.keys()}values(){return this.map.values()}entries(){return this.map.entries()}[Symbol.iterator](){return this.map[Symbol.iterator]()}}class Uw extends TB{set(e,n){this.map.set(e,n)}applyValue(e,n){const r=this.get(e);if(!r){this.set(e,{type:"shared",value:n});return}switch(r.type){case"mixed":return;case"shared":r.value!==n&&this.set(e,{type:"mixed"});return;default:U1(r,"type")}}}class dx{constructor(){y(this,"items",new WeakMap)}get(e,n){return this.items.has(e)||this.items.set(e,n(e)),this.items.get(e)}access(e){return this.items.get(e)}set(e,n){this.items.set(e,n)}has(e){return this.items.has(e)}invalidate(e){this.items.delete(e)}bust(){this.items=new WeakMap}}function AB(t,e,n){return fetch(t).then(function(r){return r.arrayBuffer()}).then(function(r){return new File([r],e,{type:n})})}function MB(t,e){var s;let n=t;const r=new Set(e);for(;r.has(n);)n=(s=/^.*(\d+)$/.exec(n))!=null&&s[1]?n.replace(/(\d+)(?=\D?)$/,o=>(+o+1).toString()):`${n} 1`;return n}const Hn="0123456789ABCDEFGHIJKLMNOPQRSTUVWXYZabcdefghijklmnopqrstuvwxyz",OB="a0",I3="A00000000000000000000000000";function $3(t){if(t>="a"&&t<="z")return t.charCodeAt(0)-"a".charCodeAt(0)+2;if(t>="A"&&t<="Z")return"Z".charCodeAt(0)-t.charCodeAt(0)+2;throw new Error("Invalid index key head: "+t)}function T3(t){if(t.length!==$3(t.charAt(0)))throw new Error("invalid integer part of index key: "+t)}function U_(t){if(t===void 0)throw Error("n is undefined")}function H_(t){T3(t);const[e,...n]=t.split("");let r=!0;for(let s=n.length-1;r&&s>=0;s--){const o=Hn.indexOf(n[s])+1;o===Hn.length?n[s]="0":(n[s]=Hn.charAt(o),r=!1)}if(r){if(e==="Z")return"a0";if(e==="z")return;const s=String.fromCharCode(e.charCodeAt(0)+1);return s>"a"?n.push("0"):n.pop(),s+n.join("")}else return e+n.join("")}function DB(t){T3(t);const[e,...n]=t.split("");let r=!0;for(let s=n.length-1;r&&s>=0;s--){const o=Hn.indexOf(n[s])-1;o===-1?n[s]=Hn.slice(-1):(n[s]=Hn.charAt(o),r=!1)}if(r){if(e==="a")return"Z"+Hn.slice(-1);if(e==="A")return;const s=String.fromCharCode(e.charCodeAt(0)-1);return s<"Z"?n.push(Hn.slice(-1)):n.pop(),s+n.join("")}else return e+n.join("")}function mc(t,e){if(e!==void 0&&t>=e)throw new Error(t+" >= "+e);if(t.slice(-1)==="0"||e&&e.slice(-1)==="0")throw new Error("trailing zero");if(e){let s=0;for(;(t.charAt(s)||"0")===e.charAt(s);)s++;if(s>0)return e.slice(0,s)+mc(t.slice(s),e.slice(s))}const n=t?Hn.indexOf(t.charAt(0)):0,r=e!==void 0?Hn.indexOf(e.charAt(0)):Hn.length;if(r-n>1){const s=Math.round(.5*(n+r));return Hn.charAt(s)}else return e&&e.length>1?e.slice(0,1):Hn.charAt(n)+mc(t.slice(1),void 0)}function ou(t){const e=$3(t.charAt(0));if(e>t.length)throw new Error("invalid index: "+t);return t.slice(0,e)}function K_(t){if(t===I3)throw new Error("invalid index: "+t);const e=ou(t);if(t.slice(e.length).slice(-1)==="0")throw new Error("invalid index: "+t)}function Ya(t,e){if(t!==void 0&&K_(t),e!==void 0&&K_(e),t!==void 0&&e!==void 0&&t>=e)throw new Error(t+" >= "+e);if(t===void 0&&e===void 0)return OB;if(t===void 0){if(e===void 0)throw Error("b is undefined");const a=ou(e),c=e.slice(a.length);if(a===I3)return a+mc("",c);if(a<e)return a;const l=DB(a);return U_(l),l}if(e===void 0){const a=ou(t),c=t.slice(a.length),l=H_(a);return l===void 0?a+mc(c,void 0):l}const n=ou(t),r=t.slice(n.length),s=ou(e),o=e.slice(s.length);if(n===s)return n+mc(r,o);const i=H_(n);return U_(i),i<e?i:n+mc(r,void 0)}function oi(t,e,n){if(n===0)return[];if(n===1)return[Ya(t,e)];if(e===void 0){let o=Ya(t,e);const i=[o];for(let a=0;a<n-1;a++)o=Ya(o,e),i.push(o);return i}if(t===void 0){let o=Ya(t,e);const i=[o];for(let a=0;a<n-1;a++)o=Ya(t,o),i.push(o);return i.reverse(),i}const r=Math.floor(n/2),s=Ya(t,e);return[...oi(t,s,r),s,...oi(s,e,n-r-1)]}function Yc(t,e,n){return oi(t,e,n)}function Jy(t,e){return oi(t,void 0,e)}function vu(t,e){return oi(t,e,1)[0]}function Ms(t){return oi(t,void 0,1)[0]}function RB(t){return oi(void 0,t,1)[0]}function A3(t,e="a1"){return[e,...oi(e,void 0,t)]}function Qt(t,e){return t.index<e.index?-1:t.index>e.index?1:0}function Hh(t,e,n){if(n.length===0)return[];const r=new Map;for(const o of me(n.map(i=>t.getShape(i)))){const{parentId:i}=o;r.has(i)||r.set(i,{children:me(t.getSortedChildIdsForParent(i).map(a=>t.getShape(a))),moving:new Set}),r.get(i).moving.add(o)}const s=[];switch(e){case"toBack":{r.forEach(({moving:o,children:i})=>LB(o,i,s));break}case"toFront":{r.forEach(({moving:o,children:i})=>jB(o,i,s));break}case"forward":{r.forEach(({moving:o,children:i})=>NB(o,i,s));break}case"backward":{r.forEach(({moving:o,children:i})=>zB(o,i,s));break}}return s}function LB(t,e,n){const r=e.length;if(t.size===r)return;let s,o;for(let i=0;i<r;i++){const a=e[i];if(t.has(a))s=a.index,t.delete(a);else{o=a.index;break}}if(t.size!==0){const i=Yc(s,o,t.size);n.push(...Array.from(t.values()).sort(Qt).map((a,c)=>({...a,index:i[c]})))}}function jB(t,e,n){const r=e.length;if(t.size===r)return;let s,o;for(let i=r-1;i>-1;i--){const a=e[i];if(t.has(a))o=a.index,t.delete(a);else{s=a.index;break}}if(t.size!==0){const i=Yc(s,o,t.size);n.push(...Array.from(t.values()).sort(Qt).map((a,c)=>({...a,index:i[c]})))}}function NB(t,e,n){var o;const r=e.length;if(t.size===r)return;let s={name:"skipping"};for(let i=0;i<r;i++){const a=t.has(e[i]);switch(s.name){case"skipping":{if(!a)continue;s={name:"selecting",selectIndex:i};break}case"selecting":{if(a)continue;const{selectIndex:c}=s;Yc(e[i].index,(o=e[i+1])==null?void 0:o.index,i-c).forEach((l,u)=>n.push({...e[c+u],index:l})),s={name:"skipping"};break}}}}function zB(t,e,n){var o;const r=e.length;if(t.size===r)return;let s={name:"skipping"};for(let i=r-1;i>-1;i--){const a=t.has(e[i]);switch(s.name){case"skipping":{if(!a)continue;s={name:"selecting",selectIndex:i};break}case"selecting":{if(a)continue;Yc((o=e[i-1])==null?void 0:o.index,e[i].index,s.selectIndex-i).forEach((c,l)=>{n.push({...e[i+l+1],index:c})}),s={name:"skipping"};break}}}}function M3({editor:t}){const{selectionRotation:e,selectionRotatedPageBounds:n,inputs:{originPagePoint:r},selectedShapes:s}=t;if(!n)return null;const o=n.center.clone().rotWith(n.point,e);return{selectionPageCenter:o,initialCursorAngle:o.angle(r),initialSelectionRotation:e,shapeSnapshots:s.map(i=>({shape:ei(i),initialPagePoint:t.getShapePageTransform(i.id).point()}))}}function Lf({delta:t,editor:e,snapshot:n,stage:r}){const{selectionPageCenter:s,shapeSnapshots:o}=n;e.updateShapes(o.map(({shape:a,initialPagePoint:c})=>{const l=ar(a.parentId)?e.getShapePageTransform(a.parentId):te.Identity(),u=P.RotWith(c,s,t),d=te.applyToPoint(te.Inverse(l),u),h=Us(a.rotation+t);return{id:a.id,type:a.type,x:d.x,y:d.y,rotation:h}}));const i=[];o.forEach(({shape:a})=>{var d,h,f;const c=e.getShape(a.id);if(!c)return;const l=e.getShapeUtil(a);if(r==="start"||r==="one-off"){const p=(d=l.onRotateStart)==null?void 0:d.call(l,a);p&&i.push(p)}const u=(h=l.onRotate)==null?void 0:h.call(l,a,c);if(u&&i.push(u),r==="end"||r==="one-off"){const p=(f=l.onRotateEnd)==null?void 0:f.call(l,a,c);p&&i.push(p)}}),i.length>0&&e.updateShapes(i)}const FB=t=>{const{store:e}=t,n=e.query.filterHistory("shape"),r=e.query.records("shape",()=>({type:{eq:"arrow"}}));function s(){const o=r.value,i={};for(const a of o){const{start:c,end:l}=a.props;if(c.type==="binding"){const u=i[c.boundShapeId];u?u.push({arrowId:a.id,handleId:"start"}):i[c.boundShapeId]=[{arrowId:a.id,handleId:"start"}]}if(l.type==="binding"){const u=i[l.boundShapeId];u?u.push({arrowId:a.id,handleId:"end"}):i[l.boundShapeId]=[{arrowId:a.id,handleId:"end"}]}}return i}return X("arrowBindingsIndex",(o,i)=>{if(Ic(o))return s();const a=o,c=n.getDiffSince(i);if(c===Gn)return s();let l;function u(f){l||(l={...a}),l[f]?l[f]===a[f]&&(l[f]=[...l[f]]):l[f]=[]}function d(f,p,m){u(f),l[f]=l[f].filter(v=>v.arrowId!==p||v.handleId!==m),l[f].length===0&&delete l[f]}function h(f,p,m){u(f),l[f].push({arrowId:p,handleId:m})}for(const f of c){for(const p of Object.values(f.added))if(t.isShapeOfType(p,"arrow")){const{start:m,end:v}=p.props;m.type==="binding"&&h(m.boundShapeId,p.id,"start"),v.type==="binding"&&h(v.boundShapeId,p.id,"end")}for(const[p,m]of Object.values(f.updated))if(!(!t.isShapeOfType(p,"arrow")||!t.isShapeOfType(m,"arrow")))for(const v of["start","end"]){const w=p.props[v],x=m.props[v];w.type==="binding"&&x.type==="point"?d(w.boundShapeId,p.id,v):w.type==="point"&&x.type==="binding"?h(x.boundShapeId,m.id,v):w.type==="binding"&&x.type==="binding"&&w.boundShapeId!==x.boundShapeId&&(d(w.boundShapeId,p.id,v),h(x.boundShapeId,m.id,v))}for(const p of Object.values(f.removed))if(t.isShapeOfType(p,"arrow")){const{start:m,end:v}=p.props;m.type==="binding"&&d(m.boundShapeId,p.id,"start"),v.type==="binding"&&d(v.boundShapeId,p.id,"end")}}return l??a})},BB=t=>{const e=t.query.ids("shape");function n(){const r={},s=e.value,o=Array(s.size);return s.forEach(i=>o.push(t.get(i))),o.sort(Qt),o.forEach(i=>{r[i.parentId]||(r[i.parentId]=[]),r[i.parentId].push(i.id)}),r}return X("parentsToChildrenWithIndexes",(r,s)=>{if(Ic(r))return n();const o=t.history.getDiffSince(s);if(o===Gn)return n();if(o.length===0)return r;let i=null;const a=u=>{i||(i={...r}),i[u]?i[u]===r[u]&&(i[u]=[...i[u]]):i[u]=[]},c=new Set;let l;for(let u=0,d=o.length;u<d;u++){l=o[u];for(const h of Object.values(l.added))Hi(h)&&(a(h.parentId),i[h.parentId].push(h.id),c.add(i[h.parentId]));for(const[h,f]of Object.values(l.updated))if(Hi(f)&&Hi(h)){if(h.parentId!==f.parentId)a(h.parentId),a(f.parentId),i[h.parentId].splice(i[h.parentId].indexOf(f.id),1),i[f.parentId].push(f.id),c.add(i[f.parentId]);else if(h.index!==f.index){a(f.parentId);const p=i[f.parentId].indexOf(f.id);i[f.parentId][p]=f.id,c.add(i[f.parentId])}}for(const h of Object.values(l.removed))Hi(h)&&(a(h.parentId),i[h.parentId].splice(i[h.parentId].indexOf(h.id),1))}for(const u of c){const d=u.map(h=>t.get(h));d.sort(Qt),u.splice(0,u.length,...d.map(h=>h.id))}return i??r})},e0=(t,e,n)=>{for(;!wn(n.parentId);){const r=t.get(n.parentId);if(!r)return!1;n=r}return n.parentId===e},UB=(t,e)=>{const n=t.query.ids("shape");let r=null;function s(){const o=e();return r=o,new Set([...n.value].filter(i=>e0(t,o,t.get(i))))}return X("_shapeIdsInCurrentPage",(o,i)=>{if(Ic(o))return s();const a=e();if(a!==r)return s();const c=t.history.getDiffSince(i);if(c===Gn)return s();const l=new Af(o);for(const d of c){for(const h of Object.values(d.added))Hi(h)&&e0(t,a,h)&&l.add(h.id);for(const[h,f]of Object.values(d.updated))Hi(f)&&(e0(t,a,f)?l.add(f.id):l.remove(f.id));for(const h of Object.keys(d.removed))ar(h)&&l.remove(h)}const u=l.get();return u?ru(u.value,u.diff):o})},HB=40;class KB{constructor(e){y(this,"_clickId","");y(this,"_clickTimeout");y(this,"_clickScreenPoint");y(this,"_previousScreenPoint");y(this,"_getClickTimeout",(e,n=Ze())=>{this._clickId=n,clearTimeout(this._clickTimeout),this._clickTimeout=setTimeout(()=>{if(this._clickState===e&&this._clickId===n){switch(this._clickState){case"pendingTriple":{this.editor.dispatch({...this.lastPointerInfo,type:"click",name:"double_click",phase:"settle"});break}case"pendingQuadruple":{this.editor.dispatch({...this.lastPointerInfo,type:"click",name:"triple_click",phase:"settle"});break}case"pendingOverflow":{this.editor.dispatch({...this.lastPointerInfo,type:"click",name:"quadruple_click",phase:"settle"});break}}this._clickState="idle"}},e==="idle"||e==="pendingDouble"?e9:t9)});y(this,"_clickState","idle");y(this,"lastPointerInfo",{});y(this,"transformPointerDownEvent",e=>{if(!this._clickState)return e;switch(this._clickScreenPoint=P.From(e.point),this._previousScreenPoint&&this._previousScreenPoint.dist(this._clickScreenPoint)>HB&&(this._clickState="idle"),this._previousScreenPoint=this._clickScreenPoint,this.lastPointerInfo=e,this._clickState){case"idle":return this._clickState="pendingDouble",this._clickTimeout=this._getClickTimeout(this._clickState),e;case"pendingDouble":return this._clickState="pendingTriple",this._clickTimeout=this._getClickTimeout(this._clickState),{...e,type:"click",name:"double_click",phase:"down"};case"pendingTriple":return this._clickState="pendingQuadruple",this._clickTimeout=this._getClickTimeout(this._clickState),{...e,type:"click",name:"triple_click",phase:"down"};case"pendingQuadruple":return this._clickState="pendingOverflow",this._clickTimeout=this._getClickTimeout(this._clickState),{...e,type:"click",name:"quadruple_click",phase:"down"};case"pendingOverflow":return this._clickState="overflow",this._clickTimeout=this._getClickTimeout(this._clickState),e;default:return this._clickTimeout=this._getClickTimeout(this._clickState),e}});y(this,"transformPointerUpEvent",e=>{if(!this._clickState)return e;switch(this._clickScreenPoint=P.From(e.point),this._clickState){case"pendingTriple":return{...this.lastPointerInfo,type:"click",name:"double_click",phase:"up"};case"pendingQuadruple":return{...this.lastPointerInfo,type:"click",name:"triple_click",phase:"up"};case"pendingOverflow":return{...this.lastPointerInfo,type:"click",name:"quadruple_click",phase:"up"};default:return e}});y(this,"cancelDoubleClickTimeout",()=>{this._clickTimeout=clearTimeout(this._clickTimeout),this._clickState="idle"});y(this,"handleMove",()=>{this._clickState!=="idle"&&this._clickScreenPoint&&this._clickScreenPoint.dist(this.editor.inputs.currentScreenPoint)>(this.editor.instanceState.isCoarsePointer?Nw:Ju)&&this.cancelDoubleClickTimeout()});this.editor=e}get clickState(){return this._clickState}}class VB{constructor(e){y(this,"isSafari");y(this,"isIos");y(this,"isChromeForIos");y(this,"isFirefox");y(this,"isAndroid");this.editor=e,typeof window<"u"&&"navigator"in window?(this.isSafari=/^((?!chrome|android).)*safari/i.test(navigator.userAgent),this.isIos=!!navigator.userAgent.match(/iPad/i)||!!navigator.userAgent.match(/iPhone/i),this.isChromeForIos=/crios.*safari/i.test(navigator.userAgent),this.isFirefox=/firefox/i.test(navigator.userAgent),this.isAndroid=/android/i.test(navigator.userAgent)):(this.isSafari=!1,this.isIos=!1,this.isChromeForIos=!1,this.isFirefox=!1,this.isAndroid=!1)}}function Di(t){if(t){let e=V_;for(;t.length;)e=e.push(t.pop());return e}return V_}class WB{constructor(){y(this,"length",0);y(this,"head",null);y(this,"tail",this)}push(e){return new hx(e,this)}toArray(){return Fs}[Symbol.iterator](){return{next(){return{value:void 0,done:!0}}}}}const V_=new WB;class hx{constructor(e,n){y(this,"length");this.head=e,this.tail=n,this.length=n.length+1}push(e){return new hx(e,this)}toArray(){return Array.from(this)}[Symbol.iterator](){let e=this;return{next(){if(e.length){const n=e.head;return e=e.tail,{value:n,done:!1}}else return{value:void 0,done:!0}}}}}class GB{constructor(e,n){y(this,"_undos",Cn("HistoryManager.undos",Di()));y(this,"_redos",Cn("HistoryManager.redos",Di()));y(this,"_batchDepth",0);y(this,"onBatchComplete",()=>{});y(this,"_commands",{});y(this,"createCommand",(e,n,r)=>{if(this._commands[e])throw new Error(`Duplicate command: ${e}`);this._commands[e]=r;const s=(...o)=>{if(!this._batchDepth)return this.batch(()=>s(...o)),this.ctx;const i=n(...o);if(!i)return this.ctx;const{data:a,ephemeral:c,squashing:l,preservesRedoStack:u}=i;if(this.ignoringUpdates((d,h)=>(r.do(a),{undos:d,redos:h})),!c){const d=this._undos.value.head;l&&d&&d.type==="command"&&d.name===e&&d.preservesRedoStack===u?this._undos.update(h=>h.tail.push({...d,id:Ze(),data:r.squash(d.data,a)})):this._undos.update(h=>h.push({type:"command",name:e,data:a,id:Ze(),preservesRedoStack:u})),i.preservesRedoStack||this._redos.set(Di()),this.ctx.emit("change-history",{reason:"push"})}return this.ctx};return s});y(this,"batch",e=>{try{this._batchDepth++,this._batchDepth===1?ur(()=>{var r,s;const n=(r=this._undos.value.head)==null?void 0:r.id;e(),n!==((s=this._undos.value.head)==null?void 0:s.id)&&this.onBatchComplete()}):e()}catch(n){throw this.annotateError(n),n}finally{this._batchDepth--}return this});y(this,"ignoringUpdates",e=>{let n=this._undos.value,r=this._redos.value;this._undos.set(Di()),this._redos.set(Di());try{({undos:n,redos:r}=ur(()=>e(n,r)))}finally{this._undos.set(n),this._redos.set(r)}});y(this,"_undo",({pushToRedoStack:e,toMark:n=void 0})=>(this.ignoringUpdates((r,s)=>{var o;if(r.length===0)return{undos:r,redos:s};for(;((o=r.head)==null?void 0:o.type)==="STOP";){const i=r.head;if(r=r.tail,e&&(s=s.push(i)),i.id===n)return this.ctx.emit("change-history",e?{reason:"undo"}:{reason:"bail",markId:n}),{undos:r,redos:s}}if(r.length===0)return this.ctx.emit("change-history",e?{reason:"undo"}:{reason:"bail",markId:n}),{undos:r,redos:s};for(;r.head;){const i=r.head;if(r=r.tail,e&&(s=s.push(i)),i.type==="STOP"){if(i.onUndo&&(!n||i.id===n))return this.ctx.emit("change-history",e?{reason:"undo"}:{reason:"bail",markId:n}),{undos:r,redos:s}}else this._commands[i.name].undo(i.data)}return this.ctx.emit("change-history",e?{reason:"undo"}:{reason:"bail",markId:n}),{undos:r,redos:s}}),this));y(this,"undo",()=>(this._undo({pushToRedoStack:!0}),this));y(this,"redo",()=>(this.ignoringUpdates((e,n)=>{var r;if(n.length===0)return{undos:e,redos:n};for(;((r=n.head)==null?void 0:r.type)==="STOP";)e=e.push(n.head),n=n.tail;if(n.length===0)return this.ctx.emit("change-history",{reason:"redo"}),{undos:e,redos:n};for(;n.head;){const s=n.head;if(e=e.push(n.head),n=n.tail,s.type==="STOP"){if(s.onRedo)break}else{const o=this._commands[s.name];o.redo?o.redo(s.data):o.do(s.data)}}return this.ctx.emit("change-history",{reason:"redo"}),{undos:e,redos:n}}),this));y(this,"bail",()=>(this._undo({pushToRedoStack:!1}),this));y(this,"bailToMark",e=>(this._undo({pushToRedoStack:!1,toMark:e}),this));y(this,"mark",(e=Ze(),n=!0,r=!0)=>{const s=this._undos.value.head;return s&&s.type==="STOP"&&s.id===e&&s.onUndo===n&&s.onRedo===r?s.id:(this._undos.update(o=>o.push({type:"STOP",id:e,onUndo:n,onRedo:r})),this.ctx.emit("mark-history",{id:e}),e)});this.ctx=e,this.annotateError=n}get numUndos(){return this._undos.value.length}get numRedos(){return this._redos.value.length}clear(){this._undos.set(Di()),this._redos.set(Di())}}class YB{constructor(e){y(this,"_beforeCreateHandlers",{});y(this,"_afterCreateHandlers",{});y(this,"_beforeChangeHandlers",{});y(this,"_afterChangeHandlers",{});y(this,"_beforeDeleteHandlers",{});y(this,"_afterDeleteHandlers",{});y(this,"_batchCompleteHandlers",[]);this.editor=e,e.store.onBeforeCreate=(r,s)=>{const o=this._beforeCreateHandlers[r.typeName];if(o){let i=r;for(const a of o)i=a(i,s);return i}return r},e.store.onAfterCreate=(r,s)=>{const o=this._afterCreateHandlers[r.typeName];if(o)for(const i of o)i(r,s)},e.store.onBeforeChange=(r,s,o)=>{const i=this._beforeChangeHandlers[s.typeName];if(i){let a=s;for(const c of i)a=c(r,a,o);return a}return s};let n=0;e.store.onAfterChange=(r,s,o)=>{if(n++,n>1e3)console.error("[CleanupManager.onAfterChange] Maximum update depth exceeded, bailing out.");else{const i=this._afterChangeHandlers[s.typeName];if(i)for(const a of i)a(r,s,o)}n--},e.store.onBeforeDelete=(r,s)=>{const o=this._beforeDeleteHandlers[r.typeName];if(o){for(const i of o)if(i(r,s)===!1)return!1}},e.store.onAfterDelete=(r,s)=>{const o=this._afterDeleteHandlers[r.typeName];if(o)for(const i of o)i(r,s)},e.history.onBatchComplete=()=>{this._batchCompleteHandlers.forEach(r=>r())}}registerBeforeCreateHandler(e,n){this._beforeCreateHandlers[e]||(this._beforeCreateHandlers[e]=[]),this._beforeCreateHandlers[e].push(n)}registerAfterCreateHandler(e,n){this._afterCreateHandlers[e]||(this._afterCreateHandlers[e]=[]),this._afterCreateHandlers[e].push(n)}registerBeforeChangeHandler(e,n){this._beforeChangeHandlers[e]||(this._beforeChangeHandlers[e]=[]),this._beforeChangeHandlers[e].push(n)}registerAfterChangeHandler(e,n){this._afterChangeHandlers[e]||(this._afterChangeHandlers[e]=[]),this._afterChangeHandlers[e].push(n)}registerBeforeDeleteHandler(e,n){this._beforeDeleteHandlers[e]||(this._beforeDeleteHandlers[e]=[]),this._beforeDeleteHandlers[e].push(n)}registerAfterDeleteHandler(e,n){this._afterDeleteHandlers[e]||(this._afterDeleteHandlers[e]=[]),this._afterDeleteHandlers[e].push(n)}registerBatchCompleteHandler(e){this._batchCompleteHandlers.push(e)}}var XB=Object.defineProperty,qB=Object.getOwnPropertyDescriptor,Pa=(t,e,n,r)=>{for(var s=r>1?void 0:r?qB(e,n):e,o=t.length-1,i;o>=0;o--)(i=t[o])&&(s=(r?i(e,n,s):i(s))||s);return r&&s&&XB(e,n,s),s};const ce=t=>Math.round(t*10**8)/10**8;function $s(t,e,n,r,s,o){if(o>100)return[];const i=t.filter(c=>(r==="forward"?c.startNode.id===e:c.endNode.id===e)&&ce(c.length)===ce(n)&&Or(c.breadthIntersection[0],c.breadthIntersection[1],s[0],s[1]));if(i.length===0)return[];const a=new Set;for(const c of i){const l=r==="forward"?c.endNode.id:c.startNode.id;a.has(l)||(a.add(l),i.push(...$s(t,l,n,r,Or(c.breadthIntersection[0],c.breadthIntersection[1],s[0],s[1]),o+1)))}return i}function QB(t){t.sort((e,n)=>n.gaps.length-e.gaps.length);for(let e=t.length-1;e>0;e--){const n=t[e];for(let r=e-1;r>=0;r--){const s=t[r];if(s.direction===n.direction&&n.gaps.every(o=>s.gaps.some(i=>ce(o.startEdge[0].x)===ce(i.startEdge[0].x)&&ce(o.startEdge[0].y)===ce(i.startEdge[0].y)&&ce(o.startEdge[1].x)===ce(i.startEdge[1].x)&&ce(o.startEdge[1].y)===ce(i.startEdge[1].y))&&s.gaps.some(i=>ce(o.endEdge[0].x)===ce(i.endEdge[0].x)&&ce(o.endEdge[0].y)===ce(i.endEdge[0].y)&&ce(o.endEdge[1].x)===ce(i.endEdge[1].x)&&ce(o.endEdge[1].y)===ce(i.endEdge[1].y)))){t.splice(e,1);break}}}}class Si{constructor(e){y(this,"_snapLines",Cn("snapLines",void 0));this.editor=e}get lines(){return this._snapLines.value??Fs}clear(){this.lines.length&&this._snapLines.set(void 0)}setLines(e){this._snapLines.set(e)}get snapPointsCache(){const{editor:e}=this;return e.store.createComputedCache("snapPoints",n=>{const r=e.getShapePageTransform(n.id);return r?this.editor.getShapeGeometry(n).snapPoints.map((o,i)=>{const{x:a,y:c}=te.applyToPoint(r,o);return{x:a,y:c,id:`${n.id}:${i}`}}):void 0})}get snapThreshold(){return 8/this.editor.zoomLevel}get snappableShapes(){const{editor:e}=this,{selectedShapeIds:n,renderingBounds:r}=e,s=[],o=i=>{const a=e.getSortedChildIdsForParent(i);for(const c of a){if(n.includes(c))continue;const l=e.getShape(c);if(!l||!e.getShapeUtil(l).canSnap(l))continue;const d=e.getShapePageBounds(c);if(d&&r.includes(d)){if(e.isShapeOfType(l,"group")){o(c);continue}s.push({id:c,pageBounds:d,isClosed:e.getShapeGeometry(l).isClosed})}}};return o(this.currentCommonAncestor??e.currentPageId),s}get currentCommonAncestor(){return this.editor.findCommonAncestor(this.editor.selectedShapes)}get snappablePoints(){const{snappableShapes:e,snapPointsCache:n}=this,r=[];return e.forEach(s=>{const o=n.get(s.id);o&&r.push(...o)}),r}get visibleGaps(){const e=[],n=[];let r,s;const o=this.snappableShapes.sort((a,c)=>a.pageBounds.minX-c.pageBounds.minX);for(let a=0;a<o.length;a++){r=o[a];for(let c=a+1;c<o.length;c++)s=o[c],r.pageBounds.maxX<s.pageBounds.minX&&Fl(r.pageBounds.minY,r.pageBounds.maxY,s.pageBounds.minY,s.pageBounds.maxY)&&e.push({startNode:r,endNode:s,startEdge:[new P(r.pageBounds.maxX,r.pageBounds.minY),new P(r.pageBounds.maxX,r.pageBounds.maxY)],endEdge:[new P(s.pageBounds.minX,s.pageBounds.minY),new P(s.pageBounds.minX,s.pageBounds.maxY)],length:s.pageBounds.minX-r.pageBounds.maxX,breadthIntersection:Or(r.pageBounds.minY,r.pageBounds.maxY,s.pageBounds.minY,s.pageBounds.maxY)})}const i=o.sort((a,c)=>a.pageBounds.minY-c.pageBounds.minY);for(let a=0;a<i.length;a++){r=i[a];for(let c=a+1;c<i.length;c++)s=i[c],r.pageBounds.maxY<s.pageBounds.minY&&Fl(r.pageBounds.minX,r.pageBounds.maxX,s.pageBounds.minX,s.pageBounds.maxX)&&n.push({startNode:r,endNode:s,startEdge:[new P(r.pageBounds.minX,r.pageBounds.maxY),new P(r.pageBounds.maxX,r.pageBounds.maxY)],endEdge:[new P(s.pageBounds.minX,s.pageBounds.minY),new P(s.pageBounds.maxX,s.pageBounds.minY)],length:s.pageBounds.minY-r.pageBounds.maxY,breadthIntersection:Or(r.pageBounds.minX,r.pageBounds.maxX,s.pageBounds.minX,s.pageBounds.maxX)})}return{horizontal:e,vertical:n}}snapTranslate({lockedAxis:e,initialSelectionPageBounds:n,initialSelectionSnapPoints:r,dragDelta:s}){var v,w;const{snappablePoints:o,snapThreshold:i}=this,a=n.clone().translate(s),c=r.map(({x,y:b},C)=>({id:"selection:"+C,x:x+s.x,y:b+s.y})),l=o,u=[],d=[],h=new P(i,i);this.collectPointSnaps({minOffset:h,nearestSnapsX:u,nearestSnapsY:d,otherNodeSnapPoints:l,selectionSnapPoints:c}),this.collectGapSnaps({selectionPageBounds:a,nearestSnapsX:u,nearestSnapsY:d,minOffset:h});const f=new P(e==="x"?0:((v=u[0])==null?void 0:v.nudge)??0,e==="y"?0:((w=d[0])==null?void 0:w.nudge)??0);h.x=0,h.y=0,u.length=0,d.length=0,c.forEach(x=>{x.x+=f.x,x.y+=f.y}),a.translate(f),this.collectPointSnaps({minOffset:h,nearestSnapsX:u,nearestSnapsY:d,otherNodeSnapPoints:l,selectionSnapPoints:c}),this.collectGapSnaps({selectionPageBounds:a,nearestSnapsX:u,nearestSnapsY:d,minOffset:h});const p=this.getPointSnapLines({nearestSnapsX:u,nearestSnapsY:d}),m=this.getGapSnapLines({selectionPageBounds:a,nearestSnapsX:u,nearestSnapsY:d});return this._snapLines.set([...m,...p]),{nudge:f}}get outlinesInPageSpace(){return this.snappableShapes.map(({id:e,isClosed:n})=>{const r=kn(this.editor.getShapeGeometry(e).vertices);n&&r.push(r[0]);const s=this.editor.getShapePageTransform(e);if(!s)throw Error("No page transform");return te.applyToPoints(s,r)})}getSnappingHandleDelta({handlePoint:e,additionalSegments:n}){const{outlinesInPageSpace:r,snapThreshold:s}=this;let o=s,i=null,a,c,l,u;const d=[...r,...n];for(const h of d)for(let f=0;f<h.length-1;f++)a=h[f],c=h[f+1],l=P.NearestPointOnLineSegment(a,c,e),u=P.Dist(e,l),!isNaN(u)&&u<o&&(o=u,i=l);return i?(this._snapLines.set([{id:Ze(),type:"points",points:[i]}]),P.Sub(i,e)):null}snapResize({initialSelectionPageBounds:e,dragDelta:n,handle:r,isAspectRatioLocked:s,isResizingFromCenter:o}){var k,I;const{snapThreshold:i}=this,{box:a,scaleX:c,scaleY:l}=ae.Resize(e,r,o?n.x*2:n.x,o?n.y*2:n.y,s);let u=r;c<0&&(u=jN(u)),l<0&&(u=LN(u)),o&&(a.center=e.center);const d=u==="top"||u==="bottom",h=u==="left"||u==="right",f=W_(u,a),p=this.snappablePoints,m=[],v=[],w=new P(i,i);this.collectPointSnaps({minOffset:w,nearestSnapsX:m,nearestSnapsY:v,otherNodeSnapPoints:p,selectionSnapPoints:f});const x=new P(d?0:((k=m[0])==null?void 0:k.nudge)??0,h?0:((I=v[0])==null?void 0:I.nudge)??0);if(s&&NN(u)&&x.len()!==0){const $=m.length&&v.length?Math.abs(x.x)<Math.abs(x.y)?"x":"y":m.length?"x":"y",A=e.aspectRatio;$==="x"?(v.length=0,x.y=x.x/A,(u==="bottom_left"||u==="top_right")&&(x.y=-x.y)):(m.length=0,x.x=x.y*A,(u==="bottom_left"||u==="top_right")&&(x.x=-x.x))}const b=P.Add(n,x),{box:C}=ae.Resize(e,r,o?b.x*2:b.x,o?b.y*2:b.y,s);o&&(C.center=e.center);const E=W_("any",C);m.length=0,v.length=0,w.x=0,w.y=0,this.collectPointSnaps({minOffset:w,nearestSnapsX:m,nearestSnapsY:v,otherNodeSnapPoints:p,selectionSnapPoints:E});const _=this.getPointSnapLines({nearestSnapsX:m,nearestSnapsY:v});return this._snapLines.set([..._]),{nudge:x}}collectPointSnaps({selectionSnapPoints:e,otherNodeSnapPoints:n,minOffset:r,nearestSnapsX:s,nearestSnapsY:o}){for(const i of e)for(const a of n){const c=P.Sub(i,a),l=Math.abs(c.x),u=Math.abs(c.y);ce(l)<=ce(r.x)&&(ce(l)<ce(r.x)&&(s.length=0),s.push({type:"points",points:{thisPoint:i,otherPoint:a},nudge:a.x-i.x}),r.x=l),ce(u)<=ce(r.y)&&(ce(u)<ce(r.y)&&(o.length=0),o.push({type:"points",points:{thisPoint:i,otherPoint:a},nudge:a.y-i.y}),r.y=u)}}collectGapSnaps({selectionPageBounds:e,minOffset:n,nearestSnapsX:r,nearestSnapsY:s}){const{horizontal:o,vertical:i}=this.visibleGaps;for(const a of o){if(!Fl(a.breadthIntersection[0],a.breadthIntersection[1],e.minY,e.maxY))continue;const l=a.startEdge[0].x+a.length/2-e.center.x;if(a.length>e.width&&ce(Math.abs(l))<=ce(n.x)){ce(Math.abs(l))<ce(n.x)&&(r.length=0),n.x=Math.abs(l);const w={type:"gap_center",gap:a,nudge:l},x=r.find(({type:C})=>C==="gap_center"),b=x&&Or(a.breadthIntersection[0],a.breadthIntersection[1],x.gap.breadthIntersection[0],x.gap.breadthIntersection[1]);x&&x.gap.length>a.length&&b?r[r.indexOf(x)]=w:(!x||!b)&&r.push(w)}const d=a.startNode.pageBounds.minX-a.length,h=e.maxX,f=d-h;ce(Math.abs(f))<=ce(n.x)&&(ce(Math.abs(f))<ce(n.x)&&(r.length=0),n.x=Math.abs(f),r.push({type:"gap_duplicate",gap:a,protrusionDirection:"left",nudge:f}));const p=a.endNode.pageBounds.maxX+a.length,m=e.minX,v=p-m;ce(Math.abs(v))<=ce(n.x)&&(ce(Math.abs(v))<ce(n.x)&&(r.length=0),n.x=Math.abs(v),r.push({type:"gap_duplicate",gap:a,protrusionDirection:"right",nudge:v}))}for(const a of i){if(!Fl(a.breadthIntersection[0],a.breadthIntersection[1],e.minX,e.maxX))continue;const l=a.startEdge[0].y+a.length/2-e.center.y;if(a.length>e.height&&ce(Math.abs(l))<=ce(n.y)){ce(Math.abs(l))<ce(n.y)&&(s.length=0),n.y=Math.abs(l);const w={type:"gap_center",gap:a,nudge:l},x=s.find(({type:C})=>C==="gap_center"),b=x&&Fl(x.gap.breadthIntersection[0],x.gap.breadthIntersection[1],a.breadthIntersection[0],a.breadthIntersection[1]);x&&x.gap.length>a.length&&b?s[s.indexOf(x)]=w:(!x||!b)&&s.push(w);continue}const d=a.startNode.pageBounds.minY-a.length,h=e.maxY,f=d-h;ce(Math.abs(f))<=ce(n.y)&&(ce(Math.abs(f))<ce(n.y)&&(s.length=0),n.y=Math.abs(f),s.push({type:"gap_duplicate",gap:a,protrusionDirection:"top",nudge:f}));const p=a.endNode.pageBounds.maxY+a.length,m=e.minY,v=p-m;ce(Math.abs(v))<=ce(n.y)&&(ce(Math.abs(v))<ce(n.y)&&(s.length=0),n.y=Math.abs(v),s.push({type:"gap_duplicate",gap:a,protrusionDirection:"bottom",nudge:v}))}}getPointSnapLines({nearestSnapsX:e,nearestSnapsY:n}){const r={},s={};if(e.length>0){for(const o of e)if(o.type==="points"){const i=ce(o.points.otherPoint.x);r[i]||(r[i]=[]),r[i].push(o.points)}}if(n.length>0){for(const o of n)if(o.type==="points"){const i=ce(o.points.otherPoint.y);s[i]||(s[i]=[]),s[i].push(o.points)}}return Object.values(r).concat(Object.values(s)).map(o=>({id:Ze(),type:"points",points:Kp(o.map(i=>P.From(i.otherPoint)).concat(o.map(i=>P.From(i.thisPoint))),(i,a)=>i.equals(a))}))}getGapSnapLines({selectionPageBounds:e,nearestSnapsX:n,nearestSnapsY:r}){const{vertical:s,horizontal:o}=this.visibleGaps,i={top:e.sides[0],right:e.sides[1],bottom:[e.corners[3],e.corners[2]],left:[e.corners[0],e.corners[3]]},a=[];if(n.length>0)for(const c of n){if(c.type==="points")continue;const{gap:{breadthIntersection:l,startEdge:u,startNode:d,endNode:h,length:f,endEdge:p}}=c;switch(c.type){case"gap_center":{const m=(f-e.width)/2,v=Or(l[0],l[1],e.minY,e.maxY);a.push({type:"gaps",direction:"horizontal",id:Ze(),gaps:[...$s(o,d.id,m,"backward",v,0),{startEdge:u,endEdge:i.left},{startEdge:i.right,endEdge:p},...$s(o,h.id,m,"forward",v,0)]});break}case"gap_duplicate":{const m=Or(l[0],l[1],e.minY,e.maxY);a.push({type:"gaps",direction:"horizontal",id:Ze(),gaps:c.protrusionDirection==="left"?[{startEdge:i.right,endEdge:u.map(v=>v.clone().addXY(-d.pageBounds.width,0))},{startEdge:u,endEdge:p},...$s(o,h.id,f,"forward",m,0)]:[...$s(o,d.id,f,"backward",m,0),{startEdge:u,endEdge:p},{startEdge:p.map(v=>v.clone().addXY(c.gap.endNode.pageBounds.width,0)),endEdge:i.left}]});break}}}if(r.length>0)for(const c of r){if(c.type==="points")continue;const{gap:{breadthIntersection:l,startEdge:u,startNode:d,endNode:h,length:f,endEdge:p}}=c;switch(c.type){case"gap_center":{const m=(f-e.height)/2,v=Or(l[0],l[1],e.minX,e.maxX);a.push({type:"gaps",direction:"vertical",id:Ze(),gaps:[...$s(s,d.id,m,"backward",v,0),{startEdge:u,endEdge:i.top},{startEdge:i.bottom,endEdge:p},...$s(s,c.gap.endNode.id,m,"forward",v,0)]});break}case"gap_duplicate":{const m=Or(l[0],l[1],e.minX,e.maxX);a.push({type:"gaps",direction:"vertical",id:Ze(),gaps:c.protrusionDirection==="top"?[{startEdge:i.bottom,endEdge:u.map(v=>v.clone().addXY(0,-d.pageBounds.height))},{startEdge:u,endEdge:p},...$s(s,h.id,f,"forward",m,0)]:[...$s(s,d.id,f,"backward",m,0),{startEdge:u,endEdge:p},{startEdge:p.map(v=>v.clone().addXY(0,h.pageBounds.height)),endEdge:i.top}]})}break}}return QB(a),a}}Pa([X],Si.prototype,"snapPointsCache",1);Pa([X],Si.prototype,"snapThreshold",1);Pa([X],Si.prototype,"snappableShapes",1);Pa([X],Si.prototype,"currentCommonAncestor",1);Pa([X],Si.prototype,"snappablePoints",1);Pa([X],Si.prototype,"visibleGaps",1);Pa([X],Si.prototype,"outlinesInPageSpace",1);function W_(t,e){const{minX:n,maxX:r,minY:s,maxY:o}=e,i=[];switch(t){case"top":case"left":case"top_left":case"any":i.push({id:"top_left",handle:"top_left",x:n,y:s})}switch(t){case"top":case"right":case"top_right":case"any":i.push({id:"top_right",handle:"top_right",x:r,y:s})}switch(t){case"bottom":case"right":case"bottom_right":case"any":i.push({id:"bottom_right",handle:"bottom_right",x:r,y:o})}switch(t){case"bottom":case"left":case"bottom_left":case"any":i.push({id:"bottom_left",handle:"bottom_left",x:n,y:o})}return i}const ZB=/\r?\n|\r/g;function JB(t){return t.replace(ZB,`
`).split(`
`).map(e=>e||" ").join(`
`)}const eU={start:"left","start-legacy":"left",middle:"center","middle-legacy":"center",end:"right","end-legacy":"right"},tU=/\s/;class nU{constructor(e){y(this,"measureText",(e,n)=>{const r=this.getTextElement();r.setAttribute("dir","ltr"),r.style.setProperty("font-family",n.fontFamily),r.style.setProperty("font-style",n.fontStyle),r.style.setProperty("font-weight",n.fontWeight),r.style.setProperty("font-size",n.fontSize+"px"),r.style.setProperty("line-height",n.lineHeight*n.fontSize+"px"),r.style.setProperty("width",n.width),r.style.setProperty("min-width",n.minWidth??null),r.style.setProperty("max-width",n.maxWidth),r.style.setProperty("padding",n.padding),r.textContent=JB(e);const s=r.getBoundingClientRect();return{x:0,y:0,w:s.width,h:s.height}});this.editor=e}getTextElement(){const e=document.querySelector(".tl-text-measure");e==null||e.remove();const n=document.createElement("div");return this.editor.getContainer().appendChild(n),n.id=`__textMeasure_${Ze()}`,n.classList.add("tl-text"),n.classList.add("tl-text-measure"),n.tabIndex=-1,n}measureElementTextNodeSpans(e,{shouldTruncateToFirstLine:n=!1}={}){const r=[],s=e.getBoundingClientRect(),o=-s.left,i=-s.top,a=new Range,c=e.childNodes[0];let l=0,u=null,d=null,h=0,f=!1;for(const p of e.childNodes)if(p.nodeType===Node.TEXT_NODE)for(const m of p.textContent??""){a.setStart(c,l),a.setEnd(c,l+m.length);const v=a.getClientRects(),w=v[v.length-1],x=w.top+i,b=w.left+o,C=w.right+o,E=tU.test(m);if(E!==d||x!==h||!u){if(u){if(n&&x!==h){f=!0;break}r.push(u)}u={box:{x:b,y:x,w:w.width,h:w.height},text:m}}else u.box.w=C-u.box.x,u.text+=m;d=E,h=x,l+=m.length}return u&&r.push(u),{spans:r,didTruncate:f}}measureTextSpans(e,n){const r=n.overflow==="truncate-ellipsis"||n.overflow==="truncate-clip",s=this.getTextElement(),o=Math.ceil(n.width-n.padding*2);s.style.setProperty("width",`${o}px`),s.style.setProperty("height","min-content"),s.style.setProperty("dir","ltr"),s.style.setProperty("font-size",`${n.fontSize}px`),s.style.setProperty("font-family",n.fontFamily),s.style.setProperty("font-weight",n.fontWeight),s.style.setProperty("line-height",`${n.lineHeight*n.fontSize}px`),s.style.setProperty("text-align",eU[n.textAlign]),r&&(s.style.setProperty("overflow-wrap","anywhere"),s.style.setProperty("word-break","break-all")),s.textContent=e;const{spans:i,didTruncate:a}=this.measureElementTextNodeSpans(s,{shouldTruncateToFirstLine:r});if(n.overflow==="truncate-ellipsis"&&a){s.textContent="";const c=Math.ceil(this.measureElementTextNodeSpans(s).spans[0].box.w);s.style.setProperty("width",`${o-c}px`),s.textContent=e;const l=this.measureElementTextNodeSpans(s,{shouldTruncateToFirstLine:!0}).spans,u=l[l.length-1];return l.push({text:"",box:{x:Math.min(u.box.x+u.box.w,n.width-n.padding-c),y:u.box.y,w:c,h:u.box.h}}),l}return s.remove(),i}}class rU{constructor(e){y(this,"raf");y(this,"isPaused",!0);y(this,"last",0);y(this,"t",0);y(this,"start",()=>{this.isPaused=!1,cancelAnimationFrame(this.raf),this.raf=requestAnimationFrame(this.tick),this.last=Date.now()});y(this,"tick",()=>{if(this.isPaused)return;const e=Date.now(),n=e-this.last;if(this.last=e,this.t+=n,this.editor.emit("frame",n),this.t<16){this.raf=requestAnimationFrame(this.tick);return}this.t-=16,this.updatePointerVelocity(n),this.editor.emit("tick",n),this.raf=requestAnimationFrame(this.tick)});y(this,"dispose",()=>{this.isPaused=!0,cancelAnimationFrame(this.raf)});y(this,"prevPoint",new P);y(this,"updatePointerVelocity",e=>{const{prevPoint:n,editor:{inputs:{currentScreenPoint:r,pointerVelocity:s}}}=this;if(e===0)return;const o=P.Sub(r,n);this.prevPoint=r.clone();const i=o.len(),a=i?o.div(i):new P(0,0),c=s.clone().lrp(a.mul(i/e),.5);Math.abs(c.x)<.01&&(c.x=0),Math.abs(c.y)<.01&&(c.y=0),s.equals(c)||(this.editor.inputs.pointerVelocity=c)});this.editor=e,this.editor.disposables.add(this.dispose),this.start()}}var sU=Object.defineProperty,oU=Object.getOwnPropertyDescriptor,xi=(t,e,n,r)=>{for(var s=r>1?void 0:r?oU(e,n):e,o=t.length-1,i;o>=0;o--)(i=t[o])&&(s=(r?i(e,n,s):i(s))||s);return r&&s&&sU(e,n,s),s};class uo{constructor(e){y(this,"updateUserPreferences",e=>{this.user.setUserPreferences({...this.userPreferences,...e})});this.user=e}get userPreferences(){return this.user.userPreferences.value}get isDarkMode(){return this.userPreferences.isDarkMode}get animationSpeed(){return this.userPreferences.animationSpeed}get id(){return this.userPreferences.id}get name(){return this.userPreferences.name}get locale(){return this.userPreferences.locale}get color(){return this.userPreferences.color}get isSnapMode(){return this.userPreferences.isSnapMode}}xi([X],uo.prototype,"userPreferences",1);xi([X],uo.prototype,"isDarkMode",1);xi([X],uo.prototype,"animationSpeed",1);xi([X],uo.prototype,"id",1);xi([X],uo.prototype,"name",1);xi([X],uo.prototype,"locale",1);xi([X],uo.prototype,"color",1);xi([X],uo.prototype,"isSnapMode",1);function Ul(t){return Math.abs(t.props.bend)<8}function lg(t,e){if(e.type==="point")return;const n=t.getShape(e.boundShapeId),r=t.getShapePageTransform(n),s=t.getShapeGeometry(n);return{shape:n,transform:r,isClosed:s.isClosed,isExact:e.isExact,didIntersect:!1,outline:s.outerVertices}}function G_(t,e,n){if(n.type==="point")return P.From(n);const r=t.getShape(n.boundShapeId);if(r){const{point:s,size:o}=t.getShapeGeometry(r).bounds,i=P.Add(s,P.MulV(n.normalizedAnchor,o)),a=te.applyToPoint(t.getShapePageTransform(r),i);return te.applyToPoint(te.Inverse(e),a)}else return new P(0,0)}function jr(t,e){const n=t.getShapePageTransform(e),r=G_(t,n,e.props.start),s=G_(t,n,e.props.end);return{start:r,end:s}}const Vi=48,ug=10,iU=10,Fo={s:2,m:3.5,l:5,xl:10};function wu(t,e){const{start:n,end:r,arrowheadStart:s,arrowheadEnd:o}=e.props,i=jr(t,e),a=i.start.clone(),c=i.end.clone(),l=P.Med(a,c),u=P.Sub(c,a).uni(),d=lg(t,n),h=lg(t,r),f=t.getShapePageTransform(e);Y_(c,i.start,f,h),Y_(a,i.end,f,d);let p=Vi;const m=d&&h&&d.shape===h.shape;d&&h&&!m&&!d.isExact&&!h.isExact&&(h.didIntersect&&!d.didIntersect?d.isClosed&&a.setTo(P.Nudge(c,a,p)):h.didIntersect||h.isClosed&&c.setTo(P.Nudge(a,c,p)));const v=P.Sub(c,a).uni(),w=!P.Equals(v,u);if(!m){if(d&&s!=="none"&&!d.isExact){const b=ug+Fo[e.props.size]/2+("size"in d.shape.props?Fo[d.shape.props.size]/2:0);p-=b,a.nudge(c,b*(w?-1:1))}if(h&&o!=="none"&&!h.isExact){const b=ug+Fo[e.props.size]/2+("size"in h.shape.props?Fo[h.shape.props.size]/2:0);p-=b,c.nudge(a,b*(w?-1:1))}}d&&h&&(w?c.setTo(P.Add(a,v.mul(-p))):P.Dist(a,c)<Vi/2&&c.setTo(P.Add(a,v.mul(Vi/2)))),w?l.setTo(P.Med(i.start,i.end)):l.setTo(P.Med(a,c));const x=P.Dist(a,c);return{isStraight:!0,start:{handle:i.start,point:a,arrowhead:e.props.arrowheadStart},end:{handle:i.end,point:c,arrowhead:e.props.arrowheadEnd},middle:l,isValid:x>0,length:x}}function Y_(t,e,n,r){if(r===void 0||r.isExact)return;const s=te.applyToPoint(n,e),o=te.applyToPoint(n,t),i=te.applyToPoint(te.Inverse(r.transform),s),a=te.applyToPoint(te.Inverse(r.transform),o),c=r.isClosed,u=(c?_B:_3)(i,a,r.outline);let d;if(u!==null&&(d=u.sort((p,m)=>P.Dist(p,i)-P.Dist(m,i))[0]??(c?void 0:a)),d===void 0)return;const h=te.applyToPoint(r.transform,d),f=te.applyToPoint(te.Inverse(n),h);t.setTo(f),r.didIntersect=!0}function aU(t){return O3(t.start.handle,t.end.handle)}function t0(t){return O3(t.start.point,t.end.point)}function O3(t,e){return`M${t.x},${t.y}L${e.x},${e.y}`}function n0(t,e,n=0){const{arrowheadEnd:r,arrowheadStart:s}=e.props,o=e.props.bend+n;if(Math.abs(o)>Math.abs(e.props.bend*iU))return wu(t,e);const i=jr(t,e),a=P.Med(i.start,i.end),c=P.Sub(i.end,i.start).uni(),l=P.Add(a,c.per().mul(-o)),u=lg(t,e.props.start),d=lg(t,e.props.end),h=i.start.clone(),f=i.end.clone(),p=l.clone(),m=X_(h,f,p);if(m.length===0||m.size===0||!f_(m.length)||!f_(m.size))return wu(t,e);const v=t.getShapePageTransform(e);if(u&&!u.isExact){const E=te.applyToPoint(v,h),_=te.applyToPoint(v,f),k=te.applyToPoint(v,m.center),I=te.Inverse(u.transform),$=te.applyToPoint(I,E),A=te.applyToPoint(I,_),D=te.applyToPoint(I,k),{isClosed:L}=u,j=L?N_:z_;let M,B=j(D,m.radius,t.getShapeGeometry(u.shape).vertices);if(B){B=B.filter(F=>+P.Clockwise($,F,A)===m.sweepFlag);const U=P.Angle(m.center,l),q=P.Angle(m.center,i.start),N=Oi(U,q,.5);B.sort((F,K)=>Math.abs(os(N,D.angle(F)))-Math.abs(os(N,D.angle(K)))),M=B[0]??(L?void 0:$)}else M=L?void 0:$;if(M&&(h.setTo(t.getPointInShapeSpace(e,te.applyToPoint(u.transform,M))),u.didIntersect=!0,s!=="none")){const U=ug+Fo[e.props.size]/2+("size"in u.shape.props?Fo[u.shape.props.size]/2:0);h.setTo(Ao(m.center.x,m.center.y,m.radius,Oi(P.Angle(m.center,h),P.Angle(m.center,l),U/Math.abs(Fh(m.center,m.radius,h,l)))))}}if(d&&!d.isExact){const E=te.applyToPoint(v,h),_=te.applyToPoint(v,f),k=te.applyToPoint(v,m.center),I=te.Inverse(d.transform),$=te.applyToPoint(I,E),A=te.applyToPoint(I,_),D=te.applyToPoint(I,k),L=d.isClosed,j=L?N_:z_,M=P.Angle(m.center,l),B=P.Angle(m.center,i.end),U=Oi(M,B,.5);let q,N=j(D,m.radius,t.getShapeGeometry(d.shape).outerVertices);if(N?(N=N.filter(F=>+P.Clockwise($,F,A)===m.sweepFlag),N.sort((F,K)=>Math.abs(os(U,D.angle(F)))-Math.abs(os(U,D.angle(K)))),q=N[0]??(L?void 0:A)):q=L?void 0:A,q&&(f.setTo(t.getPointInShapeSpace(e,te.applyToPoint(d.transform,q))),d.didIntersect=!0,r!=="none")){let F=ug+Fo[e.props.size]/2+("size"in d.shape.props?Fo[d.shape.props.size]/2:0);P.Dist(h,f)<Vi&&(F*=-2),f.setTo(Ao(m.center.x,m.center.y,m.radius,Oi(P.Angle(m.center,f),P.Angle(m.center,l),F/Math.abs(Fh(m.center,m.radius,f,l)))))}}if(Math.abs(Fh(m.center,m.radius,h,f))<Vi/2&&(h.setTo(i.start),f.setTo(i.end)),u&&d&&u.shape!==d.shape&&!u.isExact&&!d.isExact){const E=P.Angle(m.center,h),_=P.Angle(m.center,f),k=m.sweepFlag?Vi:-Vi,I=Fh(m.center,m.radius,f,h),{center:{x:$,y:A},radius:D}=m;u&&!u.didIntersect&&h.setTo(Ao($,A,D,Oi(E,_,k/I))),d&&!d.didIntersect&&f.setTo(Ao($,A,D,Oi(E,_,-k/I)))}let x=Oi(P.Angle(m.center,h),P.Angle(m.center,f),.5),b=Ao(m.center.x,m.center.y,m.radius,x);+P.Clockwise(h,b,f)!==m.sweepFlag&&(x+=$e,b=Ao(m.center.x,m.center.y,m.radius,x)),p.setTo(b);const C=X_(h,f,p);return{isStraight:!1,start:{point:h,handle:i.start,arrowhead:e.props.arrowheadStart},end:{point:f,handle:i.end,arrowhead:e.props.arrowheadEnd},middle:p,handleArc:m,bodyArc:C,isValid:C.length!==0&&isFinite(C.center.x)&&isFinite(C.center.y)}}function cU(t){const{start:e,end:n,handleArc:{radius:r,largeArcFlag:s,sweepFlag:o}}=t;return`M${e.handle.x},${e.handle.y} A${r} ${r} 0 ${s} ${o} ${n.handle.x},${n.handle.y}`}function r0(t){const{start:e,end:n,bodyArc:{radius:r,largeArcFlag:s,sweepFlag:o}}=t;return`M${e.point.x},${e.point.y} A${r} ${r} 0 ${s} ${o} ${n.point.x},${n.point.y}`}function X_(t,e,n){const r=-2*(t.x*(e.y-n.y)-t.y*(e.x-n.x)+e.x*n.y-n.x*e.y),s={x:((t.x*t.x+t.y*t.y)*(n.y-e.y)+(e.x*e.x+e.y*e.y)*(t.y-n.y)+(n.x*n.x+n.y*n.y)*(e.y-t.y))/r,y:((t.x*t.x+t.y*t.y)*(e.x-n.x)+(e.x*e.x+e.y*e.y)*(n.x-t.x)+(n.x*n.x+n.y*n.y)*(t.x-e.x))/r},o=P.Dist(s,t),i=+P.Clockwise(t,n,e),a=Math.hypot(t.y-e.y,t.x-e.x),c=Math.hypot(e.y-n.y,e.x-n.x),l=Math.hypot(n.y-t.y,n.x-t.x),u=Math.acos((c*c+l*l-a*a)/(2*c*l))*2,d=+($e>u),h=(Oe-u)*(i?1:-1),f=h*o;return{center:s,radius:o,size:h,length:f,largeArcFlag:d,sweepFlag:i}}const lU={wheel:"onWheel",pointer_down:"onPointerDown",pointer_move:"onPointerMove",pointer_up:"onPointerUp",right_click:"onRightClick",middle_click:"onMiddleClick",key_down:"onKeyDown",key_up:"onKeyUp",key_repeat:"onKeyRepeat",cancel:"onCancel",complete:"onComplete",interrupt:"onInterrupt",double_click:"onDoubleClick",triple_click:"onTripleClick",quadruple_click:"onQuadrupleClick"};var uU=Object.defineProperty,dU=Object.getOwnPropertyDescriptor,hU=(t,e,n,r)=>{for(var s=r>1?void 0:r?dU(e,n):e,o=t.length-1,i;o>=0;o--)(i=t[o])&&(s=(r?i(e,n,s):i(s))||s);return r&&s&&uU(e,n,s),s};class re{constructor(e,n){y(this,"path");y(this,"id");y(this,"current");y(this,"type");y(this,"shapeType");y(this,"initial");y(this,"children");y(this,"parent");y(this,"isActive",!1);y(this,"_currentToolIdMask",Cn("curent tool id mask",void 0));y(this,"onWheel");y(this,"onPointerDown");y(this,"onPointerMove");y(this,"onPointerUp");y(this,"onDoubleClick");y(this,"onTripleClick");y(this,"onQuadrupleClick");y(this,"onRightClick");y(this,"onMiddleClick");y(this,"onKeyDown");y(this,"onKeyUp");y(this,"onKeyRepeat");y(this,"onCancel");y(this,"onComplete");y(this,"onInterrupt");y(this,"onEnter");y(this,"onExit");this.editor=e;const{id:r,children:s,initial:o}=this.constructor;this.id=r,this.current=Cn("toolState"+this.id,void 0),this.path=X("toolPath"+this.id,()=>{const i=this.current.value;return this.id+(i?`.${i.path.value}`:"")}),this.parent=n??{},this.parent?s&&o?(this.type="branch",this.initial=o,this.children=Object.fromEntries(s().map(i=>[i.id,new i(this.editor,this)])),this.current.set(this.children[this.initial])):this.type="leaf":(this.type="root",s&&o&&(this.initial=o,this.children=Object.fromEntries(s().map(i=>[i.id,new i(this.editor,this)])),this.current.set(this.children[this.initial])))}transition(e,n){var o;const r=e.split(".");let s=this;for(let i=0;i<r.length;i++){const a=r[i],c=s.current.value,l=(o=s.children)==null?void 0:o[a];if(!l)throw Error(`${s.id} - no child state exists with the id ${a}.`);if((c==null?void 0:c.id)!==l.id&&(c==null||c.exit(n,a),s.current.set(l),l.enter(n,(c==null?void 0:c.id)||"initial"),!l.isActive))break;s=l}return this}handleEvent(e){var s;const n=lU[e.name],r=this.current.value;(s=this[n])==null||s.call(this,e),this.current.value===r&&this.isActive&&(r==null||r.handleEvent(e))}enter(e,n){var r;if(this.isActive=!0,(r=this.onEnter)==null||r.call(this,e,n),this.children&&this.initial&&this.isActive){const s=this.children[this.initial];this.current.set(s),s.enter(e,n)}}exit(e,n){var r,s;this.isActive=!1,(r=this.onExit)==null||r.call(this,e,n),this.isActive||(s=this.current.value)==null||s.exit(e,n)}get currentToolIdMask(){return this._currentToolIdMask.value}set currentToolIdMask(e){this._currentToolIdMask.set(e)}}y(re,"id"),y(re,"initial"),y(re,"children");hU([X],re.prototype,"currentToolIdMask",1);class jf extends re{constructor(){super(...arguments);y(this,"onKeyDown",n=>{var r;switch(n.code){case"KeyZ":{if(!(n.shiftKey||n.ctrlKey)){const s=this.current.value;s&&((r=s.current.value)==null?void 0:r.id)==="idle"&&this.children.zoom&&this.editor.setCurrentTool("zoom",{...n,onInteractionEnd:s.id})}break}}})}}y(jf,"id","root"),y(jf,"initial",""),y(jf,"children",()=>[]);var fU=Object.defineProperty,pU=Object.getOwnPropertyDescriptor,he=(t,e,n,r)=>{for(var s=r>1?void 0:r?pU(e,n):e,o=t.length-1,i;o>=0;o--)(i=t[o])&&(s=(r?i(e,n,s):i(s))||s);return r&&s&&fU(e,n,s),s};class ue extends CB{constructor({store:n,user:r,shapeUtils:s,tools:o,getContainer:i,initialState:a}){super();y(this,"store");y(this,"root");y(this,"disposables",new Set);y(this,"_tickManager",new rU(this));y(this,"snaps");y(this,"user");y(this,"textMeasure");y(this,"environment");y(this,"getContainer");y(this,"sideEffects");y(this,"shapeUtils");y(this,"styleProps");y(this,"history",new GB(this,n=>{this.annotateError(n,{origin:"history.batch",willCrashApp:!0}),this.crash(n)}));y(this,"_crashingError",null);y(this,"_updateInstanceState",this.history.createCommand("updateInstanceState",(n,r=!1,s=!1)=>{const o=this.instanceState,i={...o,...n};return{data:{prev:o,next:i},squashing:s,ephemeral:r}},{do:({next:n})=>{this.store.put([n])},undo:({prev:n})=>{this.store.put([n])},squash({prev:n},{next:r}){return{prev:n,next:r}}}));y(this,"_isChangingStyleTimeout",-1);y(this,"focus",()=>{this.getContainer().focus()});y(this,"blur",()=>{this.getContainer().blur()});y(this,"_setInstancePageState",this.history.createCommand("setInstancePageState",(n,r=!1)=>({data:{prev:this.store.get(n.id??this.currentPageState.id),partial:n},ephemeral:r}),{do:({prev:n,partial:r})=>{this.store.update(n.id,s=>({...s,...r}))},undo:({prev:n})=>{this.store.update(n.id,()=>n)}}));y(this,"_setSelectedShapeIds",this.history.createCommand("setSelectedShapeIds",(n,r=!1)=>{const{selectedShapeIds:s}=this.currentPageState,o=new Set(s);return n.length===o.size&&n.every(i=>o.has(i))?null:{data:{selectedShapeIds:n,prevSelectedShapeIds:s},squashing:r,preservesRedoStack:!0}},{do:({selectedShapeIds:n})=>{this.store.put([{...this.currentPageState,selectedShapeIds:n}])},undo:({prevSelectedShapeIds:n})=>{this.store.put([{...this.currentPageState,selectedShapeIds:n}])},squash({prevSelectedShapeIds:n},{selectedShapeIds:r}){return{selectedShapeIds:r,prevSelectedShapeIds:n}}}));y(this,"_setFocusedGroupId",this.history.createCommand("setFocusedGroupId",n=>!n&&!this.canUndo?void 0:{data:{prev:this.currentPageState.focusedGroupId,next:n},preservesRedoStack:!0,squashing:!0},{do:({next:n})=>{this.store.update(this.currentPageState.id,r=>({...r,focusedGroupId:n}))},undo:({prev:n})=>{this.store.update(this.currentPageState.id,r=>({...r,focusedGroupId:n}))},squash({prev:n},{next:r}){return{prev:n,next:r}}}));y(this,"_viewportAnimation",null);y(this,"_willSetInitialBounds",!0);y(this,"_cameraState",Cn("camera state","idle"));y(this,"_cameraStateTimeoutRemaining",0);y(this,"_lastUpdateRenderingBoundsTimestamp",Date.now());y(this,"_decayCameraStateTimeout",n=>{this._cameraStateTimeoutRemaining-=n,this._cameraStateTimeoutRemaining<=0&&(this.off("tick",this._decayCameraStateTimeout),this._cameraState.set("idle"),this.updateRenderingBounds())});y(this,"_tickCameraState",()=>{this._cameraStateTimeoutRemaining=i9;const n=Date.now();this._cameraState.__unsafe__getWithoutCapture()==="idle"?(this._lastUpdateRenderingBoundsTimestamp=n,this._cameraState.set("moving"),this.on("tick",this._decayCameraStateTimeout)):n-this._lastUpdateRenderingBoundsTimestamp>a9&&this.updateRenderingBounds()});y(this,"_renderingBounds",Cn("rendering viewport",new ae));y(this,"_renderingBoundsExpanded",Cn("rendering viewport expanded",new ae));y(this,"renderingBoundsMargin",100);y(this,"_currentPageShapeIds");y(this,"_setCurrentPageId",this.history.createCommand("setCurrentPage",(n,{stopFollowing:r=!0}={})=>{if(!this.store.has(n)){console.error("Tried to set the current page id to a page that doesn't exist.");return}return r&&this.instanceState.followingUserId&&this.stopFollowingUser(),{data:{toId:n,fromId:this.currentPageId},squashing:!0,preservesRedoStack:!0}},{do:({toId:n})=>{if(this.store.has(n)){if(!this.pageStates.find(r=>r.pageId===n)){const r=Dt.create({id:Dt.createId(n)});this.store.put([r,Rt.create({id:Rt.createId(n),pageId:n})])}this.store.put([{...this.instanceState,currentPageId:n}]),this.updateRenderingBounds()}},undo:({fromId:n})=>{this.store.has(n)&&(this.store.put([{...this.instanceState,currentPageId:n}]),this.updateRenderingBounds())},squash:({fromId:n},{toId:r})=>({toId:r,fromId:n})}));y(this,"_updatePage",this.history.createCommand("updatePage",(n,r=!1)=>{if(this.instanceState.isReadonly)return null;const s=this.getPage(n.id);return s?{data:{prev:s,partial:n},squashing:r}:null},{do:({partial:n})=>{this.store.update(n.id,r=>({...r,...n}))},undo:({prev:n,partial:r})=>{this.store.update(r.id,()=>n)},squash(n,r){return{prev:{...n.prev,...r.prev},partial:r.partial}}}));y(this,"_createPage",this.history.createCommand("createPage",(n,r=Un.createId(),s)=>{var d,h;if(this.instanceState.isReadonly||this.pages.length>=ng)return null;const o=this.pages,i=s??((d=o[o.length-1])==null?void 0:d.index)??"a1",a=(h=o[o.findIndex(f=>f.index===i)+1])==null?void 0:h.index;n=MB(n,o.map(f=>f.name));const c=Un.create({id:r,name:n,index:a&&i!==a?vu(i,a):Ms(i),meta:{}}),l=Dt.create({id:Dt.createId(c.id)}),u=Rt.create({id:Rt.createId(c.id),pageId:c.id});return{data:{prevSelectedPageId:this.currentPageId,newPage:c,newTabPageState:u,newCamera:l}}},{do:({newPage:n,newTabPageState:r,newCamera:s})=>{this.store.put([n,s,r,{...this.instanceState,currentPageId:n.id}]),this.updateRenderingBounds()},undo:({newPage:n,prevSelectedPageId:r,newTabPageState:s,newCamera:o})=>{this.pages.length!==1&&(this.store.remove([s.id,n.id,o.id]),this.store.has(r)&&this.currentPageId!==r&&this.store.put([{...this.instanceState,currentPageId:r}]),this.updateRenderingBounds())}}));y(this,"_deletePage",this.history.createCommand("delete_page",n=>{if(this.instanceState.isReadonly)return null;const{pages:r}=this;if(r.length===1)return null;const s=this.getPage(n),o=this.pageStates.filter(i=>i.pageId===n);if(!s)return null;if(n===this.currentPageId){const i=r.findIndex(c=>c.id===n),a=r[i-1]??r[i+1];this.setCurrentPage(a.id)}return{data:{id:n,deletedPage:s,deletedPageStates:o}}},{do:({deletedPage:n,deletedPageStates:r})=>{const{pages:s}=this;if(s.length!==1){if(n.id===this.currentPageId){const o=s.findIndex(a=>a.id===n.id),i=s[o-1]??s[o+1];this.setCurrentPage(i.id)}this.store.remove(r.map(o=>o.id)),this.store.remove([n.id]),this.updateRenderingBounds()}},undo:({deletedPage:n,deletedPageStates:r})=>{this.store.put([n]),this.store.put(r),this.updateRenderingBounds()}}));y(this,"_createAssets",this.history.createCommand("createAssets",n=>this.instanceState.isReadonly||n.length<=0?null:{data:{assets:n}},{do:({assets:n})=>{this.store.put(n)},undo:({assets:n})=>{this.store.remove(n.map(r=>r.id))}}));y(this,"_updateAssets",this.history.createCommand("updateAssets",n=>this.instanceState.isReadonly||n.length<=0?void 0:{data:{snapshots:{},assets:n}},{do:({assets:n,snapshots:r})=>{this.store.put(n.map(s=>{const o=this.store.get(s.id);return r[s.id]=o,{...o,...s}}))},undo:({snapshots:n})=>{this.store.put(Object.values(n))}}));y(this,"_deleteAssets",this.history.createCommand("deleteAssets",n=>{if(this.instanceState.isReadonly||n.length<=0)return;const r=me(n.map(s=>this.store.get(s)));return{data:{ids:n,prev:r}}},{do:({ids:n})=>{this.store.remove(n)},undo:({prev:n})=>{this.store.put(n)}}));y(this,"_parentIdsToChildIds");y(this,"_childIdsCache",new dx);y(this,"_createShapes",this.history.createCommand("createShapes",n=>{if(this.instanceState.isReadonly||n.length<=0)return null;const{currentPageShapeIds:r}=this;if(n.length+r.size>Io){Kh(this);return}return n.length===0?null:{data:{currentPageId:this.currentPageId,partials:n.map(o=>o.id?o:{...o,id:Ke()})}}},{do:({partials:n})=>{var a,c;const{focusedGroupId:r}=this,{currentPageShapesSorted:s}=this;n=n.map(l=>{var u;if(!l.parentId||!(this.store.has(l.parentId)||n.some(d=>d.id===l.parentId))){l={...l};const d=((u=s.findLast(h=>this.getShapeUtil(h).canReceiveNewChildrenOfType(h,l.type)&&this.isPointInShape(h,{x:l.x??0,y:l.y??0},{margin:0,hitInside:!0})))==null?void 0:u.id)??this.focusedGroupId;if(l.parentId=d,ar(d)){const h=this.getPointInShapeSpace(this.getShape(d),{x:l.x??0,y:l.y??0});l.x=h.x,l.y=h.y,l.rotation=-this.getShapePageTransform(d).rotation()+(l.rotation??0)}l.parentId===l.id&&(l.parentId=r)}return l});const o=new Map,i=[];for(const l of n){const u=this.getShapeUtil(l);let d=l.index;if(!d){const m=l.parentId??r;o.has(m)||o.set(m,this.getHighestIndexForParent(m)),d=o.get(m),o.set(m,Ms(d))}const h=u.getDefaultProps();for(const[m,v]of this.styleProps[l.type])h[v]=this.getStyleForNextShape(m);let f=this.store.schema.types.shape.create({...l,index:d,opacity:l.opacity??this.instanceState.opacityForNextShape,parentId:l.parentId??r,props:"props"in l?{...h,...l.props}:h});if(f.index===void 0)throw Error("no index!");const p=(c=(a=this.getShapeUtil(f)).onBeforeCreate)==null?void 0:c.call(a,f);p&&(f=p),i.push(f)}i.forEach(l=>{l.meta={...this.getInitialMetaForShape(l),...l.meta}}),this.store.put(i)},undo:({partials:n})=>{this.store.remove(n.map(r=>r.id))}}));y(this,"animatingShapes",new Map);y(this,"_updateShapes",this.history.createCommand("updateShapes",(n,r=!1)=>{if(this.instanceState.isReadonly)return null;const s=me(n),o=Object.fromEntries(me(s.map(({id:c})=>this.getShape(c))).map(c=>[c.id,c]));if(s.length<=0)return null;const i=me(s.map(c=>{const l=o[c.id];if(!l)return null;let u=null;for(const[d,h]of Object.entries(c))if(h!==void 0)switch(d){case"id":case"type":continue;default:if(h!==l[d])if(u||(u={...l}),d==="props"){const f={...l.props};for(const[p,m]of Object.entries(h))m!==void 0&&(f[p]=m);u.props=f}else if(d==="meta"){const f={...l.meta};for(const[p,m]of Object.entries(h))m!==void 0&&(f[p]=m);u.meta=f}else u[d]=h}return u??l})),a=Object.fromEntries(i.map(c=>[c.id,c]));return{data:{snapshots:o,updates:a},squashing:r}},{do:({updates:n})=>{var s,o;const r=Object.values(n);for(let i=0;i<r.length;i++){const a=r[i],c=this.store.get(a.id);if(!c)continue;const l=(o=(s=this.getShapeUtil(a)).onBeforeUpdate)==null?void 0:o.call(s,c,a);l&&(r[i]=l)}this.store.put(r)},undo:({snapshots:n})=>{this.store.put(Object.values(n))},squash(n,r){return{snapshots:{...r.snapshots,...n.snapshots},updates:{...n.updates,...r.updates}}}}));y(this,"_deleteShapes",this.history.createCommand("delete_shapes",n=>{if(this.instanceState.isReadonly||n.length===0)return null;const r=[...this.currentPageState.selectedShapeIds],s=new Set(n);for(const l of n)this.visitDescendants(l,u=>{s.add(u)});const o=[...s],i=this._arrowBindingsIndex.value,a=me(o.flatMap(l=>{const u=this.getShape(l),d=i[l];return d&&d.length>0?d.map(({arrowId:h})=>this.getShape(h)).concat(u):u})),c=r.filter(l=>!s.has(l));return{data:{deletedIds:o,snapshots:a,prevSelectedShapeIds:r,postSelectedShapeIds:c}}},{do:({deletedIds:n,postSelectedShapeIds:r})=>{this.store.remove(n),this.store.update(this.currentPageState.id,s=>({...s,selectedShapeIds:r}))},undo:({snapshots:n,prevSelectedShapeIds:r})=>{this.store.put(n),this.store.update(this.currentPageState.id,s=>({...s,selectedShapeIds:r}))}}));y(this,"_selectionSharedStyles",X("_selectionSharedStyles",()=>{const{selectedShapes:n}=this,r=new Uw;for(const s of n)this._extractSharedStyles(s,r);return r}));y(this,"externalAssetContentHandlers",{file:null,url:null});y(this,"externalContentHandlers",{text:null,files:null,embed:null,"svg-text":null,url:null});y(this,"inputs",{originPagePoint:new P,originScreenPoint:new P,previousPagePoint:new P,previousScreenPoint:new P,currentPagePoint:new P,currentScreenPoint:new P,keys:new Set,buttons:new Set,isPen:!1,shiftKey:!1,ctrlKey:!1,altKey:!1,isDragging:!1,isPointing:!1,isPinching:!1,isEditing:!1,isPanning:!1,pointerVelocity:new P});y(this,"_clickManager",new KB(this));y(this,"_prevCursor","default");y(this,"_shiftKeyTimeout",-1);y(this,"_setShiftKeyTimeout",()=>{this.inputs.shiftKey=!1,this.dispatch({type:"keyboard",name:"key_up",key:"Shift",shiftKey:this.inputs.shiftKey,ctrlKey:this.inputs.ctrlKey,altKey:this.inputs.altKey,code:"ShiftLeft"})});y(this,"_altKeyTimeout",-1);y(this,"_setAltKeyTimeout",()=>{this.inputs.altKey=!1,this.dispatch({type:"keyboard",name:"key_up",key:"Alt",shiftKey:this.inputs.shiftKey,ctrlKey:this.inputs.ctrlKey,altKey:this.inputs.altKey,code:"AltLeft"})});y(this,"_ctrlKeyTimeout",-1);y(this,"_setCtrlKeyTimeout",()=>{this.inputs.ctrlKey=!1,this.dispatch({type:"keyboard",name:"key_up",key:"Ctrl",shiftKey:this.inputs.shiftKey,ctrlKey:this.inputs.ctrlKey,altKey:this.inputs.altKey,code:"ControlLeft"})});y(this,"_restoreToolId","select");y(this,"_pinchStart",1);y(this,"_didPinch",!1);y(this,"_selectedShapeIdsAtPointerDown",[]);y(this,"capturedPointerId",null);this.store=n,this.snaps=new Si(this),this.user=new uo(r??b3()),this.getContainer=i??(()=>document.body),this.textMeasure=new nU(this);class c extends jf{}y(c,"initial",a??""),this.root=new c(this),this.root.children={};const l=k3(s),u=new Set(Object.keys(n.schema.types.shape.migrations.subTypeMigrations));for(const E of l){if(!u.has(E.type))throw Error(`Editor and store have different shapes: "${E.type}" was passed into the editor but not the schema`);u.delete(E.type)}if(u.size>0)throw Error(`Editor and store have different shapes: "${[...u][0]}" is present in the store schema but not provided to the editor`);const d={},h={},f=new Map;for(const E of l){const _=new E(this);d[E.type]=_;const k=zT(E.props??{});h[E.type]=k;for(const I of k.keys())if(!f.has(I.id))f.set(I.id,I);else if(f.get(I.id)!==I)throw Error(`Multiple style props with id "${I.id}" in use. Style prop IDs must be unique.`)}this.shapeUtils=d,this.styleProps=h;for(const E of[...o]){if(am(this.root.children,E.id))throw Error(`Can't override tool with id "${E.id}"`);this.root.children[E.id]=new E(this,this.root)}this.environment=new VB(this);const p=new Set,m=E=>{const _=this.getShape(E);if(!_)return;const{start:k,end:I}=_.props,$=k.type==="binding"?this.getShape(k.boundShapeId):void 0,A=I.type==="binding"?this.getShape(I.boundShapeId):void 0,D=this.getAncestorPageId(_);if(!D)return;let L;if($&&A)L=this.findCommonAncestor([$,A])??D;else if($||A)L=D;else return;L&&L!==_.parentId&&this.reparentShapes([E],L);const j=this.getShape(E);if(!j)throw Error("no reparented arrow");const M=this.getShapeNearestSibling(j,$),B=this.getShapeNearestSibling(j,A);let U;if(M&&B)U=M.index>B.index?M:B;else if(M&&!B)U=M;else if(B&&!M)U=B;else return;let q;const N=this.getSortedChildIdsForParent(U.parentId).map(F=>this.getShape(F)).filter(F=>F.index>U.index);if(N.length){const F=N.find(K=>K.type!=="arrow");if(j.index>U.index&&(!F||j.index<F.index))return;q=vu(U.index,N[0].index)}else q=Ms(U.index);q!==j.index&&this.updateShapes([{id:E,type:"arrow",index:q}])},v=(E,_)=>{const{x:k,y:I}=jr(this,E)[_];this.store.put([{...E,props:{...E.props,[_]:{type:"point",x:k,y:I}}}])},w=E=>{for(const _ of["start","end"]){const k=E.props[_];if(k.type!=="binding")continue;const I=this.getShape(k.boundShapeId),$=this.getAncestorPageId(E)===this.getAncestorPageId(I);(!I||!$)&&v(E,_)}m(E.id)},x=(E,_)=>{let k=null;const I=E.selectedShapeIds.filter(D=>!_.has(D));I.length!==E.selectedShapeIds.length&&(k||(k={...E}),k.selectedShapeIds=I);const $=E.erasingShapeIds.filter(D=>!_.has(D));$.length!==E.erasingShapeIds.length&&(k||(k={...E}),k.erasingShapeIds=$),E.hoveredShapeId&&_.has(E.hoveredShapeId)&&(k||(k={...E}),k.hoveredShapeId=null),E.editingShapeId&&_.has(E.editingShapeId)&&(k||(k={...E}),k.editingShapeId=null);const A=E.hintingShapeIds.filter(D=>!_.has(D));return A.length!==E.hintingShapeIds.length&&(k||(k={...E}),k.hintingShapeIds=A),E.focusedGroupId&&_.has(E.focusedGroupId)&&(k||(k={...E}),k.focusedGroupId=null),k};this.sideEffects=new YB(this),this.sideEffects.registerBatchCompleteHandler(()=>{var E;for(const _ of p){p.delete(_);const k=this.getShape(_);if(!k)continue;const I=this.getShapeUtil(k),$=(E=I.onChildrenChange)==null?void 0:E.call(I,k);$!=null&&$.length&&this.updateShapes($,!0)}this.emit("update")}),this.sideEffects.registerBeforeDeleteHandler("shape",E=>{E.parentId&&ar(E.parentId)&&p.add(E.parentId);const _=this._arrowBindingsIndex.value[E.id];if(_!=null&&_.length)for(const{arrowId:$,handleId:A}of _){const D=this.getShape($);D&&v(D,A)}const k=new Set([E.id]),I=me(this.pageStates.map($=>x($,k)));I.length&&this.store.put(I)}),this.sideEffects.registerBeforeDeleteHandler("page",E=>{var $;if(this.instanceState.currentPageId!==E.id)return;const _=($=this.pages.find(A=>A.id!==E.id))==null?void 0:$.id;if(!_)return;this.store.put([{...this.instanceState,currentPageId:_}]);const k=Dt.createId(E.id),I=Rt.createId(E.id);this.store.remove([k,I])}),this.sideEffects.registerAfterChangeHandler("shape",(E,_)=>{if(this.isShapeOfType(_,"arrow")&&w(_),E.parentId!==_.parentId){const k=I=>{const $=this._arrowBindingsIndex.value[I];if($!=null&&$.length)for(const A of $)m(A.arrowId)};k(_.id),this.visitDescendants(_.id,k)}if(E.parentId!==_.parentId&&wn(_.parentId)){const k=new Set([E.id]);this.visitDescendants(E.id,I=>{k.add(I)});for(const I of this.pageStates){if(I.pageId===_.parentId)continue;const $=x(I,k);$&&this.store.put([$])}}E.parentId&&ar(E.parentId)&&p.add(E.parentId),_.parentId!==E.parentId&&ar(_.parentId)&&p.add(_.parentId)}),this.sideEffects.registerAfterChangeHandler("instance_page_state",(E,_)=>{if((E==null?void 0:E.selectedShapeIds)!==(_==null?void 0:_.selectedShapeIds)){const k=_.selectedShapeIds.filter($=>{var D,L;let A=(D=this.getShape($))==null?void 0:D.parentId;for(;ar(A);){if(_.selectedShapeIds.includes(A))return!1;A=(L=this.getShape(A))==null?void 0:L.parentId}return!0});let I=null;if(k.length>0){const $=this.findCommonAncestor(me(k.map(A=>this.getShape(A))),A=>this.isShapeOfType(A,"group"));$&&(I=$)}else _!=null&&_.focusedGroupId&&(I=_.focusedGroupId);(k.length!==_.selectedShapeIds.length||I!==_.focusedGroupId)&&this.store.put([{..._,selectedShapeIds:k,focusedGroupId:I??null}])}}),this.sideEffects.registerAfterCreateHandler("shape",E=>{this.isShapeOfType(E,"arrow")&&w(E)}),this.sideEffects.registerAfterCreateHandler("page",E=>{const _=Dt.createId(E.id),k=Rt.createId(E.id);this.store.has(_)||this.store.put([Dt.create({id:_})]),this.store.has(k)||this.store.put([Rt.create({id:k,pageId:E.id})])}),this._currentPageShapeIds=UB(this.store,()=>this.currentPageId),this._parentIdsToChildIds=BB(this.store),this.disposables.add(this.store.listen(E=>{this.emit("change",E)}));const b=this.getContainer(),C=K1(()=>{const{activeElement:E}=document,{isFocused:_}=this.instanceState,k=b===E||b.contains(E);(!_&&k||_&&!k)&&(this.updateInstanceState({isFocused:k}),this.updateViewportScreenBounds())},32);if(b.addEventListener("focusin",C),b.addEventListener("focus",C),b.addEventListener("focusout",C),b.addEventListener("blur",C),this.disposables.add(()=>{b.removeEventListener("focusin",C),b.removeEventListener("focus",C),b.removeEventListener("focusout",C),b.removeEventListener("blur",C)}),this.store.ensureStoreIsUsable(),this._setInstancePageState({editingShapeId:null,hoveredShapeId:null,erasingShapeIds:[]},!0),a&&this.root.children[a]===void 0)throw Error(`No state found for initialState "${a}".`);this.root.enter(void 0,"initial"),this.instanceState.followingUserId&&this.stopFollowingUser(),this.updateRenderingBounds(),requestAnimationFrame(()=>{this._tickManager.start()})}dispose(){this.disposables.forEach(n=>n()),this.disposables.clear()}getShapeUtil(n){const r=typeof n=="string"?n:n.type,s=Zi(this.shapeUtils,r);return H1(s,`No shape util found for type "${r}"`),s}undo(){return this.history.undo()}get canUndo(){return this.history.numUndos>0}redo(){return this.history.redo(),this}get canRedo(){return this.history.numRedos>0}mark(n,r,s){return this.history.mark(n,r,s)}bail(){return this.history.bail(),this}bailToMark(n){return this.history.bailToMark(n),this}batch(n){return this.history.batch(n),this}get _arrowBindingsIndex(){return FB(this)}getArrowsBoundTo(n){return this._arrowBindingsIndex.value[n]||Fs}get arrowInfoCache(){return this.store.createComputedCache("arrow infoCache",n=>Ul(n)?wu(this,n):n0(this,n))}getArrowInfo(n){return this.arrowInfoCache.get(n.id)}annotateError(n,{origin:r,willCrashApp:s,tags:o,extras:i}){const a=this.createErrorAnnotations(r,s);return V1(n,{tags:{...a.tags,...o},extras:{...a.extras,...i}}),s&&this.store.markAsPossiblyCorrupted(),this}createErrorAnnotations(n,r){try{return{tags:{origin:n,willCrashApp:r},extras:{activeStateNode:this.root.path.value,selectedShapes:this.selectedShapes,editingShape:this.editingShapeId?this.getShape(this.editingShapeId):void 0,inputs:this.inputs}}}catch{return{tags:{origin:n,willCrashApp:r},extras:{}}}}get crashingError(){return this._crashingError}crash(n){return this._crashingError=n,this.store.markAsPossiblyCorrupted(),this.emit("crash",{error:n}),this}isIn(n){const r=n.split(".").reverse();let s=this.root;for(;r.length>0;){const o=r.pop();if(!o)return!0;const i=s.current.value;if((i==null?void 0:i.id)===o){if(r.length===0)return!0;s=i;continue}else return!1}return!1}isInAny(...n){return n.some(r=>this.isIn(r))}setCurrentTool(n,r={}){return this.root.transition(n,r),this}get currentTool(){return this.root.current.value}get currentToolId(){const{currentTool:n}=this;return n?n.currentToolIdMask??n.id:""}getStateDescendant(n){var o;const r=n.split(".").reverse();let s=this.root;for(;r.length>0;){const i=r.pop();if(!i)return s;const a=(o=s.children)==null?void 0:o[i];if(!a)return;s=a}return s}get documentSettings(){return this.store.get(Lw)}updateDocumentSettings(n){return this.store.put([{...this.documentSettings,...n}]),this}get instanceState(){return this.store.get(Zt)}updateInstanceState(n,r=!0,s=!0){return this._updateInstanceState(n,r,s),n.isChangingStyle!==void 0&&(clearTimeout(this._isChangingStyleTimeout),n.isChangingStyle===!0&&(this._isChangingStyleTimeout=setTimeout(()=>{this.updateInstanceState({isChangingStyle:!1})},2e3))),this}get openMenus(){return this.instanceState.openMenus}addOpenMenu(n){const r=new Set(this.openMenus);return r.has(n)||(r.add(n),this.updateInstanceState({openMenus:[...r]})),this}deleteOpenMenu(n){const r=new Set(this.openMenus);return r.has(n)&&(r.delete(n),this.updateInstanceState({openMenus:[...r]})),this}get isMenuOpen(){return this.openMenus.length>0}get pageStates(){return this._pageStates.value}get _pageStates(){return this.store.query.records("instance_page_state")}get currentPageState(){return this.store.get(this._currentPageStateId)}get _currentPageStateId(){return Rt.createId(this.currentPageId)}updateCurrentPageState(n,r=!1){return this._setInstancePageState(n,r),this}get selectedShapeIds(){return this.currentPageState.selectedShapeIds}setSelectedShapeIds(n,r=!1){return this._setSelectedShapeIds(n,r),this}isAncestorSelected(n){const r=this.getShape(typeof n=="string"?n:n.id);if(!r)return!1;const{selectedShapeIds:s}=this;return!!this.findShapeAncestor(r,o=>s.includes(o.id))}select(...n){const r=typeof n[0]=="string"?n:n.map(s=>s.id);return this.setSelectedShapeIds(r),this}deselect(...n){const r=typeof n[0]=="string"?n:n.map(o=>o.id),{selectedShapeIds:s}=this;return s.length>0&&r.length>0&&this.setSelectedShapeIds(s.filter(o=>!r.includes(o))),this}selectAll(){const n=this.getSortedChildIdsForParent(this.currentPageId);return n.length<=0?this:(this.setSelectedShapeIds(this._getUnlockedShapeIds(n)),this)}selectNone(){return this.selectedShapeIds.length>0&&this.setSelectedShapeIds([]),this}get selectedShapes(){const{selectedShapeIds:n}=this.currentPageState;return me(n.map(r=>this.store.get(r)))}get onlySelectedShape(){const{selectedShapes:n}=this;return n.length===1?n[0]:null}get selectionPageBounds(){const{currentPageState:{selectedShapeIds:n}}=this;return n.length===0?null:ae.Common(me(n.map(r=>this.getShapePageBounds(r))))}get selectionRotation(){const{selectedShapeIds:n}=this;if(n.length===0)return 0;if(n.length===1)return this.getShapePageTransform(this.selectedShapeIds[0]).rotation();const r=n.map(s=>this.getShapePageTransform(s).rotation());return r.every(s=>Math.abs(s-r[0])<Math.PI/180)?this.getShapePageTransform(n[0]).rotation():0}get selectionRotatedPageBounds(){const{selectedShapeIds:n}=this;if(n.length===0)return;const{selectionRotation:r}=this;if(r===0)return this.selectionPageBounds;if(n.length===1){const o=this.getShapeGeometry(n[0]).bounds.clone(),i=this.getShapePageTransform(n[0]);return o.point=i.applyToPoint(o.point),o}const s=ae.FromPoints(this.selectedShapeIds.flatMap(o=>{const i=this.getShapePageTransform(o);return i?i.applyToPoints(this.getShapeGeometry(o).vertices):[]}).map(o=>P.Rot(o,-r)));return s.point=s.point.rot(r),s}get focusedGroupId(){return this.currentPageState.focusedGroupId??this.currentPageId}setFocusedGroupId(n){return this._setFocusedGroupId(n),this}popFocusLayer(){const n=this.currentPageState.focusedGroupId,r=n&&this.getShape(n);if(r){const s=this.findShapeAncestor(r,o=>this.isShapeOfType(o,"group"));this.setFocusedGroupId((s==null?void 0:s.id)??null),this.select(r.id)}else this.setFocusedGroupId(null),this.selectNone();return this}get editingShapeId(){return this.currentPageState.editingShapeId}setEditingShapeId(n){if(!n)this._setInstancePageState({editingShapeId:null});else if(n!==this.editingShapeId){const r=this.getShape(n),s=this.getShapeUtil(r);r&&s.canEdit(r)&&this._setInstancePageState({editingShapeId:n,hoveredShapeId:null},!1)}return this}get hoveredShapeId(){return this.currentPageState.hoveredShapeId}setHoveredShapeId(n){return n===this.currentPageState.hoveredShapeId?this:(this.updateCurrentPageState({hoveredShapeId:n},!0),this)}get hoveredShape(){return this.hoveredShapeId?this.getShape(this.hoveredShapeId):void 0}get hintingShapeIds(){return this.currentPageState.hintingShapeIds}setHintingIds(n){return this.store.update(this.currentPageState.id,r=>({...r,hintingShapeIds:Kp(n)})),this}get erasingShapeIds(){return this.currentPageState.erasingShapeIds}setErasingShapeIds(n){const r=this.erasingShapeIdsSet;return n.length===r.size&&n.every(s=>r.has(s))?this:(this._setInstancePageState({erasingShapeIds:n},!0),this)}get erasingShapeIdsSet(){return new Set(this.erasingShapeIds)}get croppingShapeId(){return this.currentPageState.croppingShapeId}setCroppingShapeId(n){if(n!==this.croppingShapeId)if(!n)this.updateCurrentPageState({croppingShapeId:null}),this.isInAny("select.crop","select.pointing_crop_handle","select.cropping")&&this.setCurrentTool("select.idle");else{const r=this.getShape(n),s=this.getShapeUtil(r);r&&s.canCrop(r)&&this.updateCurrentPageState({croppingShapeId:n})}return this}get cameraId(){return Dt.createId(this.currentPageId)}get camera(){return this.store.get(this.cameraId)}get zoomLevel(){return this.camera.z}_setCamera(n){const r=this.camera;return r.x===n.x&&r.y===n.y&&r.z===n.z?this:(this.batch(()=>{this.store.put([{...r,...n}]);const{currentScreenPoint:s}=this.inputs;this.dispatch({type:"pointer",target:"canvas",name:"pointer_move",point:s,pointerId:m_.CAMERA_MOVE,ctrlKey:this.inputs.ctrlKey,altKey:this.inputs.altKey,shiftKey:this.inputs.shiftKey,button:0,isPen:this.instanceState.isPenMode??!1}),this._tickCameraState()}),this)}setCamera(n,r){const s=Number.isFinite(n.x)?n.x:0,o=Number.isFinite(n.y)?n.y:0,i=Number.isFinite(n.z)?n.z:this.zoomLevel;if(this.stopCameraAnimation(),this.instanceState.followingUserId&&this.stopFollowingUser(),r){const{width:a,height:c}=this.viewportScreenBounds;return this._animateToViewport(new ae(-s,-o,a/i,c/i),r)}else this._setCamera({x:s,y:o,z:i});return this}centerOnPoint(n,r){if(!this.instanceState.canMoveCamera)return this;const{viewportPageBounds:{width:s,height:o},camera:i}=this;return this.setCamera({x:-(n.x-s/2),y:-(n.y-o/2),z:i.z},r),this}zoomToContent(){const n=this.selectionPageBounds??this.currentPageBounds;return n&&this.zoomToBounds(n,Math.min(1,this.zoomLevel),{duration:220}),this}zoomToFit(n){if(!this.instanceState.canMoveCamera)return this;const r=[...this.currentPageShapeIds];if(r.length<=0)return this;const s=ae.Common(me(r.map(o=>this.getShapePageBounds(o))));return this.zoomToBounds(s,void 0,n),this}resetZoom(n=this.viewportScreenCenter,r){if(!this.instanceState.canMoveCamera)return this;const{x:s,y:o,z:i}=this.camera,{x:a,y:c}=n;return this.setCamera({x:s+(a/1-a)-(a/i-a),y:o+(c/1-c)-(c/i-c),z:1},r),this}zoomIn(n=this.viewportScreenCenter,r){if(!this.instanceState.canMoveCamera)return this;const{x:s,y:o,z:i}=this.camera;let a=Ro;for(let u=1;u<Ka.length;u++){const d=Ka[u-1],h=Ka[u];if(!(h-i<=(h-d)/2)){a=h;break}}const{x:c,y:l}=n;return this.setCamera({x:s+(c/a-c)-(c/i-c),y:o+(l/a-l)-(l/i-l),z:a},r),this}zoomOut(n=this.viewportScreenCenter,r){if(!this.instanceState.canMoveCamera)return this;const{x:s,y:o,z:i}=this.camera;let a=Bl;for(let u=Ka.length-1;u>0;u--){const d=Ka[u-1],h=Ka[u];if(!(h-i>=(h-d)/2)){a=d;break}}const{x:c,y:l}=n;return this.setCamera({x:s+(c/a-c)-(c/i-c),y:o+(l/a-l)-(l/i-l),z:a},r),this}zoomToSelection(n){if(!this.instanceState.canMoveCamera)return this;const{selectionPageBounds:r}=this;return r?(this.zoomToBounds(r,Math.max(1,this.zoomLevel),n),this):this}panZoomIntoView(n,r){if(!this.instanceState.canMoveCamera)return this;if(n.length<=0)return this;const s=ae.Common(me(n.map(i=>this.getShapePageBounds(i)))),{viewportPageBounds:o}=this;if(o.h<s.h||o.w<s.w)return this.zoomToBounds(s,this.camera.z,r),this;{const i=this.viewportPageBounds.clone().expandBy(-32/this.zoomLevel);let a=0,c=0;i.maxY<s.maxY?c=i.maxY-s.maxY:i.minY>s.minY&&(c=i.minY-s.minY),i.maxX<s.maxX?a=i.maxX-s.maxX:i.minX>s.minX&&(a=i.minX-s.minX);const{camera:l}=this;this.setCamera({x:l.x+a,y:l.y+c,z:l.z},r)}return this}zoomToBounds(n,r,s){if(!this.instanceState.canMoveCamera)return this;const{viewportScreenBounds:o}=this,i=Math.min(256,o.width*.28);let a=Rr(Math.min((o.width-i)/n.width,(o.height-i)/n.height),Bl,Ro);return r!==void 0&&(a=Math.min(r,a)),this.setCamera({x:-n.minX+(o.width-n.width*a)/2/a,y:-n.minY+(o.height-n.height*a)/2/a,z:a},s),this}pan(n,r){if(!this.instanceState.canMoveCamera)return this;const{x:s,y:o,z:i}=this.camera;return this.setCamera({x:s+n.x/i,y:o+n.y/i,z:i},r),this}stopCameraAnimation(){return this.emit("stop-camera-animation"),this}_animateViewport(n){if(!this._viewportAnimation)return;const r=()=>{this.removeListener("tick",this._animateViewport),this.removeListener("stop-camera-animation",r),this._viewportAnimation=null};this.once("stop-camera-animation",r),this._viewportAnimation.elapsed+=n;const{elapsed:s,easing:o,duration:i,start:a,end:c}=this._viewportAnimation;if(s>i){this._setCamera({x:-c.x,y:-c.y,z:this.viewportScreenBounds.width/c.width}),r();return}const l=i-s,u=o(1-l/i),d=a.minX+(c.minX-a.minX)*u,h=a.minY+(c.minY-a.minY)*u,f=a.maxX+(c.maxX-a.maxX)*u;this._setCamera({x:-d,y:-h,z:this.viewportScreenBounds.width/(f-d)})}_animateToViewport(n,r={}){const{duration:s=0,easing:o=en.easeInOutCubic}=r,{user:{animationSpeed:i},viewportPageBounds:a}=this;return this.stopCameraAnimation(),this.instanceState.followingUserId&&this.stopFollowingUser(),s===0||i===0?this._setCamera({x:-n.x,y:-n.y,z:this.viewportScreenBounds.width/n.width}):(this._viewportAnimation={elapsed:0,duration:s/i,easing:o,start:a.clone(),end:n.clone()},this.addListener("tick",this._animateViewport),this)}slideCamera(n={}){if(!this.instanceState.canMoveCamera)return this;this.stopCameraAnimation();const{animationSpeed:r}=this.user;if(r===0)return this;const{speed:s,friction:o,direction:i,speedThreshold:a=.01}=n;let c=Math.min(s,1);const l=()=>{this.removeListener("tick",u),this.removeListener("stop-camera-animation",l)};this.once("stop-camera-animation",l);const u=d=>{const{x:h,y:f,z:p}=this.camera,m=P.Mul(i,c*d/p);c*=1-o,c<a?l():this._setCamera({x:h+m.x,y:f+m.y,z:p})};return this.addListener("tick",u),this}animateToUser(n){const s=[...this.store.query.records("instance_presence",()=>({userId:{eq:n}})).value].sort((o,i)=>o.lastActivityTimestamp-i.lastActivityTimestamp).pop();return s?(this.batch(()=>{this.instanceState.followingUserId!==null&&this.stopFollowingUser();const o=s.currentPageId===this.currentPageId;o||this.setCurrentPage(s.currentPageId);const i=o?{duration:500}:void 0;this.centerOnPoint(s.cursor,i);const{highlightedUserIds:a}=this.instanceState;this.updateInstanceState({highlightedUserIds:[...a,n]}),setTimeout(()=>{const c=[...this.instanceState.highlightedUserIds],l=c.indexOf(n);l<0||(c.splice(l,1),this.updateInstanceState({highlightedUserIds:c}))},QT)}),this):this}animateToShape(n,r=r9){if(!this.instanceState.canMoveCamera)return this;const s=this.viewportScreenBounds.clone().expandBy(-32),o=s.width/s.height,i=this.getShapePageBounds(n);if(!i)return this;const a=i.width/i.height,c=i.clone(),l=i.width/s.width;return c.width+=(s.minX+s.maxX)*l,c.height+=(s.minY+s.maxY)*l,c.x-=s.minX*l,c.y-=s.minY*l,a>o?(c.height=i.width/o,c.y-=(c.height-i.height)/2):(c.width=i.height*o,c.x-=(c.width-i.width)/2),this._animateToViewport(c,r)}updateViewportScreenBounds(n=!1){const r=this.getContainer();if(!r)return this;const s=r.getBoundingClientRect(),o=new ae(s.left||s.x,s.top||s.y,Math.max(s.width,1),Math.max(s.height,1)),i=o.equals(this.viewportScreenBounds),{_willSetInitialBounds:a}=this;if(i)this._willSetInitialBounds=!1;else if(a)this._willSetInitialBounds=!1,this.updateInstanceState({screenBounds:o.toJson()},!0,!0);else if(n&&!this.instanceState.followingUserId){const l=this.viewportPageCenter;this.updateInstanceState({screenBounds:o.toJson()},!0,!0),this.centerOnPoint(l)}else this.updateInstanceState({screenBounds:o.toJson()},!0,!0);this._tickCameraState(),this.updateRenderingBounds();const{editingShapeId:c}=this;return c&&this.panZoomIntoView([c]),this}get viewportScreenBounds(){const{x:n,y:r,w:s,h:o}=this.instanceState.screenBounds;return new ae(n,r,s,o)}get viewportScreenCenter(){return this.viewportScreenBounds.center}get viewportPageBounds(){const{w:n,h:r}=this.viewportScreenBounds,{x:s,y:o,z:i}=this.camera;return new ae(-s,-o,n/i,r/i)}get viewportPageCenter(){return this.viewportPageBounds.center}screenToPage(n){const{screenBounds:r}=this.store.unsafeGetWithoutCapture(Zt),{x:s,y:o,z:i=1}=this.camera;return{x:(n.x-r.x-s)/i,y:(n.y-r.y-o)/i,z:n.z??.5}}pageToScreen(n){const{screenBounds:r}=this.store.unsafeGetWithoutCapture(Zt),{x:s,y:o,z:i=1}=this.camera;return{x:n.x*i+s+r.x,y:n.y*i+o+r.y,z:n.z??.5}}startFollowingUser(n){const r=this.store.query.records("instance_presence",()=>({userId:{eq:n}})),s=this.user.id;if(s||console.warn("You should set the userId for the current instance before following a user"),r.value.some(c=>c.followingUserId===s))return this;ur(()=>{this.stopFollowingUser(),this.updateInstanceState({followingUserId:n},!0)});const o=()=>{this.removeListener("frame",a),this.removeListener("stop-following",o)};let i=!1;const a=()=>{const c=[...r.value].sort((j,M)=>j.lastActivityTimestamp-M.lastActivityTimestamp).pop();if(!c){this.stopFollowingUser();return}const l=c.currentPageId===this.currentPageId,u=l?XN:1;if(!l){this.stopFollowingUser(),this.setCurrentPage(c.currentPageId,{stopFollowing:!1}),this.startFollowingUser(n);return}const{center:d,width:h,height:f}=this.viewportPageBounds,p=ae.From(c.screenBounds),m=p.width/c.camera.z,v=p.height/c.camera.z,w=new P(m/2-c.camera.x,v/2-c.camera.y),x=c.followingUserId===s,b=h+(m-h)*u,C=f+(v-f)*u,E=x?f/C:Math.min(h/b,f/C),_=Rr(this.camera.z*E,Bl,Ro),k=this.viewportScreenBounds.w/_,I=this.viewportScreenBounds.h/_,$=w.sub(d),A=P.Add(d,P.Mul($,u)),D=P.Sub(A,d).len(),L=Math.abs(_-this.camera.z);if(D<qN&&L<ZN){i=!0;return}i&&D<QN&&L<JN||(i=!1,this.stopCameraAnimation(),this._setCamera({x:-(A.x-k/2),y:-(A.y-I/2),z:_}))};return this.once("stop-following",o),this.addListener("frame",a),this}stopFollowingUser(){return this.updateInstanceState({followingUserId:null},!0),this.emit("stop-following"),this}get cameraState(){return this._cameraState.value}getUnorderedRenderingShapes(n,{renderingBounds:r,renderingBoundsExpanded:s,erasingShapeIdsSet:o,editingShapeId:i,selectedShapeIds:a}={}){const c=[];let l=Io,u=0;const d=(h,f,p)=>{if(Un.isId(h)){for(const I of this.getSortedChildIdsForParent(h))d(I,f,p);return}const m=this.getShape(h);if(!m)return;let v=m.opacity*f,w=!1;!p&&(o!=null&&o.has(h))&&(w=!0,v*=.32);const x=this.getShapeMaskedPageBounds(h),b=x?(r==null?void 0:r.includes(x))??!0:!1,C=this.getShapeUtil(m),E=x===void 0?!0:C.canUnmount(m)&&i!==h&&!(a!=null&&a.includes(h))&&!!(s&&!s.includes(x));c.push({id:h,shape:m,util:C,index:l,backgroundIndex:u,opacity:v,isCulled:E,isInViewport:b,maskedPageBounds:x}),l+=1,u+=1;const _=this.getSortedChildIdsForParent(h);if(!_.length)return;let k=null;C.providesBackgroundForChildren(m)&&(k=u,u=l,l+=Io);for(const I of _)d(I,v,p||w);k!==null&&(u=k)};for(const h of n)d(h,1,!1);return c}get renderingShapes(){return this.getUnorderedRenderingShapes([this.currentPageId],{renderingBounds:this.renderingBounds,renderingBoundsExpanded:this.renderingBoundsExpanded,erasingShapeIdsSet:this.erasingShapeIdsSet,editingShapeId:this.editingShapeId,selectedShapeIds:this.selectedShapeIds}).sort(F7)}get renderingBounds(){return this._renderingBounds.value}get renderingBoundsExpanded(){return this._renderingBoundsExpanded.value}updateRenderingBounds(){const{viewportPageBounds:n}=this;return n.equals(this._renderingBounds.__unsafe__getWithoutCapture())?this:(this._renderingBounds.set(n.clone()),this._renderingBoundsExpanded.set(n.clone().expandBy(this.renderingBoundsMargin/this.zoomLevel)),this)}get _pages(){return this.store.query.records("page")}get pages(){return this._pages.value.sort(Qt)}get currentPage(){return this.getPage(this.currentPageId)}get currentPageId(){return this.instanceState.currentPageId}getPage(n){return this.store.get(typeof n=="string"?n:n.id)}get currentPageShapeIds(){return this._currentPageShapeIds.value}getCurrentPageShapeIds(n){const r=typeof n=="string"?n:n.id,s=this.store.query.exec("shape",{parentId:{eq:r}});return this.getShapeAndDescendantIds(s.map(o=>o.id))}setCurrentPage(n,{stopFollowing:r=!0}={}){const s=typeof n=="string"?n:n.id;return this._setCurrentPageId(s,{stopFollowing:r}),this}updatePage(n,r=!1){return this._updatePage(n,r),this}createPage(n,r=Un.createId(),s){return this._createPage(n,r,s),this}deletePage(n){const r=typeof n=="string"?n:n.id;return this._deletePage(r),this}duplicatePage(n,r=Un.createId()){if(this.pages.length>=ng)return this;const s=typeof n=="string"?n:n.id,o=this.getPage(s);if(!o)return this;const i={...this.camera},a=this.getContent(this.getSortedChildIdsForParent(o.id));return this.batch(()=>{if(this.createPage(o.name+" Copy",r,o.index),this.setCurrentPage(r),this.setCamera(i),a)return this.putContent(a)}),this}renamePage(n,r,s=!1){const o=typeof n=="string"?n:n.id;return this.instanceState.isReadonly?this:(this.updatePage({id:o,name:r},s),this)}get _assets(){return this.store.query.records("asset")}get assets(){return this._assets.value}createAssets(n){return this._createAssets(n),this}updateAssets(n){return this._updateAssets(n),this}deleteAssets(n){const r=typeof n[0]=="string"?n:n.map(s=>s.id);return this._deleteAssets(r),this}getAsset(n){return this.store.get(typeof n=="string"?n:n.id)}get _shapeGeometryCache(){return this.store.createComputedCache("bounds",n=>this.getShapeUtil(n).getGeometry(n))}getShapeGeometry(n){return this._shapeGeometryCache.get(typeof n=="string"?n:n.id)}get _shapeOutlineSegmentsCache(){return this.store.createComputedCache("outline-segments",n=>this.getShapeUtil(n).getOutlineSegments(n))}getShapeOutlineSegments(n){return this._shapeOutlineSegmentsCache.get(typeof n=="string"?n:n.id)??Fs}get _shapeHandlesCache(){return this.store.createComputedCache("handles",n=>{var r,s;return(s=(r=this.getShapeUtil(n)).getHandles)==null?void 0:s.call(r,n)})}getShapeHandles(n){return this._shapeHandlesCache.get(typeof n=="string"?n:n.id)}getShapeLocalTransform(n){const r=typeof n=="string"?this.getShape(n):n;if(!r)throw Error("Editor.getTransform: shape not found");return te.Identity().translate(r.x,r.y).rotate(r.rotation)}get _shapePageTransformCache(){return this.store.createComputedCache("pageTransformCache",n=>{if(wn(n.parentId))return this.getShapeLocalTransform(n);const r=this._shapePageTransformCache.get(n.parentId)??te.Identity();return te.Compose(r,this.getShapeLocalTransform(n))})}getShapeParentTransform(n){const r=typeof n=="string"?this.getShape(n):n;return!r||wn(r.parentId)?te.Identity():this._shapePageTransformCache.get(r.parentId)??te.Identity()}getShapePageTransform(n){const r=typeof n=="string"?n:this.getShape(n).id;return this._shapePageTransformCache.get(r)??te.Identity()}get _shapePageBoundsCache(){return this.store.createComputedCache("pageBoundsCache",n=>{const r=this._shapePageTransformCache.get(n.id);return r?ae.FromPoints(te.applyToPoints(r,this.getShapeGeometry(n).vertices)):new ae})}getShapePageBounds(n){return this._shapePageBoundsCache.get(typeof n=="string"?n:n.id)}get _shapeClipPathCache(){return this.store.createComputedCache("clipPathCache",n=>{const r=this._shapeMaskCache.get(n.id);if(!r)return;const s=this._shapePageTransformCache.get(n.id);return s?r.length===0?"polygon(0px 0px, 0px 0px, 0px 0px)":`polygon(${te.applyToPoints(te.Inverse(s),r).map(i=>`${i.x}px ${i.y}px`).join(",")})`:void 0})}getShapeClipPath(n){return this._shapeClipPathCache.get(typeof n=="string"?n:n.id)}get _shapeMaskCache(){return this.store.createComputedCache("pageMaskCache",n=>{if(wn(n.parentId))return;const r=this.getShapeAncestors(n.id).filter(o=>this.isShapeOfType(o,"frame"));return r.length===0?void 0:r.map(o=>this._shapePageTransformCache.get(o.id).applyToPoints(this.getShapeGeometry(o).vertices)).reduce((o,i)=>{if(!(i&&o))return;const a=Bw(o,i);if(a)return a.map(P.Cast)})})}getShapeMask(n){return this._shapeMaskCache.get(typeof n=="string"?n:n.id)}getShapeMaskedPageBounds(n){typeof n!="string"&&(n=n.id);const r=this._shapePageBoundsCache.get(n);if(!r)return;const s=this._shapeMaskCache.get(n);if(s){const o=Bw(s,r.corners);return o?ae.FromPoints(o):void 0}return r}getShapeAncestors(n,r=[]){const s=typeof n=="string"?this.getShape(n):n;if(!s)return r;const o=s.parentId;if(wn(o))return r.reverse(),r;const i=this.store.get(o);return i?(r.push(i),this.getShapeAncestors(i,r)):r}findShapeAncestor(n,r){const s=typeof n=="string"?this.getShape(n):n;if(!s)return;const o=s.parentId;if(wn(o))return;const i=this.getShape(o);if(i)return r(i)?i:this.findShapeAncestor(i,r)}hasAncestor(n,r){const s=typeof n=="string"?this.getShape(n):n;return s?s.parentId===r?!0:this.hasAncestor(this.getShapeParent(s),r):!1}findCommonAncestor(n,r){var c;if(n.length===0)return;const s=typeof n[0]=="string"?n.map(l=>this.getShape(l)):n;if(s.length===1){const l=s[0].parentId;return wn(l)?void 0:r?(c=this.findShapeAncestor(s[0],r))==null?void 0:c.id:l}const[o,...i]=s;let a=this.getShapeParent(o);for(;a;){if(r&&!r(a)){a=this.getShapeParent(a);continue}if(i.every(l=>this.hasAncestor(l,a.id)))return a.id;a=this.getShapeParent(a)}}isShapeOrAncestorLocked(n){const r=typeof n=="string"?this.getShape(n):n;return r===void 0?!1:r.isLocked?!0:this.isShapeOrAncestorLocked(this.getShapeParent(r))}get currentPageBounds(){let n;return this.currentPageShapeIds.forEach(r=>{const s=this.getShapeMaskedPageBounds(r);s&&(n?n=n.expand(s):n=s.clone())}),n}getSelectedShapeAtPoint(n){const{selectedShapeIds:r}=this;return this.currentPageShapesSorted.filter(s=>s.type!=="group"&&r.includes(s.id)).findLast(s=>this.isPointInShape(s,n,{hitInside:!0,margin:0}))}getShapeAtPoint(n,r={}){const{viewportPageBounds:s,zoomLevel:o,currentPageShapesSorted:i}=this,{filter:a,margin:c=0,hitInside:l=!1,hitFrameInside:u=!1}=r;let d=1/0,h=null,f=1/0,p=null;const m=i.filter(v=>{if(this.isShapeOfType(v,"group"))return!1;const w=this.getShapeMask(v);return w&&!fs(n,w)?!1:a?a(v):!0});for(let v=m.length-1;v>=0;v--){const w=m[v];let x=this.getShapeGeometry(w);const b=this.getPointInShapeSpace(w,n),C=x.distanceToPoint(b,l);if(this.isShapeOfType(w,"frame")){if(Math.abs(C)<=c)return p||w;if(x.hitTestPoint(b,0,!0))return p||h||(u?w:void 0);continue}if(x instanceof Ki&&(x=x.children[0]),x.isClosed){if(C<=c){if(x.isFilled)return p||w;if(this.getShapePageBounds(w).contains(s))continue;if(Math.abs(C)<c)Math.abs(C)<f&&(f=Math.abs(C),p=w);else if(!p){const{area:E}=x;E<d&&(d=E,h=w)}}}else if(C<xs/o)return w}return p||h||void 0}getShapesAtPoint(n,r={}){return this.currentPageShapes.filter(s=>this.isPointInShape(s,n,r))}isPointInShape(n,r,s={}){const{hitInside:o=!1,margin:i=0}=s;typeof n!="string"&&(n=n.id);const a=this.getShapeMask(n);return a&&!fs(r,a)?!1:this.getShapeGeometry(n).hitTestPoint(this.getPointInShapeSpace(n,r),i,o)}getPointInShapeSpace(n,r){const s=typeof n=="string"?n:n.id;return this._shapePageTransformCache.get(s).clone().invert().applyToPoint(r)}getPointInParentSpace(n,r){const s=typeof n=="string"?this.getShape(n):n;if(!s)return new P(0,0);if(wn(s.parentId))return P.From(r);const o=this.getShapePageTransform(s.parentId);return o?o.clone().invert().applyToPoint(r):P.From(r)}get currentPageShapes(){return Array.from(this.currentPageShapeIds,n=>this.store.get(n))}get currentPageShapesSorted(){const n=new Set(this.currentPageShapes.sort(Qt)),r=[];function s(o){r.push(o),n.delete(o),n.forEach(i=>{i.parentId===o.id&&s(i)})}return n.forEach(o=>{const i=this.getShape(o.parentId);Hi(i)||s(o)}),r}isShapeOfType(n,r){return(typeof n=="string"?this.getShape(n):n).type===r}getShape(n){if(n===void 0)throw Error();if(typeof n!="string"&&(n=n.id),!!ar(n))return this.store.get(n)}getShapeParent(n){const r=typeof n=="string"?this.getShape(n):n;if(!(r===void 0||!ar(r.parentId)))return this.store.get(r.parentId)}getShapeNearestSibling(n,r){return r?r.parentId===n.parentId?r:this.findShapeAncestor(r,o=>o.parentId===n.parentId):void 0}isShapeInPage(n,r=this.currentPageId){const s=typeof n=="string"?this.getShape(n):n;let o=!1;if(s.parentId===r)o=!0;else{let i=this.getShape(s.parentId);e:for(;i;){if(i.parentId===r){o=!0;break e}i=this.getShape(i.parentId)}}return o}getAncestorPageId(n){const r=typeof n=="string"?this.getShape(n):n;if(r!==void 0)return wn(r.parentId)?r.parentId:this.getAncestorPageId(this.getShape(r.parentId))}reparentShapes(n,r,s){const o=typeof n[0]=="string"?n:n.map(f=>f.id),i=[],a=wn(r)?te.Identity():this.getShapePageTransform(r),c=a.rotation();let l=[];const u=me(this.getSortedChildIdsForParent(r).map(f=>this.getShape(f)));if(s){const f=u.find(p=>p.index===s);if(f){const p=u[u.indexOf(f)+1];p?l=Yc(s,p.index,o.length):l=Jy(s,o.length)}else{const p=u.sort(Qt).find(m=>m.index>s);p?l=Yc(s,p.index,o.length):l=Jy(s,o.length)}}else{const f=u.length&&u[u.length-1];l=f?Jy(f.index,o.length):A3(o.length)}const d=a.clone().invert();let h;for(let f=0;f<o.length;f++){h=o[f];const p=this.getShape(h);if(!p)continue;const m=this.getShapePageTransform(p);if(!m)continue;const v=m.point();if(!p||!v)continue;const w=d.applyToPoint(v),x=m.rotation()-c;i.push({id:p.id,type:p.type,parentId:r,x:w.x,y:w.y,rotation:x,index:l[f]})}return this.updateShapes(i),this}getHighestIndexForParent(n){const r=typeof n=="string"?n:n.id,s=this._parentIdsToChildIds.value[r];if(!s||s.length===0)return"a1";const o=this.getShape(s[s.length-1]);return Ms(o.index)}getSortedChildIdsForParent(n){const r=typeof n=="string"?n:n.id,s=this._parentIdsToChildIds.value[r];return s?this._childIdsCache.get(s,()=>s):Fs}visitDescendants(n,r){const s=typeof n=="string"?n:n.id,o=this.getSortedChildIdsForParent(s);for(const i of o)r(i)!==!1&&this.visitDescendants(i,r);return this}getShapeAndDescendantIds(n){const r=new Set,s=[...n];for(;s.length>0;){const o=s.pop();if(!o)break;if(!r.has(o)){r.add(o);for(const i of this.getSortedChildIdsForParent(o))s.push(i)}}return r}getDroppingOverShape(n,r=[]){return this.currentPageShapesSorted.findLast(s=>{if(!this.getShapeUtil(s).canDropShapes(s,r)||r.find(i=>i.id===s.id||this.hasAncestor(s,i.id)))return!1;const o=this.getShapeMaskedPageBounds(s.id);if(o&&o.containsPoint(n)&&this.getShapeGeometry(s).hitTestPoint(this.getPointInShapeSpace(s,n),0,!0))return!0})}getOutermostSelectableShape(n,r){const s=typeof n=="string"?this.getShape(n):n;let o=s,i=s;const a=this.focusedGroupId?this.getShape(this.focusedGroupId):void 0;for(;i;){if(this.isShapeOfType(i,"group")&&this.focusedGroupId!==i.id&&!this.hasAncestor(a,i.id)&&((r==null?void 0:r(i))??!0))o=i;else if(this.focusedGroupId===i.id)break;i=this.getShapeParent(i)}return o}rotateShapesBy(n,r){if((typeof n[0]=="string"?n:n.map(i=>i.id)).length<=0)return this;const o=M3({editor:this});return o?(Lf({delta:r,snapshot:o,editor:this,stage:"one-off"}),this):this}nudgeShapes(n,r,s=!1){var a,c;const o=typeof n[0]=="string"?n:n.map(l=>l.id);if(o.length<=0)return this;const i=[];for(const l of o){const u=this.getShape(l);if(!u)throw Error(`Could not find a shape with the id ${l}.`);const d=P.Cast(r),h=this.getShapeParentTransform(u);h&&d.rot(-h.rotation());const f=(c=(a=this.getShapeUtil(u)).onTranslateStart)==null?void 0:c.call(a,u);i.push(f?{...f,x:u.x+d.x,y:u.y+d.y}:{id:l,x:u.x+d.x,y:u.y+d.y,type:u.type})}return this.updateShapes(i,s),this}duplicateShapes(n,r){const s=typeof n[0]=="string"?n:n.map(u=>u.id);if(s.length<=0)return this;const o=new Set(s),i=[],a=[...s];for(;a.length>0;){const u=a.pop();if(!u)break;i.push(u),this.getSortedChildIdsForParent(u).forEach(d=>a.push(d))}i.reverse();const c=new Map(i.map(u=>[u,Ke()])),l=me(i.map(u=>{const d=this.getShape(u);if(!d)return null;const h=c.get(u);let f=0,p=0;if(r&&o.has(u)){const _=this.getShapeParentTransform(d),k=new P(r.x,r.y).rot(-_.rotation());f=k.x,p=k.y}const m=d.parentId??this.currentPageId,v=this.getSortedChildIdsForParent(m),w=v.indexOf(d.id),x=v[w+1],b=x?this.getShape(x):null,C=b?vu(d.index,b.index):Ms(d.index);let E=kn(d);if(this.isShapeOfType(d,"arrow")&&this.isShapeOfType(E,"arrow")){const _=this.getArrowInfo(d);let k,I;if(d.props.start.type==="binding"&&(k=c.get(d.props.start.boundShapeId),!k))if(_!=null&&_.isValid){const{x:A,y:D}=_.start.point;E.props.start={type:"point",x:A,y:D}}else{const{start:A}=jr(this,d);E.props.start={type:"point",x:A.x,y:A.y}}if(d.props.end.type==="binding"&&(I=c.get(d.props.end.boundShapeId),!I))if(_!=null&&_.isValid){const{x:A,y:D}=_.end.point;E.props.end={type:"point",x:A,y:D}}else{const{end:A}=jr(this,d);E.props.start={type:"point",x:A.x,y:A.y}}const $=Ul(E)?wu(this,E):n0(this,E);if(_!=null&&_.isValid&&($!=null&&$.isValid)&&!Ul(d)){const A=P.Med(_.start.handle,_.end.handle),D=P.Dist(_.middle,A),L=P.Dist($.middle,A);E.props.bend<0?E.props.bend+=L-D:E.props.bend-=L-D}E.props.start.type==="binding"&&k&&(E.props.start.boundShapeId=k),E.props.end.type==="binding"&&I&&(E.props.end.boundShapeId=I)}return E={...E,id:h,x:d.x+f,y:d.y+p,index:C},E}));return l.forEach(u=>{ar(u.parentId)&&c.has(u.parentId)&&(u.parentId=c.get(u.parentId))}),this.history.batch(()=>{const u=l.length+this.currentPageShapeIds.size>Io;u&&Kh(this);const d=u?l.slice(0,Io-this.currentPageShapeIds.size):l,h=d.map(f=>f.id);if(this.createShapes(d),this.setSelectedShapeIds(h),r!==void 0){const{viewportPageBounds:f,selectionPageBounds:p}=this;p&&!f.contains(p)&&this.centerOnPoint(p.center,{duration:Ds})}}),this}moveShapesToPage(n,r){const s=typeof n[0]=="string"?n:n.map(c=>c.id);if(s.length===0)return this;if(this.instanceState.isReadonly)return this;const{currentPageId:o}=this;if(r===o)return this;if(!this.store.has(r))return this;const i=this.getContent(s);if(!i)return this;if(this.getCurrentPageShapeIds(r).size+i.shapes.length>Io)return Kh(this,r),this;const a=this.camera.z;return this.history.batch(()=>{this.deleteShapes(s),this.setCurrentPage(r),this.setFocusedGroupId(null),this.selectNone(),this.putContent(i,{select:!0,preserveIds:!0,preservePosition:!0}),this.setCamera({...this.camera,z:a}),this.centerOnPoint(this.selectionRotatedPageBounds.center)}),this}toggleLock(n){const r=typeof n[0]=="string"?n:n.map(a=>a.id);if(this.instanceState.isReadonly||r.length===0)return this;let s=!0,o=!0;const i=[];for(const a of r){const c=this.getShape(a);c&&(i.push(c),c.isLocked?o=!1:s=!1)}return this.batch(()=>{o?(this.updateShapes(i.map(a=>({id:a.id,type:a.type,isLocked:!0}))),this.setSelectedShapeIds([])):s?this.updateShapes(i.map(a=>({id:a.id,type:a.type,isLocked:!1}))):this.updateShapes(i.map(a=>({id:a.id,type:a.type,isLocked:!0})))}),this}sendToBack(n){const r=typeof n[0]=="string"?n:n.map(o=>o.id),s=Hh(this,"toBack",r);return s&&this.updateShapes(s),this}sendBackward(n){const r=typeof n[0]=="string"?n:n.map(o=>o.id),s=Hh(this,"backward",r);return s&&this.updateShapes(s),this}bringForward(n){const r=typeof n[0]=="string"?n:n.map(o=>o.id),s=Hh(this,"forward",r);return s&&this.updateShapes(s),this}bringToFront(n){const r=typeof n[0]=="string"?n:n.map(o=>o.id),s=Hh(this,"toFront",r);return s&&this.updateShapes(s),this}flipShapes(n,r){const s=typeof n[0]=="string"?n:n.map(a=>a.id);if(this.instanceState.isReadonly)return this;let o=me(s.map(a=>this.getShape(a)));if(!o.length)return this;o=me(o.map(a=>this.isShapeOfType(a,"group")?this.getSortedChildIdsForParent(a.id).map(c=>this.getShape(c)):a).flat());const i=ae.Common(me(o.map(a=>this.getShapePageBounds(a)))).center;return this.batch(()=>{for(const a of o){const c=this.getShapeGeometry(a).bounds,l=this.getShapePageTransform(a.id);l&&this.resizeShape(a.id,{x:r==="horizontal"?-1:1,y:r==="vertical"?-1:1},{initialBounds:c,initialPageTransform:l,initialShape:a,mode:"scale_shape",scaleOrigin:i,scaleAxisRotation:0})}}),this}stackShapes(n,r,s){const o=typeof n[0]=="string"?n:n.map(v=>v.id);if(this.instanceState.isReadonly)return this;const i=me(o.map(v=>this.getShape(v))).filter(v=>!(!v||this.isShapeOfType(v,"arrow")&&(v.props.start.type==="binding"||v.props.end.type==="binding"))),a=i.length;if(s===0&&a<3||a<2)return this;const c=Object.fromEntries(i.map(v=>[v.id,this.getShapePageBounds(v)]));let l,u,d,h;r==="horizontal"?(l="x",u="minX",d="maxX",h="width"):(l="y",u="minY",d="maxY",h="height");let f;if(s===0){const v=[];i.sort((x,b)=>c[x.id][u]-c[b.id][u]);for(let x=0;x<a-1;x++){const b=i[x],C=i[x+1],E=c[b.id],k=c[C.id][u]-E[d],I=v.find($=>$.gap===k);I?I.count++:v.push({gap:k,count:1})}let w=0;v.forEach(x=>{x.count>w&&(w=x.count,f=x.gap)}),w===1&&(f=Math.max(0,v.reduce((x,b)=>x+b.gap*b.count,0)/(a-1)))}else f=s;const p=[];let m=c[i[0].id][d];return i.forEach((v,w)=>{var _,k;if(w===0)return;const x={x:0,y:0};x[l]=m+f-c[v.id][l];const b=this.getShapeParent(v),C=b?P.Rot(x,-this.getShapePageTransform(b).decompose().rotation):x,E=(k=(_=this.getShapeUtil(v)).onTranslateStart)==null?void 0:k.call(_,v);p.push(E?{...E,[l]:v[l]+C[l]}:{id:v.id,type:v.type,[l]:v[l]+C[l]}),m+=c[v.id][h]+f}),this.updateShapes(p),this}packShapes(n,r){var k,I;const s=typeof n[0]=="string"?n:n.map($=>$.id);if(this.instanceState.isReadonly)return this;if(s.length<2)return this;const o=me(s.map($=>this.getShape($)).filter($=>!(!$||this.isShapeOfType($,"arrow")&&($.props.start.type==="binding"||$.props.end.type==="binding")))),i={},a={};let c,l,u=0;for(let $=0;$<o.length;$++)c=o[$],l=this.getShapePageBounds(c),i[c.id]=l,a[c.id]=l.clone(),u+=l.width*l.height;const d=ae.Common(me(Object.values(i))),h=d.width;o.sort(($,A)=>i[A.id].height-i[$.id].height);const f=Math.max(Math.ceil(Math.sqrt(u/.95)),h),p=[new ae(d.x,d.y,f,1/0)];let m=0,v=0,w,x;for(let $=0;$<o.length;$++){c=o[$],l=a[c.id];for(let A=p.length-1;A>=0;A--)if(w=p[A],!(l.width>w.width||l.height>w.height)){l.x=w.x,l.y=w.y,v=Math.max(v,l.maxY),m=Math.max(m,l.maxX),l.width===w.width&&l.height===w.height?(x=p.pop(),A<p.length&&(p[A]=x)):l.height===w.height?(w.x+=l.width+r,w.width-=l.width+r):l.width===w.width?(w.y+=l.height+r,w.height-=l.height+r):(p.push(new ae(w.x+(l.width+r),w.y,w.width-(l.width+r),l.height)),w.y+=l.height+r,w.height-=l.height+r);break}}const b=ae.Common(Object.values(a)),C=P.Sub(d.center,b.center);let E;const _=[];for(let $=0;$<o.length;$++){c=o[$],l=i[c.id],E=a[c.id];const A=P.Sub(E.point,l.point).add(C),D=this.getShapeParentTransform(c);D&&A.rot(-D.rotation());const L={id:c.id,type:c.type,x:c.x+A.x,y:c.y+A.y},j=(I=(k=this.getShapeUtil(c)).onTranslateStart)==null?void 0:I.call(k,{...c,...L});j?_.push({...L,...j}):_.push(L)}return _.length&&this.updateShapes(_),this}alignShapes(n,r){const s=typeof n[0]=="string"?n:n.map(l=>l.id);if(this.instanceState.isReadonly)return this;if(s.length<2)return this;const o=me(s.map(l=>this.getShape(l))),i=Object.fromEntries(o.map(l=>[l.id,this.getShapePageBounds(l)])),a=ae.Common(me(Object.values(i))),c=[];return o.forEach(l=>{var m,v;const u=i[l.id];if(!u)return;const d={x:0,y:0};switch(r){case"top":{d.y=a.minY-u.minY;break}case"center-vertical":{d.y=a.midY-u.minY-u.height/2;break}case"bottom":{d.y=a.maxY-u.minY-u.height;break}case"left":{d.x=a.minX-u.minX;break}case"center-horizontal":{d.x=a.midX-u.minX-u.width/2;break}case"right":{d.x=a.maxX-u.minX-u.width;break}}const h=this.getShapeParent(l),f=h?P.Rot(d,-this.getShapePageTransform(h).decompose().rotation):d,p=(v=(m=this.getShapeUtil(l)).onTranslateStart)==null?void 0:v.call(m,l);c.push(p?{...p,x:l.x+f.x,y:l.y+f.y}:{id:l.id,type:l.type,x:l.x+f.x,y:l.y+f.y})}),this.updateShapes(c),this}distributeShapes(n,r){const s=typeof n[0]=="string"?n:n.map(b=>b.id);if(this.instanceState.isReadonly)return this;if(s.length<3)return this;const o=s.length,i=me(s.map(b=>this.getShape(b))),a=Object.fromEntries(i.map(b=>[b.id,this.getShapePageBounds(b)]));let c,l,u,d,h;r==="horizontal"?(c="x",l="minX",u="maxX",d="midX",h="width"):(c="y",l="minY",u="maxY",d="midY",h="height");const f=[],p=i.sort((b,C)=>a[b.id][l]-a[C.id][l])[0],m=i.sort((b,C)=>a[C.id][u]-a[b.id][u])[0],v=a[p.id][d],w=(a[m.id][d]-v)/(o-1),x=v+w;return i.filter(b=>b!==p&&b!==m).sort((b,C)=>a[b.id][d]-a[C.id][d]).forEach((b,C)=>{var $,A;const E={x:0,y:0};E[c]=x+w*C-a[b.id][h]/2-a[b.id][c];const _=this.getShapeParent(b),k=_?P.Rot(E,-this.getShapePageTransform(_).rotation()):E,I=(A=($=this.getShapeUtil(b)).onTranslateStart)==null?void 0:A.call($,b);f.push(I?{...I,[c]:b[c]+k[c]}:{id:b.id,type:b.type,[c]:b[c]+k[c]})}),this.updateShapes(f),this}stretchShapes(n,r){const s=typeof n[0]=="string"?n:n.map(u=>u.id);if(this.instanceState.isReadonly)return this;if(s.length<2)return this;const o=me(s.map(u=>this.getShape(u))),i=Object.fromEntries(s.map(u=>[u,this.getShapeGeometry(u).bounds])),a=Object.fromEntries(s.map(u=>[u,this.getShapePageBounds(u)])),c=ae.Common(me(Object.values(a))),l=[];switch(r){case"vertical":{this.batch(()=>{for(const u of o){if(this.getShapePageTransform(u).rotation()%Oe)continue;const h=i[u.id],f=a[u.id],p=new P(0,c.minY-f.minY),m=this.getShapeParentTransform(u);m&&p.rot(-m.rotation());const{x:v,y:w}=P.Add(p,u);this.updateShapes([{id:u.id,type:u.type,x:v,y:w}],!0);const x=new P(1,c.height/f.height);this.resizeShape(u.id,x,{initialBounds:h,scaleOrigin:new P(f.center.x,c.minY),scaleAxisRotation:0})}});break}case"horizontal":{this.batch(()=>{for(const u of o){const d=i[u.id],h=a[u.id];if(this.getShapePageTransform(u).rotation()%Oe)continue;const p=new P(c.minX-h.minX,0),m=this.getShapeParentTransform(u);m&&p.rot(-m.rotation());const{x:v,y:w}=P.Add(p,u);this.updateShapes([{id:u.id,type:u.type,x:v,y:w}],!0);const x=new P(c.width/h.width,1);this.resizeShape(u.id,x,{initialBounds:d,scaleOrigin:new P(c.minX,h.center.y),scaleAxisRotation:0})}});break}}return this.updateShapes(l),this}resizeShape(n,r,s={}){var h;if(this.instanceState.isReadonly)return this;Number.isFinite(r.x)||(r=new P(1,r.y)),Number.isFinite(r.y)||(r=new P(r.x,1));const o=s.initialShape??this.getShape(n);if(!o)return this;const i=s.scaleOrigin??((h=this.getShapePageBounds(n))==null?void 0:h.center);if(!i)return this;const a=s.initialPageTransform?te.Cast(s.initialPageTransform):this.getShapePageTransform(n);if(!a)return this;const c=a.rotation();if(c==null)return this;const l=s.scaleAxisRotation??c,u=s.initialBounds??this.getShapeGeometry(n).bounds;if(!u)return this;if(!YT(c,l))return this._resizeUnalignedShape(n,r,{...s,initialBounds:u,scaleOrigin:i,scaleAxisRotation:l,initialPageTransform:a,initialShape:o});const d=this.getShapeUtil(o);if(d.isAspectRatioLocked(o)&&(Math.abs(r.x)>Math.abs(r.y)?r=new P(r.x,Math.sign(r.y)*Math.abs(r.x)):r=new P(Math.sign(r.x)*Math.abs(r.y),r.y)),d.onResize&&d.canResize(o)){const f=this._scalePagePoint(te.applyToPoint(a,new P(0,0)),i,r,l),p=this.getPointInParentSpace(o.id,f),m=new P(r.x,r.y),v=yu((c-l)%Math.PI,0);m.x=v?r.x:r.y,m.y=v?r.y:r.x;const w=te.applyToPoint(a,new P),{x,y:b}=this.getPointInParentSpace(o.id,w);this.updateShapes([{id:n,type:o.type,x:p.x,y:p.y,...d.onResize({...o,x,y:b},{newPoint:p,handle:s.dragHandle??"bottom_right",mode:s.mode??"scale_shape",scaleX:m.x,scaleY:m.y,initialBounds:u,initialShape:o})}],!0)}else{const f=te.applyToPoint(a,u.center),p=this._scalePagePoint(f,i,r,l),m=this.getPointInParentSpace(o.id,f),v=this.getPointInParentSpace(o.id,p),w=P.Sub(v,m);this.updateShapes([{id:n,type:o.type,x:o.x+w.x,y:o.y+w.y}],!0)}return this}_resizeUnalignedShape(n,r,s){const{type:o}=s.initialShape,i=new P(r.x,r.y);if(Math.abs(r.x)>Math.abs(r.y)?i.x=Math.sign(r.x)*Math.abs(r.y):i.y=Math.sign(r.y)*Math.abs(r.x),this.resizeShape(n,i,{initialShape:s.initialShape,initialBounds:s.initialBounds}),Math.sign(r.x)*Math.sign(r.y)<0){let{rotation:w}=te.Decompose(s.initialPageTransform);w-=2*w,this.updateShapes([{id:n,type:o,rotation:w}],!0)}const a=te.applyToPoint(s.initialPageTransform,s.initialBounds.center),c=this._scalePagePoint(a,s.scaleOrigin,r,s.scaleAxisRotation),l=this.getShapePageBounds(n),u=this.getShapePageTransform(n),d=l.center,h=u.point();if(!d||!h)return this;const f=P.Sub(c,d),p=P.Add(h,f),{x:m,y:v}=this.getPointInParentSpace(n,p);return this.updateShapes([{id:n,type:o,x:m,y:v}],!0),this}_scalePagePoint(n,r,s,o){const i=P.RotWith(n,r,-o).sub(r),a=P.MulV(i,s);return P.Add(a,r).rotWith(r,o)}getInitialMetaForShape(n){return{}}createShape(n){return this._createShapes([n]),this}createShapes(n){if(!Array.isArray(n))throw Error("Editor.createShapes: must provide an array of shapes or shape partials");return this._createShapes(n),this}animateShape(n,r){return this.animateShapes([n],r)}animateShapes(n,r={}){const{duration:s=500,ease:o=en.linear}=r,i=Ze();let a=s,c;const l=[];n.forEach(h=>{if(!h)return;const f={partial:h,values:[]},p=this.getShape(h.id);if(p){for(const m of["x","y","rotation"])h[m]!==void 0&&p[m]!==h[m]&&f.values.push({prop:m,from:p[m],to:h[m]});l.push(f),this.animatingShapes.set(p.id,i)}});let u;const d=h=>{if(a-=h,a<0){const{animatingShapes:p}=this,m=n.filter(v=>v&&p.get(v.id)===i);m.length&&this.updateShapes(m,!1),this.removeListener("tick",d);return}c=o(1-a/s);const{animatingShapes:f}=this;try{const p=[];for(let m=0;m<l.length;m++)u=l[m],f.get(u.partial.id)===i&&p.push({id:u.partial.id,type:u.partial.type,...u.values.reduce((v,{prop:w,from:x,to:b})=>(v[w]=x+(b-x)*c,v),{})});this._updateShapes(p,!0)}catch{}};return this.addListener("tick",d),this}groupShapes(n,r=Ke()){var f;if(!Array.isArray(n))throw Error("Editor.groupShapes: must provide an array of shapes or shape ids");if(this.instanceState.isReadonly)return this;if(n.length<=1)return this;const s=typeof n[0]=="string"?n:n.map(p=>p.id),o=me(this._getUnlockedShapeIds(s).map(p=>this.getShape(p))),i=o.sort(Qt).map(p=>p.id),a=ae.Common(me(o.map(p=>this.getShapePageBounds(p)))),{x:c,y:l}=a.point,u=this.findCommonAncestor(o)??this.currentPageId;if(this.currentToolId!=="select")return this;this.isIn("select.idle")||this.cancel();const d=o.filter(p=>p.parentId===u).sort(Qt),h=(f=d[d.length-1])==null?void 0:f.index;return this.batch(()=>{this.createShapes([{id:r,type:"group",parentId:u,index:h,x:c,y:l,opacity:1,props:{}}]),this.reparentShapes(i,r),this.select(r)}),this}ungroupShapes(n){const r=typeof n[0]=="string"?n:n.map(a=>a.id);if(this.instanceState.isReadonly)return this;if(r.length===0)return this;if(this.currentToolId!=="select")return this;this.isIn("select.idle")||this.cancel();const s=new Set,o=me(r.map(a=>this.getShape(a))),i=[];return o.forEach(a=>{this.isShapeOfType(a,"group")?i.push(a):s.add(a.id)}),i.length===0?this:(this.batch(()=>{let a;for(let c=0,l=i.length;c<l;c++){a=i[c];const u=this.getSortedChildIdsForParent(a.id);for(let d=0,h=u.length;d<h;d++)s.add(u[d]);this.reparentShapes(u,a.parentId,a.index)}this.deleteShapes(i.map(c=>c.id)),this.select(...s)}),this)}updateShape(n,r=!1){return this.updateShapes([n],r),this}updateShapes(n,r=!1){let s=me(n);return this.animatingShapes.size>0&&s.forEach(o=>this.animatingShapes.delete(o.id)),s=s.filter(o=>{const i=this.getShape(o.id);return!(!i||this.isShapeOrAncestorLocked(i)&&!Object.hasOwn(o,"isLocked"))}),this._updateShapes(s,r),this}_getUnlockedShapeIds(n){return n.filter(r=>{var s;return!((s=this.getShape(r))!=null&&s.isLocked)})}deleteShapes(n){if(!Array.isArray(n))throw Error("Editor.deleteShapes: must provide an array of shapes or shapeIds");return this._deleteShapes(this._getUnlockedShapeIds(typeof n[0]=="string"?n:n.map(r=>r.id))),this}deleteShape(n){return this.deleteShapes([typeof n=="string"?n:n.id]),this}_extractSharedStyles(n,r){if(this.isShapeOfType(n,"group")){const s=this._parentIdsToChildIds.value[n.id];if(!s)return;for(let o=0,i=s.length;o<i;o++)this._extractSharedStyles(this.getShape(s[o]),r)}else for(const[s,o]of this.styleProps[n.type])r.applyValue(s,Zi(n.props,o))}getStyleForNextShape(n){const r=this.instanceState.stylesForNextShape[n.id];return r===void 0?n.defaultValue:r}getShapeStyleIfExists(n,r){const s=this.styleProps[n.type].get(r);if(s!==void 0)return Zi(n.props,s)}get sharedStyles(){if(this.isIn("select")&&this.selectedShapeIds.length>0)return this._selectionSharedStyles.value;const n=this.root.current.value,r=new Uw;if(n.shapeType)for(const s of this.styleProps[n.shapeType].keys())r.applyValue(s,this.getStyleForNextShape(s));return r}get sharedOpacity(){if(this.isIn("select")&&this.selectedShapeIds.length>0){const n=[],r=o=>{const i=this.getShape(o);if(i)if(this.isShapeOfType(i,"group"))for(const a of this.getSortedChildIdsForParent(i.id))r(a);else n.push(i)};for(const o of this.selectedShapeIds)r(o);let s=null;for(const o of n)if(s===null)s=o.opacity;else if(s!==o.opacity)return{type:"mixed"};if(s!==null)return{type:"shared",value:s}}return{type:"shared",value:this.instanceState.opacityForNextShape}}setOpacity(n,r=!1,s=!1){return this.history.batch(()=>{if(this.isIn("select")){const{currentPageState:{selectedShapeIds:o}}=this,i=[],a=c=>{const l=this.getShape(c);if(l)if(this.isShapeOfType(l,"group")){const u=this.getSortedChildIdsForParent(c);for(const d of u)a(d)}else i.push(l)};if(o.length>0){for(const c of o)a(c);this.updateShapes(i.map(c=>({id:c.id,type:c.type,opacity:n})),r)}}this.updateInstanceState({opacityForNextShape:n},r,s)}),this}setStyle(n,r,s=!1,o=!1){return this.history.batch(()=>{if(this.isIn("select")){const{currentPageState:{selectedShapeIds:i}}=this;if(i.length>0){const a=[],c=l=>{const u=this.getShape(l);if(u)if(this.isShapeOfType(u,"group")){const d=this.getSortedChildIdsForParent(l);for(const h of d)c(h)}else{const d=this.getShapeUtil(u),h=this.styleProps[u.type].get(n);if(h){const f={id:u.id,type:u.type,props:{[h]:r}};a.push({util:d,originalShape:u,updatePartial:f})}}};for(const l of i)c(l);this.updateShapes(a.map(({updatePartial:l})=>l),s)}}this.updateInstanceState({stylesForNextShape:{...this.instanceState.stylesForNextShape,[n.id]:r}},s,o)}),this}registerExternalAssetHandler(n,r){return this.externalAssetContentHandlers[n]=r,this}async getAssetForExternalContent(n){var r,s;return await((s=(r=this.externalAssetContentHandlers)[n.type])==null?void 0:s.call(r,n))}registerExternalContentHandler(n,r){return this.externalContentHandlers[n]=r,this}async putExternalContent(n){var r,s;return(s=(r=this.externalContentHandlers)[n.type])==null?void 0:s.call(r,n)}getContent(n){const r=typeof n[0]=="string"?n:n.map(c=>c.id);if(!r||r.length===0)return;const s={};let o=Kp(r.map(c=>this.getShape(c)).sort(Qt).flatMap(c=>{const l=[c];return this.visitDescendants(c.id,u=>{l.push(this.getShape(u))}),l}));o=o.map(c=>{if(s[c.id]=this.getShapePageTransform(c.id),c=ei(c),this.isShapeOfType(c,"arrow")){const l=c.props.start.type==="binding"?c.props.start.boundShapeId:void 0,u=c.props.end.type==="binding"?c.props.end.boundShapeId:void 0,d=this.getArrowInfo(c);if(c.props.start.type==="binding"&&!o.some(f=>f.id===l))if(d!=null&&d.isValid){const{x:f,y:p}=d.start.point;c.props.start={type:"point",x:f,y:p}}else{const{start:f}=jr(this,c);c.props.start={type:"point",x:f.x,y:f.y}}if(c.props.end.type==="binding"&&!o.some(f=>f.id===u))if(d!=null&&d.isValid){const{x:f,y:p}=d.end.point;c.props.end={type:"point",x:f,y:p}}else{const{end:f}=jr(this,c);c.props.end={type:"point",x:f.x,y:f.y}}const h=Ul(c)?wu(this,c):n0(this,c);if(d!=null&&d.isValid&&(h!=null&&h.isValid)&&!Ul(c)){const f=P.Med(d.start.handle,d.end.handle),p=P.Dist(d.middle,f),m=P.Dist(h.middle,f);c.props.bend<0?c.props.bend+=m-p:c.props.bend-=m-p}return c}return c});const i=[];o.forEach(c=>{if(o.find(l=>l.id===c.parentId)===void 0){const l=this.getShapePageTransform(c.id),u=l.point(),d=l.rotation();c.x=u.x,c.y=u.y,c.rotation=d,c.parentId=this.currentPageId,i.push(c.id)}});const a=new Set;return o.forEach(c=>{"assetId"in c.props&&c.props.assetId!==null&&a.add(c.props.assetId)}),{shapes:o,rootShapeIds:i,schema:this.store.schema.serialize(),assets:me(Array.from(a).map(c=>this.getAsset(c)))}}putContent(n,r={}){if(this.instanceState.isReadonly)return this;if(!n.schema)throw Error(`Could not put content:
content is missing a schema.`);const{select:s=!1,preserveIds:o=!1,preservePosition:i=!1}=r;let{point:a=void 0}=r;const{currentPageId:c}=this,{assets:l,shapes:u,rootShapeIds:d}=n,h=new Map(u.map(E=>[E.id,Ke()]));let f=this.currentPageId,p=1/0,m=[];for(const E of this.selectedShapes){if(p===0)break;const _=this.isShapeOfType(E,"frame"),k=this.getShapeAncestors(E);_&&k.push(E);const I=_?k.length+1:k.length;if(I<p)p=I,m=k,f=_?E.id:E.parentId;else if(I===p){if(m.length!==k.length)throw Error(`Ancestors: ${m.length} !== ${k.length}`);if(m.length===0){f=c;break}else{f=c;for(let $=0;$<m.length&&k[$]===m[$];$++)f=k[$].id}}}let v=!1;if(!wn(f)){const E=this.getShape(f);if(E){if(!this.viewportPageBounds.includes(this.getShapePageBounds(E)))f=c;else if(d.length===1){const _=u.find(k=>k.id===d[0]);this.isShapeOfType(E,"frame")&&this.isShapeOfType(_,"frame")&&_.props.w===(E==null?void 0:E.props.w)&&_.props.h===(E==null?void 0:E.props.h)&&(v=!0)}}else f=c}v||(v=h.has(f)),v&&(f=this.getShape(f).parentId);let w=this.getHighestIndexForParent(f);const x=[],b=u.map(E=>{let _;if(o)_=kn(E),h.set(E.id,E.id);else{const k=h.get(E.id);_=kn({...E,id:k})}if(d.includes(E.id)&&(_.parentId=c,x.push(_)),h.has(_.parentId)?_.parentId=h.get(E.parentId):(d.push(_.id),_.index=w,w=Ms(w)),this.isShapeOfType(_,"arrow")){if(_.props.start.type==="binding"){const k=h.get(_.props.start.boundShapeId);_.props.start=k?{..._.props.start,boundShapeId:k}:{type:"point",x:0,y:0}}if(_.props.end.type==="binding"){const k=h.get(_.props.end.boundShapeId);_.props.end=k?{..._.props.end,boundShapeId:k}:{type:"point",x:0,y:0}}}return _});if(b.length+this.currentPageShapeIds.size>Io)return Kh(this),this;let C=[];if(l){for(let _=0;_<l.length;_++){const k=l[_],I=this.store.schema.migratePersistedRecord(k,n.schema);if(I.type==="success")l[_]=I.value;else throw Error(`Could not put content:
could not migrate content for asset:
${k.id}
${k.type}
reason:${I.reason}`)}const E=[];C=l.filter(_=>!this.store.has(_.id)).map(_=>{var k;return(_.type==="image"||_.type==="video")&&(_.props.src&&((k=_.props.src)!=null&&k.startsWith("data:image"))?(E.push(ei(_)),_.props.src=null):E.push(ei(_))),_}),Promise.allSettled(E.map(async _=>{const k=await AB(_.props.src,_.props.name,_.props.mimeType??"image/png"),I=await this.getAssetForExternalContent({type:"file",file:k});return I?[_,I]:null})).then(_=>{this.updateAssets(me(_.map(k=>k.status==="fulfilled"&&k.value?{...k.value[1],id:k.value[0].id}:void 0)))})}for(let E=0;E<b.length;E++){const _=b[E],k=this.store.schema.migratePersistedRecord(_,n.schema);if(k.type==="success")b[E]=k.value;else throw Error(`Could not put content:
could not migrate content for shape:
${_.id}, ${_.type}
reason:${k.reason}`)}return this.batch(()=>{C.length>0&&this.createAssets(C),this.createShapes(b),s&&this.select(...x.map(k=>k.id)),f!==c&&this.reparentShapes(x.map(k=>k.id),f);const E=b.map(k=>this.getShape(k.id)),_=ae.Common(E.map(k=>this.getShapePageBounds(k)));if(a===void 0)if(wn(f)){const{viewportPageBounds:k}=this;i||k.includes(ae.From(_))?a=_.center:a=k.center}else{const k=this.getShape(f);a=this.getShapeGeometry(k).bounds.center}if(x.length===1){const k=x[0];if(this.isShapeOfType(k,"frame"))for(;this.getShapesAtPoint(a).some(I=>this.isShapeOfType(I,"frame")&&I.props.w===k.props.w&&I.props.h===k.props.h);)a.x+=_.w+16}this.updateShapes(x.map(k=>{const I={x:(k.x??0)-(_.x+_.w/2),y:(k.y??0)-(_.y+_.h/2)};return{id:k.id,type:k.type,x:a.x+I.x,y:a.y+I.y}}))}),this}async getSvg(n,r={}){var E,_;const s=typeof n[0]=="string"?n:n.map(k=>k.id);if(s.length===0)return;if(!window.document)throw Error("No document");const{scale:o=1,background:i=!1,padding:a=n9,preserveAspectRatio:c=!1}=r,l=An({isDarkMode:this.user.isDarkMode}),u=this.getShapeAndDescendantIds(s),d=this.getUnorderedRenderingShapes([this.currentPageId]).filter(({id:k})=>u.has(k));let h=null;for(const{maskedPageBounds:k}of d)k&&(h?h.union(k):h=k.clone());if(!h)return;const f=s.length===1&&this.isShapeOfType(this.getShape(s[0]),"frame")?s[0]:null;f||h.expandBy(a);const p=h.width*o,m=h.height*o,v=window.document.createElementNS("http://www.w3.org/2000/svg","svg");c&&v.setAttribute("preserveAspectRatio",c),v.setAttribute("direction","ltr"),v.setAttribute("width",p+""),v.setAttribute("height",m+""),v.setAttribute("viewBox",`${h.minX} ${h.minY} ${h.width} ${h.height}`),v.setAttribute("stroke-linecap","round"),v.setAttribute("stroke-linejoin","round"),i?f?v.style.setProperty("background",l.solid):v.style.setProperty("background-color",l.background):v.style.setProperty("background-color","transparent");try{(_=(E=document.body).focus)==null||_.call(E)}catch{}const w=window.document.createElementNS("http://www.w3.org/2000/svg","defs");v.append(w);const x=new Map,b={addExportDef:k=>{if(x.has(k.key))return;const I=(async()=>{const $=await k.getElement();if(!$)return;const A=document.createComment(`def: ${k.key}`);w.appendChild(A);for(const D of Array.isArray($)?$:[$])w.appendChild(D)})();x.set(k.key,I)}},C=(await Promise.all(d.map(async({id:k,opacity:I,index:$,backgroundIndex:A})=>{var N,F;if(k===f)return[];const D=this.getShape(k);if(this.isShapeOfType(D,"group"))return[];const L=this.getShapeUtil(D);let j=await((N=L.toSvg)==null?void 0:N.call(L,D,b)),M=await((F=L.toBackgroundSvg)==null?void 0:F.call(L,D,b));if(j){const K=document.createElementNS("http://www.w3.org/2000/svg","g");K.appendChild(j),j=K}if(M){const K=document.createElementNS("http://www.w3.org/2000/svg","g");K.appendChild(M),M=K}if(!j&&!M){const K=this.getShapePageBounds(D),Q=window.document.createElementNS("http://www.w3.org/2000/svg","rect");Q.setAttribute("width",K.width+""),Q.setAttribute("height",K.height+""),Q.setAttribute("fill",l.solid),Q.setAttribute("stroke",l.grey.pattern),Q.setAttribute("stroke-width","1"),j=Q}let B=this.getShapePageTransform(D).toCssString();"scale"in D.props&&D.props.scale!==1&&(B=`${B} scale(${D.props.scale}, ${D.props.scale})`),j==null||j.setAttribute("transform",B),M==null||M.setAttribute("transform",B),j==null||j.setAttribute("opacity",I+""),M==null||M.setAttribute("opacity",I+"");const U=this.getShapeMask(D.id);if(U){const K=document.createElementNS("http://www.w3.org/2000/svg","clipPath");w.appendChild(K);const Q=Ze();K.id=Q;const ne=document.createElementNS("http://www.w3.org/2000/svg","path");if(ne.setAttribute("d",`M${U.map(({x:we,y:ke})=>`${we},${ke}`).join("L")}Z`),K.appendChild(ne),j){const we=document.createElementNS("http://www.w3.org/2000/svg","g");we.setAttribute("clip-path",`url(#${Q})`),we.appendChild(j),j=we}if(M){const we=document.createElementNS("http://www.w3.org/2000/svg","g");we.setAttribute("clip-path",`url(#${Q})`),we.appendChild(M),M=we}}const q=[];return j&&q.push({zIndex:$,element:j}),M&&q.push({zIndex:A,element:M}),q}))).flat();await Promise.all(x.values());for(const{element:k}of C.sort((I,$)=>I.zIndex-$.zIndex))v.appendChild(k);return v}_updateInputsFromEvent(n){var p;const{previousScreenPoint:r,previousPagePoint:s,currentScreenPoint:o,currentPagePoint:i}=this.inputs,{screenBounds:a}=this.store.unsafeGetWithoutCapture(Zt),{x:c,y:l,z:u}=n.point,{x:d,y:h,z:f}=this.camera;r.setTo(o),s.setTo(i),o.set(c,l),i.set((c-a.x)/f-d,(l-a.y)/f-h,u??.5),this.inputs.isPen=n.type==="pointer"&&n.isPen,n.name==="pointer_down"&&this.inputs.pointerVelocity.set(0,0),this.store.put([{id:Gu,typeName:"pointer",x:i.x,y:i.y,lastActivityTimestamp:n.type==="pointer"&&n.pointerId===m_.CAMERA_MOVE?((p=this.store.get(Gu))==null?void 0:p.lastActivityTimestamp)??Date.now():Date.now(),meta:{}}])}cancel(){return this.dispatch({type:"misc",name:"cancel"}),this}interrupt(){return this.dispatch({type:"misc",name:"interrupt"}),this}complete(){return this.dispatch({type:"misc",name:"complete"}),this}cancelDoubleClick(){this._clickManager.cancelDoubleClickTimeout()}dispatch(n){if(this.crashingError)return this;const{inputs:r}=this,{type:s}=n;return this.batch(()=>{if(n.type==="misc"){(n.name==="cancel"||n.name==="complete")&&(this.inputs.isDragging=!1,this.inputs.isPanning&&(this.inputs.isPanning=!1,this.updateInstanceState({cursor:{type:this._prevCursor,rotation:0}}))),this.root.handleEvent(n);return}n.shiftKey?(clearInterval(this._shiftKeyTimeout),this._shiftKeyTimeout=-1,r.shiftKey=!0):!n.shiftKey&&r.shiftKey&&this._shiftKeyTimeout===-1&&(this._shiftKeyTimeout=setTimeout(this._setShiftKeyTimeout,150)),n.altKey?(clearInterval(this._altKeyTimeout),this._altKeyTimeout=-1,r.altKey=!0):!n.altKey&&r.altKey&&this._altKeyTimeout===-1&&(this._altKeyTimeout=setTimeout(this._setAltKeyTimeout,150)),n.ctrlKey?(clearInterval(this._ctrlKeyTimeout),this._ctrlKeyTimeout=-1,r.ctrlKey=!0):!n.ctrlKey&&r.ctrlKey&&this._ctrlKeyTimeout===-1&&(this._ctrlKeyTimeout=setTimeout(this._setCtrlKeyTimeout,150));const{originPagePoint:o,originScreenPoint:i,currentPagePoint:a,currentScreenPoint:c}=r;switch(r.isPointing||(r.isDragging=!1),s){case"pinch":{if(!this.instanceState.canMoveCamera)return;switch(this._updateInputsFromEvent(n),n.name){case"pinch_start":{if(r.isPinching)return;r.isEditing||(this._pinchStart=this.camera.z,this._selectedShapeIdsAtPointerDown.length||(this._selectedShapeIdsAtPointerDown=this.selectedShapeIds),this._didPinch=!0,r.isPinching=!0,this.interrupt());return}case"pinch":{if(!r.isPinching)return;const{point:{x:l,y:u,z:d=1},delta:{x:h,y:f}}=n,{camera:{x:p,y:m,z:v}}=this,w=Math.min(Ro,Math.max(Bl,d));this.setCamera({x:p+h/v-l/v+l/w,y:m+f/v-u/v+u/w,z:w});return}case"pinch_end":{if(!r.isPinching)return this;r.isPinching=!1;const{_selectedShapeIdsAtPointerDown:l}=this;this.setSelectedShapeIds(this._selectedShapeIdsAtPointerDown,!0),this._selectedShapeIdsAtPointerDown=[];const{camera:{x:u,y:d,z:h}}=this;let f;if(h>.9&&h<1.05?f=1:h>.49&&h<.505&&(f=.5),h>this._pinchStart-.1&&h<this._pinchStart+.05&&(f=this._pinchStart),f!==void 0){const{x:p,y:m}=this.viewportScreenCenter;this.setCamera({x:u+(p/f-p)-(p/h-p),y:d+(m/f-m)-(m/h-m),z:f},{duration:100})}this._didPinch&&(this._didPinch=!1,requestAnimationFrame(()=>{this._didPinch||this.setSelectedShapeIds(l,!0)}));return}}}case"wheel":{if(!this.instanceState.canMoveCamera)return;if(!this.isMenuOpen){if(r.ctrlKey){const{x:l,y:u}=this.inputs.currentScreenPoint,{x:d,y:h,z:f}=this.camera,p=Math.min(Ro,Math.max(Bl,f+(n.delta.z??0)*f));this.setCamera({x:d+(l/p-l)-(l/f-l),y:h+(u/p-u)-(u/f-u),z:p});return}this.pan(n.delta),!r.isDragging&&r.isPointing&&o.dist(a)>(this.instanceState.isCoarsePointer?Nw:Ju)/this.zoomLevel&&(r.isDragging=!0)}break}case"pointer":{if(r.isPinching)return;this._updateInputsFromEvent(n);const{isPen:l}=n;switch(n.name){case"pointer_down":{if(this._selectedShapeIdsAtPointerDown=this.selectedShapeIds,n.button===0&&(this.capturedPointerId=n.pointerId),r.buttons.add(n.button),r.isPointing=!0,r.isDragging=!1,this.instanceState.isPenMode){if(!l)return}else l&&this.updateInstanceState({isPenMode:!0});if(n.button===5?(this._restoreToolId=this.currentToolId,this.complete(),this.setCurrentTool("eraser")):n.button===1&&(this.inputs.isPanning||(this._prevCursor=this.instanceState.cursor.type),this.inputs.isPanning=!0),this.inputs.isPanning)return this.stopCameraAnimation(),this.updateInstanceState({cursor:{type:"grabbing",rotation:0}}),this;i.setTo(c),o.setTo(a);break}case"pointer_move":{if(!l&&this.instanceState.isPenMode)return;if(this.inputs.isPanning&&this.inputs.isPointing){const{currentScreenPoint:u,previousScreenPoint:d}=this.inputs;this.pan(P.Sub(u,d));return}!r.isDragging&&r.isPointing&&o.dist(a)>(this.instanceState.isCoarsePointer?Nw:Ju)/this.zoomLevel&&(r.isDragging=!0);break}case"pointer_up":{if(r.buttons.delete(n.button),r.isPointing=!1,r.isDragging=!1,this.isMenuOpen||!l&&this.instanceState.isPenMode)return;this.capturedPointerId===n.pointerId&&(this.capturedPointerId=null,n.button=0),r.isPanning?n.button===1?this.inputs.keys.has(" ")?(this.slideCamera({speed:Math.min(2,this.inputs.pointerVelocity.len()),direction:this.inputs.pointerVelocity,friction:Of}),this.updateInstanceState({cursor:{type:"grab",rotation:0}})):(r.isPanning=!1,this.slideCamera({speed:Math.min(2,this.inputs.pointerVelocity.len()),direction:this.inputs.pointerVelocity,friction:Of}),this.updateInstanceState({cursor:{type:this._prevCursor,rotation:0}})):n.button===0&&(this.slideCamera({speed:Math.min(2,this.inputs.pointerVelocity.len()),direction:this.inputs.pointerVelocity,friction:Of}),this.updateInstanceState({cursor:{type:"grab",rotation:0}})):n.button===5&&(this.complete(),this.setCurrentTool(this._restoreToolId));break}}break}case"keyboard":{switch(n.key==="ShiftRight"&&(n.key="ShiftLeft"),n.key==="AltRight"&&(n.key="AltLeft"),n.code==="ControlRight"&&(n.code="ControlLeft"),n.name){case"key_down":{r.keys.add(n.code),!n.ctrlKey&&n.code==="Space"&&(this.inputs.isPanning||(this._prevCursor=this.instanceState.cursor.type),this.inputs.isPanning=!0,this.updateInstanceState({cursor:{type:this.inputs.isPointing?"grabbing":"grab",rotation:0}}));break}case"key_up":{r.keys.delete(n.code),n.code==="Space"&&!this.inputs.buttons.has(1)&&(this.inputs.isPanning=!1,this.updateInstanceState({cursor:{type:this._prevCursor,rotation:0}}));break}}break}}if(n.type==="pointer"&&(n.button===1?n.name="middle_click":n.button===2&&(n.name="right_click"),n.isPen===this.instanceState.isPenMode))switch(n.name){case"pointer_down":{const l=this._clickManager.transformPointerDownEvent(n);if(n.name!==l.name){this.root.handleEvent(n),this.emit("event",n),this.root.handleEvent(l),this.emit("event",l);return}break}case"pointer_up":{const l=this._clickManager.transformPointerUpEvent(n);if(n.name!==l.name){this.root.handleEvent(n),this.emit("event",n),this.root.handleEvent(l),this.emit("event",l);return}break}case"pointer_move":{this._clickManager.handleMove();break}}this.root.handleEvent(n),this.emit("event",n)}),this}}he([X],ue.prototype,"canUndo",1);he([X],ue.prototype,"canRedo",1);he([X],ue.prototype,"_arrowBindingsIndex",1);he([X],ue.prototype,"arrowInfoCache",1);he([X],ue.prototype,"currentTool",1);he([X],ue.prototype,"currentToolId",1);he([X],ue.prototype,"documentSettings",1);he([X],ue.prototype,"instanceState",1);he([X],ue.prototype,"openMenus",1);he([X],ue.prototype,"isMenuOpen",1);he([X],ue.prototype,"pageStates",1);he([X],ue.prototype,"_pageStates",1);he([X],ue.prototype,"currentPageState",1);he([X],ue.prototype,"_currentPageStateId",1);he([X],ue.prototype,"selectedShapeIds",1);he([X],ue.prototype,"selectedShapes",1);he([X],ue.prototype,"onlySelectedShape",1);he([X],ue.prototype,"selectionPageBounds",1);he([X],ue.prototype,"selectionRotation",1);he([X],ue.prototype,"selectionRotatedPageBounds",1);he([X],ue.prototype,"hoveredShapeId",1);he([X],ue.prototype,"hoveredShape",1);he([X],ue.prototype,"hintingShapeIds",1);he([X],ue.prototype,"erasingShapeIds",1);he([X],ue.prototype,"erasingShapeIdsSet",1);he([X],ue.prototype,"cameraId",1);he([X],ue.prototype,"camera",1);he([X],ue.prototype,"zoomLevel",1);he([X],ue.prototype,"viewportScreenBounds",1);he([X],ue.prototype,"viewportScreenCenter",1);he([X],ue.prototype,"viewportPageBounds",1);he([X],ue.prototype,"viewportPageCenter",1);he([X],ue.prototype,"cameraState",1);he([X],ue.prototype,"renderingShapes",1);he([X],ue.prototype,"renderingBounds",1);he([X],ue.prototype,"renderingBoundsExpanded",1);he([X],ue.prototype,"_pages",1);he([X],ue.prototype,"pages",1);he([X],ue.prototype,"_assets",1);he([X],ue.prototype,"_shapeGeometryCache",1);he([X],ue.prototype,"_shapeOutlineSegmentsCache",1);he([X],ue.prototype,"_shapeHandlesCache",1);he([X],ue.prototype,"_shapePageTransformCache",1);he([X],ue.prototype,"_shapePageBoundsCache",1);he([X],ue.prototype,"_shapeClipPathCache",1);he([X],ue.prototype,"_shapeMaskCache",1);he([X],ue.prototype,"currentPageBounds",1);he([X],ue.prototype,"currentPageShapes",1);he([X],ue.prototype,"currentPageShapesSorted",1);he([X({isEqual:(t,e)=>t.equals(e)})],ue.prototype,"sharedStyles",1);he([X],ue.prototype,"sharedOpacity",1);function Kh(t,e=t.currentPageId){const n=t.getPage(e).name;t.emit("max-shapes",{name:n,pageId:e,count:Io})}function mm(){const t=H();return Y("isDarkMode",()=>t.user.isDarkMode,[t])}const gU='<path d="m12 24.4219v-16.015l11.591 11.619h-6.781l-.411.124z" fill="white"/><path d="m21.0845 25.0962-3.605 1.535-4.682-11.089 3.686-1.553z" fill="white"/><path d="m19.751 24.4155-1.844.774-3.1-7.374 1.841-.775z" fill="black"/><path d="m13 10.814v11.188l2.969-2.866.428-.139h4.768z" fill="black"/>',mU='<path d="m13.3315 21.3799c-.284-.359-.629-1.093-1.243-1.984-.348-.504-1.211-1.453-1.468-1.935-.223-.426-.199-.617-.146-.97.094-.628.738-1.117 1.425-1.051.519.049.959.392 1.355.716.239.195.533.574.71.788.163.196.203.277.377.509.23.307.302.459.214.121-.071-.496-.187-1.343-.355-2.092-.128-.568-.159-.657-.281-1.093-.129-.464-.195-.789-.316-1.281-.084-.348-.235-1.059-.276-1.459-.057-.547-.087-1.439.264-1.849.275-.321.906-.418 1.297-.22.512.259.803 1.003.936 1.3.239.534.387 1.151.516 1.961.164 1.031.466 2.462.476 2.763.024-.369-.068-1.146-.004-1.5.058-.321.328-.694.666-.795.286-.085.621-.116.916-.055.313.064.643.288.766.499.362.624.369 1.899.384 1.831.086-.376.071-1.229.284-1.584.14-.234.497-.445.687-.479.294-.052.655-.068.964-.008.249.049.586.345.677.487.218.344.342 1.317.379 1.658.015.141.074-.392.293-.736.406-.639 1.843-.763 1.898.639.025.654.02.624.02 1.064 0 .517-.012.828-.04 1.202-.031.4-.117 1.304-.242 1.742-.086.301-.371.978-.652 1.384 0 0-1.074 1.25-1.191 1.813-.118.562-.079.566-.102.965-.023.398.121.922.121.922s-.802.104-1.234.035c-.391-.063-.875-.841-1-1.079-.172-.328-.539-.265-.682-.023-.225.383-.709 1.07-1.051 1.113-.668.084-2.054.031-3.139.02 0 0 .185-1.011-.227-1.358-.305-.259-.83-.784-1.144-1.06z" fill="white"/><g stroke="black" stroke-linecap="round" stroke-width=".75"><path d="m13.3315 21.3799c-.284-.359-.629-1.093-1.243-1.984-.348-.504-1.211-1.453-1.468-1.935-.223-.426-.199-.617-.146-.97.094-.628.738-1.117 1.425-1.051.519.049.959.392 1.355.716.239.195.533.574.71.788.163.196.203.277.377.509.23.307.302.459.214.121-.071-.496-.187-1.343-.355-2.092-.128-.568-.159-.657-.281-1.093-.129-.464-.195-.789-.316-1.281-.084-.348-.235-1.059-.276-1.459-.057-.547-.087-1.439.264-1.849.275-.321.906-.418 1.297-.22.512.259.803 1.003.936 1.3.239.534.387 1.151.516 1.961.164 1.031.466 2.462.476 2.763.024-.369-.068-1.146-.004-1.5.058-.321.328-.694.666-.795.286-.085.621-.116.916-.055.313.064.643.288.766.499.362.624.369 1.899.384 1.831.086-.376.071-1.229.284-1.584.14-.234.497-.445.687-.479.294-.052.655-.068.964-.008.249.049.586.345.677.487.218.344.342 1.317.379 1.658.015.141.074-.392.293-.736.406-.639 1.843-.763 1.898.639.025.654.02.624.02 1.064 0 .517-.012.828-.04 1.202-.031.4-.117 1.304-.242 1.742-.086.301-.371.978-.652 1.384 0 0-1.074 1.25-1.191 1.813-.118.562-.079.566-.102.965-.023.398.121.922.121.922s-.802.104-1.234.035c-.391-.063-.875-.841-1-1.079-.172-.328-.539-.265-.682-.023-.225.383-.709 1.07-1.051 1.113-.668.084-2.054.031-3.139.02 0 0 .185-1.011-.227-1.358-.305-.259-.83-.784-1.144-1.06z" stroke-linejoin="round"/><path d="m21.5664 21.7344v-3.459"/><path d="m19.5508 21.7461-.016-3.473"/><path d="m17.5547 18.3047.021 3.426"/></g>',yU='<path d="m25 16h-6.01v-6h-2.98v6h-6.01v3h6.01v6h2.98v-6h6.01z" fill="white"/><path d="m23.9902 17.0103h-6v-6.01h-.98v6.01h-6v.98h6v6.01h.98v-6.01h6z" fill="%23231f1f"/>',vU='<path d="m19 14h1v1h-1zm1 6h-1v-1h1zm-5-5h-1v-1h1zm0 5h-1v-1h1zm2-10.987-7.985 7.988 5.222 5.221 2.763 2.763 7.984-7.985z" fill="white"/><g fill="black"><path d="m23.5664 16.9971-2.557-2.809v1.829h-4.009-4.001v-1.829l-2.571 2.809 2.572 2.808-.001-1.808h4.001 4.009l-.001 1.808z"/><path d="m17.9873 17h.013v-4.001l1.807.001-2.807-2.571-2.809 2.57h1.809v4.001h.008v4.002l-1.828-.001 2.807 2.577 2.805-2.576h-1.805z"/></g>',q_="<path d='m19.7432 17.0869-4.072 4.068 2.829 2.828-8.473-.013-.013-8.47 2.841 2.842 4.075-4.068 1.414-1.415-2.844-2.842h8.486v8.484l-2.83-2.827z' fill='%23fff'/><path d='m18.6826 16.7334-4.427 4.424 1.828 1.828-5.056-.016-.014-5.054 1.842 1.841 4.428-4.422 2.474-2.475-1.844-1.843h5.073v5.071l-1.83-1.828z' fill='%23000'/>",Q_="<path d='m9 17.9907v.005l5.997 5.996.001-3.999h1.999 2.02v4l5.98-6.001-5.98-5.999.001 4.019-2.021.002h-2l.001-4.022zm1.411.003 3.587-3.588-.001 2.587h3.5 2.521v-2.585l3.565 3.586-3.564 3.585-.001-2.585h-2.521l-3.499-.001-.001 2.586z' fill='%23fff'/><path d='m17.4971 18.9932h2.521v2.586l3.565-3.586-3.565-3.585v2.605h-2.521-3.5v-2.607l-3.586 3.587 3.586 3.586v-2.587z' fill='%23000'/>",Vh='<path d="M22.4789 9.45728L25.9935 12.9942L22.4789 16.5283V14.1032C18.126 14.1502 14.6071 17.6737 14.5675 22.0283H17.05L13.513 25.543L9.97889 22.0283H12.5674C12.6071 16.5691 17.0214 12.1503 22.4789 12.1031L22.4789 9.45728Z" fill="black"/><path fill-rule="evenodd" clip-rule="evenodd" d="M21.4789 7.03223L27.4035 12.9945L21.4789 18.9521V15.1868C18.4798 15.6549 16.1113 18.0273 15.649 21.0284H19.475L13.5128 26.953L7.55519 21.0284H11.6189C12.1243 15.8155 16.2679 11.6677 21.4789 11.1559L21.4789 7.03223ZM22.4789 12.1031C17.0214 12.1503 12.6071 16.5691 12.5674 22.0284H9.97889L13.513 25.543L17.05 22.0284H14.5675C14.5705 21.6896 14.5947 21.3558 14.6386 21.0284C15.1157 17.4741 17.9266 14.6592 21.4789 14.1761C21.8063 14.1316 22.1401 14.1069 22.4789 14.1032V16.5284L25.9935 12.9942L22.4789 9.45729L22.4789 12.1031Z" fill="white"/>',wU='<path fill="white" d="M7.94 0a5.25 5.25 0 0 0-3.47 1.17A5.27 5.27 0 0 0 1 0H0v3h1c1.41 0 1.85.7 2 1v3.94H2v3h1v3c-.13.3-.57 1-2 1H0v3h1a5.27 5.27 0 0 0 3.47-1.17c.98.8 2.21 1.21 3.47 1.17h1v-3h-1c-1.41 0-1.85-.7-2-1v-3H7v-3H6V4c.13-.3.57-1 2-1h1V0H7.94z"/><path fill="black" d="M7.94 2V1a4 4 0 0 0-3.47 1.64A4 4 0 0 0 1 1v1c1.3-.17 2.56.6 3 1.84v5.1H3v1h1v4.16c-.45 1.24-1.7 2-3 1.84v1a4.05 4.05 0 0 0 3.47-1.63 4.05 4.05 0 0 0 3.47 1.63v-1A2.82 2.82 0 0 1 5 14.1V9.93h1v-1H5V3.85A2.81 2.81 0 0 1 7.94 2z"/>',SU="<path d='m13.5732 12.0361c.48-.178 1.427-.069 1.677.473.213.462.396 1.241.406 1.075.024-.369-.024-1.167.137-1.584.117-.304.347-.59.686-.691.285-.086.62-.116.916-.055.313.064.642.287.765.499.362.623.368 1.899.385 1.831.064-.272.07-1.229.283-1.584.141-.235.497-.445.687-.479.294-.052.656-.068.964-.008.249.049.586.344.677.487.219.344.342 1.316.379 1.658.016.141.074-.393.293-.736.406-.639 1.844-.763 1.898.639.026.654.02.624.02 1.064 0 .516-.012.828-.04 1.202-.03.399-.116 1.304-.241 1.742-.086.301-.371.978-.653 1.384 0 0-1.074 1.25-1.191 1.812-.117.563-.078.567-.102.965-.023.399.121.923.121.923s-.801.104-1.234.034c-.391-.062-.875-.84-1-1.078-.172-.328-.539-.265-.682-.023-.224.383-.709 1.07-1.05 1.113-.669.084-2.055.03-3.14.02 0 0 .185-1.011-.227-1.358-.305-.26-.83-.784-1.144-1.06l-.832-.921c-.283-.36-1.002-.929-1.243-1.985-.213-.936-.192-1.395.037-1.77.232-.381.67-.589.854-.625.208-.042.692-.039.875.062.223.123.313.159.488.391.23.307.312.456.213.121-.076-.262-.322-.595-.434-.97-.109-.361-.401-.943-.38-1.526.008-.221.103-.771.832-1.042' fill='white'/><g stroke='black' stroke-width='.75'><path d='m13.5732 12.0361c.48-.178 1.427-.069 1.677.473.213.462.396 1.241.406 1.075.024-.369-.024-1.167.137-1.584.117-.304.347-.59.686-.691.285-.086.62-.116.916-.055.313.064.642.287.765.499.362.623.368 1.899.385 1.831.064-.272.07-1.229.283-1.584.141-.235.497-.445.687-.479.294-.052.656-.068.964-.008.249.049.586.344.677.487.219.344.342 1.316.379 1.658.016.141.074-.393.293-.736.406-.639 1.844-.763 1.898.639.026.654.02.624.02 1.064 0 .516-.012.828-.04 1.202-.03.399-.116 1.304-.241 1.742-.086.301-.371.978-.653 1.384 0 0-1.074 1.25-1.191 1.812-.117.563-.078.567-.102.965-.023.399.121.923.121.923s-.801.104-1.234.034c-.391-.062-.875-.84-1-1.078-.172-.328-.539-.265-.682-.023-.224.383-.709 1.07-1.05 1.113-.669.084-2.055.03-3.14.02 0 0 .185-1.011-.227-1.358-.305-.26-.83-.784-1.144-1.06l-.832-.921c-.283-.36-1.002-.929-1.243-1.985-.213-.936-.192-1.395.037-1.77.232-.381.67-.589.854-.625.208-.042.692-.039.875.062.223.123.313.159.488.391.23.307.312.456.213.121-.076-.262-.322-.595-.434-.97-.109-.361-.401-.943-.38-1.526.008-.221.103-.771.832-1.042z' stroke-linejoin='round'/><path d='m20.5664 19.7344v-3.459' stroke-linecap='round'/><path d='m18.5508 19.7461-.016-3.473' stroke-linecap='round'/><path d='m16.5547 16.3047.021 3.426' stroke-linecap='round'/></g>",xU='<path d="m13.5557 17.5742c-.098-.375-.196-.847-.406-1.552-.167-.557-.342-.859-.47-1.233-.155-.455-.303-.721-.496-1.181-.139-.329-.364-1.048-.457-1.44-.119-.509.033-.924.244-1.206.253-.339.962-.49 1.357-.351.371.13.744.512.916.788.288.46.357.632.717 1.542.393.992.564 1.918.611 2.231l.085.452c-.001-.04-.043-1.122-.044-1.162-.035-1.029-.06-1.823-.038-2.939.002-.126.064-.587.084-.715.078-.5.305-.8.673-.979.412-.201.926-.215 1.401-.017.423.173.626.55.687 1.022.014.109.094.987.093 1.107-.013 1.025.006 1.641.015 2.174.004.231.003 1.625.017 1.469.061-.656.094-3.189.344-3.942.144-.433.405-.746.794-.929.431-.203 1.113-.07 1.404.243.285.305.446.692.482 1.153.032.405-.019.897-.02 1.245 0 .867-.021 1.324-.037 2.121-.001.038-.015.298.023.182.094-.28.188-.542.266-.745.049-.125.241-.614.359-.859.114-.234.211-.369.415-.688.2-.313.415-.448.668-.561.54-.235 1.109.112 1.301.591.086.215.009.713-.028 1.105-.061.647-.254 1.306-.352 1.648-.128.447-.274 1.235-.34 1.601-.072.394-.234 1.382-.359 1.82-.086.301-.371.978-.652 1.384 0 0-1.074 1.25-1.192 1.812-.117.563-.078.567-.101.965-.024.399.121.923.121.923s-.802.104-1.234.034c-.391-.062-.875-.841-1-1.078-.172-.328-.539-.265-.682-.023-.225.383-.709 1.07-1.051 1.113-.668.084-2.054.03-3.139.02 0 0 .185-1.011-.227-1.358-.305-.26-.83-.784-1.144-1.06l-.832-.921c-.284-.36-.629-1.093-1.243-1.985-.348-.504-1.027-1.085-1.284-1.579-.223-.425-.331-.954-.19-1.325.225-.594.675-.897 1.362-.832.519.05.848.206 1.238.537.225.19.573.534.75.748.163.195.203.276.377.509.23.307.302.459.214.121" fill="white"/><g stroke="black" stroke-linecap="round" stroke-width=".75"><path d="m13.5557 17.5742c-.098-.375-.196-.847-.406-1.552-.167-.557-.342-.859-.47-1.233-.155-.455-.303-.721-.496-1.181-.139-.329-.364-1.048-.457-1.44-.119-.509.033-.924.244-1.206.253-.339.962-.49 1.357-.351.371.13.744.512.916.788.288.46.357.632.717 1.542.393.992.564 1.918.611 2.231l.085.452c-.001-.04-.043-1.122-.044-1.162-.035-1.029-.06-1.823-.038-2.939.002-.126.064-.587.084-.715.078-.5.305-.8.673-.979.412-.201.926-.215 1.401-.017.423.173.626.55.687 1.022.014.109.094.987.093 1.107-.013 1.025.006 1.641.015 2.174.004.231.003 1.625.017 1.469.061-.656.094-3.189.344-3.942.144-.433.405-.746.794-.929.431-.203 1.113-.07 1.404.243.285.305.446.692.482 1.153.032.405-.019.897-.02 1.245 0 .867-.021 1.324-.037 2.121-.001.038-.015.298.023.182.094-.28.188-.542.266-.745.049-.125.241-.614.359-.859.114-.234.211-.369.415-.688.2-.313.415-.448.668-.561.54-.235 1.109.112 1.301.591.086.215.009.713-.028 1.105-.061.647-.254 1.306-.352 1.648-.128.447-.274 1.235-.34 1.601-.072.394-.234 1.382-.359 1.82-.086.301-.371.978-.652 1.384 0 0-1.074 1.25-1.192 1.812-.117.563-.078.567-.101.965-.024.399.121.923.121.923s-.802.104-1.234.034c-.391-.062-.875-.841-1-1.078-.172-.328-.539-.265-.682-.023-.225.383-.709 1.07-1.051 1.113-.668.084-2.054.03-3.139.02 0 0 .185-1.011-.227-1.358-.305-.26-.83-.784-1.144-1.06l-.832-.921c-.284-.36-.629-1.093-1.243-1.985-.348-.504-1.027-1.085-1.284-1.579-.223-.425-.331-.954-.19-1.325.225-.594.675-.897 1.362-.832.519.05.848.206 1.238.537.225.19.573.534.75.748.163.195.203.276.377.509.23.307.302.459.214.121" stroke-linejoin="round"/><path d="m20.5664 21.7344v-3.459"/><path d="m18.5508 21.7461-.016-3.473"/><path d="m16.5547 18.3047.021 3.426"/></g>',bU='<path d="m20.5 15c0 3.038-2.462 5.5-5.5 5.5s-5.5-2.462-5.5-5.5 2.462-5.5 5.5-5.5 5.5 2.462 5.5 5.5" fill="white"/><path d="m20.5 15c0 3.038-2.462 5.5-5.5 5.5s-5.5-2.462-5.5-5.5 2.462-5.5 5.5-5.5 5.5 2.462 5.5 5.5z" stroke="black"/><g fill="black"><path d="m18 14h-2v-2h-2v2h-2v1.98h2v2.02h2v-2.02h2z"/><path d="m23.5859 25 1.414-1.414-5.449-5.449-1.414 1.414z"/></g>',CU='<path d="m20.5 15c0 3.038-2.462 5.5-5.5 5.5s-5.5-2.462-5.5-5.5 2.462-5.5 5.5-5.5 5.5 2.462 5.5 5.5" fill="white"/><path d="m20.5 15c0 3.038-2.462 5.5-5.5 5.5s-5.5-2.462-5.5-5.5 2.462-5.5 5.5-5.5 5.5 2.462 5.5 5.5z" stroke="black"/><g fill="black"><path d="m18 16h-5.98v-1.98h5.98z"/><path d="m23.5859 25 1.414-1.414-5.449-5.449-1.414 1.414z"/></g>';function At(t,e,n,r,s,o=16,i=16){const a=(-n-e)*($e/180),c=Math.sin(a),l=Math.cos(a),u=1*l-1*c,d=1*c+1*l;return`url("data:image/svg+xml,<svg height='32' width='32' viewBox='0 0 32 32' xmlns='http://www.w3.org/2000/svg' style='color: ${s};'><defs><filter id='shadow' y='-40%' x='-40%' width='180px' height='180%' color-interpolation-filters='sRGB'><feDropShadow dx='${u}' dy='${d}' stdDeviation='1.2' flood-opacity='.5'/></filter></defs><g fill='none' transform='rotate(${e+n} 16 16)${r?" scale(-1,-1) translate(0, -32)":""}' filter='url(%23shadow)'>`+t.replaceAll('"',"'")+`</g></svg>") ${o} ${i}, pointer`}const _U={none:()=>"none",default:(t,e,n)=>At(gU,t,0,e,n,12,8),pointer:(t,e,n)=>At(mU,t,0,e,n,14,10),cross:(t,e,n)=>At(yU,t,0,e,n),move:(t,e,n)=>At(vU,t,0,e,n),grab:(t,e,n)=>At(xU,t,0,e,n),grabbing:(t,e,n)=>At(SU,t,0,e,n),text:(t,e,n)=>At(wU,t,0,e,n,4,10),"ew-resize":(t,e,n)=>At(Q_,t,0,e,n),"ns-resize":(t,e,n)=>At(Q_,t,90,e,n),"nesw-resize":(t,e,n)=>At(q_,t,0,e,n),"nwse-resize":(t,e,n)=>At(q_,t,90,e,n),"nwse-rotate":(t,e,n)=>At(Vh,t,0,e,n),"nesw-rotate":(t,e,n)=>At(Vh,t,90,e,n),"senw-rotate":(t,e,n)=>At(Vh,t,180,e,n),"swne-rotate":(t,e,n)=>At(Vh,t,270,e,n),"zoom-in":(t,e,n)=>At(bU,t,0,e,n),"zoom-out":(t,e,n)=>At(CU,t,0,e,n)};function Ln(t,e=0,n="black"){return _U[t](UN(e),!1,n)}const EU=["default","pointer","cross","move","grab","grabbing","text"];function PU(){const t=H(),e=Mn(),n=mm();Qi("useCursor",()=>{const{type:r,rotation:s}=t.instanceState.cursor;if(EU.includes(r)){e.style.setProperty("--tl-cursor",`var(--tl-cursor-${r})`);return}e.style.setProperty("--tl-cursor",Ln(r,s,n?"white":"black"))},[t,e,n])}function kU(){const t=H(),e=Mn(),n=mm(),r=Y(xt.forceSrgb);Z.useEffect(()=>{n?(e.setAttribute("data-color-mode","dark"),e.classList.remove("tl-theme__light"),e.classList.add("tl-theme__dark")):(e.setAttribute("data-color-mode","light"),e.classList.remove("tl-theme__dark"),e.classList.add("tl-theme__light")),r?e.classList.add("tl-theme__force-sRGB"):e.classList.remove("tl-theme__force-sRGB")},[t,e,r,n])}function IU(t){const e=S.useRef();return S.useLayoutEffect(()=>{e.current=t}),S.useDebugValue(t),S.useCallback((...n)=>{const r=e.current;return H1(r,"fn does not exist"),r(...n)},[])}function $U(){const[t,e]=S.useState(0);S.useEffect(()=>e(n=>n+1),[])}const Ac="TLDRAW_TAB_ID_v2",Nt=globalThis.window;function TU(){return Nt?["iPad Simulator","iPhone Simulator","iPod Simulator","iPad","iPhone","iPod"].includes(Nt.navigator.platform)||Nt.navigator.userAgent.includes("Mac")&&"ontouchend"in document:!1}const dg=(Nt==null?void 0:Nt[Ac])??(Nt==null?void 0:Nt.sessionStorage[Ac])??"TLDRAW_INSTANCE_STATE_V1_"+Ze();Nt&&(Nt[Ac]=dg,TU()?Nt.sessionStorage[Ac]=dg:delete Nt.sessionStorage[Ac]);Nt==null||Nt.addEventListener("beforeunload",()=>{Nt.sessionStorage[Ac]=dg});const AU={Initial:0},td=AU.Initial,D3=Ce({version:pe,currentPageId:Wu,isFocusMode:Pe,exportBackground:Pe,isDebugMode:Pe,isToolLocked:Pe,isGridMode:Pe,pageStates:Yn(Ce({pageId:Wu,camera:Ce({x:pe,y:pe,z:pe}),selectedShapeIds:Yn(Mr),focusedGroupId:Mr.nullable()}))}),MU=Ae({currentVersion:td});function OU(t){if(!t||typeof t!="object")return console.warn("Invalid instance state"),null;if(!("version"in t)||typeof t.version!="number")return console.warn("No version in instance state"),null;const e=G1({value:t,fromVersion:t.version,toVersion:td,migrations:MU});if(e.type==="error")return console.warn(e.reason),null;const n={...e.value,version:td};try{D3.validate(n)}catch(r){return console.warn(r),null}return n}function DU(t){const e=t.query.ids("page");return X("sessionStateSnapshot",()=>{const n=t.get(Zt);if(!n)return null;const r=[...e.value];return{version:td,currentPageId:n.currentPageId,exportBackground:n.exportBackground,isFocusMode:n.isFocusMode,isDebugMode:n.isDebugMode,isToolLocked:n.isToolLocked,isGridMode:n.isGridMode,pageStates:r.map(s=>{const o=t.get(Rt.createId(s)),i=t.get(Dt.createId(s));return{pageId:s,camera:{x:(i==null?void 0:i.x)??0,y:(i==null?void 0:i.y)??0,z:(i==null?void 0:i.z)??1},selectedShapeIds:(o==null?void 0:o.selectedShapeIds)??[],focusedGroupId:(o==null?void 0:o.focusedGroupId)??null}})}})}function RU(t,e){const n=OU(e);if(!n)return;const r=t.allRecords().filter(i=>i.typeName==="instance_page_state"||i.typeName==="camera"),s={added:{},updated:{},removed:{...AT(r.map(i=>[i.id,i]))}};t.has(Zt)&&(s.removed[Zt]=t.get(Zt));const o={removed:{},updated:{},added:{[Zt]:t.schema.types.instance.create({id:Zt,currentPageId:n.currentPageId,isDebugMode:n.isDebugMode,isFocusMode:n.isFocusMode,isToolLocked:n.isToolLocked,isGridMode:n.isGridMode,exportBackground:n.exportBackground})}};for(const i of n.pageStates){const a=Dt.createId(i.pageId),c=Rt.createId(i.pageId);o.added[a]=Dt.create({id:Dt.createId(i.pageId),x:i.camera.x,y:i.camera.y,z:i.camera.z}),o.added[c]=Rt.create({id:Rt.createId(i.pageId),pageId:i.pageId,selectedShapeIds:i.selectedShapeIds,focusedGroupId:i.focusedGroupId})}ur(()=>{t.applyDiff(lm([s,o])),t.ensureStoreIsUsable()})}function LU(t){var s;const e=[];for(const o of Object.values(t))(s=o.typeName)!=null&&s.match(/^(instance.*|pointer|camera)$/)&&e.push(o);const n=e.filter(o=>o.typeName==="instance"&&o.id!==Zt)[0];if(!n)return null;const r={version:td,currentPageId:n.currentPageId,exportBackground:!!n.exportBackground,isFocusMode:!!n.isFocusMode,isDebugMode:!!n.isDebugMode,isToolLocked:!!n.isToolLocked,isGridMode:!1,pageStates:e.filter(o=>o.typeName==="instance_page_state"&&o.instanceId===n.id).map(o=>{const i=t[o.cameraId]??{x:0,y:0,z:1};return{pageId:o.pageId,camera:{x:i.x,y:i.y,z:i.z},selectedShapeIds:o.selectedShapeIds,focusedGroupId:o.focusedGroupId}})};try{return D3.validate(r),r}catch{return null}}function jU(){window.alert(`Oops! We could not save changes to your browser's storage. We now need to reload the page and try again.

Keep seeing this message?
 If you're using tldraw in a private or "incognito" window, try loading tldraw in a regular window or in a different browser.
 If your hard disk is full, try clearing up some space and then reload the page.`)}function NU(){window.alert(`Oops! We could not access your browser's storageand the app won't work correctly without that. We now need to reload the page and try again.

Keep seeing this message?
 If you're using tldraw in a private or "incognito" window, try loading tldraw in a regular window or in a different browser.`)}const zU=(t,e)=>e.some(n=>t instanceof n);let Z_,J_;function FU(){return Z_||(Z_=[IDBDatabase,IDBObjectStore,IDBIndex,IDBCursor,IDBTransaction])}function BU(){return J_||(J_=[IDBCursor.prototype.advance,IDBCursor.prototype.continue,IDBCursor.prototype.continuePrimaryKey])}const R3=new WeakMap,Hw=new WeakMap,L3=new WeakMap,s0=new WeakMap,fx=new WeakMap;function UU(t){const e=new Promise((n,r)=>{const s=()=>{t.removeEventListener("success",o),t.removeEventListener("error",i)},o=()=>{n(Hs(t.result)),s()},i=()=>{r(t.error),s()};t.addEventListener("success",o),t.addEventListener("error",i)});return e.then(n=>{n instanceof IDBCursor&&R3.set(n,t)}).catch(()=>{}),fx.set(e,t),e}function HU(t){if(Hw.has(t))return;const e=new Promise((n,r)=>{const s=()=>{t.removeEventListener("complete",o),t.removeEventListener("error",i),t.removeEventListener("abort",i)},o=()=>{n(),s()},i=()=>{r(t.error||new DOMException("AbortError","AbortError")),s()};t.addEventListener("complete",o),t.addEventListener("error",i),t.addEventListener("abort",i)});Hw.set(t,e)}let Kw={get(t,e,n){if(t instanceof IDBTransaction){if(e==="done")return Hw.get(t);if(e==="objectStoreNames")return t.objectStoreNames||L3.get(t);if(e==="store")return n.objectStoreNames[1]?void 0:n.objectStore(n.objectStoreNames[0])}return Hs(t[e])},set(t,e,n){return t[e]=n,!0},has(t,e){return t instanceof IDBTransaction&&(e==="done"||e==="store")?!0:e in t}};function KU(t){Kw=t(Kw)}function VU(t){return t===IDBDatabase.prototype.transaction&&!("objectStoreNames"in IDBTransaction.prototype)?function(e,...n){const r=t.call(o0(this),e,...n);return L3.set(r,e.sort?e.sort():[e]),Hs(r)}:BU().includes(t)?function(...e){return t.apply(o0(this),e),Hs(R3.get(this))}:function(...e){return Hs(t.apply(o0(this),e))}}function WU(t){return typeof t=="function"?VU(t):(t instanceof IDBTransaction&&HU(t),zU(t,FU())?new Proxy(t,Kw):t)}function Hs(t){if(t instanceof IDBRequest)return UU(t);if(s0.has(t))return s0.get(t);const e=WU(t);return e!==t&&(s0.set(t,e),fx.set(e,t)),e}const o0=t=>fx.get(t);function GU(t,e,{blocked:n,upgrade:r,blocking:s,terminated:o}={}){const i=indexedDB.open(t,e),a=Hs(i);return r&&i.addEventListener("upgradeneeded",c=>{r(Hs(i.result),c.oldVersion,c.newVersion,Hs(i.transaction),c)}),n&&i.addEventListener("blocked",c=>n(c.oldVersion,c.newVersion,c)),a.then(c=>{o&&c.addEventListener("close",()=>o()),s&&c.addEventListener("versionchange",l=>s(l.oldVersion,l.newVersion,l))}).catch(()=>{}),a}function YU(t,{blocked:e}={}){const n=indexedDB.deleteDatabase(t);return e&&n.addEventListener("blocked",r=>e(r.oldVersion,r)),Hs(n).then(()=>{})}const XU=["get","getKey","getAll","getAllKeys","count"],qU=["put","add","delete","clear"],i0=new Map;function eE(t,e){if(!(t instanceof IDBDatabase&&!(e in t)&&typeof e=="string"))return;if(i0.get(e))return i0.get(e);const n=e.replace(/FromIndex$/,""),r=e!==n,s=qU.includes(n);if(!(n in(r?IDBIndex:IDBObjectStore).prototype)||!(s||XU.includes(n)))return;const o=async function(i,...a){const c=this.transaction(i,s?"readwrite":"readonly");let l=c.store;return r&&(l=l.index(a.shift())),(await Promise.all([l[n](...a),s&&c.done]))[0]};return i0.set(e,o),o}KU(t=>({...t,get:(e,n,r)=>eE(e,n)||t.get(e,n,r),has:(e,n)=>!!eE(e,n)||t.has(e,n)}));const ym="TLDRAW_DOCUMENT_v2",j3="TLDRAW_DB_NAME_INDEX_v2",Me={Records:"records",Schema:"schema",SessionState:"session_state"};async function vm(t,e){tH(t);const n=await GU(t,3,{upgrade(r){r.objectStoreNames.contains(Me.Records)||r.createObjectStore(Me.Records),r.objectStoreNames.contains(Me.Schema)||r.createObjectStore(Me.Schema),r.objectStoreNames.contains(Me.SessionState)||r.createObjectStore(Me.SessionState)}});try{return await e(n)}finally{n.close()}}async function QU({persistenceKey:t,sessionId:e,didCancel:n}){const r=ym+t;if(px().includes(r))return await eH({persistenceKey:t,didCancel:n}),await vm(r,async s=>{var d,h;if(n!=null&&n())return;const o=s.transaction([Me.Records,Me.Schema,Me.SessionState],"readonly"),i=o.objectStore(Me.Records),a=o.objectStore(Me.Schema),c=o.objectStore(Me.SessionState);let l=e?(d=await c.get(e))==null?void 0:d.snapshot:null;l||(l=(h=(await c.getAll()).sort((p,m)=>p.updatedAt-m.updatedAt).pop())==null?void 0:h.snapshot);const u={records:await i.getAll(),schema:await a.get(Me.Schema),sessionStateSnapshot:l};if(n!=null&&n()){o.abort();return}return await o.done,u})}async function ZU({persistenceKey:t,schema:e,changes:n,sessionId:r,sessionStateSnapshot:s,didCancel:o}){const i=ym+t;await vm(i,async a=>{const c=a.transaction([Me.Records,Me.Schema,Me.SessionState],"readwrite"),l=c.objectStore(Me.Records),u=c.objectStore(Me.Schema),d=c.objectStore(Me.SessionState);for(const[h,f]of Object.entries(n.added))await l.put(f,h);for(const[h,f]of Object.values(n.updated))await l.put(f,f.id);for(const h of Object.keys(n.removed))await l.delete(h);if(u.put(e.serialize(),Me.Schema),s&&r?d.put({snapshot:s,updatedAt:Date.now(),id:r},r):(s||r)&&console.error("sessionStateSnapshot and instanceId must be provided together"),o!=null&&o())return c.abort();await c.done})}async function JU({persistenceKey:t,schema:e,snapshot:n,sessionId:r,sessionStateSnapshot:s,didCancel:o}){const i=ym+t;await vm(i,async a=>{const c=a.transaction([Me.Records,Me.Schema,Me.SessionState],"readwrite"),l=c.objectStore(Me.Records),u=c.objectStore(Me.Schema),d=c.objectStore(Me.SessionState);await l.clear();for(const[h,f]of Object.entries(n))await l.put(f,h);if(u.put(e.serialize(),Me.Schema),s&&r?d.put({snapshot:s,updatedAt:Date.now(),id:r},r):(s||r)&&console.error("sessionStateSnapshot and instanceId must be provided together"),o!=null&&o())return c.abort();await c.done})}async function eH({persistenceKey:t,didCancel:e}){await vm(ym+t,async n=>{const r=n.transaction([Me.SessionState],"readwrite"),s=r.objectStore(Me.SessionState),o=(await s.getAll()).sort((a,c)=>a.updatedAt-c.updatedAt);if(o.length<10){await r.done;return}const i=o.slice(0,o.length-10);for(const{id:a}of i)await s.delete(a);if(e!=null&&e())return r.abort();await r.done})}function px(){const t=JSON.parse((window==null?void 0:window.localStorage.getItem(j3))||"[]")??[];return Array.isArray(t)?t:[]}function tH(t){const e=new Set(px());e.add(t),window==null||window.localStorage.setItem(j3,JSON.stringify([...e]))}const nH=350,rH=1e4,tE=Symbol("UPDATE_INSTANCE_STATE"),sH=t=>t;class oH{constructor(e){y(this,"onmessage")}postMessage(e){}close(){}}const iH=typeof BroadcastChannel>"u"?oH:BroadcastChannel;class aH{constructor(e,{persistenceKey:n,sessionId:r=dg,onLoad:s,onLoadError:o},i=new iH(`tldraw-tab-sync-${n}`)){y(this,"disposables",new Set);y(this,"diffQueue",[]);y(this,"didDispose",!1);y(this,"shouldDoFullDBWrite",!0);y(this,"isReloading",!1);y(this,"persistenceKey");y(this,"sessionId");y(this,"serializedSchema");y(this,"isDebugging",!1);y(this,"documentTypes");y(this,"$sessionStateSnapshot");y(this,"initTime",Date.now());y(this,"isPersisting",!1);y(this,"didLastWriteError",!1);y(this,"scheduledPersistTimeout",null);this.store=e,this.channel=i,typeof window<"u"&&(window.tlsync=this),this.persistenceKey=n,this.sessionId=r,this.serializedSchema=this.store.schema.serialize(),this.$sessionStateSnapshot=DU(this.store),this.disposables.add(e.listen(({changes:a})=>{this.diffQueue.push(a),this.channel.postMessage(sH({type:"diff",storeId:this.store.id,changes:a,schema:this.serializedSchema})),this.schedulePersist()},{source:"user",scope:"document"})),this.disposables.add(e.listen(()=>{this.diffQueue.push(tE),this.schedulePersist()},{scope:"session"})),this.connect(s,o),this.documentTypes=new Set(Object.values(this.store.schema.types).filter(a=>a.scope==="document").map(a=>a.typeName))}debug(...e){this.isDebugging&&console.debug(...e)}async connect(e,n){this.debug("connecting");let r;try{r=await QU({persistenceKey:this.persistenceKey,sessionId:this.sessionId,didCancel:()=>this.didDispose})}catch(s){n(s),NU(),typeof window<"u"&&window.location.reload();return}if(this.debug("loaded data from store",r,"didDispose",this.didDispose),!this.didDispose)try{if(r){const s=Object.fromEntries(r.records.map(a=>[a.id,a])),o=r.sessionStateSnapshot??LU(s),i=this.store.schema.migrateStoreSnapshot({store:s,schema:r.schema??this.store.schema.serializeEarliestVersion()});if(i.type==="error"){console.error("failed to migrate store",i),n(new Error(`Failed to migrate store: ${i.reason}`));return}this.store.mergeRemoteChanges(()=>{this.store.put(Object.values(i.value).filter(a=>this.documentTypes.has(a.typeName)),"initialize")}),o&&RU(this.store,o)}this.channel.onmessage=({data:s})=>{var a,c;this.debug("got message",s);const o=s,i=Q7(this.serializedSchema,o.schema??this.store.schema.serializeEarliestVersion());if(i===-1){if(Date.now()-this.initTime<5e3){n(new Error("Schema mismatch, please close other tabs and reload the page"));return}this.debug("reloading"),this.isReloading=!0,(c=(a=window==null?void 0:window.location)==null?void 0:a.reload)==null||c.call(a);return}else if(i===1){this.debug("telling them to reload"),this.channel.postMessage({type:"announce",schema:this.serializedSchema}),this.shouldDoFullDBWrite=!0,this.persistIfNeeded();return}o.type==="diff"&&(this.debug("applying diff"),ur(()=>{this.store.mergeRemoteChanges(()=>{this.store.applyDiff(o.changes),this.store.ensureStoreIsUsable()})}))},this.channel.postMessage({type:"announce",schema:this.serializedSchema}),this.disposables.add(()=>{this.channel.close()}),e(this)}catch(s){if(this.debug("error loading data from store",s),this.didDispose)return;n(s);return}}close(){this.debug("closing"),this.didDispose=!0,this.disposables.forEach(e=>e())}schedulePersist(){this.debug("schedulePersist",this.scheduledPersistTimeout),!this.scheduledPersistTimeout&&(this.scheduledPersistTimeout=setTimeout(()=>{this.scheduledPersistTimeout=null,this.persistIfNeeded()},this.didLastWriteError?rH:nH))}persistIfNeeded(){this.debug("persistIfNeeded",{isPersisting:this.isPersisting,isReloading:this.isReloading,shouldDoFullDBWrite:this.shouldDoFullDBWrite,diffQueueLength:this.diffQueue.length,storeIsPossiblyCorrupt:this.store.isPossiblyCorrupted()}),this.scheduledPersistTimeout&&(clearTimeout(this.scheduledPersistTimeout),this.scheduledPersistTimeout=null),!this.isPersisting&&(this.isReloading||this.store.isPossiblyCorrupted()||(this.shouldDoFullDBWrite||this.diffQueue.length>0)&&this.doPersist())}async doPersist(){H1(!this.isPersisting,"persist already in progress"),this.isPersisting=!0,this.debug("doPersist start");const e=this.diffQueue;this.diffQueue=[];try{if(this.shouldDoFullDBWrite)this.shouldDoFullDBWrite=!1,await JU({persistenceKey:this.persistenceKey,schema:this.store.schema,snapshot:this.store.serialize(),didCancel:()=>this.didDispose,sessionId:this.sessionId,sessionStateSnapshot:this.$sessionStateSnapshot.value});else{const n=lm(e.filter(r=>r!==tE));await ZU({persistenceKey:this.persistenceKey,changes:n,schema:this.store.schema,didCancel:()=>this.didDispose,sessionId:this.sessionId,sessionStateSnapshot:this.$sessionStateSnapshot.value})}this.didLastWriteError=!1}catch(n){this.shouldDoFullDBWrite=!0,this.didLastWriteError=!0,console.error("failed to store changes in indexed db",n),jU(),typeof window<"u"&&window.location.reload()}this.isPersisting=!1,this.debug("doPersist end"),this.schedulePersist()}}function Vw({initialData:t,defaultName:e="",...n}){const r="schema"in n?n.schema:Uj({shapes:cH(k3(n.shapeUtils))});return new MT({schema:r,initialData:t,props:{defaultName:e}})}function cH(t){return Object.fromEntries(t.map(e=>[e.type,{props:e.props,migrations:e.migrations}]))}function lH(t){const[e,n]=S.useState(()=>Vw(t)),r=S.useRef(t);if(S.useEffect(()=>void(r.current=t)),Object.keys(r.current).some(s=>r.current[s]!==t[s])){const s=Vw(t);return n(s),s}return e}function uH({persistenceKey:t,sessionId:e,...n}){const[r,s]=S.useState(null),o=lH(n);return S.useEffect(()=>{const i=Ze();if(!t){s({id:i,storeWithStatus:{status:"not-synced",store:o}});return}s({id:i,storeWithStatus:{status:"loading"}});const a=l=>{s(u=>(u==null?void 0:u.id)===i?{id:i,storeWithStatus:l}:u)},c=new aH(o,{sessionId:e,persistenceKey:t,onLoad(){a({store:o,status:"synced-local"})},onLoadError(l){a({status:"error",error:l})}});return()=>{s(l=>(l==null?void 0:l.id)===i?null:l),c.close()}},[t,o,e]),(r==null?void 0:r.storeWithStatus)??{status:"loading"}}let N3=!1;if(typeof window<"u"){const t=window.navigator.userAgent,e=!!t.match(/iPad/i)||!!t.match(/iPhone/i),n=!!t.match(/WebKit/i);N3=e&&n&&!t.match(/CriOS/i)}function dH(){const t=H();S.useEffect(()=>{if(!N3)return;function e(n){(n.target instanceof HTMLInputElement&&n.target.type==="text"||n.target instanceof HTMLTextAreaElement)&&t.complete()}return document.addEventListener("focusout",e),()=>document.removeEventListener("focusout",e)},[t])}function hH(){const t=H(),e=Mn();S.useEffect(()=>{const n=o=>e.style.setProperty("--tl-zoom",o.toString()),r=K1(n,100),s=new $d("useZoomCss",()=>{t.currentPageShapeIds.size<300?n(t.zoomLevel):r(t.zoomLevel)});return s.attach(),s.execute(),()=>{s.detach()}},[t,e])}const fH=[],pH=[],gH=S.memo(function({store:e,components:n,className:r,...s}){const[o,i]=Z.useState(null),a=S.useMemo(()=>b3(),[]),c=(n==null?void 0:n.ErrorFallback)===void 0?qT:n==null?void 0:n.ErrorFallback,l={...s,shapeUtils:s.shapeUtils??fH,tools:s.tools??pH};return g.jsx("div",{ref:i,draggable:!1,className:le("tl-container tl-theme__light",r),tabIndex:0,children:g.jsx(Qu,{fallback:c,onError:u=>V1(u,{tags:{origin:"react.tldraw-before-app"}}),children:o&&g.jsx(PN,{container:o,children:g.jsx(S9,{overrides:n,children:e?e instanceof MT?g.jsx(F3,{...l,store:e,user:a}):g.jsx(z3,{...l,store:e,user:a}):g.jsx(mH,{...l,store:e,user:a})})})})})});function mH(t){const{defaultName:e,initialData:n,shapeUtils:r,persistenceKey:s,sessionId:o,user:i}=t,a=uH({shapeUtils:r,initialData:n,persistenceKey:s,sessionId:o,defaultName:e});return g.jsx(z3,{...t,store:a,user:i})}const z3=S.memo(function({store:e,user:n,...r}){const s=Mn();switch(S.useLayoutEffect(()=>{n.userPreferences.value.isDarkMode&&(s.classList.remove("tl-theme__light"),s.classList.add("tl-theme__dark"))},[s,n.userPreferences.value.isDarkMode]),e.status){case"error":throw e.error;case"loading":return g.jsx(B3,{children:"Connecting..."})}return g.jsx(F3,{...r,store:e.store,user:n})});function F3({onMount:t,children:e,store:n,tools:r,shapeUtils:s,autoFocus:o,user:i,initialState:a}){const{ErrorFallback:c}=on(),l=Mn(),[u,d]=S.useState(null);S.useLayoutEffect(()=>{const p=new ue({store:n,shapeUtils:s,tools:r,getContainer:()=>l,user:i,initialState:a});return window.app=p,window.editor=p,d(p),()=>{p.dispose()}},[l,s,r,n,i,a]),Z.useLayoutEffect(()=>{u&&o&&u.focus()},[u,o]);const h=IU(p=>{const m=t==null?void 0:t(p);return p.emit("mount"),window.tldrawReady=!0,m});Z.useLayoutEffect(()=>{if(u)return h==null?void 0:h(u)},[u,h]);const f=S.useSyncExternalStore(S.useCallback(p=>u?(u.on("crash",p),()=>u.off("crash",p)):()=>{},[u]),()=>(u==null?void 0:u.crashingError)??null);return u?g.jsx(Qu,{fallback:c,onError:p=>u.annotateError(p,{origin:"react.tldraw",willCrashApp:!0}),children:f?g.jsx(vH,{crashingError:f}):g.jsx(nx.Provider,{value:u,children:g.jsx(yH,{children:e})})}):null}function yH({children:t}){return hH(),PU(),kU(),dH(),$U(),t??g.jsx(lx,{})}function vH({crashingError:t}){throw t}function B3({children:t}){const{Spinner:e}=on();return g.jsxs("div",{className:"tl-loading",children:[e?g.jsx(e,{}):null,t]})}function wH({children:t}){return g.jsx("div",{className:"tl-loading",children:t})}function Xc({children:t,className:e="",...n}){return g.jsx("div",{...n,className:`tl-html-container ${e}`,children:t})}Ee(function({x:e=0,y:n=0,rotation:r=0,...s}){const o=H(),i=S.useRef(null);return S.useLayoutEffect(()=>{const{x:a,y:c,z:l}=o.camera,u=i.current;u&&a!==void 0&&(u.style.transform=`translate(${a}px, ${c}px) scale(${l}) rotate(${r}rad) translate(${e}px, ${n}px)`)},[o.camera,e,n,r]),g.jsx("div",{ref:i,...s,className:le("tl-positioned",s.className)})});function SH(t,e,n={}){const{newPoint:r,handle:s,scaleX:o,scaleY:i}=e,{minWidth:a=1,maxWidth:c=1/0,minHeight:l=1,maxHeight:u=1/0}=n;let d=t.props.w*o,h=t.props.h*i;const f=new P(0,0);if(d>0){if(d<a){switch(s){case"top_left":case"left":case"bottom_left":{f.x=d-a;break}case"top":case"bottom":{f.x=(d-a)/2;break}default:f.x=0}d=a}}else if(f.x=d,d=-d,d<a){switch(s){case"top_left":case"left":case"bottom_left":{f.x=-d;break}default:f.x=-a}d=a}if(h>0){if(h<l){switch(s){case"top_left":case"top":case"top_right":{f.y=h-l;break}case"right":case"left":{f.y=(h-l)/2;break}default:f.y=0}h=l}}else if(f.y=h,h=-h,h<l){switch(s){case"top_left":case"top":case"top_right":{f.y=-h;break}default:f.y=-l}h=l}const{x:p,y:m}=f.rot(t.rotation).add(r);return{x:p,y:m,props:{w:Math.min(c,d),h:Math.min(u,h)}}}class ul extends Hr{constructor(){super(...arguments);y(this,"onResize",(n,r)=>SH(n,r))}getGeometry(n){return new Ea({width:n.props.w,height:n.props.h,isFilled:!0})}}function xH(t,e,n){const r=e==="end"?t.end.point:t.start.point,s=e==="end"?t.start.point:t.end.point,o=t.isStraight?P.Dist(s,r):Math.abs(t.bodyArc.length),i=Math.max(Math.min(o/5,n*3),n);let a;if(t.isStraight)a=P.Nudge(r,s,i);else{const c=EB(r,i,t.handleArc.center,t.handleArc.radius);a=e==="end"?t.handleArc.sweepFlag?c[0]:c[1]:t.handleArc.sweepFlag?c[1]:c[0]}return{point:r,int:a}}function bH({point:t,int:e}){const n=P.RotWith(e,t,$e/6),r=P.RotWith(e,t,-$e/6);return`M ${n.x} ${n.y} L ${t.x} ${t.y} L ${r.x} ${r.y}`}function CH({point:t,int:e}){const n=P.RotWith(e,t,$e/6),r=P.RotWith(e,t,-$e/6);return`M ${n.x} ${n.y} L ${t.x} ${t.y} L ${r.x} ${r.y} Z`}function _H({point:t,int:e}){const n=P.Sub(e,t).div(2),r=P.Add(t,P.Rot(n,Te)),s=P.Sub(t,P.Rot(n,Te));return`M ${r.x} ${r.y} L ${e.x} ${e.y} L ${s.x} ${s.y} Z`}function EH({point:t,int:e}){const n=P.Lrp(t,e,.45),r=P.Dist(n,t);return`M ${n.x-r},${n.y}
  a ${r},${r} 0 1,0 ${r*2},0
  a ${r},${r} 0 1,0 -${r*2},0 `}function PH({point:t,int:e}){const n=P.Lrp(t,e,.75),r=P.RotWith(n,t,$e/4),s=P.RotWith(n,t,-$e/4),o=P.Lrp(r,s,.5);return o.add(P.Sub(o,t)),`M ${o.x} ${o.y} L ${r.x} ${r.y} ${t.x} ${t.y} L ${s.x} ${s.y} Z`}function kH({int:t,point:e}){const n=P.Lrp(e,t,.85),r=P.Sub(n,e).div(2),s=P.Add(e,P.Rot(r,Te)),o=P.Sub(e,P.Rot(r,Te)),i=P.Add(n,P.Rot(r,Te)),a=P.Sub(n,P.Rot(r,Te));return`M ${s.x} ${s.y} L ${i.x} ${i.y} L ${a.x} ${a.y} L ${o.x} ${o.y} Z`}function IH({int:t,point:e}){const n=P.Sub(t,e).div(2),r=P.Add(e,P.Rot(n,Te)),s=P.Sub(e,P.Rot(n,Te));return`M ${r.x} ${r.y} L ${s.x} ${s.y}`}function Xa(t,e,n){const r=e==="end"?t.end.arrowhead:t.start.arrowhead;if(r==="none")return;const s=xH(t,e,n);if(s){switch(r){case"bar":return IH(s);case"square":return kH(s);case"diamond":return PH(s);case"dot":return EH(s);case"inverted":return _H(s);case"arrow":return bH(s);case"triangle":return CH(s)}return""}}var dv;let $H=(dv=class extends re{constructor(){super(...arguments);y(this,"onPointerDown",n=>{this.parent.transition("pointing",n)});y(this,"onEnter",()=>{this.editor.updateInstanceState({cursor:{type:"cross",rotation:0}},!0)});y(this,"onCancel",()=>{this.editor.setCurrentTool("select")})}},y(dv,"id","idle"),dv);var hv;let TH=(hv=class extends re{constructor(){super(...arguments);y(this,"markId","");y(this,"wasFocusedOnEnter",!1);y(this,"onEnter",()=>{const{isMenuOpen:n}=this.editor;this.wasFocusedOnEnter=!n});y(this,"onPointerMove",n=>{if(this.editor.inputs.isDragging){const{originPagePoint:r}=this.editor.inputs,s=this.parent.shapeType,o=Ke();this.markId=`creating:${o}`,this.editor.mark(this.markId),this.editor.createShapes([{id:o,type:s,x:r.x,y:r.y,props:{w:1,h:1}}]).select(o),this.editor.setCurrentTool("select.resizing",{...n,target:"selection",handle:"bottom_right",isCreating:!0,creationCursorOffset:{x:1,y:1},onInteractionEnd:this.parent.id})}});y(this,"onPointerUp",()=>{this.complete()});y(this,"onCancel",()=>{this.cancel()});y(this,"onComplete",()=>{this.complete()});y(this,"onInterrupt",()=>{this.cancel()})}complete(){const{originPagePoint:n}=this.editor.inputs;if(!this.wasFocusedOnEnter)return;this.editor.mark(this.markId);const r=this.parent.shapeType,s=Ke();this.editor.mark(this.markId),this.editor.createShapes([{id:s,type:r,x:n.x,y:n.y}]);const o=this.editor.getShape(s),{w:i,h:a}=this.editor.getShapeUtil(o).getDefaultProps(),c=new P(i/2,a/2),l=this.editor.getShapeParentTransform(o);l&&c.rot(-l.rotation()),this.editor.updateShapes([{id:s,type:r,x:o.x-c.x,y:o.y-c.y}]),this.editor.setSelectedShapeIds([s]),this.editor.instanceState.isToolLocked?this.parent.transition("idle",{}):this.editor.setCurrentTool("select.idle")}cancel(){this.parent.transition("idle",{})}},y(hv,"id","pointing"),hv);class Nf extends re{}y(Nf,"id","box"),y(Nf,"initial","idle"),y(Nf,"children",()=>[$H,TH]);function nE(t){const e=H();return Y("isCropping",()=>e.croppingShapeId===t,[e,t])}function gx(t){const e=H();return Y("isEditing",()=>e.editingShapeId===t,[e,t])}function es(t){const e=H();return S.useMemo(function(){const s=l=>{if(l.isKilled||l.button!==0)return;const u=Jp(l.currentTarget);function d(){u.removeEventListener("pointerup",d),hm(u,l)}Od(u,l),u.addEventListener("pointerup",d),e.dispatch({name:"pointer_down",type:"pointer",target:"selection",handle:t,...vr(l)}),l.stopPropagation()};let o,i;function a(l){l.isKilled||l.button===0&&(l.clientX===o&&l.clientY===i||(o=l.clientX,i=l.clientY,e.dispatch({name:"pointer_move",type:"pointer",target:"selection",handle:t,...vr(l)})))}return{onPointerDown:s,onPointerMove:a,onPointerUp:l=>{l.isKilled||l.button===0&&e.dispatch({name:"pointer_up",type:"pointer",target:"selection",handle:t,...vr(l)})}}},[e,t])}const AH=20,MH=8;function mx(t,e=AH){return Math.max(MH,Math.ceil(t/e))}class OH extends _a{constructor(n){super({...n,isFilled:!1,isClosed:!1});y(this,"_center");y(this,"radius");y(this,"start");y(this,"end");y(this,"measure");y(this,"length");y(this,"angleStart");y(this,"angleEnd");const{center:r,radius:s,sweepFlag:o,largeArcFlag:i,start:a,end:c}=n;if(a.equals(c))throw Error("Arc must have different start and end points.");this.angleStart=P.Angle(r,a),this.angleEnd=P.Angle(r,c),this.measure=DH(this.angleStart,this.angleEnd,o,i),this.length=this.measure*s,this.start=a,this.end=c,this._center=r,this.radius=s}nearestPoint(n){const{_center:r,measure:s,radius:o,angleEnd:i,angleStart:a,start:c,end:l}=this,u=rE(s,a,i,r.angle(n));if(u<=0)return c;if(u>=1)return l;const d=r.clone().add(n.clone().sub(r).uni().mul(o));let h=1/0,f;for(const p of[c,l,d])n.dist(p)<h&&(f=p,h=n.dist(p));if(!f)throw Error("nearest point not found");return f}hitTestLineSegment(n,r,s){const{_center:o,radius:i,measure:a,angleStart:c,angleEnd:l}=this,u=gm(n,r,o,i);return u===null?!1:u.some(d=>{const h=rE(a,c,l,o.angle(d));return h>=0&&h<=1})}getVertices(){const{_center:n,measure:r,length:s,radius:o,angleStart:i}=this,a=[];for(let c=0,l=mx(Math.abs(s));c<l+1;c++){const u=c/l*r,d=i+u;a.push(n.clone().add(new P(Math.cos(d),Math.sin(d)).mul(o)))}return a}}function rE(t,e,n,r){let s;if(Math.abs(t)>$e){s=os(e,r);const o=os(r,n);return Math.abs(s)<Math.abs(o)?s/t:(t-o)/t}else return s=os(e,r),s/t}function DH(t,e,n,r){const s=2*((e-t)%Oe)%Oe-(e-t)%Oe;return r?(Oe-Math.abs(s))*(n?1:-1):s}class RH extends _a{constructor(n){super({isClosed:!0,...n});y(this,"_center");y(this,"radius");y(this,"x");y(this,"y");this.config=n;const{x:r=0,y:s=0,radius:o}=n;this.x=r,this.y=s,this._center=new P(o+r,o+s),this.radius=o}getBounds(){return new ae(this.x,this.y,this.radius*2,this.radius*2)}getVertices(){const{_center:n,radius:r}=this,s=Oe*r,o=[];for(let i=0,a=mx(s);i<a;i++){const c=i/a*Oe;o.push(n.clone().add(P.FromAngle(c).mul(r)))}return o}nearestPoint(n){const{_center:r,radius:s}=this;return r.clone().add(n.clone().sub(r).uni().mul(s))}hitTestLineSegment(n,r,s){const{_center:o,radius:i}=this;return gm(n,r,o,i)!==null}}class LH extends wi{constructor(n){const{start:r,cp1:s,cp2:o,end:i}=n;super({...n,points:[r,i]});y(this,"a");y(this,"b");y(this,"c");y(this,"d");this.a=r,this.b=s,this.c=o,this.d=i}getVertices(){const n=[],{a:r,b:s,c:o,d:i}=this;for(let a=0,c=10;a<c;a++){const l=a/c;n.push(new P((1-l)*(1-l)*(1-l)*r.x+3*((1-l)*(1-l))*l*s.x+3*(1-l)*(l*l)*o.x+l*l*l*i.x,(1-l)*(1-l)*(1-l)*r.y+3*((1-l)*(1-l))*l*s.y+3*(1-l)*(l*l)*o.y+l*l*l*i.y))}return n}midPoint(){const{a:n,b:r,c:s,d:o}=this,i=.5;return new P((1-i)*(1-i)*(1-i)*n.x+3*((1-i)*(1-i))*i*r.x+3*(1-i)*(i*i)*s.x+i*i*i*o.x,(1-i)*(1-i)*(1-i)*n.y+3*((1-i)*(1-i))*i*r.y+3*(1-i)*(i*i)*s.y+i*i*i*o.y)}nearestPoint(n){let r,s=1/0;for(const o of this.segments){const i=o.nearestPoint(n),a=i.dist(n);a<s&&(r=i,s=a)}if(!r)throw Error("nearest point not found");return r}}class hg extends _a{constructor(n){super({...n,isClosed:!1,isFilled:!1});y(this,"points");y(this,"_segments");y(this,"_length");const{points:r}=n;this.points=r}get segments(){if(!this._segments){this._segments=[];const{points:n}=this,r=n.length,s=r-2,o=1.25;for(let i=0;i<r-1;i++){const a=i===0?n[0]:n[i-1],c=n[i],l=n[i+1],u=i===s?l:n[i+2],d=c,h=i===0?a:new P(c.x+(l.x-a.x)/6*o,c.y+(l.y-a.y)/6*o),f=i===s?l:new P(l.x-(u.x-c.x)/6*o,l.y-(u.y-c.y)/6*o),p=l;this._segments.push(new LH({start:d,cp1:h,cp2:f,end:p}))}}return this._segments}get length(){return this._length||(this._length=this.segments.reduce((n,r)=>n+r.length,0)),this._length}getVertices(){const n=this.segments.reduce((r,s)=>r.concat(s.vertices),[]);return n.push(this.points[this.points.length-1]),n}nearestPoint(n){let r,s=1/0;for(const o of this.segments){const i=o.nearestPoint(n),a=i.dist(n);a<s&&(r=i,s=a)}if(!r)throw Error("nearest point not found");return r}hitTestLineSegment(n,r,s){return this.segments.some(o=>o.hitTestLineSegment(n,r,s))}}class U3 extends _a{constructor(n){super({...n,isClosed:!0});y(this,"w");y(this,"h");y(this,"_edges");this.config=n;const{width:r,height:s}=n;this.w=r,this.h=s}get edges(){if(!this._edges){const{vertices:n}=this;this._edges=[];for(let r=0,s=n.length;r<s;r++){const o=n[r],i=n[(r+1)%s];this._edges.push(new cg({start:o,end:i}))}}return this._edges}getVertices(){const n=Math.max(1,this.w),r=Math.max(1,this.h),s=n/2,o=r/2,i=Math.pow(s-o,2)/Math.pow(s+o,2),a=$e*(s+o)*(1+3*i/(10+Math.sqrt(4-3*i))),c=mx(a),l=Oe/c,u=Math.cos(l),d=Math.sin(l);let h=0,f=1,p=0,m=1;const v=Array(c);for(let w=0;w<c;w++)v[w]=new P(s+s*f,o+o*h),p=d*f+u*h,m=u*f-d*h,h=p,f=m;return v}nearestPoint(n){let r,s=1/0;for(const o of this.edges){const i=o.nearestPoint(n),a=i.dist(n);a<s&&(r=i,s=a)}if(!r)throw Error("nearest point not found");return r}hitTestLineSegment(n,r,s){return this.edges.some(o=>o.hitTestLineSegment(n,r,s))}getBounds(){return new ae(0,0,this.w,this.h)}}class jH extends U3{constructor(e){super({...e}),this.config=e}getVertices(){const e=Math.max(1,this.w),n=Math.max(1,this.h),r=e/2,s=n/2,o=10,i=Array(o*2-2);if(n>e)for(let a=0;a<o-1;a++){const c=-$e+$e*a/(o-2),l=$e*a/(o-2);i[a]=new P(r+r*Math.cos(c),r+r*Math.sin(c)),i[a+(o-1)]=new P(r+r*Math.cos(l),n-r+r*Math.sin(l))}else for(let a=0;a<o-1;a++){const c=-Te+$e*a/(o-2),l=Te+$e*-a/(o-2);i[a]=new P(e-s+s*Math.cos(c),n-s+s*Math.sin(c)),i[a+(o-1)]=new P(s-s*Math.cos(l),n-s+s*Math.sin(l))}return i}}async function NH({shouldReload:t=!0}={}){sessionStorage.clear(),await Promise.all(px().map(e=>YU(e))),localStorage.clear(),t&&window.location.reload()}typeof window<"u"&&(window.__tldraw__hardReset=NH);function zH(t,e="_blank"){rx.openWindow(t,e)}var Wh=function(t){return t&&t.Math==Math&&t},On=Wh(typeof globalThis=="object"&&globalThis)||Wh(typeof window=="object"&&window)||Wh(typeof self=="object"&&self)||Wh(typeof hn=="object"&&hn)||function(){return this}()||hn||Function("return this")(),yx={},yn=function(t){try{return!!t()}catch{return!0}},FH=yn,bi=!FH(function(){return Object.defineProperty({},1,{get:function(){return 7}})[1]!=7}),BH=yn,wm=!BH(function(){var t=(function(){}).bind();return typeof t!="function"||t.hasOwnProperty("prototype")}),UH=wm,Gh=Function.prototype.call,Ci=UH?Gh.bind(Gh):function(){return Gh.apply(Gh,arguments)},H3={},K3={}.propertyIsEnumerable,V3=Object.getOwnPropertyDescriptor,HH=V3&&!K3.call({1:2},1);H3.f=HH?function(e){var n=V3(this,e);return!!n&&n.enumerable}:K3;var W3=function(t,e){return{enumerable:!(t&1),configurable:!(t&2),writable:!(t&4),value:e}},G3=wm,Y3=Function.prototype,Ww=Y3.call,KH=G3&&Y3.bind.bind(Ww,Ww),It=G3?KH:function(t){return function(){return Ww.apply(t,arguments)}},X3=It,VH=X3({}.toString),WH=X3("".slice),dl=function(t){return WH(VH(t),8,-1)},GH=It,YH=yn,XH=dl,a0=Object,qH=GH("".split),QH=YH(function(){return!a0("z").propertyIsEnumerable(0)})?function(t){return XH(t)=="String"?qH(t,""):a0(t)}:a0,Sm=function(t){return t==null},ZH=Sm,JH=TypeError,hl=function(t){if(ZH(t))throw JH("Can't call method on "+t);return t},eK=QH,tK=hl,xm=function(t){return eK(tK(t))},Gw=typeof document=="object"&&document.all,nK=typeof Gw>"u"&&Gw!==void 0,q3={all:Gw,IS_HTMLDDA:nK},Q3=q3,rK=Q3.all,vn=Q3.IS_HTMLDDA?function(t){return typeof t=="function"||t===rK}:function(t){return typeof t=="function"},sE=vn,Z3=q3,sK=Z3.all,ka=Z3.IS_HTMLDDA?function(t){return typeof t=="object"?t!==null:sE(t)||t===sK}:function(t){return typeof t=="object"?t!==null:sE(t)},c0=On,oK=vn,iK=function(t){return oK(t)?t:void 0},bm=function(t,e){return arguments.length<2?iK(c0[t]):c0[t]&&c0[t][e]},aK=It,J3=aK({}.isPrototypeOf),cK=typeof navigator<"u"&&String(navigator.userAgent)||"",eA=On,l0=cK,oE=eA.process,iE=eA.Deno,aE=oE&&oE.versions||iE&&iE.version,cE=aE&&aE.v8,Lr,fg;cE&&(Lr=cE.split("."),fg=Lr[0]>0&&Lr[0]<4?1:+(Lr[0]+Lr[1]));!fg&&l0&&(Lr=l0.match(/Edge\/(\d+)/),(!Lr||Lr[1]>=74)&&(Lr=l0.match(/Chrome\/(\d+)/),Lr&&(fg=+Lr[1])));var lK=fg,lE=lK,uK=yn,dK=On,hK=dK.String,tA=!!Object.getOwnPropertySymbols&&!uK(function(){var t=Symbol();return!hK(t)||!(Object(t)instanceof Symbol)||!Symbol.sham&&lE&&lE<41}),fK=tA,nA=fK&&!Symbol.sham&&typeof Symbol.iterator=="symbol",pK=bm,gK=vn,mK=J3,yK=nA,vK=Object,rA=yK?function(t){return typeof t=="symbol"}:function(t){var e=pK("Symbol");return gK(e)&&mK(e.prototype,vK(t))},wK=String,SK=function(t){try{return wK(t)}catch{return"Object"}},xK=vn,bK=SK,CK=TypeError,vx=function(t){if(xK(t))return t;throw CK(bK(t)+" is not a function")},_K=vx,EK=Sm,wx=function(t,e){var n=t[e];return EK(n)?void 0:_K(n)},u0=Ci,d0=vn,h0=ka,PK=TypeError,kK=function(t,e){var n,r;if(e==="string"&&d0(n=t.toString)&&!h0(r=u0(n,t))||d0(n=t.valueOf)&&!h0(r=u0(n,t))||e!=="string"&&d0(n=t.toString)&&!h0(r=u0(n,t)))return r;throw PK("Can't convert object to primitive value")},sA={exports:{}},uE=On,IK=Object.defineProperty,Sx=function(t,e){try{IK(uE,t,{value:e,configurable:!0,writable:!0})}catch{uE[t]=e}return e},$K=On,TK=Sx,dE="__core-js_shared__",AK=$K[dE]||TK(dE,{}),xx=AK,hE=xx;(sA.exports=function(t,e){return hE[t]||(hE[t]=e!==void 0?e:{})})("versions",[]).push({version:"3.32.0",mode:"global",copyright:" 2014-2023 Denis Pushkarev (zloirock.ru)",license:"https://github.com/zloirock/core-js/blob/v3.32.0/LICENSE",source:"https://github.com/zloirock/core-js"});var bx=sA.exports,MK=hl,OK=Object,Nd=function(t){return OK(MK(t))},DK=It,RK=Nd,LK=DK({}.hasOwnProperty),_i=Object.hasOwn||function(e,n){return LK(RK(e),n)},jK=It,NK=0,zK=Math.random(),FK=jK(1 .toString),oA=function(t){return"Symbol("+(t===void 0?"":t)+")_"+FK(++NK+zK,36)},BK=On,UK=bx,fE=_i,HK=oA,KK=tA,VK=nA,yc=BK.Symbol,f0=UK("wks"),WK=VK?yc.for||yc:yc&&yc.withoutSetter||HK,ho=function(t){return fE(f0,t)||(f0[t]=KK&&fE(yc,t)?yc[t]:WK("Symbol."+t)),f0[t]},GK=Ci,pE=ka,gE=rA,YK=wx,XK=kK,qK=ho,QK=TypeError,ZK=qK("toPrimitive"),JK=function(t,e){if(!pE(t)||gE(t))return t;var n=YK(t,ZK),r;if(n){if(e===void 0&&(e="default"),r=GK(n,t,e),!pE(r)||gE(r))return r;throw QK("Can't convert object to primitive value")}return e===void 0&&(e="number"),XK(t,e)},eV=JK,tV=rA,iA=function(t){var e=eV(t,"string");return tV(e)?e:e+""},nV=On,mE=ka,Yw=nV.document,rV=mE(Yw)&&mE(Yw.createElement),aA=function(t){return rV?Yw.createElement(t):{}},sV=bi,oV=yn,iV=aA,cA=!sV&&!oV(function(){return Object.defineProperty(iV("div"),"a",{get:function(){return 7}}).a!=7}),aV=bi,cV=Ci,lV=H3,uV=W3,dV=xm,hV=iA,fV=_i,pV=cA,yE=Object.getOwnPropertyDescriptor;yx.f=aV?yE:function(e,n){if(e=dV(e),n=hV(n),pV)try{return yE(e,n)}catch{}if(fV(e,n))return uV(!cV(lV.f,e,n),e[n])};var fl={},gV=bi,mV=yn,lA=gV&&mV(function(){return Object.defineProperty(function(){},"prototype",{value:42,writable:!1}).prototype!=42}),yV=ka,vV=String,wV=TypeError,Ia=function(t){if(yV(t))return t;throw wV(vV(t)+" is not an object")},SV=bi,xV=cA,bV=lA,Yh=Ia,vE=iA,CV=TypeError,p0=Object.defineProperty,_V=Object.getOwnPropertyDescriptor,g0="enumerable",m0="configurable",y0="writable";fl.f=SV?bV?function(e,n,r){if(Yh(e),n=vE(n),Yh(r),typeof e=="function"&&n==="prototype"&&"value"in r&&y0 in r&&!r[y0]){var s=_V(e,n);s&&s[y0]&&(e[n]=r.value,r={configurable:m0 in r?r[m0]:s[m0],enumerable:g0 in r?r[g0]:s[g0],writable:!1})}return p0(e,n,r)}:p0:function(e,n,r){if(Yh(e),n=vE(n),Yh(r),xV)try{return p0(e,n,r)}catch{}if("get"in r||"set"in r)throw CV("Accessors not supported");return"value"in r&&(e[n]=r.value),e};var EV=bi,PV=fl,kV=W3,Cx=EV?function(t,e,n){return PV.f(t,e,kV(1,n))}:function(t,e,n){return t[e]=n,t},uA={exports:{}},Xw=bi,IV=_i,dA=Function.prototype,$V=Xw&&Object.getOwnPropertyDescriptor,_x=IV(dA,"name"),TV=_x&&(function(){}).name==="something",AV=_x&&(!Xw||Xw&&$V(dA,"name").configurable),MV={EXISTS:_x,PROPER:TV,CONFIGURABLE:AV},OV=It,DV=vn,qw=xx,RV=OV(Function.toString);DV(qw.inspectSource)||(qw.inspectSource=function(t){return RV(t)});var hA=qw.inspectSource,LV=On,jV=vn,wE=LV.WeakMap,NV=jV(wE)&&/native code/.test(String(wE)),zV=bx,FV=oA,SE=zV("keys"),fA=function(t){return SE[t]||(SE[t]=FV(t))},Ex={},BV=NV,pA=On,UV=ka,HV=Cx,v0=_i,w0=xx,KV=fA,VV=Ex,xE="Object already initialized",Qw=pA.TypeError,WV=pA.WeakMap,pg,nd,gg,GV=function(t){return gg(t)?nd(t):pg(t,{})},YV=function(t){return function(e){var n;if(!UV(e)||(n=nd(e)).type!==t)throw Qw("Incompatible receiver, "+t+" required");return n}};if(BV||w0.state){var Qr=w0.state||(w0.state=new WV);Qr.get=Qr.get,Qr.has=Qr.has,Qr.set=Qr.set,pg=function(t,e){if(Qr.has(t))throw Qw(xE);return e.facade=t,Qr.set(t,e),e},nd=function(t){return Qr.get(t)||{}},gg=function(t){return Qr.has(t)}}else{var qa=KV("state");VV[qa]=!0,pg=function(t,e){if(v0(t,qa))throw Qw(xE);return e.facade=t,HV(t,qa,e),e},nd=function(t){return v0(t,qa)?t[qa]:{}},gg=function(t){return v0(t,qa)}}var gA={set:pg,get:nd,has:gg,enforce:GV,getterFor:YV},Px=It,XV=yn,qV=vn,Xh=_i,Zw=bi,QV=MV.CONFIGURABLE,ZV=hA,mA=gA,JV=mA.enforce,eW=mA.get,bE=String,zf=Object.defineProperty,tW=Px("".slice),nW=Px("".replace),rW=Px([].join),sW=Zw&&!XV(function(){return zf(function(){},"length",{value:8}).length!==8}),oW=String(String).split("String"),iW=uA.exports=function(t,e,n){tW(bE(e),0,7)==="Symbol("&&(e="["+nW(bE(e),/^Symbol\(([^)]*)\)/,"$1")+"]"),n&&n.getter&&(e="get "+e),n&&n.setter&&(e="set "+e),(!Xh(t,"name")||QV&&t.name!==e)&&(Zw?zf(t,"name",{value:e,configurable:!0}):t.name=e),sW&&n&&Xh(n,"arity")&&t.length!==n.arity&&zf(t,"length",{value:n.arity});try{n&&Xh(n,"constructor")&&n.constructor?Zw&&zf(t,"prototype",{writable:!1}):t.prototype&&(t.prototype=void 0)}catch{}var r=JV(t);return Xh(r,"source")||(r.source=rW(oW,typeof e=="string"?e:"")),t};Function.prototype.toString=iW(function(){return qV(this)&&eW(this).source||ZV(this)},"toString");var aW=uA.exports,cW=vn,lW=fl,uW=aW,dW=Sx,yA=function(t,e,n,r){r||(r={});var s=r.enumerable,o=r.name!==void 0?r.name:e;if(cW(n)&&uW(n,o,r),r.global)s?t[e]=n:dW(e,n);else{try{r.unsafe?t[e]&&(s=!0):delete t[e]}catch{}s?t[e]=n:lW.f(t,e,{value:n,enumerable:!1,configurable:!r.nonConfigurable,writable:!r.nonWritable})}return t},vA={},hW=Math.ceil,fW=Math.floor,pW=Math.trunc||function(e){var n=+e;return(n>0?fW:hW)(n)},gW=pW,$a=function(t){var e=+t;return e!==e||e===0?0:gW(e)},mW=$a,yW=Math.max,vW=Math.min,wW=function(t,e){var n=mW(t);return n<0?yW(n+e,0):vW(n,e)},SW=$a,xW=Math.min,wA=function(t){return t>0?xW(SW(t),9007199254740991):0},bW=wA,zd=function(t){return bW(t.length)},CW=xm,_W=wW,EW=zd,CE=function(t){return function(e,n,r){var s=CW(e),o=EW(s),i=_W(r,o),a;if(t&&n!=n){for(;o>i;)if(a=s[i++],a!=a)return!0}else for(;o>i;i++)if((t||i in s)&&s[i]===n)return t||i||0;return!t&&-1}},PW={includes:CE(!0),indexOf:CE(!1)},kW=It,S0=_i,IW=xm,$W=PW.indexOf,TW=Ex,_E=kW([].push),SA=function(t,e){var n=IW(t),r=0,s=[],o;for(o in n)!S0(TW,o)&&S0(n,o)&&_E(s,o);for(;e.length>r;)S0(n,o=e[r++])&&(~$W(s,o)||_E(s,o));return s},kx=["constructor","hasOwnProperty","isPrototypeOf","propertyIsEnumerable","toLocaleString","toString","valueOf"],AW=SA,MW=kx,OW=MW.concat("length","prototype");vA.f=Object.getOwnPropertyNames||function(e){return AW(e,OW)};var xA={};xA.f=Object.getOwnPropertySymbols;var DW=bm,RW=It,LW=vA,jW=xA,NW=Ia,zW=RW([].concat),FW=DW("Reflect","ownKeys")||function(e){var n=LW.f(NW(e)),r=jW.f;return r?zW(n,r(e)):n},EE=_i,BW=FW,UW=yx,HW=fl,KW=function(t,e,n){for(var r=BW(e),s=HW.f,o=UW.f,i=0;i<r.length;i++){var a=r[i];!EE(t,a)&&!(n&&EE(n,a))&&s(t,a,o(e,a))}},VW=yn,WW=vn,GW=/#|\.prototype\./,Fd=function(t,e){var n=XW[YW(t)];return n==QW?!0:n==qW?!1:WW(e)?VW(e):!!e},YW=Fd.normalize=function(t){return String(t).replace(GW,".").toLowerCase()},XW=Fd.data={},qW=Fd.NATIVE="N",QW=Fd.POLYFILL="P",ZW=Fd,x0=On,JW=yx.f,eG=Cx,tG=yA,nG=Sx,rG=KW,sG=ZW,pl=function(t,e){var n=t.target,r=t.global,s=t.stat,o,i,a,c,l,u;if(r?i=x0:s?i=x0[n]||nG(n,{}):i=(x0[n]||{}).prototype,i)for(a in e){if(l=e[a],t.dontCallGetSet?(u=JW(i,a),c=u&&u.value):c=i[a],o=sG(r?a:n+(s?".":"#")+a,t.forced),!o&&c!==void 0){if(typeof l==typeof c)continue;rG(l,c)}(t.sham||c&&c.sham)&&eG(l,"sham",!0),tG(i,a,l,t)}},bA={},oG=SA,iG=kx,aG=Object.keys||function(e){return oG(e,iG)},cG=bi,lG=lA,uG=fl,dG=Ia,hG=xm,fG=aG;bA.f=cG&&!lG?Object.defineProperties:function(e,n){dG(e);for(var r=hG(n),s=fG(n),o=s.length,i=0,a;o>i;)uG.f(e,a=s[i++],r[a]);return e};var pG=bm,gG=pG("document","documentElement"),mG=Ia,yG=bA,PE=kx,vG=Ex,wG=gG,SG=aA,xG=fA,kE=">",IE="<",Jw="prototype",eS="script",CA=xG("IE_PROTO"),b0=function(){},_A=function(t){return IE+eS+kE+t+IE+"/"+eS+kE},$E=function(t){t.write(_A("")),t.close();var e=t.parentWindow.Object;return t=null,e},bG=function(){var t=SG("iframe"),e="java"+eS+":",n;return t.style.display="none",wG.appendChild(t),t.src=String(e),n=t.contentWindow.document,n.open(),n.write(_A("document.F=Object")),n.close(),n.F},qh,Ff=function(){try{qh=new ActiveXObject("htmlfile")}catch{}Ff=typeof document<"u"?document.domain&&qh?$E(qh):bG():$E(qh);for(var t=PE.length;t--;)delete Ff[Jw][PE[t]];return Ff()};vG[CA]=!0;var EA=Object.create||function(e,n){var r;return e!==null?(b0[Jw]=mG(e),r=new b0,b0[Jw]=null,r[CA]=e):r=Ff(),n===void 0?r:yG.f(r,n)},CG=ho,_G=EA,EG=fl.f,tS=CG("unscopables"),nS=Array.prototype;nS[tS]==null&&EG(nS,tS,{configurable:!0,value:_G(null)});var Ix=function(t){nS[tS][t]=!0},PG=pl,kG=Nd,IG=zd,$G=$a,TG=Ix;PG({target:"Array",proto:!0},{at:function(e){var n=kG(this),r=IG(n),s=$G(e),o=s>=0?s:r+s;return o<0||o>=r?void 0:n[o]}});TG("at");var AG=On,MG=It,Bd=function(t,e){return MG(AG[t].prototype[e])},OG=Bd;OG("Array","at");var DG=dl,PA=Array.isArray||function(e){return DG(e)=="Array"},RG=TypeError,LG=9007199254740991,jG=function(t){if(t>LG)throw RG("Maximum allowed index exceeded");return t},NG=dl,zG=It,kA=function(t){if(NG(t)==="Function")return zG(t)},TE=kA,FG=vx,BG=wm,UG=TE(TE.bind),HG=function(t,e){return FG(t),e===void 0?t:BG?UG(t,e):function(){return t.apply(e,arguments)}},KG=PA,VG=zd,WG=jG,GG=HG,IA=function(t,e,n,r,s,o,i,a){for(var c=s,l=0,u=i?GG(i,a):!1,d,h;l<r;)l in n&&(d=u?u(n[l],l,e):n[l],o>0&&KG(d)?(h=VG(d),c=IA(t,e,d,h,c,o-1)-1):(WG(c+1),t[c]=d),c++),l++;return c},$A=IA,YG=ho,XG=YG("toStringTag"),TA={};TA[XG]="z";var qG=String(TA)==="[object z]",QG=qG,ZG=vn,Bf=dl,JG=ho,eY=JG("toStringTag"),tY=Object,nY=Bf(function(){return arguments}())=="Arguments",rY=function(t,e){try{return t[e]}catch{}},AA=QG?Bf:function(t){var e,n,r;return t===void 0?"Undefined":t===null?"Null":typeof(n=rY(e=tY(t),eY))=="string"?n:nY?Bf(e):(r=Bf(e))=="Object"&&ZG(e.callee)?"Arguments":r},sY=It,oY=yn,MA=vn,iY=AA,aY=bm,cY=hA,OA=function(){},lY=[],DA=aY("Reflect","construct"),$x=/^\s*(?:class|function)\b/,uY=sY($x.exec),dY=!$x.exec(OA),Hl=function(e){if(!MA(e))return!1;try{return DA(OA,lY,e),!0}catch{return!1}},RA=function(e){if(!MA(e))return!1;switch(iY(e)){case"AsyncFunction":case"GeneratorFunction":case"AsyncGeneratorFunction":return!1}try{return dY||!!uY($x,cY(e))}catch{return!0}};RA.sham=!0;var hY=!DA||oY(function(){var t;return Hl(Hl.call)||!Hl(Object)||!Hl(function(){t=!0})||t})?RA:Hl,AE=PA,fY=hY,pY=ka,gY=ho,mY=gY("species"),ME=Array,yY=function(t){var e;return AE(t)&&(e=t.constructor,fY(e)&&(e===ME||AE(e.prototype))?e=void 0:pY(e)&&(e=e[mY],e===null&&(e=void 0))),e===void 0?ME:e},vY=yY,LA=function(t,e){return new(vY(t))(e===0?0:e)},wY=pl,SY=$A,xY=Nd,bY=zd,CY=$a,_Y=LA;wY({target:"Array",proto:!0},{flat:function(){var e=arguments.length?arguments[0]:void 0,n=xY(this),r=bY(n),s=_Y(n,0);return s.length=SY(s,n,n,r,0,e===void 0?1:CY(e)),s}});var EY=Ix;EY("flat");var PY=Bd;PY("Array","flat");var kY=pl,IY=$A,$Y=vx,TY=Nd,AY=zd,MY=LA;kY({target:"Array",proto:!0},{flatMap:function(e){var n=TY(this),r=AY(n),s;return $Y(e),s=MY(n,0),s.length=IY(s,n,n,r,0,1,e,arguments.length>1?arguments[1]:void 0),s}});var OY=Ix;OY("flatMap");var DY=Bd;DY("Array","flatMap");var RY=AA,LY=String,Ud=function(t){if(RY(t)==="Symbol")throw TypeError("Cannot convert a Symbol value to a string");return LY(t)},jY=pl,NY=It,zY=hl,FY=$a,BY=Ud,UY=yn,HY=NY("".charAt),KY=UY(function(){return"".at(-2)!=="\uD842"});jY({target:"String",proto:!0,forced:KY},{at:function(e){var n=BY(zY(this)),r=n.length,s=FY(e),o=s>=0?s:r+s;return o<0||o>=r?void 0:HY(n,o)}});var VY=Bd;VY("String","at");var WY=Ia,jA=function(){var t=WY(this),e="";return t.hasIndices&&(e+="d"),t.global&&(e+="g"),t.ignoreCase&&(e+="i"),t.multiline&&(e+="m"),t.dotAll&&(e+="s"),t.unicode&&(e+="u"),t.unicodeSets&&(e+="v"),t.sticky&&(e+="y"),e},Tx=yn,GY=On,Ax=GY.RegExp,Mx=Tx(function(){var t=Ax("a","y");return t.lastIndex=2,t.exec("abcd")!=null}),YY=Mx||Tx(function(){return!Ax("a","y").sticky}),XY=Mx||Tx(function(){var t=Ax("^r","gy");return t.lastIndex=2,t.exec("str")!=null}),qY={BROKEN_CARET:XY,MISSED_STICKY:YY,UNSUPPORTED_Y:Mx},QY=yn,ZY=On,JY=ZY.RegExp,eX=QY(function(){var t=JY(".","s");return!(t.dotAll&&t.exec(`
`)&&t.flags==="s")}),tX=yn,nX=On,rX=nX.RegExp,sX=tX(function(){var t=rX("(?<a>b)","g");return t.exec("b").groups.a!=="b"||"b".replace(t,"$<a>c")!=="bc"}),vc=Ci,Cm=It,oX=Ud,iX=jA,aX=qY,cX=bx,lX=EA,uX=gA.get,dX=eX,hX=sX,fX=cX("native-string-replace",String.prototype.replace),mg=RegExp.prototype.exec,rS=mg,pX=Cm("".charAt),gX=Cm("".indexOf),mX=Cm("".replace),C0=Cm("".slice),sS=function(){var t=/a/,e=/b*/g;return vc(mg,t,"a"),vc(mg,e,"a"),t.lastIndex!==0||e.lastIndex!==0}(),NA=aX.BROKEN_CARET,oS=/()??/.exec("")[1]!==void 0,yX=sS||oS||NA||dX||hX;yX&&(rS=function(e){var n=this,r=uX(n),s=oX(e),o=r.raw,i,a,c,l,u,d,h;if(o)return o.lastIndex=n.lastIndex,i=vc(rS,o,s),n.lastIndex=o.lastIndex,i;var f=r.groups,p=NA&&n.sticky,m=vc(iX,n),v=n.source,w=0,x=s;if(p&&(m=mX(m,"y",""),gX(m,"g")===-1&&(m+="g"),x=C0(s,n.lastIndex),n.lastIndex>0&&(!n.multiline||n.multiline&&pX(s,n.lastIndex-1)!==`
`)&&(v="(?: "+v+")",x=" "+x,w++),a=new RegExp("^(?:"+v+")",m)),oS&&(a=new RegExp("^"+v+"$(?!\\s)",m)),sS&&(c=n.lastIndex),l=vc(mg,p?a:n,x),p?l?(l.input=C0(l.input,w),l[0]=C0(l[0],w),l.index=n.lastIndex,n.lastIndex+=l[0].length):n.lastIndex=0:sS&&l&&(n.lastIndex=n.global?l.index+l[0].length:c),oS&&l&&l.length>1&&vc(fX,l[0],a,function(){for(u=1;u<arguments.length-2;u++)arguments[u]===void 0&&(l[u]=void 0)}),l&&f)for(l.groups=d=lX(null),u=0;u<f.length;u++)h=f[u],d[h[0]]=l[h[1]];return l});var Ox=rS,vX=pl,OE=Ox;vX({target:"RegExp",proto:!0,forced:/./.exec!==OE},{exec:OE});var wX=wm,zA=Function.prototype,DE=zA.apply,RE=zA.call,SX=typeof Reflect=="object"&&Reflect.apply||(wX?RE.bind(DE):function(){return RE.apply(DE,arguments)}),LE=kA,jE=yA,xX=Ox,NE=yn,FA=ho,bX=Cx,CX=FA("species"),_0=RegExp.prototype,_X=function(t,e,n,r){var s=FA(t),o=!NE(function(){var l={};return l[s]=function(){return 7},""[t](l)!=7}),i=o&&!NE(function(){var l=!1,u=/a/;return t==="split"&&(u={},u.constructor={},u.constructor[CX]=function(){return u},u.flags="",u[s]=/./[s]),u.exec=function(){return l=!0,null},u[s](""),!l});if(!o||!i||n){var a=LE(/./[s]),c=e(s,""[t],function(l,u,d,h,f){var p=LE(l),m=u.exec;return m===xX||m===_0.exec?o&&!f?{done:!0,value:a(u,d,h)}:{done:!0,value:p(d,u,h)}:{done:!1}});jE(String.prototype,t,c[0]),jE(_0,s,c[1])}r&&bX(_0[s],"sham",!0)},Dx=It,EX=$a,PX=Ud,kX=hl,IX=Dx("".charAt),zE=Dx("".charCodeAt),$X=Dx("".slice),FE=function(t){return function(e,n){var r=PX(kX(e)),s=EX(n),o=r.length,i,a;return s<0||s>=o?t?"":void 0:(i=zE(r,s),i<55296||i>56319||s+1===o||(a=zE(r,s+1))<56320||a>57343?t?IX(r,s):i:t?$X(r,s,s+2):(i-55296<<10)+(a-56320)+65536)}},TX={codeAt:FE(!1),charAt:FE(!0)},AX=TX.charAt,MX=function(t,e,n){return e+(n?AX(t,e).length:1)},Rx=It,OX=Nd,DX=Math.floor,E0=Rx("".charAt),RX=Rx("".replace),P0=Rx("".slice),LX=/\$([$&'`]|\d{1,2}|<[^>]*>)/g,jX=/\$([$&'`]|\d{1,2})/g,BA=function(t,e,n,r,s,o){var i=n+t.length,a=r.length,c=jX;return s!==void 0&&(s=OX(s),c=LX),RX(o,c,function(l,u){var d;switch(E0(u,0)){case"$":return"$";case"&":return t;case"`":return P0(e,0,n);case"'":return P0(e,i);case"<":d=s[P0(u,1,-1)];break;default:var h=+u;if(h===0)return l;if(h>a){var f=DX(h/10);return f===0?l:f<=a?r[f-1]===void 0?E0(u,1):r[f-1]+E0(u,1):l}d=r[h-1]}return d===void 0?"":d})},BE=Ci,NX=Ia,zX=vn,FX=dl,BX=Ox,UX=TypeError,HX=function(t,e){var n=t.exec;if(zX(n)){var r=BE(n,t,e);return r!==null&&NX(r),r}if(FX(t)==="RegExp")return BE(BX,t,e);throw UX("RegExp#exec called on incompatible receiver")},KX=SX,UE=Ci,_m=It,VX=_X,WX=yn,GX=Ia,YX=vn,XX=Sm,qX=$a,QX=wA,Qa=Ud,ZX=hl,JX=MX,eq=wx,tq=BA,nq=HX,rq=ho,iS=rq("replace"),sq=Math.max,oq=Math.min,iq=_m([].concat),k0=_m([].push),HE=_m("".indexOf),KE=_m("".slice),aq=function(t){return t===void 0?t:String(t)},cq=function(){return"a".replace(/./,"$0")==="$0"}(),VE=function(){return/./[iS]?/./[iS]("a","$0")==="":!1}(),lq=!WX(function(){var t=/./;return t.exec=function(){var e=[];return e.groups={a:"7"},e},"".replace(t,"$<a>")!=="7"});VX("replace",function(t,e,n){var r=VE?"$":"$0";return[function(o,i){var a=ZX(this),c=XX(o)?void 0:eq(o,iS);return c?UE(c,o,a,i):UE(e,Qa(a),o,i)},function(s,o){var i=GX(this),a=Qa(s);if(typeof o=="string"&&HE(o,r)===-1&&HE(o,"$<")===-1){var c=n(e,i,a,o);if(c.done)return c.value}var l=YX(o);l||(o=Qa(o));var u=i.global;if(u){var d=i.unicode;i.lastIndex=0}for(var h=[];;){var f=nq(i,a);if(f===null||(k0(h,f),!u))break;var p=Qa(f[0]);p===""&&(i.lastIndex=JX(a,QX(i.lastIndex),d))}for(var m="",v=0,w=0;w<h.length;w++){f=h[w];for(var x=Qa(f[0]),b=sq(oq(qX(f.index),a.length),0),C=[],E=1;E<f.length;E++)k0(C,aq(f[E]));var _=f.groups;if(l){var k=iq([x],C,b,a);_!==void 0&&k0(k,_);var I=Qa(KX(o,void 0,k))}else I=tq(x,a,b,C,_,o);b>=v&&(m+=KE(a,v,b)+I,v=b+x.length)}return m+KE(a,v)}]},!lq||!cq||VE);var uq=ka,dq=dl,hq=ho,fq=hq("match"),pq=function(t){var e;return uq(t)&&((e=t[fq])!==void 0?!!e:dq(t)=="RegExp")},gq=Ci,mq=_i,yq=J3,vq=jA,WE=RegExp.prototype,wq=function(t){var e=t.flags;return e===void 0&&!("flags"in WE)&&!mq(t,"flags")&&yq(WE,t)?gq(vq,t):e},Sq=pl,xq=Ci,Lx=It,GE=hl,bq=vn,Cq=Sm,_q=pq,Kl=Ud,Eq=wx,Pq=wq,kq=BA,Iq=ho,$q=Iq("replace"),Tq=TypeError,UA=Lx("".indexOf);Lx("".replace);var YE=Lx("".slice),Aq=Math.max,XE=function(t,e,n){return n>t.length?-1:e===""?n:UA(t,e,n)};Sq({target:"String",proto:!0},{replaceAll:function(e,n){var r=GE(this),s,o,i,a,c,l,u,d,h,f=0,p=0,m="";if(!Cq(e)){if(s=_q(e),s&&(o=Kl(GE(Pq(e))),!~UA(o,"g")))throw Tq("`.replaceAll` does not allow non-global regexes");if(i=Eq(e,$q),i)return xq(i,e,r,n)}for(a=Kl(r),c=Kl(e),l=bq(n),l||(n=Kl(n)),u=c.length,d=Aq(1,u),f=XE(a,c,0);f!==-1;)h=l?Kl(n(c,f,a)):kq(c,a,f,[],void 0,n),m+=YE(a,p,f)+h,p=f+u,f=XE(a,c,f+d);return p<a.length&&(m+=YE(a,p)),m}});var Mq=Bd;Mq("String","replaceAll");const HA=S.createContext(null);function Oq({assetUrls:t,children:e}){return g.jsx(HA.Provider,{value:t,children:e})}function jx(){const t=S.useContext(HA);if(!t)throw new Error("useAssetUrls must be used within an AssetUrlsProvider");return t}const aS={"action.convert-to-bookmark":"Convert to Bookmark","action.convert-to-embed":"Convert to Embed","action.open-embed-link":"Open link","action.align-bottom":"Align bottom","action.align-center-horizontal":"Align horizontally","action.align-center-vertical":"Align vertically","action.align-center-horizontal.short":"Align H","action.align-center-vertical.short":"Align V","action.align-left":"Align left","action.align-right":"Align right","action.align-top":"Align top","action.back-to-content":"Back to content","action.bring-forward":"Bring forward","action.bring-to-front":"Bring to front","action.copy-as-json.short":"JSON","action.copy-as-json":"Copy as JSON","action.copy-as-png.short":"PNG","action.copy-as-png":"Copy as PNG","action.copy-as-svg.short":"SVG","action.copy-as-svg":"Copy as SVG","action.copy":"Copy","action.cut":"Cut","action.delete":"Delete","action.distribute-horizontal":"Distribute horizontally","action.distribute-vertical":"Distribute vertically","action.distribute-horizontal.short":"Distribute H","action.distribute-vertical.short":"Distribute V","action.duplicate":"Duplicate","action.edit-link":"Edit link","action.exit-pen-mode":"Exit pen mode","action.export-as-json.short":"JSON","action.export-as-json":"Export as JSON","action.export-as-png.short":"PNG","action.export-as-png":"Export as PNG","action.export-as-svg.short":"SVG","action.export-as-svg":"Export as SVG","action.flip-horizontal":"Flip horizontally","action.flip-vertical":"Flip vertically","action.flip-horizontal.short":"Flip H","action.flip-vertical.short":"Flip V","action.fork-project":"Fork this project","action.group":"Group","action.insert-embed":"Insert embed","action.insert-media":"Upload media","action.leave-shared-project":"Leave shared project","action.new-project":"New project","action.new-shared-project":"New shared project","action.open-cursor-chat":"Cursor chat","action.open-file":"Open file","action.pack":"Pack","action.paste":"Paste","action.print":"Print","action.redo":"Redo","action.rotate-ccw":"Rotate counterclockwise","action.rotate-cw":"Rotate clockwise","action.save-copy":"Save a copy","action.select-all":"Select all","action.select-none":"Select none","action.send-backward":"Send backward","action.send-to-back":"Send to back","action.share-project":"Share this project","action.stack-horizontal":"Stack horizontally","action.stack-vertical":"Stack vertically","action.stack-horizontal.short":"Stack H","action.stack-vertical.short":"Stack V","action.stop-following":"Stop following","action.stretch-horizontal":"Stretch horizontally","action.stretch-vertical":"Stretch vertically","action.stretch-horizontal.short":"Stretch H","action.stretch-vertical.short":"Stretch V","action.toggle-auto-size":"Toggle auto size","action.toggle-dark-mode.menu":"Dark mode","action.toggle-dark-mode":"Toggle dark mode","action.toggle-reduce-motion.menu":"Reduce motion","action.toggle-reduce-motion":"Toggle reduce motion","action.toggle-debug-mode.menu":"Debug mode","action.toggle-debug-mode":"Toggle debug mode","action.toggle-focus-mode.menu":"Focus mode","action.toggle-focus-mode":"Toggle focus mode","action.toggle-grid.menu":"Show grid","action.toggle-grid":"Toggle grid","action.toggle-lock":"Toggle locked","action.toggle-snap-mode.menu":"Always snap","action.toggle-snap-mode":"Toggle always snap","action.toggle-tool-lock.menu":"Tool lock","action.toggle-tool-lock":"Toggle tool lock","action.toggle-transparent.context-menu":"Transparent","action.toggle-transparent.menu":"Transparent","action.toggle-transparent":"Toggle transparent background","action.undo":"Undo","action.ungroup":"Ungroup","action.zoom-in":"Zoom in","action.zoom-out":"Zoom out","action.zoom-to-100":"Zoom to 100%","action.zoom-to-fit":"Zoom to fit","action.zoom-to-selection":"Zoom to selection","color-style.black":"Black","color-style.blue":"Blue","color-style.green":"Green","color-style.grey":"Grey","color-style.light-blue":"Light blue","color-style.light-green":"Light green","color-style.light-red":"Light red","color-style.light-violet":"Light violet","color-style.orange":"Orange","color-style.red":"Red","color-style.violet":"Violet","color-style.yellow":"Yellow","fill-style.none":"None","fill-style.semi":"Semi","fill-style.solid":"Solid","fill-style.pattern":"Pattern","dash-style.dashed":"Dashed","dash-style.dotted":"Dotted","dash-style.draw":"Draw","dash-style.solid":"Solid","size-style.s":"Small","size-style.m":"Medium","size-style.l":"Large","size-style.xl":"Extra large","opacity-style.0.1":"10%","opacity-style.0.25":"25%","opacity-style.0.5":"50%","opacity-style.0.75":"75%","opacity-style.1":"100%","font-style.draw":"Draw","font-style.sans":"Sans","font-style.serif":"Serif","font-style.mono":"Mono","align-style.start":"Start","align-style.middle":"Middle","align-style.end":"End","align-style.justify":"Justify","geo-style.arrow-down":"Arrow down","geo-style.arrow-left":"Arrow left","geo-style.arrow-right":"Arrow right","geo-style.arrow-up":"Arrow up","geo-style.diamond":"Diamond","geo-style.ellipse":"Ellipse","geo-style.hexagon":"Hexagon","geo-style.octagon":"Octagon","geo-style.oval":"Oval","geo-style.cloud":"Cloud","geo-style.pentagon":"Pentagon","geo-style.rectangle":"Rectangle","geo-style.rhombus-2":"Rhombus 2","geo-style.rhombus":"Rhombus","geo-style.star":"Star","geo-style.trapezoid":"Trapezoid","geo-style.triangle":"Triangle","geo-style.x-box":"X box","geo-style.check-box":"Check box","arrowheadStart-style.none":"None","arrowheadStart-style.arrow":"Arrow","arrowheadStart-style.bar":"Bar","arrowheadStart-style.diamond":"Diamond","arrowheadStart-style.dot":"Dot","arrowheadStart-style.inverted":"Inverted","arrowheadStart-style.pipe":"Pipe","arrowheadStart-style.square":"Square","arrowheadStart-style.triangle":"Triangle","arrowheadEnd-style.none":"None","arrowheadEnd-style.arrow":"Arrow","arrowheadEnd-style.bar":"Bar","arrowheadEnd-style.diamond":"Diamond","arrowheadEnd-style.dot":"Dot","arrowheadEnd-style.inverted":"Inverted","arrowheadEnd-style.pipe":"Pipe","arrowheadEnd-style.square":"Square","arrowheadEnd-style.triangle":"Triangle","spline-style.line":"Line","spline-style.cubic":"Cubic","tool.select":"Select","tool.hand":"Hand","tool.draw":"Draw","tool.eraser":"Eraser","tool.arrow-down":"Arrow down","tool.arrow-left":"Arrow left","tool.arrow-right":"Arrow right","tool.arrow-up":"Arrow up","tool.arrow":"Arrow","tool.cloud":"Cloud","tool.diamond":"Diamond","tool.ellipse":"Ellipse","tool.hexagon":"Hexagon","tool.highlight":"Highlight","tool.line":"Line","tool.octagon":"Octagon","tool.oval":"Oval","tool.pentagon":"Pentagon","tool.rectangle":"Rectangle","tool.rhombus":"Rhombus","tool.star":"Star","tool.trapezoid":"Trapezoid","tool.triangle":"Triangle","tool.x-box":"X box","tool.check-box":"Check box","tool.asset":"Asset","tool.frame":"Frame","tool.note":"Note","tool.laser":"Laser","tool.embed":"Embed","tool.text":"Text","menu.title":"Menu","menu.copy-as":"Copy as","menu.edit":"Edit","menu.export-as":"Export as","menu.file":"File","menu.language":"Language","menu.preferences":"Preferences","menu.view":"View","context-menu.arrange":"Arrange","context-menu.copy-as":"Copy as","context-menu.export-as":"Export as","context-menu.move-to-page":"Move to page","context-menu.reorder":"Reorder","page-menu.title":"Pages","page-menu.create-new-page":"Create new page","page-menu.max-page-count-reached":"Max pages reached","page-menu.new-page-initial-name":"Page 1","page-menu.edit-start":"Edit","page-menu.edit-done":"Done","page-menu.go-to-page":"Go to page","page-menu.submenu.rename":"Rename","page-menu.submenu.duplicate-page":"Duplicate","page-menu.submenu.title":"Menu","page-menu.submenu.move-down":"Move down","page-menu.submenu.move-up":"Move up","page-menu.submenu.delete":"Delete","share-menu.title":"Share","share-menu.save-note":"Download this project to your computer as a .tldr file.","share-menu.fork-note":"Create a new shared project based on this snapshot.","share-menu.share-project":"Share this project","share-menu.default-project-name":"Shared Project","share-menu.copy-link":"Copy share link","share-menu.readonly-link":"Read-only","share-menu.create-snapshot-link":"Copy snapshot link","share-menu.snapshot-link-note":"Capture and share this project as a read-only snapshot link.","share-menu.copy-readonly-link":"Copy read-only link","share-menu.offline-note":"Create a new shared project based on your current project.","share-menu.copy-link-note":"Anyone with the link will be able to view and edit this project.","share-menu.copy-readonly-link-note":"Anyone with the link will be able to view (but not edit) this project.","share-menu.project-too-large":"Sorry, this project can't be shared because it's too large. We're working on it!","share-menu.upload-failed":"Sorry, we couldn't upload your project at the moment. Please try again or let us know if the problem persists.","people-menu.title":"People","people-menu.change-name":"Change name","people-menu.change-color":"Change color","people-menu.follow":"Following","people-menu.following":"Following","people-menu.leading":"Following You","people-menu.user":"(You)","people-menu.invite":"Invite others","help-menu.title":"Help and resources","help-menu.about":"About","help-menu.discord":"Discord","help-menu.github":"GitHub","help-menu.keyboard-shortcuts":"Keyboard shortcuts","help-menu.twitter":"Twitter","actions-menu.title":"Actions","edit-link-dialog.title":"Edit link","edit-link-dialog.invalid-url":"A link must be a valid URL.","edit-link-dialog.detail":"Links will open in a new tab.","edit-link-dialog.url":"URL","edit-link-dialog.clear":"Clear","edit-link-dialog.save":"Continue","edit-link-dialog.cancel":"Cancel","embed-dialog.title":"Insert embed","embed-dialog.back":"Back","embed-dialog.create":"Create","embed-dialog.cancel":"Cancel","embed-dialog.url":"URL","embed-dialog.instruction":"Paste in the site's URL to create the embed.","embed-dialog.invalid-url":"We could not create an embed from that URL.","edit-pages-dialog.move-down":"Move down","edit-pages-dialog.move-up":"Move up","shortcuts-dialog.title":"Keyboard shortcuts","shortcuts-dialog.edit":"Edit","shortcuts-dialog.file":"File","shortcuts-dialog.preferences":"Preferences","shortcuts-dialog.tools":"Tools","shortcuts-dialog.transform":"Transform","shortcuts-dialog.view":"View","shortcuts-dialog.collaboration":"Collaboration","home-project-dialog.title":"Home project","home-project-dialog.description":"This is your local home project. It's just for you!","rename-project-dialog.title":"Rename project","rename-project-dialog.cancel":"Cancel","rename-project-dialog.rename":"Rename","home-project-dialog.ok":"Ok","style-panel.title":"Styles","style-panel.align":"Align","style-panel.vertical-align":"Vertical align","style-panel.position":"Position","style-panel.arrowheads":"Arrowheads","style-panel.arrowhead-start":"Start","style-panel.arrowhead-end":"End","style-panel.color":"Color","style-panel.dash":"Dash","style-panel.fill":"Fill","style-panel.font":"Font","style-panel.geo":"Shape","style-panel.mixed":"Mixed","style-panel.opacity":"Opacity","style-panel.size":"Size","style-panel.spline":"Spline","tool-panel.drawing":"Drawing","tool-panel.shapes":"Shapes","tool-panel.more":"More","debug-panel.more":"More","navigation-zone.toggle-minimap":"Toggle minimap","navigation-zone.zoom":"Zoom","focus-mode.toggle-focus-mode":"Toggle focus mode","toast.close":"Close","file-system.file-open-error.title":"Could not open file","file-system.file-open-error.not-a-tldraw-file":"The file you tried to open doesn't look like a tldraw file.","file-system.file-open-error.file-format-version-too-new":"The file you tried to open is from a newer version of tldraw. Please reload the page and try again.","file-system.file-open-error.generic-corrupted-file":"The file you tried to open is corrupted.","file-system.confirm-open.title":"Overwrite current project?","file-system.confirm-open.description":"Opening a file will replace your current project and any unsaved changes will be lost. Are you sure you want to continue?","file-system.confirm-open.cancel":"Cancel","file-system.confirm-open.open":"Open file","file-system.confirm-open.dont-show-again":"Don't ask again","file-system.confirm-clear.title":"Clear current project?","file-system.confirm-clear.description":"Creating a new project will clear your current project and any unsaved changes will be lost. Are you sure you want to continue?","file-system.confirm-clear.cancel":"Cancel","file-system.confirm-clear.continue":"Continue","file-system.confirm-clear.dont-show-again":"Don't ask again","file-system.shared-document-file-open-error.title":"Could not open file","file-system.shared-document-file-open-error.description":"Opening files from shared projects is not supported.","sharing.confirm-leave.title":"Leave current project?","sharing.confirm-leave.description":"Are you sure you want to leave this shared project? You can return to it by navigating to its URL.","sharing.confirm-leave.cancel":"Cancel","sharing.confirm-leave.leave":"Leave","sharing.confirm-leave.dont-show-again":"Don't ask again","toast.error.export-fail.title":"Failed export","toast.error.export-fail.desc":"Failed to export image","toast.error.copy-fail.title":"Failed copy","toast.error.copy-fail.desc":"Failed to copy image","context.pages.new-page":"New page","vscode.file-open.desc":"We've updated this document to work with the current version of tldraw. If you'd like to keep the original version (which will work on old.tldraw.com), click below to create a backup.","vscode.file-open.open":"Continue","vscode.file-open.backup":"Backup","vscode.file-open.backup-saved":"Backup saved","vscode.file-open.backup-failed":"Backup failed: this is not a .tldr file.","vscode.file-open.dont-show-again":"Don't ask again","cursor-chat.type-to-chat":"Type to chat..."},Za={locale:"en",label:"English",messages:aS};async function Dq(t,e){if(!(await fetch(e.translations.en)).ok)return console.warn("No main translations found."),Za;if(t==="en")return Za;const r=qu.find(a=>a.locale===t);if(!r)return console.warn(`No translation found for locale ${t}`),Za;const o=await(await fetch(e.translations[r.locale])).json();if(!o)return console.warn(`No messages found for locale ${t}`),Za;const i=[];for(const a in Za)o[a]||i.push(a);return i.length>0,{locale:t,label:r.label,messages:{...Za.messages,...o}}}const KA=S.createContext({}),Rq=()=>S.useContext(KA),Lq=Ee(function({overrides:e,children:n}){const s=H().user.locale,o=jx(),[i,a]=S.useState(()=>e&&e.en?{locale:"en",label:"English",messages:{...aS,...e.en}}:{locale:"en",label:"English",messages:aS});return S.useEffect(()=>{let c=!1;async function l(){const u=await Dq(s,o);u&&!c&&(e&&e[s]?a({...u,messages:{...u.messages,...e[s]}}):a(u))}return l(),()=>{c=!0}},[o,s,e]),g.jsx(KA.Provider,{value:i,children:n})});function be(){const t=Rq();return S.useCallback(function(n){return t.messages[n]??n},[t])}function jq(t){return g.jsx("svg",{width:16,height:16,viewBox:"0 0 16 16",...t,children:g.jsxs("g",{strokeWidth:2,fill:"none",fillRule:"evenodd",children:[g.jsx("circle",{strokeOpacity:.25,cx:8,cy:8,r:7,stroke:"currentColor"}),g.jsx("path",{strokeLinecap:"round",d:"M15 8c0-4.5-4.5-7-7-7",stroke:"currentColor",children:g.jsx("animateTransform",{attributeName:"transform",type:"rotate",from:"0 8 8",to:"360 8 8",dur:"1s",repeatCount:"indefinite"})})]})})}const In=S.memo(function({small:e,invertIcon:n,icon:r,color:s,className:o,...i}){const c=jx().icons[r],l=S.useRef(null);return S.useLayoutEffect(()=>{l!=null&&l.current&&(l.current.style.webkitMask=`url(${c}) center 100% / 100% no-repeat`)},[l,c]),g.jsx("div",{...i,ref:l,className:le("tlui-icon",{"tlui-icon__small":e},o),style:{color:s,mask:`url(${c}) center 100% / 100% no-repeat`,transform:n?"scale(-1, 1)":void 0}})}),VA=typeof window>"u"?!1:window.navigator.userAgent.toLowerCase().indexOf("mac")>-1,WA=VA?"":"Ctrl",GA=VA?"":"Alt";function Nq(t){return t.split(",")[0].split("").map(e=>{const n=e.replace(/\$/g,WA).replace(/\?/g,GA).replace(/!/g,"");return n[0].toUpperCase()+n.slice(1)})}function ps(t){return" "+t.split(",")[0].split("").map(e=>{const n=e.replace(/\$/g,WA).replace(/\?/g,GA).replace(/!/g,"");return n[0].toUpperCase()+n.slice(1)}).join("")}function Em({children:t}){return g.jsx("kbd",{className:"tlui-kbd",children:Nq(t).map((e,n)=>g.jsx("span",{children:e},n))})}const se=S.forwardRef(function({label:e,icon:n,invertIcon:r,iconLeft:s,smallIcon:o,kbd:i,isChecked:a=!1,type:c="normal",children:l,spinner:u,...d},h){const f=be(),p=e?f(e):"";return g.jsxs("button",{ref:h,draggable:!1,type:"button",...d,title:d.title??p,className:le("tlui-button",`tlui-button__${c}`,d.className),children:[s&&g.jsx(In,{icon:s,className:"tlui-icon-left",small:!0}),l,e&&g.jsxs("span",{draggable:!1,children:[p,a&&g.jsx(In,{icon:"check"})]}),i&&g.jsx(Em,{children:i}),n&&!u&&g.jsx(In,{icon:n,small:!!e||o,invertIcon:r}),u&&g.jsx(jq,{})]})});function Pm({className:t,children:e}){return g.jsx("div",{className:le("tlui-dialog__header",t),children:e})}function km({className:t,children:e}){return g.jsx(g7,{dir:"ltr",className:le("tlui-dialog__header__title",t),children:e})}function Im(){return g.jsx("div",{className:"tlui-dialog__header__close",children:g.jsx(y7,{"data-testid":"dialog.close",dir:"ltr",asChild:!0,children:g.jsx(se,{"aria-label":"Close",onTouchEnd:t=>t.target.click(),children:g.jsx(In,{small:!0,icon:"cross-2"})})})})}function rd({className:t,children:e,style:n}){return g.jsx("div",{className:le("tlui-dialog__body",t),style:n,children:e})}function Nx({className:t,children:e}){return g.jsx("div",{className:le("tlui-dialog__footer",t),children:e})}function $m(t){const e=t+"CollectionProvider",[n,r]=oo(e),[s,o]=n(e,{collectionRef:{current:null},itemMap:new Map}),i=f=>{const{scope:p,children:m}=f,v=Z.useRef(null),w=Z.useRef(new Map).current;return Z.createElement(s,{scope:p,itemMap:w,collectionRef:v},m)},a=t+"CollectionSlot",c=Z.forwardRef((f,p)=>{const{scope:m,children:v}=f,w=o(a,m),x=et(p,w.collectionRef);return Z.createElement(Hc,{ref:x},v)}),l=t+"CollectionItemSlot",u="data-radix-collection-item",d=Z.forwardRef((f,p)=>{const{scope:m,children:v,...w}=f,x=Z.useRef(null),b=et(p,x),C=o(l,m);return Z.useEffect(()=>(C.itemMap.set(x,{ref:x,...w}),()=>void C.itemMap.delete(x))),Z.createElement(Hc,{[u]:"",ref:b},v)});function h(f){const p=o(t+"CollectionConsumer",f);return Z.useCallback(()=>{const v=p.collectionRef.current;if(!v)return[];const w=Array.from(v.querySelectorAll(`[${u}]`));return Array.from(p.itemMap.values()).sort((C,E)=>w.indexOf(C.ref.current)-w.indexOf(E.ref.current))},[p.collectionRef,p.itemMap])}return[{Provider:i,Slot:c,ItemSlot:d},h,r]}const zq=S.createContext(void 0);function zx(t){const e=S.useContext(zq);return t||e||"ltr"}const Fq=["top","right","bottom","left"],ii=Math.min,Fn=Math.max,yg=Math.round,Qh=Math.floor,ai=t=>({x:t,y:t}),Bq={left:"right",right:"left",bottom:"top",top:"bottom"},Uq={start:"end",end:"start"};function cS(t,e,n){return Fn(t,ii(e,n))}function Js(t,e){return typeof t=="function"?t(e):t}function eo(t){return t.split("-")[0]}function gl(t){return t.split("-")[1]}function Fx(t){return t==="x"?"y":"x"}function Bx(t){return t==="y"?"height":"width"}function ml(t){return["top","bottom"].includes(eo(t))?"y":"x"}function Ux(t){return Fx(ml(t))}function Hq(t,e,n){n===void 0&&(n=!1);const r=gl(t),s=Ux(t),o=Bx(s);let i=s==="x"?r===(n?"end":"start")?"right":"left":r==="start"?"bottom":"top";return e.reference[o]>e.floating[o]&&(i=vg(i)),[i,vg(i)]}function Kq(t){const e=vg(t);return[lS(t),e,lS(e)]}function lS(t){return t.replace(/start|end/g,e=>Uq[e])}function Vq(t,e,n){const r=["left","right"],s=["right","left"],o=["top","bottom"],i=["bottom","top"];switch(t){case"top":case"bottom":return n?e?s:r:e?r:s;case"left":case"right":return e?o:i;default:return[]}}function Wq(t,e,n,r){const s=gl(t);let o=Vq(eo(t),n==="start",r);return s&&(o=o.map(i=>i+"-"+s),e&&(o=o.concat(o.map(lS)))),o}function vg(t){return t.replace(/left|right|bottom|top/g,e=>Bq[e])}function Gq(t){return{top:0,right:0,bottom:0,left:0,...t}}function YA(t){return typeof t!="number"?Gq(t):{top:t,right:t,bottom:t,left:t}}function wg(t){return{...t,top:t.y,left:t.x,right:t.x+t.width,bottom:t.y+t.height}}function qE(t,e,n){let{reference:r,floating:s}=t;const o=ml(e),i=Ux(e),a=Bx(i),c=eo(e),l=o==="y",u=r.x+r.width/2-s.width/2,d=r.y+r.height/2-s.height/2,h=r[a]/2-s[a]/2;let f;switch(c){case"top":f={x:u,y:r.y-s.height};break;case"bottom":f={x:u,y:r.y+r.height};break;case"right":f={x:r.x+r.width,y:d};break;case"left":f={x:r.x-s.width,y:d};break;default:f={x:r.x,y:r.y}}switch(gl(e)){case"start":f[i]-=h*(n&&l?-1:1);break;case"end":f[i]+=h*(n&&l?-1:1);break}return f}const Yq=async(t,e,n)=>{const{placement:r="bottom",strategy:s="absolute",middleware:o=[],platform:i}=n,a=o.filter(Boolean),c=await(i.isRTL==null?void 0:i.isRTL(e));let l=await i.getElementRects({reference:t,floating:e,strategy:s}),{x:u,y:d}=qE(l,r,c),h=r,f={},p=0;for(let m=0;m<a.length;m++){const{name:v,fn:w}=a[m],{x,y:b,data:C,reset:E}=await w({x:u,y:d,initialPlacement:r,placement:h,strategy:s,middlewareData:f,rects:l,platform:i,elements:{reference:t,floating:e}});if(u=x??u,d=b??d,f={...f,[v]:{...f[v],...C}},E&&p<=50){p++,typeof E=="object"&&(E.placement&&(h=E.placement),E.rects&&(l=E.rects===!0?await i.getElementRects({reference:t,floating:e,strategy:s}):E.rects),{x:u,y:d}=qE(l,h,c)),m=-1;continue}}return{x:u,y:d,placement:h,strategy:s,middlewareData:f}};async function sd(t,e){var n;e===void 0&&(e={});const{x:r,y:s,platform:o,rects:i,elements:a,strategy:c}=t,{boundary:l="clippingAncestors",rootBoundary:u="viewport",elementContext:d="floating",altBoundary:h=!1,padding:f=0}=Js(e,t),p=YA(f),v=a[h?d==="floating"?"reference":"floating":d],w=wg(await o.getClippingRect({element:(n=await(o.isElement==null?void 0:o.isElement(v)))==null||n?v:v.contextElement||await(o.getDocumentElement==null?void 0:o.getDocumentElement(a.floating)),boundary:l,rootBoundary:u,strategy:c})),x=d==="floating"?{...i.floating,x:r,y:s}:i.reference,b=await(o.getOffsetParent==null?void 0:o.getOffsetParent(a.floating)),C=await(o.isElement==null?void 0:o.isElement(b))?await(o.getScale==null?void 0:o.getScale(b))||{x:1,y:1}:{x:1,y:1},E=wg(o.convertOffsetParentRelativeRectToViewportRelativeRect?await o.convertOffsetParentRelativeRectToViewportRelativeRect({rect:x,offsetParent:b,strategy:c}):x);return{top:(w.top-E.top+p.top)/C.y,bottom:(E.bottom-w.bottom+p.bottom)/C.y,left:(w.left-E.left+p.left)/C.x,right:(E.right-w.right+p.right)/C.x}}const QE=t=>({name:"arrow",options:t,async fn(e){const{x:n,y:r,placement:s,rects:o,platform:i,elements:a}=e,{element:c,padding:l=0}=Js(t,e)||{};if(c==null)return{};const u=YA(l),d={x:n,y:r},h=Ux(s),f=Bx(h),p=await i.getDimensions(c),m=h==="y",v=m?"top":"left",w=m?"bottom":"right",x=m?"clientHeight":"clientWidth",b=o.reference[f]+o.reference[h]-d[h]-o.floating[f],C=d[h]-o.reference[h],E=await(i.getOffsetParent==null?void 0:i.getOffsetParent(c));let _=E?E[x]:0;(!_||!await(i.isElement==null?void 0:i.isElement(E)))&&(_=a.floating[x]||o.floating[f]);const k=b/2-C/2,I=_/2-p[f]/2-1,$=ii(u[v],I),A=ii(u[w],I),D=$,L=_-p[f]-A,j=_/2-p[f]/2+k,M=cS(D,j,L),U=gl(s)!=null&&j!=M&&o.reference[f]/2-(j<D?$:A)-p[f]/2<0?j<D?D-j:L-j:0;return{[h]:d[h]-U,data:{[h]:M,centerOffset:j-M+U}}}}),Xq=function(t){return t===void 0&&(t={}),{name:"flip",options:t,async fn(e){var n;const{placement:r,middlewareData:s,rects:o,initialPlacement:i,platform:a,elements:c}=e,{mainAxis:l=!0,crossAxis:u=!0,fallbackPlacements:d,fallbackStrategy:h="bestFit",fallbackAxisSideDirection:f="none",flipAlignment:p=!0,...m}=Js(t,e),v=eo(r),w=eo(i)===i,x=await(a.isRTL==null?void 0:a.isRTL(c.floating)),b=d||(w||!p?[vg(i)]:Kq(i));!d&&f!=="none"&&b.push(...Wq(i,p,f,x));const C=[i,...b],E=await sd(e,m),_=[];let k=((n=s.flip)==null?void 0:n.overflows)||[];if(l&&_.push(E[v]),u){const D=Hq(r,o,x);_.push(E[D[0]],E[D[1]])}if(k=[...k,{placement:r,overflows:_}],!_.every(D=>D<=0)){var I,$;const D=(((I=s.flip)==null?void 0:I.index)||0)+1,L=C[D];if(L)return{data:{index:D,overflows:k},reset:{placement:L}};let j=($=k.filter(M=>M.overflows[0]<=0).sort((M,B)=>M.overflows[1]-B.overflows[1])[0])==null?void 0:$.placement;if(!j)switch(h){case"bestFit":{var A;const M=(A=k.map(B=>[B.placement,B.overflows.filter(U=>U>0).reduce((U,q)=>U+q,0)]).sort((B,U)=>B[1]-U[1])[0])==null?void 0:A[0];M&&(j=M);break}case"initialPlacement":j=i;break}if(r!==j)return{reset:{placement:j}}}return{}}}};function ZE(t,e){return{top:t.top-e.height,right:t.right-e.width,bottom:t.bottom-e.height,left:t.left-e.width}}function JE(t){return Fq.some(e=>t[e]>=0)}const qq=function(t){return t===void 0&&(t={}),{name:"hide",options:t,async fn(e){const{rects:n}=e,{strategy:r="referenceHidden",...s}=Js(t,e);switch(r){case"referenceHidden":{const o=await sd(e,{...s,elementContext:"reference"}),i=ZE(o,n.reference);return{data:{referenceHiddenOffsets:i,referenceHidden:JE(i)}}}case"escaped":{const o=await sd(e,{...s,altBoundary:!0}),i=ZE(o,n.floating);return{data:{escapedOffsets:i,escaped:JE(i)}}}default:return{}}}}};async function Qq(t,e){const{placement:n,platform:r,elements:s}=t,o=await(r.isRTL==null?void 0:r.isRTL(s.floating)),i=eo(n),a=gl(n),c=ml(n)==="y",l=["left","top"].includes(i)?-1:1,u=o&&c?-1:1,d=Js(e,t);let{mainAxis:h,crossAxis:f,alignmentAxis:p}=typeof d=="number"?{mainAxis:d,crossAxis:0,alignmentAxis:null}:{mainAxis:0,crossAxis:0,alignmentAxis:null,...d};return a&&typeof p=="number"&&(f=a==="end"?p*-1:p),c?{x:f*u,y:h*l}:{x:h*l,y:f*u}}const Zq=function(t){return t===void 0&&(t=0),{name:"offset",options:t,async fn(e){const{x:n,y:r}=e,s=await Qq(e,t);return{x:n+s.x,y:r+s.y,data:s}}}},Jq=function(t){return t===void 0&&(t={}),{name:"shift",options:t,async fn(e){const{x:n,y:r,placement:s}=e,{mainAxis:o=!0,crossAxis:i=!1,limiter:a={fn:v=>{let{x:w,y:x}=v;return{x:w,y:x}}},...c}=Js(t,e),l={x:n,y:r},u=await sd(e,c),d=ml(eo(s)),h=Fx(d);let f=l[h],p=l[d];if(o){const v=h==="y"?"top":"left",w=h==="y"?"bottom":"right",x=f+u[v],b=f-u[w];f=cS(x,f,b)}if(i){const v=d==="y"?"top":"left",w=d==="y"?"bottom":"right",x=p+u[v],b=p-u[w];p=cS(x,p,b)}const m=a.fn({...e,[h]:f,[d]:p});return{...m,data:{x:m.x-n,y:m.y-r}}}}},eQ=function(t){return t===void 0&&(t={}),{options:t,fn(e){const{x:n,y:r,placement:s,rects:o,middlewareData:i}=e,{offset:a=0,mainAxis:c=!0,crossAxis:l=!0}=Js(t,e),u={x:n,y:r},d=ml(s),h=Fx(d);let f=u[h],p=u[d];const m=Js(a,e),v=typeof m=="number"?{mainAxis:m,crossAxis:0}:{mainAxis:0,crossAxis:0,...m};if(c){const b=h==="y"?"height":"width",C=o.reference[h]-o.floating[b]+v.mainAxis,E=o.reference[h]+o.reference[b]-v.mainAxis;f<C?f=C:f>E&&(f=E)}if(l){var w,x;const b=h==="y"?"width":"height",C=["top","left"].includes(eo(s)),E=o.reference[d]-o.floating[b]+(C&&((w=i.offset)==null?void 0:w[d])||0)+(C?0:v.crossAxis),_=o.reference[d]+o.reference[b]+(C?0:((x=i.offset)==null?void 0:x[d])||0)-(C?v.crossAxis:0);p<E?p=E:p>_&&(p=_)}return{[h]:f,[d]:p}}}},tQ=function(t){return t===void 0&&(t={}),{name:"size",options:t,async fn(e){const{placement:n,rects:r,platform:s,elements:o}=e,{apply:i=()=>{},...a}=Js(t,e),c=await sd(e,a),l=eo(n),u=gl(n),d=ml(n)==="y",{width:h,height:f}=r.floating;let p,m;l==="top"||l==="bottom"?(p=l,m=u===(await(s.isRTL==null?void 0:s.isRTL(o.floating))?"start":"end")?"left":"right"):(m=l,p=u==="end"?"top":"bottom");const v=f-c[p],w=h-c[m],x=!e.middlewareData.shift;let b=v,C=w;if(d){const _=h-c.left-c.right;C=u||x?ii(w,_):_}else{const _=f-c.top-c.bottom;b=u||x?ii(v,_):_}if(x&&!u){const _=Fn(c.left,0),k=Fn(c.right,0),I=Fn(c.top,0),$=Fn(c.bottom,0);d?C=h-2*(_!==0||k!==0?_+k:Fn(c.left,c.right)):b=f-2*(I!==0||$!==0?I+$:Fn(c.top,c.bottom))}await i({...e,availableWidth:C,availableHeight:b});const E=await s.getDimensions(o.floating);return h!==E.width||f!==E.height?{reset:{rects:!0}}:{}}}};function ci(t){return XA(t)?(t.nodeName||"").toLowerCase():"#document"}function Xn(t){var e;return(t==null||(e=t.ownerDocument)==null?void 0:e.defaultView)||window}function fo(t){var e;return(e=(XA(t)?t.ownerDocument:t.document)||window.document)==null?void 0:e.documentElement}function XA(t){return t instanceof Node||t instanceof Xn(t).Node}function to(t){return t instanceof Element||t instanceof Xn(t).Element}function gs(t){return t instanceof HTMLElement||t instanceof Xn(t).HTMLElement}function eP(t){return typeof ShadowRoot>"u"?!1:t instanceof ShadowRoot||t instanceof Xn(t).ShadowRoot}function Hd(t){const{overflow:e,overflowX:n,overflowY:r,display:s}=br(t);return/auto|scroll|overlay|hidden|clip/.test(e+r+n)&&!["inline","contents"].includes(s)}function nQ(t){return["table","td","th"].includes(ci(t))}function Hx(t){const e=Kx(),n=br(t);return n.transform!=="none"||n.perspective!=="none"||(n.containerType?n.containerType!=="normal":!1)||!e&&(n.backdropFilter?n.backdropFilter!=="none":!1)||!e&&(n.filter?n.filter!=="none":!1)||["transform","perspective","filter"].some(r=>(n.willChange||"").includes(r))||["paint","layout","strict","content"].some(r=>(n.contain||"").includes(r))}function rQ(t){let e=qc(t);for(;gs(e)&&!Tm(e);){if(Hx(e))return e;e=qc(e)}return null}function Kx(){return typeof CSS>"u"||!CSS.supports?!1:CSS.supports("-webkit-backdrop-filter","none")}function Tm(t){return["html","body","#document"].includes(ci(t))}function br(t){return Xn(t).getComputedStyle(t)}function Am(t){return to(t)?{scrollLeft:t.scrollLeft,scrollTop:t.scrollTop}:{scrollLeft:t.pageXOffset,scrollTop:t.pageYOffset}}function qc(t){if(ci(t)==="html")return t;const e=t.assignedSlot||t.parentNode||eP(t)&&t.host||fo(t);return eP(e)?e.host:e}function qA(t){const e=qc(t);return Tm(e)?t.ownerDocument?t.ownerDocument.body:t.body:gs(e)&&Hd(e)?e:qA(e)}function Sg(t,e){var n;e===void 0&&(e=[]);const r=qA(t),s=r===((n=t.ownerDocument)==null?void 0:n.body),o=Xn(r);return s?e.concat(o,o.visualViewport||[],Hd(r)?r:[]):e.concat(r,Sg(r))}function QA(t){const e=br(t);let n=parseFloat(e.width)||0,r=parseFloat(e.height)||0;const s=gs(t),o=s?t.offsetWidth:n,i=s?t.offsetHeight:r,a=yg(n)!==o||yg(r)!==i;return a&&(n=o,r=i),{width:n,height:r,$:a}}function Vx(t){return to(t)?t:t.contextElement}function Mc(t){const e=Vx(t);if(!gs(e))return ai(1);const n=e.getBoundingClientRect(),{width:r,height:s,$:o}=QA(e);let i=(o?yg(n.width):n.width)/r,a=(o?yg(n.height):n.height)/s;return(!i||!Number.isFinite(i))&&(i=1),(!a||!Number.isFinite(a))&&(a=1),{x:i,y:a}}const sQ=ai(0);function ZA(t){const e=Xn(t);return!Kx()||!e.visualViewport?sQ:{x:e.visualViewport.offsetLeft,y:e.visualViewport.offsetTop}}function oQ(t,e,n){return e===void 0&&(e=!1),!n||e&&n!==Xn(t)?!1:e}function fa(t,e,n,r){e===void 0&&(e=!1),n===void 0&&(n=!1);const s=t.getBoundingClientRect(),o=Vx(t);let i=ai(1);e&&(r?to(r)&&(i=Mc(r)):i=Mc(t));const a=oQ(o,n,r)?ZA(o):ai(0);let c=(s.left+a.x)/i.x,l=(s.top+a.y)/i.y,u=s.width/i.x,d=s.height/i.y;if(o){const h=Xn(o),f=r&&to(r)?Xn(r):r;let p=h.frameElement;for(;p&&r&&f!==h;){const m=Mc(p),v=p.getBoundingClientRect(),w=br(p),x=v.left+(p.clientLeft+parseFloat(w.paddingLeft))*m.x,b=v.top+(p.clientTop+parseFloat(w.paddingTop))*m.y;c*=m.x,l*=m.y,u*=m.x,d*=m.y,c+=x,l+=b,p=Xn(p).frameElement}}return wg({width:u,height:d,x:c,y:l})}function iQ(t){let{rect:e,offsetParent:n,strategy:r}=t;const s=gs(n),o=fo(n);if(n===o)return e;let i={scrollLeft:0,scrollTop:0},a=ai(1);const c=ai(0);if((s||!s&&r!=="fixed")&&((ci(n)!=="body"||Hd(o))&&(i=Am(n)),gs(n))){const l=fa(n);a=Mc(n),c.x=l.x+n.clientLeft,c.y=l.y+n.clientTop}return{width:e.width*a.x,height:e.height*a.y,x:e.x*a.x-i.scrollLeft*a.x+c.x,y:e.y*a.y-i.scrollTop*a.y+c.y}}function aQ(t){return Array.from(t.getClientRects())}function JA(t){return fa(fo(t)).left+Am(t).scrollLeft}function cQ(t){const e=fo(t),n=Am(t),r=t.ownerDocument.body,s=Fn(e.scrollWidth,e.clientWidth,r.scrollWidth,r.clientWidth),o=Fn(e.scrollHeight,e.clientHeight,r.scrollHeight,r.clientHeight);let i=-n.scrollLeft+JA(t);const a=-n.scrollTop;return br(r).direction==="rtl"&&(i+=Fn(e.clientWidth,r.clientWidth)-s),{width:s,height:o,x:i,y:a}}function lQ(t,e){const n=Xn(t),r=fo(t),s=n.visualViewport;let o=r.clientWidth,i=r.clientHeight,a=0,c=0;if(s){o=s.width,i=s.height;const l=Kx();(!l||l&&e==="fixed")&&(a=s.offsetLeft,c=s.offsetTop)}return{width:o,height:i,x:a,y:c}}function uQ(t,e){const n=fa(t,!0,e==="fixed"),r=n.top+t.clientTop,s=n.left+t.clientLeft,o=gs(t)?Mc(t):ai(1),i=t.clientWidth*o.x,a=t.clientHeight*o.y,c=s*o.x,l=r*o.y;return{width:i,height:a,x:c,y:l}}function tP(t,e,n){let r;if(e==="viewport")r=lQ(t,n);else if(e==="document")r=cQ(fo(t));else if(to(e))r=uQ(e,n);else{const s=ZA(t);r={...e,x:e.x-s.x,y:e.y-s.y}}return wg(r)}function eM(t,e){const n=qc(t);return n===e||!to(n)||Tm(n)?!1:br(n).position==="fixed"||eM(n,e)}function dQ(t,e){const n=e.get(t);if(n)return n;let r=Sg(t).filter(a=>to(a)&&ci(a)!=="body"),s=null;const o=br(t).position==="fixed";let i=o?qc(t):t;for(;to(i)&&!Tm(i);){const a=br(i),c=Hx(i);!c&&a.position==="fixed"&&(s=null),(o?!c&&!s:!c&&a.position==="static"&&!!s&&["absolute","fixed"].includes(s.position)||Hd(i)&&!c&&eM(t,i))?r=r.filter(u=>u!==i):s=a,i=qc(i)}return e.set(t,r),r}function hQ(t){let{element:e,boundary:n,rootBoundary:r,strategy:s}=t;const i=[...n==="clippingAncestors"?dQ(e,this._c):[].concat(n),r],a=i[0],c=i.reduce((l,u)=>{const d=tP(e,u,s);return l.top=Fn(d.top,l.top),l.right=ii(d.right,l.right),l.bottom=ii(d.bottom,l.bottom),l.left=Fn(d.left,l.left),l},tP(e,a,s));return{width:c.right-c.left,height:c.bottom-c.top,x:c.left,y:c.top}}function fQ(t){return QA(t)}function pQ(t,e,n){const r=gs(e),s=fo(e),o=n==="fixed",i=fa(t,!0,o,e);let a={scrollLeft:0,scrollTop:0};const c=ai(0);if(r||!r&&!o)if((ci(e)!=="body"||Hd(s))&&(a=Am(e)),r){const l=fa(e,!0,o,e);c.x=l.x+e.clientLeft,c.y=l.y+e.clientTop}else s&&(c.x=JA(s));return{x:i.left+a.scrollLeft-c.x,y:i.top+a.scrollTop-c.y,width:i.width,height:i.height}}function nP(t,e){return!gs(t)||br(t).position==="fixed"?null:e?e(t):t.offsetParent}function tM(t,e){const n=Xn(t);if(!gs(t))return n;let r=nP(t,e);for(;r&&nQ(r)&&br(r).position==="static";)r=nP(r,e);return r&&(ci(r)==="html"||ci(r)==="body"&&br(r).position==="static"&&!Hx(r))?n:r||rQ(t)||n}const gQ=async function(t){let{reference:e,floating:n,strategy:r}=t;const s=this.getOffsetParent||tM,o=this.getDimensions;return{reference:pQ(e,await s(n),r),floating:{x:0,y:0,...await o(n)}}};function mQ(t){return br(t).direction==="rtl"}const yQ={convertOffsetParentRelativeRectToViewportRelativeRect:iQ,getDocumentElement:fo,getClippingRect:hQ,getOffsetParent:tM,getElementRects:gQ,getClientRects:aQ,getDimensions:fQ,getScale:Mc,isElement:to,isRTL:mQ};function vQ(t,e){let n=null,r;const s=fo(t);function o(){clearTimeout(r),n&&n.disconnect(),n=null}function i(a,c){a===void 0&&(a=!1),c===void 0&&(c=1),o();const{left:l,top:u,width:d,height:h}=t.getBoundingClientRect();if(a||e(),!d||!h)return;const f=Qh(u),p=Qh(s.clientWidth-(l+d)),m=Qh(s.clientHeight-(u+h)),v=Qh(l),x={rootMargin:-f+"px "+-p+"px "+-m+"px "+-v+"px",threshold:Fn(0,ii(1,c))||1};let b=!0;function C(E){const _=E[0].intersectionRatio;if(_!==c){if(!b)return i();_?i(!1,_):r=setTimeout(()=>{i(!1,1e-7)},100)}b=!1}try{n=new IntersectionObserver(C,{...x,root:s.ownerDocument})}catch{n=new IntersectionObserver(C,x)}n.observe(t)}return i(!0),o}function wQ(t,e,n,r){r===void 0&&(r={});const{ancestorScroll:s=!0,ancestorResize:o=!0,elementResize:i=typeof ResizeObserver=="function",layoutShift:a=typeof IntersectionObserver=="function",animationFrame:c=!1}=r,l=Vx(t),u=s||o?[...l?Sg(l):[],...Sg(e)]:[];u.forEach(w=>{s&&w.addEventListener("scroll",n,{passive:!0}),o&&w.addEventListener("resize",n)});const d=l&&a?vQ(l,n):null;let h=-1,f=null;i&&(f=new ResizeObserver(w=>{let[x]=w;x&&x.target===l&&f&&(f.unobserve(e),cancelAnimationFrame(h),h=requestAnimationFrame(()=>{f&&f.observe(e)})),n()}),l&&!c&&f.observe(l),f.observe(e));let p,m=c?fa(t):null;c&&v();function v(){const w=fa(t);m&&(w.x!==m.x||w.y!==m.y||w.width!==m.width||w.height!==m.height)&&n(),m=w,p=requestAnimationFrame(v)}return n(),()=>{u.forEach(w=>{s&&w.removeEventListener("scroll",n),o&&w.removeEventListener("resize",n)}),d&&d(),f&&f.disconnect(),f=null,c&&cancelAnimationFrame(p)}}const SQ=(t,e,n)=>{const r=new Map,s={platform:yQ,...n},o={...s.platform,_c:r};return Yq(t,e,{...s,platform:o})},xQ=t=>{function e(n){return{}.hasOwnProperty.call(n,"current")}return{name:"arrow",options:t,fn(n){const{element:r,padding:s}=typeof t=="function"?t(n):t;return r&&e(r)?r.current!=null?QE({element:r.current,padding:s}).fn(n):{}:r?QE({element:r,padding:s}).fn(n):{}}}};var Uf=typeof document<"u"?S.useLayoutEffect:S.useEffect;function xg(t,e){if(t===e)return!0;if(typeof t!=typeof e)return!1;if(typeof t=="function"&&t.toString()===e.toString())return!0;let n,r,s;if(t&&e&&typeof t=="object"){if(Array.isArray(t)){if(n=t.length,n!=e.length)return!1;for(r=n;r--!==0;)if(!xg(t[r],e[r]))return!1;return!0}if(s=Object.keys(t),n=s.length,n!==Object.keys(e).length)return!1;for(r=n;r--!==0;)if(!{}.hasOwnProperty.call(e,s[r]))return!1;for(r=n;r--!==0;){const o=s[r];if(!(o==="_owner"&&t.$$typeof)&&!xg(t[o],e[o]))return!1}return!0}return t!==t&&e!==e}function nM(t){return typeof window>"u"?1:(t.ownerDocument.defaultView||window).devicePixelRatio||1}function rP(t,e){const n=nM(t);return Math.round(e*n)/n}function sP(t){const e=S.useRef(t);return Uf(()=>{e.current=t}),e}function bQ(t){t===void 0&&(t={});const{placement:e="bottom",strategy:n="absolute",middleware:r=[],platform:s,elements:{reference:o,floating:i}={},transform:a=!0,whileElementsMounted:c,open:l}=t,[u,d]=S.useState({x:0,y:0,strategy:n,placement:e,middlewareData:{},isPositioned:!1}),[h,f]=S.useState(r);xg(h,r)||f(r);const[p,m]=S.useState(null),[v,w]=S.useState(null),x=S.useCallback(U=>{U!=_.current&&(_.current=U,m(U))},[m]),b=S.useCallback(U=>{U!==k.current&&(k.current=U,w(U))},[w]),C=o||p,E=i||v,_=S.useRef(null),k=S.useRef(null),I=S.useRef(u),$=sP(c),A=sP(s),D=S.useCallback(()=>{if(!_.current||!k.current)return;const U={placement:e,strategy:n,middleware:h};A.current&&(U.platform=A.current),SQ(_.current,k.current,U).then(q=>{const N={...q,isPositioned:!0};L.current&&!xg(I.current,N)&&(I.current=N,so.flushSync(()=>{d(N)}))})},[h,e,n,A]);Uf(()=>{l===!1&&I.current.isPositioned&&(I.current.isPositioned=!1,d(U=>({...U,isPositioned:!1})))},[l]);const L=S.useRef(!1);Uf(()=>(L.current=!0,()=>{L.current=!1}),[]),Uf(()=>{if(C&&(_.current=C),E&&(k.current=E),C&&E){if($.current)return $.current(C,E,D);D()}},[C,E,D,$]);const j=S.useMemo(()=>({reference:_,floating:k,setReference:x,setFloating:b}),[x,b]),M=S.useMemo(()=>({reference:C,floating:E}),[C,E]),B=S.useMemo(()=>{const U={position:n,left:0,top:0};if(!M.floating)return U;const q=rP(M.floating,u.x),N=rP(M.floating,u.y);return a?{...U,transform:"translate("+q+"px, "+N+"px)",...nM(M.floating)>=1.5&&{willChange:"transform"}}:{position:n,left:q,top:N}},[n,a,M.floating,u.x,u.y]);return S.useMemo(()=>({...u,update:D,refs:j,elements:M,floatingStyles:B}),[u,D,j,M,B])}function rM(t){const[e,n]=S.useState(void 0);return ua(()=>{if(t){n({width:t.offsetWidth,height:t.offsetHeight});const r=new ResizeObserver(s=>{if(!Array.isArray(s)||!s.length)return;const o=s[0];let i,a;if("borderBoxSize"in o){const c=o.borderBoxSize,l=Array.isArray(c)?c[0]:c;i=l.inlineSize,a=l.blockSize}else i=t.offsetWidth,a=t.offsetHeight;n({width:i,height:a})});return r.observe(t,{box:"border-box"}),()=>r.unobserve(t)}else n(void 0)},[t]),e}const sM="Popper",[oM,iM]=oo(sM),[CQ,aM]=oM(sM),_Q=t=>{const{__scopePopper:e,children:n}=t,[r,s]=S.useState(null);return S.createElement(CQ,{scope:e,anchor:r,onAnchorChange:s},n)},EQ="PopperAnchor",PQ=S.forwardRef((t,e)=>{const{__scopePopper:n,virtualRef:r,...s}=t,o=aM(EQ,n),i=S.useRef(null),a=et(e,i);return S.useEffect(()=>{o.onAnchorChange((r==null?void 0:r.current)||i.current)}),r?null:S.createElement(Fe.div,W({},s,{ref:a}))}),cM="PopperContent",[kQ,Ole]=oM(cM),IQ=S.forwardRef((t,e)=>{var n,r,s,o,i,a,c,l;const{__scopePopper:u,side:d="bottom",sideOffset:h=0,align:f="center",alignOffset:p=0,arrowPadding:m=0,collisionBoundary:v=[],collisionPadding:w=0,sticky:x="partial",hideWhenDetached:b=!1,avoidCollisions:C=!0,onPlaced:E,..._}=t,k=aM(cM,u),[I,$]=S.useState(null),A=et(e,Er=>$(Er)),[D,L]=S.useState(null),j=rM(D),M=(n=j==null?void 0:j.width)!==null&&n!==void 0?n:0,B=(r=j==null?void 0:j.height)!==null&&r!==void 0?r:0,U=d+(f!=="center"?"-"+f:""),q=typeof w=="number"?w:{top:0,right:0,bottom:0,left:0,...w},N=Array.isArray(v)?v:[v],F=N.length>0,K={padding:q,boundary:N.filter($Q),altBoundary:F},{refs:Q,floatingStyles:ne,placement:we,isPositioned:ke,middlewareData:de}=bQ({strategy:"fixed",placement:U,whileElementsMounted:wQ,elements:{reference:k.anchor},middleware:[Zq({mainAxis:h+B,alignmentAxis:p}),C&&Jq({mainAxis:!0,crossAxis:!1,limiter:x==="partial"?eQ():void 0,...K}),C&&Xq({...K}),tQ({...K,apply:({elements:Er,rects:wo,availableWidth:Es,availableHeight:tr})=>{const{width:Pr,height:nr}=wo.reference,ln=Er.floating.style;ln.setProperty("--radix-popper-available-width",`${Es}px`),ln.setProperty("--radix-popper-available-height",`${tr}px`),ln.setProperty("--radix-popper-anchor-width",`${Pr}px`),ln.setProperty("--radix-popper-anchor-height",`${nr}px`)}}),D&&xQ({element:D,padding:m}),TQ({arrowWidth:M,arrowHeight:B}),b&&qq({strategy:"referenceHidden"})]}),[Ye,Xe]=lM(we),qe=rn(E);ua(()=>{ke&&(qe==null||qe())},[ke,qe]);const Be=(s=de.arrow)===null||s===void 0?void 0:s.x,cn=(o=de.arrow)===null||o===void 0?void 0:o.y,vo=((i=de.arrow)===null||i===void 0?void 0:i.centerOffset)!==0,[Dn,_s]=S.useState();return ua(()=>{I&&_s(window.getComputedStyle(I).zIndex)},[I]),S.createElement("div",{ref:Q.setFloating,"data-radix-popper-content-wrapper":"",style:{...ne,transform:ke?ne.transform:"translate(0, -200%)",minWidth:"max-content",zIndex:Dn,"--radix-popper-transform-origin":[(a=de.transformOrigin)===null||a===void 0?void 0:a.x,(c=de.transformOrigin)===null||c===void 0?void 0:c.y].join(" ")},dir:t.dir},S.createElement(kQ,{scope:u,placedSide:Ye,onArrowChange:L,arrowX:Be,arrowY:cn,shouldHideArrow:vo},S.createElement(Fe.div,W({"data-side":Ye,"data-align":Xe},_,{ref:A,style:{..._.style,animation:ke?void 0:"none",opacity:(l=de.hide)!==null&&l!==void 0&&l.referenceHidden?0:void 0}}))))});function $Q(t){return t!==null}const TQ=t=>({name:"transformOrigin",options:t,fn(e){var n,r,s,o,i;const{placement:a,rects:c,middlewareData:l}=e,d=((n=l.arrow)===null||n===void 0?void 0:n.centerOffset)!==0,h=d?0:t.arrowWidth,f=d?0:t.arrowHeight,[p,m]=lM(a),v={start:"0%",center:"50%",end:"100%"}[m],w=((r=(s=l.arrow)===null||s===void 0?void 0:s.x)!==null&&r!==void 0?r:0)+h/2,x=((o=(i=l.arrow)===null||i===void 0?void 0:i.y)!==null&&o!==void 0?o:0)+f/2;let b="",C="";return p==="bottom"?(b=d?v:`${w}px`,C=`${-f}px`):p==="top"?(b=d?v:`${w}px`,C=`${c.floating.height+f}px`):p==="right"?(b=`${-f}px`,C=d?v:`${x}px`):p==="left"&&(b=`${c.floating.width+f}px`,C=d?v:`${x}px`),{data:{x:b,y:C}}}});function lM(t){const[e,n="center"]=t.split("-");return[e,n]}const uM=_Q,AQ=PQ,MQ=IQ,I0="rovingFocusGroup.onEntryFocus",OQ={bubbles:!1,cancelable:!0},Wx="RovingFocusGroup",[uS,dM,DQ]=$m(Wx),[RQ,hM]=oo(Wx,[DQ]),[LQ,jQ]=RQ(Wx),NQ=S.forwardRef((t,e)=>S.createElement(uS.Provider,{scope:t.__scopeRovingFocusGroup},S.createElement(uS.Slot,{scope:t.__scopeRovingFocusGroup},S.createElement(zQ,W({},t,{ref:e}))))),zQ=S.forwardRef((t,e)=>{const{__scopeRovingFocusGroup:n,orientation:r,loop:s=!1,dir:o,currentTabStopId:i,defaultCurrentTabStopId:a,onCurrentTabStopIdChange:c,onEntryFocus:l,...u}=t,d=S.useRef(null),h=et(e,d),f=zx(o),[p=null,m]=Ca({prop:i,defaultProp:a,onChange:c}),[v,w]=S.useState(!1),x=rn(l),b=dM(n),C=S.useRef(!1),[E,_]=S.useState(0);return S.useEffect(()=>{const k=d.current;if(k)return k.addEventListener(I0,x),()=>k.removeEventListener(I0,x)},[x]),S.createElement(LQ,{scope:n,orientation:r,dir:f,loop:s,currentTabStopId:p,onItemFocus:S.useCallback(k=>m(k),[m]),onItemShiftTab:S.useCallback(()=>w(!0),[]),onFocusableItemAdd:S.useCallback(()=>_(k=>k+1),[]),onFocusableItemRemove:S.useCallback(()=>_(k=>k-1),[])},S.createElement(Fe.div,W({tabIndex:v||E===0?-1:0,"data-orientation":r},u,{ref:h,style:{outline:"none",...t.style},onMouseDown:oe(t.onMouseDown,()=>{C.current=!0}),onFocus:oe(t.onFocus,k=>{const I=!C.current;if(k.target===k.currentTarget&&I&&!v){const $=new CustomEvent(I0,OQ);if(k.currentTarget.dispatchEvent($),!$.defaultPrevented){const A=b().filter(B=>B.focusable),D=A.find(B=>B.active),L=A.find(B=>B.id===p),M=[D,L,...A].filter(Boolean).map(B=>B.ref.current);fM(M)}}C.current=!1}),onBlur:oe(t.onBlur,()=>w(!1))})))}),FQ="RovingFocusGroupItem",BQ=S.forwardRef((t,e)=>{const{__scopeRovingFocusGroup:n,focusable:r=!0,active:s=!1,tabStopId:o,...i}=t,a=Zo(),c=o||a,l=jQ(FQ,n),u=l.currentTabStopId===c,d=dM(n),{onFocusableItemAdd:h,onFocusableItemRemove:f}=l;return S.useEffect(()=>{if(r)return h(),()=>f()},[r,h,f]),S.createElement(uS.ItemSlot,{scope:n,id:c,focusable:r,active:s},S.createElement(Fe.span,W({tabIndex:u?0:-1,"data-orientation":l.orientation},i,{ref:e,onMouseDown:oe(t.onMouseDown,p=>{r?l.onItemFocus(c):p.preventDefault()}),onFocus:oe(t.onFocus,()=>l.onItemFocus(c)),onKeyDown:oe(t.onKeyDown,p=>{if(p.key==="Tab"&&p.shiftKey){l.onItemShiftTab();return}if(p.target!==p.currentTarget)return;const m=KQ(p,l.orientation,l.dir);if(m!==void 0){p.preventDefault();let w=d().filter(x=>x.focusable).map(x=>x.ref.current);if(m==="last")w.reverse();else if(m==="prev"||m==="next"){m==="prev"&&w.reverse();const x=w.indexOf(p.currentTarget);w=l.loop?VQ(w,x+1):w.slice(x+1)}setTimeout(()=>fM(w))}})})))}),UQ={ArrowLeft:"prev",ArrowUp:"prev",ArrowRight:"next",ArrowDown:"next",PageUp:"first",Home:"first",PageDown:"last",End:"last"};function HQ(t,e){return e!=="rtl"?t:t==="ArrowLeft"?"ArrowRight":t==="ArrowRight"?"ArrowLeft":t}function KQ(t,e,n){const r=HQ(t.key,n);if(!(e==="vertical"&&["ArrowLeft","ArrowRight"].includes(r))&&!(e==="horizontal"&&["ArrowUp","ArrowDown"].includes(r)))return UQ[r]}function fM(t){const e=document.activeElement;for(const n of t)if(n===e||(n.focus(),document.activeElement!==e))return}function VQ(t,e){return t.map((n,r)=>t[(e+r)%t.length])}const WQ=NQ,GQ=BQ,dS=["Enter"," "],YQ=["ArrowDown","PageUp","Home"],pM=["ArrowUp","PageDown","End"],XQ=[...YQ,...pM],qQ={ltr:[...dS,"ArrowRight"],rtl:[...dS,"ArrowLeft"]},QQ={ltr:["ArrowLeft"],rtl:["ArrowRight"]},Mm="Menu",[od,ZQ,JQ]=$m(Mm),[Ta,Om]=oo(Mm,[JQ,iM,hM]),Dm=iM(),gM=hM(),[mM,Ei]=Ta(Mm),[eZ,Kd]=Ta(Mm),tZ=t=>{const{__scopeMenu:e,open:n=!1,children:r,dir:s,onOpenChange:o,modal:i=!0}=t,a=Dm(e),[c,l]=S.useState(null),u=S.useRef(!1),d=rn(o),h=zx(s);return S.useEffect(()=>{const f=()=>{u.current=!0,document.addEventListener("pointerdown",p,{capture:!0,once:!0}),document.addEventListener("pointermove",p,{capture:!0,once:!0})},p=()=>u.current=!1;return document.addEventListener("keydown",f,{capture:!0}),()=>{document.removeEventListener("keydown",f,{capture:!0}),document.removeEventListener("pointerdown",p,{capture:!0}),document.removeEventListener("pointermove",p,{capture:!0})}},[]),S.createElement(uM,a,S.createElement(mM,{scope:e,open:n,onOpenChange:d,content:c,onContentChange:l},S.createElement(eZ,{scope:e,onClose:S.useCallback(()=>d(!1),[d]),isUsingKeyboardRef:u,dir:h,modal:i},r)))},yM=S.forwardRef((t,e)=>{const{__scopeMenu:n,...r}=t,s=Dm(n);return S.createElement(AQ,W({},s,r,{ref:e}))}),vM="MenuPortal",[nZ,wM]=Ta(vM,{forceMount:void 0}),rZ=t=>{const{__scopeMenu:e,forceMount:n,children:r,container:s}=t,o=Ei(vM,e);return S.createElement(nZ,{scope:e,forceMount:n},S.createElement(io,{present:n||o.open},S.createElement(N1,{asChild:!0,container:s},r)))},Kr="MenuContent",[sZ,Gx]=Ta(Kr),oZ=S.forwardRef((t,e)=>{const n=wM(Kr,t.__scopeMenu),{forceMount:r=n.forceMount,...s}=t,o=Ei(Kr,t.__scopeMenu),i=Kd(Kr,t.__scopeMenu);return S.createElement(od.Provider,{scope:t.__scopeMenu},S.createElement(io,{present:r||o.open},S.createElement(od.Slot,{scope:t.__scopeMenu},i.modal?S.createElement(iZ,W({},s,{ref:e})):S.createElement(aZ,W({},s,{ref:e})))))}),iZ=S.forwardRef((t,e)=>{const n=Ei(Kr,t.__scopeMenu),r=S.useRef(null),s=et(e,r);return S.useEffect(()=>{const o=r.current;if(o)return F1(o)},[]),S.createElement(Yx,W({},t,{ref:s,trapFocus:n.open,disableOutsidePointerEvents:n.open,disableOutsideScroll:!0,onFocusOutside:oe(t.onFocusOutside,o=>o.preventDefault(),{checkForDefaultPrevented:!1}),onDismiss:()=>n.onOpenChange(!1)}))}),aZ=S.forwardRef((t,e)=>{const n=Ei(Kr,t.__scopeMenu);return S.createElement(Yx,W({},t,{ref:e,trapFocus:!1,disableOutsidePointerEvents:!1,disableOutsideScroll:!1,onDismiss:()=>n.onOpenChange(!1)}))}),Yx=S.forwardRef((t,e)=>{const{__scopeMenu:n,loop:r=!1,trapFocus:s,onOpenAutoFocus:o,onCloseAutoFocus:i,disableOutsidePointerEvents:a,onEntryFocus:c,onEscapeKeyDown:l,onPointerDownOutside:u,onFocusOutside:d,onInteractOutside:h,onDismiss:f,disableOutsideScroll:p,...m}=t,v=Ei(Kr,n),w=Kd(Kr,n),x=Dm(n),b=gM(n),C=ZQ(n),[E,_]=S.useState(null),k=S.useRef(null),I=et(e,k,v.onContentChange),$=S.useRef(0),A=S.useRef(""),D=S.useRef(0),L=S.useRef(null),j=S.useRef("right"),M=S.useRef(0),B=p?z1:S.Fragment,U=p?{as:Hc,allowPinchZoom:!0}:void 0,q=F=>{var K,Q;const ne=A.current+F,we=C().filter(Be=>!Be.disabled),ke=document.activeElement,de=(K=we.find(Be=>Be.ref.current===ke))===null||K===void 0?void 0:K.textValue,Ye=we.map(Be=>Be.textValue),Xe=xZ(Ye,ne,de),qe=(Q=we.find(Be=>Be.textValue===Xe))===null||Q===void 0?void 0:Q.ref.current;(function Be(cn){A.current=cn,window.clearTimeout($.current),cn!==""&&($.current=window.setTimeout(()=>Be(""),1e3))})(ne),qe&&setTimeout(()=>qe.focus())};S.useEffect(()=>()=>window.clearTimeout($.current),[]),rT();const N=S.useCallback(F=>{var K,Q;return j.current===((K=L.current)===null||K===void 0?void 0:K.side)&&CZ(F,(Q=L.current)===null||Q===void 0?void 0:Q.area)},[]);return S.createElement(sZ,{scope:n,searchRef:A,onItemEnter:S.useCallback(F=>{N(F)&&F.preventDefault()},[N]),onItemLeave:S.useCallback(F=>{var K;N(F)||((K=k.current)===null||K===void 0||K.focus(),_(null))},[N]),onTriggerLeave:S.useCallback(F=>{N(F)&&F.preventDefault()},[N]),pointerGraceTimerRef:D,onPointerGraceIntentChange:S.useCallback(F=>{L.current=F},[])},S.createElement(B,U,S.createElement(tT,{asChild:!0,trapped:s,onMountAutoFocus:oe(o,F=>{var K;F.preventDefault(),(K=k.current)===null||K===void 0||K.focus()}),onUnmountAutoFocus:i},S.createElement(j1,{asChild:!0,disableOutsidePointerEvents:a,onEscapeKeyDown:l,onPointerDownOutside:u,onFocusOutside:d,onInteractOutside:h,onDismiss:f},S.createElement(WQ,W({asChild:!0},b,{dir:w.dir,orientation:"vertical",loop:r,currentTabStopId:E,onCurrentTabStopIdChange:_,onEntryFocus:oe(c,F=>{w.isUsingKeyboardRef.current||F.preventDefault()})}),S.createElement(MQ,W({role:"menu","aria-orientation":"vertical","data-state":EM(v.open),"data-radix-menu-content":"",dir:w.dir},x,m,{ref:I,style:{outline:"none",...m.style},onKeyDown:oe(m.onKeyDown,F=>{const Q=F.target.closest("[data-radix-menu-content]")===F.currentTarget,ne=F.ctrlKey||F.altKey||F.metaKey,we=F.key.length===1;Q&&(F.key==="Tab"&&F.preventDefault(),!ne&&we&&q(F.key));const ke=k.current;if(F.target!==ke||!XQ.includes(F.key))return;F.preventDefault();const Ye=C().filter(Xe=>!Xe.disabled).map(Xe=>Xe.ref.current);pM.includes(F.key)&&Ye.reverse(),wZ(Ye)}),onBlur:oe(t.onBlur,F=>{F.currentTarget.contains(F.target)||(window.clearTimeout($.current),A.current="")}),onPointerMove:oe(t.onPointerMove,id(F=>{const K=F.target,Q=M.current!==F.clientX;if(F.currentTarget.contains(K)&&Q){const ne=F.clientX>M.current?"right":"left";j.current=ne,M.current=F.clientX}}))})))))))}),cZ=S.forwardRef((t,e)=>{const{__scopeMenu:n,...r}=t;return S.createElement(Fe.div,W({role:"group"},r,{ref:e}))}),hS="MenuItem",oP="menu.itemSelect",SM=S.forwardRef((t,e)=>{const{disabled:n=!1,onSelect:r,...s}=t,o=S.useRef(null),i=Kd(hS,t.__scopeMenu),a=Gx(hS,t.__scopeMenu),c=et(e,o),l=S.useRef(!1),u=()=>{const d=o.current;if(!n&&d){const h=new CustomEvent(oP,{bubbles:!0,cancelable:!0});d.addEventListener(oP,f=>r==null?void 0:r(f),{once:!0}),L1(d,h),h.defaultPrevented?l.current=!1:i.onClose()}};return S.createElement(xM,W({},s,{ref:c,disabled:n,onClick:oe(t.onClick,u),onPointerDown:d=>{var h;(h=t.onPointerDown)===null||h===void 0||h.call(t,d),l.current=!0},onPointerUp:oe(t.onPointerUp,d=>{var h;l.current||(h=d.currentTarget)===null||h===void 0||h.click()}),onKeyDown:oe(t.onKeyDown,d=>{const h=a.searchRef.current!=="";n||h&&d.key===" "||dS.includes(d.key)&&(d.currentTarget.click(),d.preventDefault())})}))}),xM=S.forwardRef((t,e)=>{const{__scopeMenu:n,disabled:r=!1,textValue:s,...o}=t,i=Gx(hS,n),a=gM(n),c=S.useRef(null),l=et(e,c),[u,d]=S.useState(!1),[h,f]=S.useState("");return S.useEffect(()=>{const p=c.current;if(p){var m;f(((m=p.textContent)!==null&&m!==void 0?m:"").trim())}},[o.children]),S.createElement(od.ItemSlot,{scope:n,disabled:r,textValue:s??h},S.createElement(GQ,W({asChild:!0},a,{focusable:!r}),S.createElement(Fe.div,W({role:"menuitem","data-highlighted":u?"":void 0,"aria-disabled":r||void 0,"data-disabled":r?"":void 0},o,{ref:l,onPointerMove:oe(t.onPointerMove,id(p=>{r?i.onItemLeave(p):(i.onItemEnter(p),p.defaultPrevented||p.currentTarget.focus())})),onPointerLeave:oe(t.onPointerLeave,id(p=>i.onItemLeave(p))),onFocus:oe(t.onFocus,()=>d(!0)),onBlur:oe(t.onBlur,()=>d(!1))}))))}),lZ=S.forwardRef((t,e)=>{const{checked:n=!1,onCheckedChange:r,...s}=t;return S.createElement(dZ,{scope:t.__scopeMenu,checked:n},S.createElement(SM,W({role:"menuitemcheckbox","aria-checked":bg(n)?"mixed":n},s,{ref:e,"data-state":PM(n),onSelect:oe(s.onSelect,()=>r==null?void 0:r(bg(n)?!0:!n),{checkForDefaultPrevented:!1})})))}),uZ="MenuRadioGroup";Ta(uZ,{value:void 0,onValueChange:()=>{}});const bM="MenuItemIndicator",[dZ,hZ]=Ta(bM,{checked:!1}),fZ=S.forwardRef((t,e)=>{const{__scopeMenu:n,forceMount:r,...s}=t,o=hZ(bM,n);return S.createElement(io,{present:r||bg(o.checked)||o.checked===!0},S.createElement(Fe.span,W({},s,{ref:e,"data-state":PM(o.checked)})))}),CM="MenuSub",[pZ,_M]=Ta(CM),gZ=t=>{const{__scopeMenu:e,children:n,open:r=!1,onOpenChange:s}=t,o=Ei(CM,e),i=Dm(e),[a,c]=S.useState(null),[l,u]=S.useState(null),d=rn(s);return S.useEffect(()=>(o.open===!1&&d(!1),()=>d(!1)),[o.open,d]),S.createElement(uM,i,S.createElement(mM,{scope:e,open:r,onOpenChange:d,content:l,onContentChange:u},S.createElement(pZ,{scope:e,contentId:Zo(),triggerId:Zo(),trigger:a,onTriggerChange:c},n)))},Zh="MenuSubTrigger",mZ=S.forwardRef((t,e)=>{const n=Ei(Zh,t.__scopeMenu),r=Kd(Zh,t.__scopeMenu),s=_M(Zh,t.__scopeMenu),o=Gx(Zh,t.__scopeMenu),i=S.useRef(null),{pointerGraceTimerRef:a,onPointerGraceIntentChange:c}=o,l={__scopeMenu:t.__scopeMenu},u=S.useCallback(()=>{i.current&&window.clearTimeout(i.current),i.current=null},[]);return S.useEffect(()=>u,[u]),S.useEffect(()=>{const d=a.current;return()=>{window.clearTimeout(d),c(null)}},[a,c]),S.createElement(yM,W({asChild:!0},l),S.createElement(xM,W({id:s.triggerId,"aria-haspopup":"menu","aria-expanded":n.open,"aria-controls":s.contentId,"data-state":EM(n.open)},t,{ref:sm(e,s.onTriggerChange),onClick:d=>{var h;(h=t.onClick)===null||h===void 0||h.call(t,d),!(t.disabled||d.defaultPrevented)&&(d.currentTarget.focus(),n.open||n.onOpenChange(!0))},onPointerMove:oe(t.onPointerMove,id(d=>{o.onItemEnter(d),!d.defaultPrevented&&!t.disabled&&!n.open&&!i.current&&(o.onPointerGraceIntentChange(null),i.current=window.setTimeout(()=>{n.onOpenChange(!0),u()},100))})),onPointerLeave:oe(t.onPointerLeave,id(d=>{var h;u();const f=(h=n.content)===null||h===void 0?void 0:h.getBoundingClientRect();if(f){var p;const m=(p=n.content)===null||p===void 0?void 0:p.dataset.side,v=m==="right",w=v?-5:5,x=f[v?"left":"right"],b=f[v?"right":"left"];o.onPointerGraceIntentChange({area:[{x:d.clientX+w,y:d.clientY},{x,y:f.top},{x:b,y:f.top},{x:b,y:f.bottom},{x,y:f.bottom}],side:m}),window.clearTimeout(a.current),a.current=window.setTimeout(()=>o.onPointerGraceIntentChange(null),300)}else{if(o.onTriggerLeave(d),d.defaultPrevented)return;o.onPointerGraceIntentChange(null)}})),onKeyDown:oe(t.onKeyDown,d=>{const h=o.searchRef.current!=="";if(!(t.disabled||h&&d.key===" ")&&qQ[r.dir].includes(d.key)){var f;n.onOpenChange(!0),(f=n.content)===null||f===void 0||f.focus(),d.preventDefault()}})})))}),yZ="MenuSubContent",vZ=S.forwardRef((t,e)=>{const n=wM(Kr,t.__scopeMenu),{forceMount:r=n.forceMount,...s}=t,o=Ei(Kr,t.__scopeMenu),i=Kd(Kr,t.__scopeMenu),a=_M(yZ,t.__scopeMenu),c=S.useRef(null),l=et(e,c);return S.createElement(od.Provider,{scope:t.__scopeMenu},S.createElement(io,{present:r||o.open},S.createElement(od.Slot,{scope:t.__scopeMenu},S.createElement(Yx,W({id:a.contentId,"aria-labelledby":a.triggerId},s,{ref:l,align:"start",side:i.dir==="rtl"?"left":"right",disableOutsidePointerEvents:!1,disableOutsideScroll:!1,trapFocus:!1,onOpenAutoFocus:u=>{var d;i.isUsingKeyboardRef.current&&((d=c.current)===null||d===void 0||d.focus()),u.preventDefault()},onCloseAutoFocus:u=>u.preventDefault(),onFocusOutside:oe(t.onFocusOutside,u=>{u.target!==a.trigger&&o.onOpenChange(!1)}),onEscapeKeyDown:oe(t.onEscapeKeyDown,u=>{i.onClose(),u.preventDefault()}),onKeyDown:oe(t.onKeyDown,u=>{const d=u.currentTarget.contains(u.target),h=QQ[i.dir].includes(u.key);if(d&&h){var f;o.onOpenChange(!1),(f=a.trigger)===null||f===void 0||f.focus(),u.preventDefault()}})})))))});function EM(t){return t?"open":"closed"}function bg(t){return t==="indeterminate"}function PM(t){return bg(t)?"indeterminate":t?"checked":"unchecked"}function wZ(t){const e=document.activeElement;for(const n of t)if(n===e||(n.focus(),document.activeElement!==e))return}function SZ(t,e){return t.map((n,r)=>t[(e+r)%t.length])}function xZ(t,e,n){const s=e.length>1&&Array.from(e).every(l=>l===e[0])?e[0]:e,o=n?t.indexOf(n):-1;let i=SZ(t,Math.max(o,0));s.length===1&&(i=i.filter(l=>l!==n));const c=i.find(l=>l.toLowerCase().startsWith(s.toLowerCase()));return c!==n?c:void 0}function bZ(t,e){const{x:n,y:r}=t;let s=!1;for(let o=0,i=e.length-1;o<e.length;i=o++){const a=e[o].x,c=e[o].y,l=e[i].x,u=e[i].y;c>r!=u>r&&n<(l-a)*(r-c)/(u-c)+a&&(s=!s)}return s}function CZ(t,e){if(!e)return!1;const n={x:t.clientX,y:t.clientY};return bZ(n,e)}function id(t){return e=>e.pointerType==="mouse"?t(e):void 0}const kM=tZ,IM=yM,$M=rZ,TM=oZ,AM=cZ,MM=SM,OM=lZ,_Z=fZ,DM=gZ,RM=mZ,LM=vZ,jM="DropdownMenu",[EZ,Dle]=oo(jM,[Om]),Gr=Om(),[PZ,NM]=EZ(jM),kZ=t=>{const{__scopeDropdownMenu:e,children:n,dir:r,open:s,defaultOpen:o,onOpenChange:i,modal:a=!0}=t,c=Gr(e),l=S.useRef(null),[u=!1,d]=Ca({prop:s,defaultProp:o,onChange:i});return S.createElement(PZ,{scope:e,triggerId:Zo(),triggerRef:l,contentId:Zo(),open:u,onOpenChange:d,onOpenToggle:S.useCallback(()=>d(h=>!h),[d]),modal:a},S.createElement(kM,W({},c,{open:u,onOpenChange:d,dir:r,modal:a}),n))},IZ="DropdownMenuTrigger",$Z=S.forwardRef((t,e)=>{const{__scopeDropdownMenu:n,disabled:r=!1,...s}=t,o=NM(IZ,n),i=Gr(n);return S.createElement(IM,W({asChild:!0},i),S.createElement(Fe.button,W({type:"button",id:o.triggerId,"aria-haspopup":"menu","aria-expanded":o.open,"aria-controls":o.open?o.contentId:void 0,"data-state":o.open?"open":"closed","data-disabled":r?"":void 0,disabled:r},s,{ref:sm(e,o.triggerRef),onPointerDown:oe(t.onPointerDown,a=>{!r&&a.button===0&&a.ctrlKey===!1&&(o.onOpenToggle(),o.open||a.preventDefault())}),onKeyDown:oe(t.onKeyDown,a=>{r||(["Enter"," "].includes(a.key)&&o.onOpenToggle(),a.key==="ArrowDown"&&o.onOpenChange(!0),["Enter"," ","ArrowDown"].includes(a.key)&&a.preventDefault())})})))}),TZ=t=>{const{__scopeDropdownMenu:e,...n}=t,r=Gr(e);return S.createElement($M,W({},r,n))},AZ="DropdownMenuContent",MZ=S.forwardRef((t,e)=>{const{__scopeDropdownMenu:n,...r}=t,s=NM(AZ,n),o=Gr(n),i=S.useRef(!1);return S.createElement(TM,W({id:s.contentId,"aria-labelledby":s.triggerId},o,r,{ref:e,onCloseAutoFocus:oe(t.onCloseAutoFocus,a=>{var c;i.current||(c=s.triggerRef.current)===null||c===void 0||c.focus(),i.current=!1,a.preventDefault()}),onInteractOutside:oe(t.onInteractOutside,a=>{const c=a.detail.originalEvent,l=c.button===0&&c.ctrlKey===!0,u=c.button===2||l;(!s.modal||u)&&(i.current=!0)}),style:{...t.style,"--radix-dropdown-menu-content-transform-origin":"var(--radix-popper-transform-origin)","--radix-dropdown-menu-content-available-width":"var(--radix-popper-available-width)","--radix-dropdown-menu-content-available-height":"var(--radix-popper-available-height)","--radix-dropdown-menu-trigger-width":"var(--radix-popper-anchor-width)","--radix-dropdown-menu-trigger-height":"var(--radix-popper-anchor-height)"}}))}),OZ=S.forwardRef((t,e)=>{const{__scopeDropdownMenu:n,...r}=t,s=Gr(n);return S.createElement(AM,W({},s,r,{ref:e}))}),DZ=S.forwardRef((t,e)=>{const{__scopeDropdownMenu:n,...r}=t,s=Gr(n);return S.createElement(MM,W({},s,r,{ref:e}))}),RZ=S.forwardRef((t,e)=>{const{__scopeDropdownMenu:n,...r}=t,s=Gr(n);return S.createElement(OM,W({},s,r,{ref:e}))}),LZ=S.forwardRef((t,e)=>{const{__scopeDropdownMenu:n,...r}=t,s=Gr(n);return S.createElement(_Z,W({},s,r,{ref:e}))}),jZ=t=>{const{__scopeDropdownMenu:e,children:n,open:r,onOpenChange:s,defaultOpen:o}=t,i=Gr(e),[a=!1,c]=Ca({prop:r,defaultProp:o,onChange:s});return S.createElement(DM,W({},i,{open:a,onOpenChange:c}),n)},NZ=S.forwardRef((t,e)=>{const{__scopeDropdownMenu:n,...r}=t,s=Gr(n);return S.createElement(RM,W({},s,r,{ref:e}))}),zZ=S.forwardRef((t,e)=>{const{__scopeDropdownMenu:n,...r}=t,s=Gr(n);return S.createElement(LM,W({},s,r,{ref:e,style:{...t.style,"--radix-dropdown-menu-content-transform-origin":"var(--radix-popper-transform-origin)","--radix-dropdown-menu-content-available-width":"var(--radix-popper-available-width)","--radix-dropdown-menu-content-available-height":"var(--radix-popper-available-height)","--radix-dropdown-menu-trigger-width":"var(--radix-popper-anchor-width)","--radix-dropdown-menu-trigger-height":"var(--radix-popper-anchor-height)"}}))}),zM=kZ,ad=$Z,Xx=TZ,FM=MZ,FZ=OZ,nc=DZ,BM=RZ,BZ=LZ,UZ=jZ,HZ=NZ,KZ=zZ,UM=()=>{},HM=S.createContext({});function VZ({onEvent:t,children:e}){return g.jsx(HM.Provider,{value:t??UM,children:e})}function yl(){return S.useContext(HM)??UM}function Aa(t,e){const n=H(),r=S.useRef(!1),s=yl(),o=S.useCallback(a=>{r.current=a,n.batch(()=>{a?(n.complete(),n.addOpenMenu(t)):(n.deleteOpenMenu(t),n.openMenus.forEach(c=>{c.startsWith(t)&&n.deleteOpenMenu(c)})),e==null||e(a)})},[n,t,e]);return S.useEffect(()=>(r.current&&(s("open-menu",{source:"unknown",id:t}),n.addOpenMenu(t)),()=>{r.current&&(n.deleteOpenMenu(t),n.openMenus.forEach(a=>{a.startsWith(t)&&(s("close-menu",{source:"unknown",id:t}),n.deleteOpenMenu(a))}),r.current=!1)}),[n,t,s]),[Y("is menu open",()=>n.openMenus.includes(t),[n,t]),o]}function li({id:t,children:e,modal:n=!1}){const[r,s]=Aa(t);return g.jsx(zM,{open:r,dir:"ltr",modal:n,onOpenChange:s,children:e})}function Vd({children:t,"data-testid":e}){return g.jsx(ad,{dir:"ltr","data-testid":e,asChild:!0,children:t})}function ui({side:t="bottom",align:e="start",sideOffset:n=8,alignOffset:r=8,children:s}){const o=Mn();return g.jsx(Xx,{dir:"ltr",container:o,children:g.jsx(FM,{className:"tlui-menu",align:e,sideOffset:n,side:t,alignOffset:r,collisionPadding:4,children:s})})}function qx({id:t,children:e}){const[n,r]=Aa(t);return g.jsx(UZ,{open:n,onOpenChange:r,children:e})}function Qx({label:t,"data-testid":e,"data-direction":n}){return g.jsx(HZ,{dir:"ltr","data-direction":n,"data-testid":e,asChild:!0,children:g.jsx(se,{className:"tlui-menu__button tlui-menu__submenu__trigger",label:t,icon:"chevron-right"})})}function Zx({alignOffset:t=0,sideOffset:e=5,children:n}){const r=Mn();return g.jsx(Xx,{container:r,dir:"ltr",children:g.jsx(KZ,{className:"tlui-menu tlui-menu__submenu__content",alignOffset:t,sideOffset:e,collisionPadding:4,children:n})})}function Ks({children:t,size:e="medium"}){return g.jsx(FZ,{dir:"ltr",className:"tlui-menu__group","data-size":e,children:t})}function Bn({noClose:t,...e}){return g.jsx(nc,{dir:"ltr",asChild:!0,onClick:t||e.isChecked!==void 0?je:void 0,children:g.jsx(se,{className:"tlui-menu__button",...e})})}function KM({children:t,onSelect:e,...n}){return g.jsxs(BM,{dir:"ltr",className:"tlui-button tlui-menu__button tlui-menu__checkbox-item",onSelect:r=>{e==null||e(r),je(r)},...n,children:[g.jsx("div",{className:"tlui-menu__checkbox-item__check",style:{transformOrigin:"75% center",transform:`scale(${n.checked?1:.5})`,opacity:n.checked?1:.5},children:g.jsx(In,{small:!0,icon:n.checked?"check":"checkbox-empty"})}),t]})}function WZ({children:t,onSelect:e,...n}){return g.jsxs(BM,{dir:"ltr",className:"tlui-button tlui-menu__button tlui-menu__checkbox-item",onSelect:r=>{e==null||e(r),je(r)},...n,children:[g.jsx(BZ,{dir:"ltr",className:"tlui-menu__checkbox-item__check",children:g.jsx(In,{icon:"check"})}),t]})}const GZ=({children:t})=>{const e=H();return Y("shouldDisplayHandles",()=>e.isInAny("select.idle","select.pointing_handle"),[e])?g.jsx("svg",{className:"tl-user-handles tl-overlays__item",children:t}):null},YZ=({shapeId:t})=>{const e=H();return Y("show hovered",()=>e.isIn("select.editing_shape")?e.hoveredShapeId!==e.editingShapeId:e.isInAny("select.idle"),[e])?g.jsx(Dd,{className:"tl-user-indicator__hovered",id:t}):null},{PI:XZ}=Math,Ja=XZ+1e-4;function cd(t,e={}){const{size:n=16,smoothing:r=.5,start:s={},end:o={},last:i=!1}=e,{cap:a=!0}=s,{cap:c=!0}=o;if(t.length===0||n<=0)return[];const l=t[0],u=t[t.length-1],d=u.runningLength,h=s.taper===!1?0:s.taper===!0?Math.max(n,d):s.taper,f=o.taper===!1?0:o.taper===!0?Math.max(n,d):o.taper,p=Math.pow(n*r,2),m=[],v=[];let w=t[0].vector,x=t[0].point,b=x,C=x,E=b,_=!1,k;for(let j=0;j<t.length;j++){k=t[j];const{point:M,vector:B}=t[j],U=k.vector.dpr(w),q=(j<t.length-1?t[j+1]:t[j]).vector,N=j<t.length-1?q.dpr(k.vector):1,F=U<0&&!_,K=N!==null&&N<.2;if(F||K){if(N>-.62&&d-k.runningLength>k.radius){const ne=w.clone().mul(k.radius);w.clone().cpr(q)<0?(C=P.Add(M,ne),E=P.Sub(M,ne)):(C=P.Sub(M,ne),E=P.Add(M,ne)),m.push(C),v.push(E)}else{const ne=w.clone().mul(k.radius).per(),we=P.Sub(k.input,ne);for(let ke=1/13,de=0;de<1;de+=ke)C=P.RotWith(we,k.input,Ja*de),m.push(C),E=P.RotWith(we,k.input,Ja+Ja*-de),v.push(E)}x=C,b=E,K&&(_=!0);continue}if(_=!1,k===l||k===u){const ne=P.Per(B).mul(k.radius);m.push(P.Sub(M,ne)),v.push(P.Add(M,ne));continue}const Q=P.Lrp(q,B,N).per().mul(k.radius);C=P.Sub(M,Q),(j<=1||P.Dist2(x,C)>p)&&(m.push(C),x=C),E=P.Add(M,Q),(j<=1||P.Dist2(b,E)>p)&&(v.push(E),b=E),w=B}const I=l.point,$=t.length>1?t[t.length-1].point:P.AddXY(l.point,1,1);if(t.length===1&&(!(h||f)||i)){const j=P.Add(I,P.Sub(I,$).uni().per().mul(-l.radius)),M=[];for(let B=1/13,U=B;U<=1;U+=B)M.push(P.RotWith(j,I,Ja*2*U));return M}const A=[];if(!(h||f&&t.length===1))if(a)for(let j=1/8,M=j;M<=1;M+=j){const B=P.RotWith(v[0],I,Ja*M);A.push(B)}else{const j=P.Sub(m[0],v[0]),M=P.Mul(j,.5),B=P.Mul(j,.51);A.push(P.Sub(I,M),P.Sub(I,B),P.Add(I,B),P.Add(I,M))}const D=[],L=u.vector.clone().per().neg();if(f||h&&t.length===1)D.push($);else if(c){const j=P.Add($,P.Mul(L,u.radius));for(let M=1/29,B=M;B<1;B+=M)D.push(P.RotWith(j,$,Ja*3*B))}else D.push(P.Add($,P.Mul(L,u.radius)),P.Add($,P.Mul(L,u.radius*.99)),P.Sub($,P.Mul(L,u.radius*.99)),P.Sub($,P.Mul(L,u.radius)));return m.concat(D,v.reverse(),A)}const qZ=.025,QZ=.01;function Ns(t,e={}){var v;const{streamline:n=.5,size:r=16,simulatePressure:s=!1}=e;if(t.length===0)return[];const o=.15+(1-n)*.85;let i=t.map(P.From),a=0;if(!s){let w=i[0];for(;w&&!(w.z>=qZ);)i.shift(),w=i[0]}if(!s){let w=i[i.length-1];for(;w&&!(w.z>=QZ);)i.pop(),w=i[i.length-1]}if(i.length===0)return[{point:P.From(t[0]),input:P.From(t[0]),pressure:s?.5:.15,vector:new P(1,1),distance:0,runningLength:0,radius:1}];let c=i[1];for(;c&&!(P.Dist(c,i[0])>r/3);)i[0].z=Math.max(i[0].z,c.z),i.splice(1,1),c=i[1];const l=i.pop();for(c=i[i.length-1];c&&!(P.Dist(c,l)>r/3);)i.pop(),c=i[i.length-1],a++;i.push(l);const u=e.last||!e.simulatePressure||i.length>1&&P.Dist(i[i.length-1],i[i.length-2])<r||a>0;if(i.length===2&&e.simulatePressure){const w=i[1];i=i.slice(0,-1);for(let x=1;x<5;x++){const b=P.Lrp(i[0],w,x/4);b.z=(i[0].z+(w.z-i[0].z))*x/4,i.push(b)}}const d=[{point:i[0],input:i[0],pressure:s?.5:i[0].z,vector:new P(1,1),distance:0,runningLength:0,radius:1}];let h=0,f=d[0],p,m;u&&n>0&&i.push(i[i.length-1].clone());for(let w=1,x=i.length;w<x;w++)p=!o||e.last&&w===x-1?i[w].clone():i[w].clone().lrp(f.point,1-o),!f.point.equals(p)&&(m=P.Dist(p,f.point),h+=m,!(w<4&&h<r)&&(f={input:i[w],point:p,pressure:s?.5:i[w].z,vector:P.Sub(f.point,p).uni(),distance:m,runningLength:h,radius:1},d.push(f)));if((v=d[1])!=null&&v.vector&&(d[0].vector=d[1].vector.clone()),h<1){const w=Math.max(.5,...d.map(x=>x.pressure));d.forEach(x=>x.pressure=w)}return d}const{min:Po}=Math,$0=.275;function ld(t,e){const{size:n=16,thinning:r=.5,simulatePressure:s=!0,easing:o=v=>v,start:i={},end:a={}}=e,{easing:c=en.easeOutQuad}=i,{easing:l=en.easeOutCubic}=a,u=t[t.length-1].runningLength;let d,h=t[0].pressure,f;if(!s&&u<n){const v=t.reduce((w,x)=>Math.max(w,x.pressure),.5);return t.forEach(w=>{w.pressure=v,w.radius=n*o(.5-r*(.5-w.pressure))}),t}else{let v;for(let w=0,x=t.length;w<x&&(f=t[w],!(f.runningLength>n*5));w++){const b=Po(1,f.distance/n);if(s){const C=Po(1,1-b);v=Po(1,h+(C-h)*(b*$0))}else v=Po(1,h+(f.pressure-h)*.5);h=h+(v-h)*.5}for(let w=0;w<t.length;w++){if(f=t[w],r){let{pressure:x}=f;const b=Po(1,f.distance/n);if(s){const C=Po(1,1-b);x=Po(1,h+(C-h)*(b*$0))}else x=Po(1,h+(x-h)*(b*$0));f.radius=n*o(.5-r*(.5-x)),h=x}else f.radius=n/2;d===void 0&&(d=f.radius)}}const p=i.taper===!1?0:i.taper===!0?Math.max(n,u):i.taper,m=a.taper===!1?0:a.taper===!0?Math.max(n,u):a.taper;if(p||m)for(let v=0;v<t.length;v++){f=t[v];const{runningLength:w}=f,x=w<p?c(w/p):1,b=u-w<m?l((u-w)/m):1;f.radius=Math.max(.01,f.radius*Math.min(x,b))}return t}function ZZ(t,e={}){return cd(ld(Ns(t,e),e),e)}const JZ=({scribble:t,zoom:e,color:n,opacity:r,className:s})=>{if(!t.points.length)return null;const o=ZZ(t.points,{size:t.size/e,start:{taper:!0,easing:en.linear},last:t.state==="stopping",simulatePressure:!1,streamline:.32});let i;if(o.length<4){const a=t.size/e/2,{x:c,y:l}=t.points[t.points.length-1];i=`M ${c-a},${l} a ${a},${a} 0 1,0 ${a*2},0 a ${a},${a} 0 1,0 ${-a*2},0`}else i=Gc(o);return g.jsx("svg",{className:s&&le("tl-overlays__item",s),children:g.jsx("path",{className:"tl-scribble",d:i,fill:n??`var(--color-${t.color})`,opacity:r??t.opacity})})},eJ=({bounds:t,rotation:e})=>{const n=H();return Y("should display",()=>n.isInAny("select.idle","select.brushing","select.scribble_brushing","select.pointing_shape","select.pointing_selection","text.resizing"),[n])?g.jsx(ZT,{bounds:t,rotation:e}):null};function Cr(){const t=H();return Y("isReadonlyMode",()=>t.instanceState.isReadonly,[t])}function tJ({size:t,width:e,height:n,hideAlternateHandles:r}){const s=R(t/3),o=s/2;return g.jsxs("svg",{className:"tl-overlays__item",children:[g.jsx("polyline",{className:"tl-corner-crop-handle",points:`
						${R(0-o)},${R(t)} 
						${R(0-o)},${R(0-o)} 
						${R(t)},${R(0-o)}`,strokeWidth:s,"data-testid":"selection.crop.top_left","aria-label":"top_left handle"}),g.jsx("line",{className:le("tl-corner-crop-edge-handle",{"tl-hidden":r}),x1:R(e/2-t),y1:R(0-o),x2:R(e/2+t),y2:R(0-o),strokeWidth:s,"data-testid":"selection.crop.top","aria-label":"top handle"}),g.jsx("polyline",{className:le("tl-corner-crop-handle",{"tl-hidden":r}),points:`
						${R(e-t)},${R(0-o)} 
						${R(e+o)},${R(0-o)} 
						${R(e+o)},${R(t)}`,strokeWidth:s,"data-testid":"selection.crop.top_right","aria-label":"top_right handle"}),g.jsx("line",{className:le("tl-corner-crop-edge-handle",{"tl-hidden":r}),x1:R(e+o),y1:R(n/2-t),x2:R(e+o),y2:R(n/2+t),strokeWidth:s,"data-testid":"selection.crop.right","aria-label":"right handle"}),g.jsx("polyline",{className:"tl-corner-crop-handle",points:`
						${R(e+o)},${R(n-t)} 
						${R(e+o)},${R(n+o)}
						${R(e-t)},${R(n+o)}`,strokeWidth:s,"data-testid":"selection.crop.bottom_right","aria-label":"bottom_right handle"}),g.jsx("line",{className:le("tl-corner-crop-edge-handle",{"tl-hidden":r}),x1:R(e/2-t),y1:R(n+o),x2:R(e/2+t),y2:R(n+o),strokeWidth:s,"data-testid":"selection.crop.bottom","aria-label":"bottom handle"}),g.jsx("polyline",{className:le("tl-corner-crop-handle",{"tl-hidden":r}),points:`
						${R(0+t)},${R(n+o)} 
						${R(0-o)},${R(n+o)}
						${R(0-o)},${R(n-t)}`,strokeWidth:s,"data-testid":"selection.crop.bottom_left","aria-label":"bottom_left handle"}),g.jsx("line",{className:le("tl-corner-crop-edge-handle",{"tl-hidden":r}),x1:R(0-o),y1:R(n/2-t),x2:R(0-o),y2:R(n/2+t),strokeWidth:s,"data-testid":"selection.crop.left","aria-label":"left handle"})]})}const nJ=typeof navigator<"u"&&navigator.userAgent&&navigator.userAgent.toLowerCase().indexOf("firefox")>-1,rJ=Ee(function({bounds:e,rotation:n}){const r=H(),s=S.useRef(null),o=Cr(),i=es("top"),a=es("right"),c=es("bottom"),l=es("left"),u=es("top_left"),d=es("top_right"),h=es("bottom_right"),f=es("bottom_left"),p=!r.isMenuOpen&&r.instanceState.cursor.type==="default",m=r.instanceState.isCoarsePointer,v=r.selectedShapes,w=r.onlySelectedShape,x=w&&r.isShapeOrAncestorLocked(w),b=w?r.getShapeUtil(w).expandSelectionOutlinePx(w):0;if(al(s,e==null?void 0:e.x,e==null?void 0:e.y,1,r.selectionRotation,{x:-b,y:-b}),!e)return null;e=e.clone().expandBy(b);const C=r.zoomLevel,E=r.instanceState.isChangingStyle,_=Math.max(1,e.width),k=Math.max(1,e.height),I=8/C,$=_<I*2,A=k<I*2,D=_<I*4,L=k<I*4,j=_<I*5,M=k<I*5,B=m?1.75:1,U=6/C*B,q=(D?U/2:U)*(B*.75),N=(L?U/2:U)*(B*.75),F=(w?!r.getShapeUtil(w).hideSelectionBoundsFg(w):!0)&&!E;let K=F&&r.isInAny("select.idle","select.brushing","select.scribble_brushing","select.pointing_canvas","select.pointing_selection","select.pointing_shape","select.crop.idle","select.crop.pointing_crop","select.pointing_resize_handle","select.pointing_crop_handle")||F&&r.isIn("select.resizing")&&w&&r.isShapeOfType(w,"text");w&&K&&nJ&&r.isShapeOfType(w,"embed")&&(K=!1);const Q=r.isInAny("select.pointing_crop_handle","select.crop.idle","select.crop.pointing_crop")&&!E&&!o,ne=r.isInAny("select.idle","select.pointing_selection","select.pointing_shape","select.crop.idle")&&!E&&!o,we=!m&&!($||A)&&(ne||Q)&&(w?!r.getShapeUtil(w).hideRotateHandle(w):!0)&&!x,ke=m&&(!D||!L)&&(ne||Q)&&(w?!r.getShapeUtil(w).hideRotateHandle(w):!0)&&!x,de=ne&&(w?r.getShapeUtil(w).canResize(w)&&!r.getShapeUtil(w).hideResizeHandles(w):!0)&&!Q&&!x,Ye=$||A,Xe=$&&A,qe=j||M,Be=de||Q,cn=!we,vo=!ne||!ke,Dn=!ne||!Be,_s=!ne||!Be||Ye,Er=!ne||!Be||Ye,wo=!ne||!Be||Xe&&!Q;let Es=m;Es&&v.every(ln=>r.getShapeUtil(ln).isAspectRatioLocked(ln))&&(Es=!1);let tr=!0;Q?tr=qe:de&&(tr=Ye||Xe||Es);const Pr=Math.min(24/C,k-N*3),nr=ne&&m&&w&&r.isShapeOfType(w,"text")&&Pr*C>=4;return g.jsxs("svg",{ref:s,className:"tl-overlays__item tl-selection__fg","data-testid":"selection-foreground",children:[K&&g.jsx("rect",{className:le("tl-selection__fg__outline"),width:R(_),height:R(k)}),g.jsx(Jh,{"data-testid":"selection.rotate.top-left",cx:0,cy:0,targetSize:U,corner:"top_left_rotate",cursor:p?Ln("nwse-rotate",n):void 0,isHidden:cn}),g.jsx(Jh,{"data-testid":"selection.rotate.top-right",cx:_+U*3,cy:0,targetSize:U,corner:"top_right_rotate",cursor:p?Ln("nesw-rotate",n):void 0,isHidden:cn}),g.jsx(Jh,{"data-testid":"selection.rotate.bottom-left",cx:0,cy:k+U*3,targetSize:U,corner:"bottom_left_rotate",cursor:p?Ln("swne-rotate",n):void 0,isHidden:cn}),g.jsx(Jh,{"data-testid":"selection.rotate.bottom-right",cx:_+U*3,cy:k+U*3,targetSize:U,corner:"bottom_right_rotate",cursor:p?Ln("senw-rotate",n):void 0,isHidden:cn})," ",g.jsx(oJ,{"data-testid":"selection.rotate.mobile",cx:D?-U*1.5:_/2,cy:D?k/2:-U*1.5,size:I,isHidden:vo}),g.jsx("rect",{className:le("tl-transparent",{"tl-hidden":tr}),"data-testid":"selection.resize.top","aria-label":"top target",pointerEvents:"all",x:0,y:R(0-(L?N*2:N)),width:R(Math.max(1,_)),height:R(Math.max(1,N*2)),style:p?{cursor:Ln("ns-resize",n)}:void 0,...i}),g.jsx("rect",{className:le("tl-transparent",{"tl-hidden":tr}),"data-testid":"selection.resize.right","aria-label":"right target",pointerEvents:"all",x:R(_-(D?0:q)),y:0,height:R(Math.max(1,k)),width:R(Math.max(1,q*2)),style:p?{cursor:Ln("ew-resize",n)}:void 0,...a}),g.jsx("rect",{className:le("tl-transparent",{"tl-hidden":tr}),"data-testid":"selection.resize.bottom","aria-label":"bottom target",pointerEvents:"all",x:0,y:R(k-(L?0:N)),width:R(Math.max(1,_)),height:R(Math.max(1,N*2)),style:p?{cursor:Ln("ns-resize",n)}:void 0,...c}),g.jsx("rect",{className:le("tl-transparent",{"tl-hidden":tr}),"data-testid":"selection.resize.left","aria-label":"left target",pointerEvents:"all",x:R(0-(D?q*2:q)),y:0,height:R(Math.max(1,k)),width:R(Math.max(1,q*2)),style:p?{cursor:Ln("ew-resize",n)}:void 0,...l}),g.jsx("rect",{className:le("tl-transparent",{"tl-hidden":Dn}),"data-testid":"selection.target.top-left","aria-label":"top-left target",pointerEvents:"all",x:R(0-(D?q*2:q*1.5)),y:R(0-(L?N*2:N*1.5)),width:R(q*3),height:R(N*3),style:p?{cursor:Ln("nwse-resize",n)}:void 0,...u}),g.jsx("rect",{className:le("tl-transparent",{"tl-hidden":_s}),"data-testid":"selection.target.top-right","aria-label":"top-right target",pointerEvents:"all",x:R(_-(D?0:q*1.5)),y:R(0-(L?N*2:N*1.5)),width:R(q*3),height:R(N*3),style:p?{cursor:Ln("nesw-resize",n)}:void 0,...d}),g.jsx("rect",{className:le("tl-transparent",{"tl-hidden":wo}),"data-testid":"selection.target.bottom-right","aria-label":"bottom-right target",pointerEvents:"all",x:R(_-(D?q:q*1.5)),y:R(k-(L?N:N*1.5)),width:R(q*3),height:R(N*3),style:p?{cursor:Ln("nwse-resize",n)}:void 0,...h}),g.jsx("rect",{className:le("tl-transparent",{"tl-hidden":Er}),"data-testid":"selection.target.bottom-left","aria-label":"bottom-left target",pointerEvents:"all",x:R(0-(D?q*3:q*1.5)),y:R(k-(L?0:N*1.5)),width:R(q*3),height:R(N*3),style:p?{cursor:Ln("nesw-resize",n)}:void 0,...f}),de&&g.jsxs(g.Fragment,{children:[g.jsx("rect",{"data-testid":"selection.resize.top-left",className:le("tl-corner-handle",{"tl-hidden":Dn}),"aria-label":"top_left handle",x:R(0-I/2),y:R(0-I/2),width:R(I),height:R(I)}),g.jsx("rect",{"data-testid":"selection.resize.top-right",className:le("tl-corner-handle",{"tl-hidden":_s}),"aria-label":"top_right handle",x:R(_-I/2),y:R(0-I/2),width:R(I),height:R(I)}),g.jsx("rect",{"data-testid":"selection.resize.bottom-right",className:le("tl-corner-handle",{"tl-hidden":wo}),"aria-label":"bottom_right handle",x:R(_-I/2),y:R(k-I/2),width:R(I),height:R(I)}),g.jsx("rect",{"data-testid":"selection.resize.bottom-left",className:le("tl-corner-handle",{"tl-hidden":Er}),"aria-label":"bottom_left handle",x:R(0-I/2),y:R(k-I/2),width:R(I),height:R(I)})]}),nr&&g.jsxs(g.Fragment,{children:[g.jsx("rect",{"data-testid":"selection.text-resize.left.handle",className:"tl-text-handle","aria-label":"bottom_left handle",x:R(0-I/4),y:R(k/2-Pr/2),rx:I/4,width:R(I/2),height:R(Pr)}),g.jsx("rect",{"data-testid":"selection.text-resize.right.handle",className:"tl-text-handle","aria-label":"bottom_left handle",rx:I/4,x:R(_-I/4),y:R(k/2-Pr/2),width:R(I/2),height:R(Pr)})]}),Q&&g.jsx(tJ,{size:I,width:_,height:k,hideAlternateHandles:qe})]})}),Jh=function({cx:e,cy:n,targetSize:r,corner:s,cursor:o,isHidden:i,"data-testid":a}){const c=es(s);return g.jsx("rect",{className:le("tl-transparent","tl-rotate-corner",{"tl-hidden":i}),"data-testid":a,"aria-label":`${s} target`,pointerEvents:"all",x:R(e-r*3),y:R(n-r*3),width:R(Math.max(1,r*3)),height:R(Math.max(1,r*3)),cursor:o,...c})},sJ=Math.sqrt(Math.PI),oJ=function({cx:e,cy:n,size:r,isHidden:s,"data-testid":o}){const i=es("mobile_rotate");return g.jsxs("g",{children:[g.jsx("circle",{"data-testid":o,pointerEvents:"all",className:le("tl-transparent","tl-mobile-rotate__bg",{"tl-hidden":s}),cx:e,cy:n,...i}),g.jsx("circle",{className:le("tl-mobile-rotate__fg",{"tl-hidden":s}),cx:e,cy:n,r:r/sJ})]})};var fv;let iJ=(fv=class extends re{constructor(){super(...arguments);y(this,"onPointerDown",n=>{this.parent.transition("pointing",n)});y(this,"onEnter",()=>{this.editor.updateInstanceState({cursor:{type:"cross",rotation:0}},!0)});y(this,"onCancel",()=>{this.editor.setCurrentTool("select")})}},y(fv,"id","idle"),fv);var pv;let aJ=(pv=class extends re{constructor(){super(...arguments);y(this,"shape");y(this,"markId","");y(this,"onEnter",()=>{this.didTimeout=!1;const n=this.editor.getShapeAtPoint(this.editor.inputs.currentPagePoint,{filter:r=>this.editor.getShapeUtil(r).canBind(r),margin:0,hitInside:!0});n?this.editor.setHintingIds([n.id]):this.createArrowShape(),this.startPreciseTimeout()});y(this,"onExit",()=>{this.shape=void 0,this.editor.setHintingIds([]),this.clearPreciseTimeout()});y(this,"onPointerMove",()=>{if(this.editor.inputs.isDragging){if(this.shape||this.createArrowShape(),!this.shape)throw Error("expected shape");this.updateArrowShapeEndHandle(),this.editor.setCurrentTool("select.dragging_handle",{shape:this.shape,handle:this.editor.getShapeHandles(this.shape).find(n=>n.id==="end"),isCreating:!0,onInteractionEnd:"arrow"})}});y(this,"onPointerUp",()=>{this.cancel()});y(this,"onCancel",()=>{this.cancel()});y(this,"onComplete",()=>{this.cancel()});y(this,"onInterrupt",()=>{this.cancel()});y(this,"preciseTimeout",-1);y(this,"didTimeout",!1)}cancel(){this.shape&&this.editor.bailToMark(this.markId),this.editor.setHintingIds([]),this.parent.transition("idle",{})}createArrowShape(){var l,u;const{originPagePoint:n}=this.editor.inputs,r=Ke();this.markId=this.editor.mark(`creating:${r}`),this.editor.createShapes([{id:r,type:"arrow",x:n.x,y:n.y}]);const s=this.editor.getShape(r);if(!s)throw Error("expected shape");const o=this.editor.getShapeHandles(s);if(!o)throw Error("expected handles for arrow");const i=this.editor.getShapeUtil("arrow"),a=o.find(d=>d.id==="start"),c=(l=i.onHandleChange)==null?void 0:l.call(i,s,{handle:{...a,x:0,y:0},isPrecise:!0});if(c){const d=(u=c.props)==null?void 0:u.start;(d==null?void 0:d.type)==="binding"&&this.editor.setHintingIds([d.boundShapeId]),this.editor.updateShapes([c],!0)}this.shape=this.editor.getShape(r),this.editor.select(r)}updateArrowShapeEndHandle(){var s,o,i;const n=this.shape;if(!n)throw Error("expected shape");const r=this.editor.getShapeHandles(n);if(!r)throw Error("expected handles for arrow");{const a=this.editor.getShapeUtil("arrow"),c=this.editor.getPointInShapeSpace(n,this.editor.inputs.currentPagePoint),l=r.find(d=>d.id==="end"),u=(s=a.onHandleChange)==null?void 0:s.call(a,n,{handle:{...l,x:c.x,y:c.y},isPrecise:!1});if(u){const d=(o=u.props)==null?void 0:o.end;(d==null?void 0:d.type)==="binding"&&this.editor.setHintingIds([d.boundShapeId]),this.editor.updateShapes([u],!0)}}{const a=this.editor.getShapeUtil("arrow"),c=r.find(u=>u.id==="start"),l=(i=a.onHandleChange)==null?void 0:i.call(a,n,{handle:{...c,x:0,y:0},isPrecise:this.didTimeout});l&&this.editor.updateShapes([l],!0)}this.shape=this.editor.getShape(n.id)}startPreciseTimeout(){this.preciseTimeout=window.setTimeout(()=>{this.isActive&&(this.didTimeout=!0)},320)}clearPreciseTimeout(){clearTimeout(this.preciseTimeout)}},y(pv,"id","pointing"),pv);class Hf extends re{constructor(){super(...arguments);y(this,"shapeType","arrow")}}y(Hf,"id","arrow"),y(Hf,"initial","idle"),y(Hf,"children",()=>[iJ,aJ]);const Ft={lineHeight:1.35,fontWeight:"normal",fontVariant:"normal",fontStyle:"normal",padding:"0px",maxWidth:"auto"},Jt={s:2,m:3.5,l:5,xl:10},Bo={s:18,m:24,l:36,xl:44},Ji={s:18,m:22,l:26,xl:32},Mo={s:18,m:20,l:24,xl:28},Vs={draw:"var(--tl-font-draw)",sans:"var(--tl-font-sans)",serif:"var(--tl-font-serif)",mono:"var(--tl-font-mono)"};class Jx extends re{constructor(){super(...arguments);y(this,"info",{});y(this,"initialShape");y(this,"shapeType",this.parent.id==="highlight"?"highlight":"draw");y(this,"util",this.editor.getShapeUtil(this.shapeType));y(this,"isPen",!1);y(this,"segmentMode","free");y(this,"didJustShiftClickToExtendPreviousShapeLine",!1);y(this,"pagePointWhereCurrentSegmentChanged",{});y(this,"pagePointWhereNextSegmentChanged",null);y(this,"lastRecordedPoint",{});y(this,"mergeNextPoint",!1);y(this,"currentLineLength",0);y(this,"canDraw",!1);y(this,"onEnter",n=>{this.info=n,this.canDraw=!this.editor.isMenuOpen,this.lastRecordedPoint=this.editor.inputs.currentPagePoint.clone(),this.canDraw&&this.startShape()});y(this,"onPointerMove",()=>{const{editor:{inputs:n}}=this;this.isPen!==n.isPen&&this.cancel(),!this.canDraw&&n.isDragging&&(this.startShape(),this.canDraw=!0),this.canDraw&&(n.isPen?P.Dist(n.currentPagePoint,this.lastRecordedPoint)>=1/this.editor.zoomLevel?(this.lastRecordedPoint=n.currentPagePoint.clone(),this.mergeNextPoint=!1):this.mergeNextPoint=!0:this.mergeNextPoint=!1,this.updateShapes())});y(this,"onKeyDown",n=>{if(n.key==="Shift")switch(this.segmentMode){case"free":{this.segmentMode="starting_straight",this.pagePointWhereNextSegmentChanged=this.editor.inputs.currentPagePoint.clone();break}case"starting_free":this.segmentMode="starting_straight"}this.updateShapes()});y(this,"onKeyUp",n=>{if(n.key==="Shift")switch(this.editor.snaps.clear(),this.segmentMode){case"straight":{this.segmentMode="starting_free",this.pagePointWhereNextSegmentChanged=this.editor.inputs.currentPagePoint.clone();break}case"starting_straight":{this.pagePointWhereNextSegmentChanged=null,this.segmentMode="free";break}}this.updateShapes()});y(this,"onExit",()=>{this.editor.snaps.clear(),this.pagePointWhereCurrentSegmentChanged=this.editor.inputs.currentPagePoint.clone()});y(this,"onPointerUp",()=>{this.complete()});y(this,"onCancel",()=>{this.cancel()});y(this,"onComplete",()=>{this.complete()});y(this,"onInterrupt",()=>{this.editor.inputs.isDragging||(this.editor.bail(),this.cancel())})}canClose(){return this.shapeType!=="highlight"}getIsClosed(n,r){if(!this.canClose())return!1;const s=Jt[r],o=n[0].points[0],i=n[n.length-1],a=i.points[i.points.length-1];return o!==a&&this.currentLineLength>s*4&&P.Dist(o,a)<s*2}startShape(){const{inputs:{originPagePoint:n,isPen:r}}=this.editor;this.editor.mark("draw create start"),this.isPen=r;const s=this.isPen?this.info.point.z*1.25:.5;if(this.segmentMode=this.editor.inputs.shiftKey?"straight":"free",this.didJustShiftClickToExtendPreviousShapeLine=!1,this.lastRecordedPoint=n.clone(),this.initialShape){const i=this.editor.getShape(this.initialShape.id);if(i&&this.segmentMode==="straight"){this.didJustShiftClickToExtendPreviousShapeLine=!0;const a=Sn(i.props.segments);if(!a)throw Error("Expected a previous segment!");const c=Sn(a.points);if(!c)throw Error("Expected a previous point!");const{x:l,y:u}=this.editor.getPointInShapeSpace(i,n).toFixed(),d=this.isPen?this.info.point.z*1.25:.5,h={type:this.segmentMode,points:[{x:c.x,y:c.y,z:+d.toFixed(2)},{x:l,y:u,z:+d.toFixed(2)}]},f=te.applyToPoint(this.editor.getShapePageTransform(i.id),c);this.pagePointWhereCurrentSegmentChanged=f,this.pagePointWhereNextSegmentChanged=null;const p=[...i.props.segments,h];this.currentLineLength=this.getLineLength(p);const m={id:i.id,type:this.shapeType,props:{segments:p}};this.canClose()&&(m.props.isClosed=this.getIsClosed(p,i.props.size)),this.editor.updateShapes([m]);return}}this.pagePointWhereCurrentSegmentChanged=n.clone();const o=Ke();this.editor.createShapes([{id:o,type:this.shapeType,x:n.x,y:n.y,props:{isPen:this.isPen,segments:[{type:this.segmentMode,points:[{x:0,y:0,z:+s.toFixed(2)}]}]}}]),this.currentLineLength=0,this.initialShape=this.editor.getShape(o)}updateShapes(){const{inputs:n}=this.editor,{initialShape:r}=this;if(!r)return;const{id:s,props:{size:o}}=r,i=this.editor.getShape(s);if(!i)return;const{segments:a}=i.props,{x:c,y:l,z:u}=this.editor.getPointInShapeSpace(i,n.currentPagePoint).toFixed(),d={x:c,y:l,z:this.isPen?+(u*1.25).toFixed(2):.5};switch(this.segmentMode){case"starting_straight":{const{pagePointWhereNextSegmentChanged:h}=this;if(h===null)throw Error("We should have a point where the segment changed");if(P.Dist(h,n.currentPagePoint)>Ju){this.pagePointWhereCurrentSegmentChanged=this.pagePointWhereNextSegmentChanged.clone(),this.pagePointWhereNextSegmentChanged=null,this.segmentMode="straight";const p=Sn(a);if(!p)throw Error("Expected a previous segment!");const m=Sn(p.points);if(!m)throw Error("Expected a previous last point!");let v;const w=this.editor.getPointInShapeSpace(i,this.pagePointWhereCurrentSegmentChanged).toFixed().toJson();if(p.type==="straight"){this.currentLineLength+=P.Dist(m,w),v={type:"straight",points:[{...m},w]};const b=this.editor.getShapePageTransform(i);this.pagePointWhereCurrentSegmentChanged=te.applyToPoint(b,m)}else v={type:"straight",points:[w,d]};const x={id:s,type:this.shapeType,props:{segments:[...a,v]}};this.canClose()&&(x.props.isClosed=this.getIsClosed(a,o)),this.editor.updateShapes([x],!0)}break}case"starting_free":{const{pagePointWhereNextSegmentChanged:h}=this;if(h===null)throw Error("We should have a point where the segment changed");if(P.Dist(h,n.currentPagePoint)>Ju){this.pagePointWhereCurrentSegmentChanged=this.pagePointWhereNextSegmentChanged.clone(),this.pagePointWhereNextSegmentChanged=null,this.segmentMode="free";const p=a.slice(),m=p[p.length-1],v=Sn(m.points);if(!v)throw Error("No previous point!");const w={type:"free",points:[...P.PointsBetween(v,d,6).map(C=>C.toFixed().toJson())]},x=[...p,w];this.currentLineLength=this.getLineLength(x);const b={id:s,type:this.shapeType,props:{segments:x}};this.canClose()&&(b.props.isClosed=this.getIsClosed(x,o)),this.editor.updateShapes([b],!0)}break}case"straight":{const h=a.slice(),f=h[h.length-1],{pagePointWhereCurrentSegmentChanged:p}=this,{currentPagePoint:m,ctrlKey:v}=this.editor.inputs;if(!p)throw Error("We should have a point where the segment changed");let w,x=!1;this.didJustShiftClickToExtendPreviousShapeLine?this.editor.inputs.isDragging&&(x=!v,this.didJustShiftClickToExtendPreviousShapeLine=!1):x=!v;let b=this.editor.getPointInShapeSpace(i,m).toFixed().toJson(),C=!1,E;if((this.editor.user.isSnapMode?!v:v)&&h.length>2){let I,$=8/this.editor.zoomLevel;for(let A=0,D=a.length-2;A<D;A++){const L=a[A];if(!L)break;if(L.type==="free")continue;const j=L.points[0],M=Sn(L.points);if(!(j&&M))continue;const B=P.NearestPointOnLineSegment(j,M,b),U=P.Dist(B,b);if(U<$){I=B.toFixed().toJson(),$=U,E=L;break}}I&&(C=!0,b=I)}if(C&&E){const I=this.editor.getShapePageTransform(i),$=E.points[0],A=Sn(E.points);if(!A)throw Error("Expected a last point!");const D=te.applyToPoint(I,$),L=te.applyToPoint(I,A),j=te.applyToPoint(I,b);this.editor.snaps.setLines([{id:Ze(),type:"points",points:[D,j,L]}])}else{if(this.editor.snaps.clear(),x){const I=P.Angle(p,m),A=eg(I,24)-I;w=P.RotWith(m,p,A)}else w=m;b=this.editor.getPointInShapeSpace(i,w).toFixed().toJson()}this.currentLineLength+=P.Dist(f.points[0],b),h[h.length-1]={...f,type:"straight",points:[f.points[0],b]};const k={id:s,type:this.shapeType,props:{segments:h}};this.canClose()&&(k.props.isClosed=this.getIsClosed(a,o)),this.editor.updateShapes([k],!0);break}case"free":{const h=a.slice(),f=h[h.length-1],p=[...f.points];if(p.length&&this.mergeNextPoint){const{z:v}=p[p.length-1];p[p.length-1]={x:d.x,y:d.y,z:v?Math.max(v,d.z):d.z}}else this.currentLineLength+=P.Dist(p[p.length-1],d),p.push(d);h[h.length-1]={...f,points:p},this.currentLineLength=this.getLineLength(h);const m={id:s,type:this.shapeType,props:{segments:h}};if(this.canClose()&&(m.props.isClosed=this.getIsClosed(h,o)),this.editor.updateShapes([m],!0),p.length>500){this.editor.updateShapes([{id:s,type:this.shapeType,props:{isComplete:!0}}]);const{currentPagePoint:v}=this.editor.inputs,w=Ke();this.editor.createShapes([{id:w,type:this.shapeType,x:tg(v.x),y:tg(v.y),props:{isPen:this.isPen,segments:[{type:"free",points:[{x:0,y:0,z:this.isPen?+(u*1.25).toFixed():.5}]}]}}]),this.initialShape=structuredClone(this.editor.getShape(w)),this.mergeNextPoint=!1,this.lastRecordedPoint=this.editor.inputs.currentPagePoint.clone(),this.currentLineLength=0}break}}}getLineLength(n){let r=0;for(const s of n)for(let o=0;o<s.points.length-1;o++){const i=s.points[o],a=s.points[o+1];r+=P.Sub(a,i).len2()}return Math.sqrt(r)}complete(){if(!this.canDraw){this.cancel();return}const{initialShape:n}=this;n&&(this.editor.updateShapes([{id:n.id,type:n.type,props:{isComplete:!0}}]),this.parent.transition("idle",{}))}cancel(){this.parent.transition("idle",this.info)}}y(Jx,"id","drawing");var gv;let VM=(gv=class extends re{constructor(){super(...arguments);y(this,"onPointerDown",n=>{this.parent.transition("drawing",n)});y(this,"onEnter",()=>{this.editor.updateInstanceState({cursor:{type:"cross",rotation:0}},!0)});y(this,"onCancel",()=>{this.editor.setCurrentTool("select")})}},y(gv,"id","idle"),gv);class Kf extends re{constructor(){super(...arguments);y(this,"shapeType","draw");y(this,"onExit",()=>{const n=this.children.drawing;n.initialShape=void 0})}}y(Kf,"id","draw"),y(Kf,"initial","idle"),y(Kf,"children",()=>[VM,Jx]);class fS extends Nf{constructor(){super(...arguments);y(this,"shapeType","frame")}}y(fS,"id","frame"),y(fS,"initial","idle");var mv;let cJ=(mv=class extends re{constructor(){super(...arguments);y(this,"onPointerDown",n=>{this.parent.transition("pointing",n)});y(this,"onEnter",()=>{this.editor.updateInstanceState({cursor:{type:"cross",rotation:0}},!0)});y(this,"onKeyUp",n=>{if(n.key==="Enter"){const r=this.editor.onlySelectedShape;r&&this.editor.isShapeOfType(r,"geo")&&(this.editor.mark("editing shape"),this.editor.setEditingShapeId(r.id),this.editor.setCurrentTool("select.editing_shape",{...n,target:"shape",shape:r}))}});y(this,"onCancel",()=>{this.editor.setCurrentTool("select")})}},y(mv,"id","idle"),mv);var yv;let lJ=(yv=class extends re{constructor(){super(...arguments);y(this,"markId","");y(this,"onPointerUp",()=>{this.complete()});y(this,"onPointerMove",n=>{if(this.editor.inputs.isDragging){const{originPagePoint:r}=this.editor.inputs,s=Ke();this.markId=`creating:${s}`,this.editor.mark(this.markId),this.editor.createShapes([{id:s,type:"geo",x:r.x,y:r.y,props:{w:1,h:1,geo:this.editor.getStyleForNextShape(cs)}}]).select(s).setCurrentTool("select.resizing",{...n,target:"selection",handle:"bottom_right",isCreating:!0,creationCursorOffset:{x:1,y:1},onInteractionEnd:"geo"})}});y(this,"onCancel",()=>{this.cancel()});y(this,"onComplete",()=>{this.complete()});y(this,"onInterrupt",()=>{this.cancel()})}complete(){const{originPagePoint:n}=this.editor.inputs,r=Ke();this.markId=`creating:${r}`,this.editor.mark(this.markId),this.editor.createShapes([{id:r,type:"geo",x:n.x,y:n.y,props:{geo:this.editor.getStyleForNextShape(cs),w:1,h:1}}]);const s=this.editor.getShape(r);if(!s)return;const o=s.props.geo==="star"?HN(5,200,200):s.props.geo==="cloud"?new ae(0,0,300,180):new ae(0,0,200,200),i=o.center,a=this.editor.getShapeParentTransform(s);a&&i.rot(-a.rotation()),this.editor.select(r),this.editor.updateShapes([{id:s.id,type:"geo",x:s.x-i.x,y:s.y-i.y,props:{geo:this.editor.getStyleForNextShape(cs),w:o.width,h:o.height}}]),this.editor.instanceState.isToolLocked?this.parent.transition("idle",{}):this.editor.setCurrentTool("select",{})}cancel(){this.parent.transition("idle",{})}},y(yv,"id","pointing"),yv);class Vf extends re{constructor(){super(...arguments);y(this,"shapeType","geo")}}y(Vf,"id","geo"),y(Vf,"initial","idle"),y(Vf,"children",()=>[cJ,lJ]);class Wf extends re{constructor(){super(...arguments);y(this,"shapeType","highlight");y(this,"onExit",()=>{const n=this.children.drawing;n.initialShape=void 0})}}y(Wf,"id","highlight"),y(Wf,"initial","idle"),y(Wf,"children",()=>[VM,Jx]);var vv;let uJ=(vv=class extends re{constructor(){super(...arguments);y(this,"shapeId","");y(this,"onEnter",n=>{this.shapeId=n.shapeId,this.editor.updateInstanceState({cursor:{type:"cross",rotation:0}},!0)});y(this,"onPointerDown",()=>{this.parent.transition("pointing",{shapeId:this.shapeId})});y(this,"onCancel",()=>{this.editor.setCurrentTool("select")})}},y(vv,"id","idle"),vv);var wv;let dJ=(wv=class extends re{constructor(){super(...arguments);y(this,"shape",{});y(this,"markId");y(this,"onEnter",n=>{const{inputs:r}=this.editor,{currentPagePoint:s}=r;this.markId=void 0;const o=n.shapeId&&this.editor.getShape(n.shapeId);if(o){if(this.markId=this.editor.mark(`creating:${o.id}`),this.shape=o,r.shiftKey){const i=this.editor.getShapeHandles(this.shape);if(!i)return;const a=i.filter(p=>p.type==="vertex").sort(Qt),c=a[a.length-1],l=te.applyToPoint(this.editor.getShapeParentTransform(this.shape),new P(this.shape.x,this.shape.y));let u,d,h;a.length===2&&a[1].x===1&&a[1].y===1?(u=a[1].index,d=a[1].id,h={...a[1],x:s.x-l.x,y:s.y-l.y}):(u=Ms(c.index),d="handle:"+u,h={x:s.x-l.x,y:s.y-l.y,index:u,canBind:!1,type:"vertex",id:d});const f=ei(this.shape.props.handles);f[h.id]=h,this.editor.updateShapes([{id:this.shape.id,type:this.shape.type,props:{handles:f}}])}}else{const i=Ke();this.markId=this.editor.mark(`creating:${i}`),this.editor.createShapes([{id:i,type:"line",x:s.x,y:s.y}]),this.editor.select(i),this.shape=this.editor.getShape(i)}});y(this,"onPointerMove",()=>{if(this.shape&&this.editor.inputs.isDragging){const n=this.editor.getShapeHandles(this.shape);if(!n)throw this.markId&&this.editor.bailToMark(this.markId),Error("No handles found");this.editor.setCurrentTool("select.dragging_handle",{shape:this.shape,isCreating:!0,handle:Sn(n),onInteractionEnd:"line"})}});y(this,"onPointerUp",()=>{this.complete()});y(this,"onCancel",()=>{this.cancel()});y(this,"onComplete",()=>{this.complete()});y(this,"onInterrupt",()=>{this.parent.transition("idle",{}),this.markId&&this.editor.bailToMark(this.markId),this.editor.snaps.clear()})}complete(){this.parent.transition("idle",{shapeId:this.shape.id}),this.editor.snaps.clear()}cancel(){this.markId&&this.editor.bailToMark(this.markId),this.parent.transition("idle",{shapeId:this.shape.id}),this.editor.snaps.clear()}},y(wv,"id","pointing"),wv);class Gf extends re{constructor(){super(...arguments);y(this,"shapeType","line")}}y(Gf,"id","line"),y(Gf,"initial","idle"),y(Gf,"children",()=>[uJ,dJ]);var Sv;let hJ=(Sv=class extends re{constructor(){super(...arguments);y(this,"onPointerDown",n=>{this.parent.transition("pointing",n)});y(this,"onEnter",()=>{this.editor.updateInstanceState({cursor:{type:"cross",rotation:0}},!0)});y(this,"onCancel",()=>{this.editor.setCurrentTool("select")})}},y(Sv,"id","idle"),Sv);var xv;let fJ=(xv=class extends re{constructor(){super(...arguments);y(this,"dragged",!1);y(this,"info",{});y(this,"wasFocusedOnEnter",!1);y(this,"markId","");y(this,"shape",{});y(this,"onEnter",()=>{this.wasFocusedOnEnter=!this.editor.isMenuOpen,this.wasFocusedOnEnter&&(this.shape=this.createShape())});y(this,"onPointerMove",n=>{this.editor.inputs.isDragging&&(this.wasFocusedOnEnter||(this.shape=this.createShape()),this.editor.setCurrentTool("select.translating",{...n,target:"shape",shape:this.shape,isCreating:!0,editAfterComplete:!0,onInteractionEnd:"note"}))});y(this,"onPointerUp",()=>{this.complete()});y(this,"onInterrupt",()=>{this.cancel()});y(this,"onComplete",()=>{this.complete()});y(this,"onCancel",()=>{this.cancel()})}complete(){this.wasFocusedOnEnter&&(this.editor.instanceState.isToolLocked?this.parent.transition("idle",{}):(this.editor.setEditingShapeId(this.shape.id),this.editor.setCurrentTool("select.editing_shape",{...this.info,target:"shape",shape:this.shape})))}cancel(){this.editor.bailToMark(this.markId),this.parent.transition("idle",this.info)}createShape(){const{inputs:{originPagePoint:n}}=this.editor,r=Ke();this.markId=`creating:${r}`,this.editor.mark(this.markId),this.editor.createShapes([{id:r,type:"note",x:n.x,y:n.y}]).select(r);const s=this.editor.getShape(r),o=this.editor.getShapeGeometry(s).bounds;return this.editor.updateShapes([{id:r,type:"note",x:s.x-o.width/2,y:s.y-o.height/2}]),this.editor.getShape(r)}},y(xv,"id","pointing"),xv);class Yf extends re{constructor(){super(...arguments);y(this,"shapeType","note")}}y(Yf,"id","note"),y(Yf,"initial","idle"),y(Yf,"children",()=>[hJ,fJ]);function eb(t){const e=t.getShapeAtPoint(t.inputs.currentPagePoint,{hitInside:!1,margin:xs/t.zoomLevel});if(!e)return t.setHoveredShapeId(null);let n;const r=t.getOutermostSelectableShape(e);return r===e||r.id===t.focusedGroupId||t.selectedShapeIds.includes(r.id)?n=e:n=r,t.setHoveredShapeId(n.id)}var bv;let pJ=(bv=class extends re{constructor(){super(...arguments);y(this,"onPointerMove",n=>{switch(n.target){case"shape":case"canvas":eb(this.editor)}});y(this,"onPointerDown",n=>{const{hoveredShape:r}=this.editor,s=r&&!this.editor.isShapeOfType(r,"group")?r:this.editor.getShapeAtPoint(this.editor.inputs.currentPagePoint);if(s&&this.editor.isShapeOfType(s,"text")){requestAnimationFrame(()=>{this.editor.setSelectedShapeIds([s.id]),this.editor.setEditingShapeId(s.id),this.editor.setCurrentTool("select.editing_shape",{...n,target:"shape",shape:s})});return}this.parent.transition("pointing",n)});y(this,"onEnter",()=>{this.editor.updateInstanceState({cursor:{type:"cross",rotation:0}},!0)});y(this,"onKeyDown",n=>{if(n.key==="Enter"){const r=this.editor.selectedShapes[0];r&&this.editor.isShapeOfType(r,"geo")&&(this.editor.setCurrentTool("select"),this.editor.setEditingShapeId(r.id),this.editor.root.current.value.transition("editing_shape",{...n,target:"shape",shape:r}))}});y(this,"onCancel",()=>{this.editor.setCurrentTool("select")})}},y(bv,"id","idle"),bv);var Cv;let gJ=(Cv=class extends re{constructor(){super(...arguments);y(this,"shape");y(this,"markId","");y(this,"onExit",()=>{this.editor.setHintingIds([])});y(this,"onPointerMove",n=>{if(this.editor.inputs.isDragging){const{inputs:{originPagePoint:r}}=this.editor,s=Ke();if(this.markId=this.editor.mark(`creating:${s}`),this.editor.createShapes([{id:s,type:"text",x:r.x,y:r.y,props:{text:"",autoSize:!1,w:20}}]),this.editor.select(s),this.shape=this.editor.getShape(s),!this.shape)return;this.editor.setCurrentTool("select.resizing",{...n,target:"selection",handle:"right",isCreating:!0,creationCursorOffset:{x:1,y:1},editAfterComplete:!0,onInteractionEnd:"text"})}});y(this,"onPointerUp",()=>{this.complete()});y(this,"onComplete",()=>{this.cancel()});y(this,"onCancel",()=>{this.cancel()});y(this,"onInterrupt",()=>{this.cancel()})}complete(){var o;this.editor.mark("creating text shape");const n=Ke(),{x:r,y:s}=this.editor.inputs.currentPagePoint;this.editor.createShapes([{id:n,type:"text",x:r,y:s,props:{text:"",autoSize:!0}}]).select(n),this.editor.setEditingShapeId(n),this.editor.setCurrentTool("select"),(o=this.editor.root.current.value)==null||o.transition("editing_shape",{})}cancel(){this.parent.transition("idle",{}),this.editor.bailToMark(this.markId)}},y(Cv,"id","pointing"),Cv);class Xf extends re{constructor(){super(...arguments);y(this,"shapeType","text")}}y(Xf,"id","text"),y(Xf,"initial","idle"),y(Xf,"children",()=>[pJ,gJ]);const mJ=[Xf,Kf,Vf,Yf,Gf,fS,Hf,Wf];function $t(){return An({isDarkMode:mm()})}const mt=Z.memo(function({theme:e,d:n,color:r,fill:s}){switch(s){case"none":return null;case"solid":return g.jsx("path",{fill:e[r].semi,d:n});case"semi":return g.jsx("path",{fill:e.solid,d:n});case"pattern":return g.jsx(yJ,{theme:e,color:r,fill:s,d:n})}}),yJ=function({d:e,color:n,theme:r}){const s=H(),o=Y("zoomLevel",()=>s.zoomLevel,[s]),i=Math.ceil(o),a=s.zoomLevel<=.18;return g.jsxs(g.Fragment,{children:[g.jsx("path",{fill:r[n].pattern,d:e}),g.jsx("path",{fill:a?r[n].semi:`url(#${rg[`${i}_${r.id}`]})`,d:e})]})};function er({d:t,color:e,fill:n,theme:r}){if(n==="none")return;if(n==="pattern"){const o=document.createElementNS("http://www.w3.org/2000/svg","g"),i=document.createElementNS("http://www.w3.org/2000/svg","path");i.setAttribute("d",t),i.setAttribute("fill",r[e].pattern);const a=document.createElementNS("http://www.w3.org/2000/svg","path");return a.setAttribute("d",t),a.setAttribute("fill","url(#hash_pattern)"),o.appendChild(i),o.appendChild(a),o}const s=document.createElementNS("http://www.w3.org/2000/svg","path");switch(s.setAttribute("d",t),n){case"semi":{s.setAttribute("fill",r.solid);break}case"solid":{s.setAttribute("fill",r[e].semi);break}}return s}function Yr(t,e){if(e){const n=document.createElementNS("http://www.w3.org/2000/svg","g");return n.appendChild(e),n.appendChild(t),n}else return t}function vJ(t){return t.replace(/\s/g,"")}function Rm(t,e,n){const{padding:r=0}=n,s=document.createElementNS("http://www.w3.org/2000/svg","text");if(s.setAttribute("font-size",n.fontSize+"px"),s.setAttribute("font-family",n.fontFamily),s.setAttribute("font-style",n.fontStyle),s.setAttribute("font-weight",n.fontWeight),s.setAttribute("line-height",n.lineHeight*n.fontSize+"px"),s.setAttribute("dominant-baseline","mathematical"),s.setAttribute("alignment-baseline","mathematical"),e.length===0)return s;const o=ae.From(e[0].box);for(const{box:l}of e)o.union(l);const i=r+(n.offsetX??0),a=(n.offsetY??0)+n.fontSize/2+(n.verticalTextAlign==="start"?r:n.verticalTextAlign==="end"?n.height-r-o.height:(Math.ceil(n.height)-o.height)/2);let c=null;for(const{text:l,box:u}of e){if(c!==null&&u.y>c){const p=document.createElementNS("http://www.w3.org/2000/svg","tspan");p.setAttribute("alignment-baseline","mathematical"),p.setAttribute("x",i+"px"),p.setAttribute("y",u.y+a+"px"),p.textContent=`
`,s.appendChild(p)}const h=document.createElementNS("http://www.w3.org/2000/svg","tspan");h.setAttribute("alignment-baseline","mathematical"),h.setAttribute("x",u.x+i+"px"),h.setAttribute("y",u.y+a+"px");const f=vJ(l);h.textContent=f,s.appendChild(h),c=u.y}return n.stroke&&n.strokeWidth&&(s.setAttribute("stroke",n.stroke),s.setAttribute("stroke-width",n.strokeWidth+"px")),n.fill&&s.setAttribute("fill",n.fill),s}function Lm(t){return{key:`${ds.id}:${t}`,getElement:async()=>{const e=wJ(t);if(!e)return null;const n=e.$$_url,r=e.$$_fontface;if(!n||!r)return null;const s=await(await fetch(n)).blob(),o=await new Promise((c,l)=>{const u=new FileReader;u.onload=()=>c(u.result),u.onerror=l,u.readAsDataURL(s)}),i=r.replace(n,o),a=document.createElementNS("http://www.w3.org/2000/svg","style");return a.textContent=i,a}}}function wJ(t){const e=Md[t];for(const n of document.fonts)if(e.includes(n.family))return n;return null}function tb(t,e){return{key:`${ds.id}:${t}`,getElement:async()=>{if(t!=="pattern")return null;const n=8/12,r=document.createElement("div");return r.innerHTML=`
				<svg>
					<defs>
						<mask id="hash_pattern_mask">
							<rect x="0" y="0" width="8" height="8" fill="white" />
							<g
								strokeLinecap="round"
								stroke="black"
							>
								<line x1="${n*1}" y1="${n*3}" x2="${n*3}" y2="${n*1}" />
								<line x1="${n*5}" y1="${n*7}" x2="${n*7}" y2="${n*5}" />
								<line x1="${n*9}" y1="${n*11}" x2="${n*11}" y2="${n*9}" />
							</g>
						</mask>
						<pattern
							id="hash_pattern"
							width="8"
							height="8"
							patternUnits="userSpaceOnUse"
						>
							<rect x="0" y="0" width="8" height="8" fill="${e.solid}" mask="url(#hash_pattern_mask)" />
						</pattern>
					</defs>
				</svg>
			`,Array.from(r.querySelectorAll("defs > *"))}}}function nb(){return{key:`${ds.id}:pattern`,component:bJ}}const iu=8,iP=(t,e,n)=>new Promise((r,s)=>{const o=iu*e*t,i=document.createElement("canvas");i.width=o,i.height=o;const a=i.getContext("2d");if(!a)return;a.fillStyle=n?"#212529":"#f8f9fa",a.fillRect(0,0,o,o),a.globalCompositeOperation="destination-out",a.lineCap="round",a.lineWidth=1.25*e*t;const c=8/12,l=u=>u*e*t;a.beginPath(),a.moveTo(l(c*1),l(c*3)),a.lineTo(l(c*3),l(c*1)),a.moveTo(l(c*5),l(c*7)),a.lineTo(l(c*7),l(c*5)),a.moveTo(l(c*9),l(c*11)),a.lineTo(l(c*11),l(c*9)),a.stroke(),i.toBlob(u=>{!u||xt.throwToBlob.value?s():r(u)})}),aP=(t,e)=>{const n=document.createElement("canvas");n.width=t[0],n.height=t[1];const r=n.getContext("2d");return r?(e(r),n.toDataURL()):""},SJ=()=>{const t=[];for(let e=1;e<=Math.ceil(Ro);e++){const n=aP([1,1],s=>{s.fillStyle=Yp.lightMode.black.semi,s.fillRect(0,0,1,1)}),r=aP([1,1],s=>{s.fillStyle=Yp.darkMode.black.semi,s.fillRect(0,0,1,1)});t.push({zoom:e,url:n,darkMode:!1}),t.push({zoom:e,url:r,darkMode:!0})}return t};function xJ(){const e=H().instanceState.devicePixelRatio,[n,r]=S.useState(!1),s=S.useMemo(()=>SJ(),[]),[o,i]=S.useState(s);return S.useEffect(()=>{const c=[];for(let u=1;u<=Math.ceil(Ro);u++)c.push(iP(e,u,!1).then(d=>({zoom:u,url:URL.createObjectURL(d),darkMode:!1}))),c.push(iP(e,u,!0).then(d=>({zoom:u,url:URL.createObjectURL(d),darkMode:!0})));let l=!1;return Promise.all(c).then(u=>{l||(i(u),r(!0))}),()=>{l=!0,r(!1)}},[e]),{defs:g.jsx(g.Fragment,{children:o.map(c=>{const l=c.zoom+(c.darkMode?"_dark":"_light");return g.jsx("pattern",{id:rg[l],width:iu,height:iu,patternUnits:"userSpaceOnUse",children:g.jsx("image",{href:c.url,width:iu,height:iu})},l)})}),isReady:n}}function bJ(){const t=H(),e=S.useRef(null),{defs:n,isReady:r}=xJ();return S.useEffect(()=>{if(r&&t.environment.isSafari){const s=WM(e.current);s&&requestAnimationFrame(()=>{s.style.display="none",requestAnimationFrame(()=>{s.style.display=""})})}},[t,r]),g.jsx("g",{ref:e,children:n})}function WM(t){return t.classList.contains("tl-html-layer")?t:t.parentElement?WM(t.parentElement):null}function tn(t,e,n={}){const{closed:r=!1,snap:s=1,start:o="outset",end:i="outset",lengthRatio:a=2,style:c="dashed"}=n;let l=0,u=0,d=1,h=0,f=0;switch(c){case"dashed":{d=1,l=Math.min(e*a,t/4);break}case"dotted":{d=100,l=e/d;break}default:return{strokeDasharray:"none",strokeDashoffset:"none"}}return r||(o==="outset"?(t+=l/2,f+=l/2):o==="skip"&&(t-=l,f-=l),i==="outset"?t+=l/2:i==="skip"&&(t-=l)),u=Math.floor(t/l/(2*d)),u-=u%s,u<3&&c==="dashed"?t/e<5?(l=t,u=1,h=0):(l=t*.333,h=t*.333):(u=Math.max(u,3),l=t/u/(2*d),r?(f=l/2,h=(t-u*l)/u):h=(t-u*l)/Math.max(1,u-1)),{strokeDasharray:[l,h].join(" "),strokeDashoffset:f.toString()}}const wc="  ",un=class un{static insertTextFirefox(e,n){e.setRangeText(n,e.selectionStart||0,e.selectionEnd||0,"end"),e.dispatchEvent(new InputEvent("input",{data:n,inputType:"insertText",isComposing:!1}))}static insert(e,n){const r=e.ownerDocument,s=r.activeElement;s!==e&&e.focus(),r.execCommand("insertText",!1,n)||un.insertTextFirefox(e,n),s===r.body?e.blur():s instanceof HTMLElement&&s!==e&&s.focus()}static set(e,n){e.select(),un.insert(e,n)}static getSelection(e){const{selectionStart:n,selectionEnd:r}=e;return e.value.slice(n||void 0,r||void 0)}static wrapSelection(e,n,r){const{selectionStart:s,selectionEnd:o}=e,i=un.getSelection(e);un.insert(e,n+i+(r??n)),e.selectionStart=(s||0)+n.length,e.selectionEnd=(o||0)+n.length}static replace(e,n,r){let s=0;e.value.replace(n,(...o)=>{const i=s+o[o.length-2],a=o[0].length;e.selectionStart=i,e.selectionEnd=i+a;const c=typeof r=="string"?r:r(...o);return un.insert(e,c),e.selectionStart=i,s+=c.length-a,c})}static findLineEnd(e,n){const r=e.lastIndexOf(`
`,n-1)+1;return e.charAt(r)!=="	"?n:r+1}static indent(e){var a;const{selectionStart:n,selectionEnd:r,value:s}=e,o=s.slice(n,r),i=(a=/\n/g.exec(o))==null?void 0:a.length;if(i&&i>0){const c=s.lastIndexOf(`
`,n-1)+1,l=e.value.slice(c,r-1),u=l.replace(/^|\n/g,`$&${wc}`),d=u.length-l.length;e.setSelectionRange(c,r-1),un.insert(e,u),e.setSelectionRange(n+1,r+d)}else un.insert(e,wc)}static unindent(e){const{selectionStart:n,selectionEnd:r,value:s}=e,o=s.lastIndexOf(`
`,n-1)+1,i=un.findLineEnd(s,r),a=e.value.slice(o,i),c=a.replace(/(^|\n)(\t| {1,2})/g,"$1"),l=a.length-c.length;e.setSelectionRange(o,i),un.insert(e,c);const u=/\t| {1,2}/.exec(s.slice(o,n)),d=u?u[0].length:0,h=n-d;e.setSelectionRange(n-d,Math.max(h,r-l))}static indentCE(e){var c;const n=window.getSelection(),r=e.innerText,s=ef(e)??0,o=ef(e)??0,i=r.slice(s,o),a=(c=/\n/g.exec(i))==null?void 0:c.length;if(a&&a>0){const l=r.lastIndexOf(`
`,s-1)+1,u=r.slice(l,o-1),h=u.replace(/^|\n/g,`$&${wc}`).length-u.length;n&&n.setBaseAndExtent(e,s+1,e,o+h)}else{const l=window.getSelection();e.innerText=r.slice(0,s)+wc+r.slice(s),l==null||l.setBaseAndExtent(e,s+1,e,s+2)}}static unindentCE(e){const n=window.getSelection(),r=e.innerText,s=ef(e)??0,o=ef(e)??0,i=r.lastIndexOf(`
`,s-1)+1,a=un.findLineEnd(r,o),c=r.slice(i,a),l=c.replace(/(^|\n)(\t| {1,2})/g,"$1"),u=c.length-l.length;if(n){n.setBaseAndExtent(e,i,e,a);const d=/\t| {1,2}/.exec(r.slice(i,s)),h=d?d[0].length:0,f=s-h;n.setBaseAndExtent(e,s-h,e,Math.max(f,o-u))}}static normalizeText(e){return e.replace(un.fixNewLines,`
`)}static normalizeTextForDom(e){return e.replace(un.fixNewLines,`
`).split(`
`).map(n=>n||" ").join(`
`)}};y(un,"fixNewLines",/\r?\n|\r/g);let ea=un;function ef(t){if(typeof window.getSelection>"u")return;const e=window.getSelection();if(!e)return;let n=0;if(e.rangeCount!==0){const r=e.getRangeAt(0),s=r.cloneRange();s.selectNodeContents(t),s.setEnd(r.endContainer,r.endOffset),n=s.toString().length}return n}function rb(t,e,n){const r=H(),s=S.useRef(null),o=Y("isEditing",()=>r.currentPageState.editingShapeId===t,[r,t]),i=Y("isInEditingShapePath",()=>r.isIn("select.editing_shape"),[r]),a=S.useRef(!1),c=S.useRef(),l=Y("is editable hovering",()=>{const{hoveredShapeId:x,editingShapeId:b}=r;if(e==="text"&&r.isIn("text")&&x===t)return!0;if(i){if(!b)return!1;const C=r.getShape(b);return C?(x===t||b!==t)&&C.type===e&&r.getShapeUtil(C).canEdit(C):!1}return!1},[e,t,i]),u=S.useCallback(()=>{l||requestAnimationFrame(()=>{const x=s.current;if(!x)return;const b=r.getShape(t);b&&(x.value=b.props.text,x.value.length&&!a.current&&x.select(),a.current=!1)})},[r,t,l]),d=S.useCallback(()=>{const x=c.current;requestAnimationFrame(()=>{var C;const b=s.current;if(b&&r.isIn("select.editing_shape")){if(r.editingShapeId===t)if(x)if(!x.length)b.focus();else{a.current=!0,b.focus();const E=window.getSelection();E&&x.forEach(_=>E.addRange(_))}else b.focus()}else(C=window.getSelection())==null||C.removeAllRanges(),r.complete()})},[r,t]),h=S.useCallback(x=>{switch((x.ctrlKey||x.metaKey)&&Vn(x),x.key){case"Enter":{(x.ctrlKey||x.metaKey)&&r.complete();break}case"Tab":{je(x),x.shiftKey?ea.unindent(x.currentTarget):ea.indent(x.currentTarget);break}}},[r]),f=S.useCallback(x=>{let b=ea.normalizeText(x.currentTarget.value);const C=b.replace(/\t/g,wc);if(C!==b){const E=x.currentTarget.selectionStart;x.currentTarget.value=C,x.currentTarget.selectionStart=E+(C.length-b.length),x.currentTarget.selectionEnd=E+(C.length-b.length),b=C}r.updateShapes([{id:t,type:e,props:{text:b}}])},[r,t,e]),p=n.trim().length===0;S.useEffect(()=>{if(s.current){let b=function(){var E,_;const C=(E=window.getSelection)==null?void 0:E.call(window);if(C&&C.type!=="None"){const k=[];if(C)for(let I=0;I<C.rangeCount;I++)k.push((_=C.getRangeAt)==null?void 0:_.call(C,I));c.current=k}};return document.addEventListener("selectionchange",b),()=>{document.removeEventListener("selectionchange",b)}}},[]);const m=S.useCallback(x=>{l&&ur(()=>{r.setEditingShapeId(t),r.setHoveredShapeId(t),r.setSelectedShapeIds([t])}),Vn(x)},[r,l,t]),v=S.useCallback(x=>{r.dispatch({...vr(x),type:"pointer",name:"pointer_down",target:"shape",shape:r.getShape(t)}),Vn(x)},[r,t]);return S.useEffect(()=>{const x=s.current;x&&o&&document.activeElement!==x&&x.focus()},[o]),{rInput:s,isEditing:o,isEditableFromHover:l,handleFocus:u,handleBlur:d,handleKeyDown:h,handleChange:f,handleInputPointerDown:m,handleContentPointerDown:v,handleDoubleClick:Vn,isEmpty:p}}const CJ=S.memo(function({id:e,text:n,size:r,font:s,position:o,width:i,labelColor:a}){const{rInput:c,isEditing:l,handleFocus:u,handleBlur:d,handleKeyDown:h,handleChange:f,isEmpty:p,handleInputPointerDown:m,handleContentPointerDown:v}=rb(e,"arrow",n);return!l&&p?null:g.jsx("div",{className:"tl-arrow-label","data-font":s,"data-align":"center","data-hastext":!p,"data-isediting":l,style:{textAlign:"center",fontSize:Mo[r],lineHeight:Mo[r]*Ft.lineHeight+"px",transform:`translate(${o.x}px, ${o.y}px)`,color:a},children:g.jsxs("div",{className:"tl-arrow-label__inner",children:[g.jsx("p",{style:{width:i||"9px"},onPointerDown:v,children:n?ea.normalizeTextForDom(n):" "}),l&&g.jsx("textarea",{ref:c,className:"tl-text tl-text-input",name:"text",tabIndex:-1,autoComplete:"false",autoCapitalize:"false",autoCorrect:"false",autoSave:"false",autoFocus:!0,placeholder:"",spellCheck:"true",wrap:"off",dir:"auto",datatype:"wysiwyg",defaultValue:n,onFocus:u,onChange:f,onKeyDown:h,onBlur:d,onContextMenu:Vn,onPointerDown:m})]})})});let _J=0;class qf extends Hr{constructor(){super(...arguments);y(this,"canEdit",()=>!0);y(this,"canBind",()=>!1);y(this,"canSnap",()=>!1);y(this,"hideResizeHandles",()=>!0);y(this,"hideRotateHandle",()=>!0);y(this,"hideSelectionBoundsBg",()=>!0);y(this,"hideSelectionBoundsFg",()=>!0);y(this,"onHandleChange",(n,{handle:r,isPrecise:s})=>{const o=r.id;if(o==="middle"){const{start:m,end:v}=jr(this.editor,n),w=P.Sub(v,m),x=P.Per(w),b=P.Med(v,m),C=P.Sub(b,x),E=P.Add(b,x),_=P.NearestPointOnLineSegment(C,E,r,!1);let k=P.Dist(_,b);return P.Clockwise(_,v,b)&&(k*=-1),{id:n.id,type:n.type,props:{bend:k}}}const i=kn(n),c=this.editor.getShapePageTransform(i.id).applyToPoint(r);if(this.editor.inputs.ctrlKey)return i.props[o]={type:"point",x:r.x,y:r.y},i;const l=this.editor.getShapePageTransform(n.id).applyToPoint(r),u=this.editor.getShapeAtPoint(l,{filter:m=>this.editor.getShapeUtil(m).canBind(m),hitInside:!0,hitFrameInside:!0,margin:0});if(!u)return i.props[o]={type:"point",x:r.x,y:r.y},i;const d=this.editor.getShapeGeometry(u),h=d.bounds,f=this.editor.getPointInShapeSpace(u,c);let p=s;if(!p){const m=i.props[o];(m.type==="point"||m.type==="binding"&&u.id!==m.boundShapeId)&&(p=this.editor.inputs.pointerVelocity.len()<.5)}if(p&&(p=P.Dist(f,h.center)>Math.max(4,Math.min(Math.min(h.width,h.height)*.15,16))/this.editor.zoomLevel),!s){d.isClosed||(p=!0);const m=i.props[o==="start"?"end":"start"];m.type==="binding"&&u.id===m.boundShapeId&&P.Equals(m.normalizedAnchor,{x:.5,y:.5})&&(p=!0)}return i.props[o]={type:"binding",boundShapeId:u.id,normalizedAnchor:p?{x:(f.x-h.minX)/h.width,y:(f.y-h.minY)/h.height}:{x:.5,y:.5},isExact:this.editor.inputs.altKey},i.props.start.type==="binding"&&i.props.end.type==="binding"&&i.props.start.boundShapeId===i.props.end.boundShapeId&&P.Equals(i.props.start.normalizedAnchor,i.props.end.normalizedAnchor)&&(i.props.end.normalizedAnchor.x+=.05),i});y(this,"onTranslateStart",n=>{const r=n.props.start.type==="binding"?n.props.start.boundShapeId:null,s=n.props.end.type==="binding"?n.props.end.boundShapeId:null,{selectedShapeIds:o}=this.editor;if(r&&(o.includes(r)||this.editor.isAncestorSelected(r))||s&&(o.includes(s)||this.editor.isAncestorSelected(s)))return;const{start:i,end:a}=jr(this.editor,n);return{id:n.id,type:n.type,props:{...n.props,start:{type:"point",x:i.x,y:i.y},end:{type:"point",x:a.x,y:a.y}}}});y(this,"onResize",(n,r)=>{const{scaleX:s,scaleY:o}=r,i=jr(this.editor,n),{start:a,end:c}=kn(n.props);let{bend:l}=n.props;a.type==="point"&&(a.x=i.start.x*s,a.y=i.start.y*o),c.type==="point"&&(c.x=i.end.x*s,c.y=i.end.y*o);const u=Math.abs(s),d=Math.abs(o);return s<0&&o>=0?(l!==0&&(l*=-1,l*=Math.max(u,d)),a.type==="binding"&&(a.normalizedAnchor.x=1-a.normalizedAnchor.x),c.type==="binding"&&(c.normalizedAnchor.x=1-c.normalizedAnchor.x)):s>=0&&o<0?(l!==0&&(l*=-1,l*=Math.max(u,d)),a.type==="binding"&&(a.normalizedAnchor.y=1-a.normalizedAnchor.y),c.type==="binding"&&(c.normalizedAnchor.y=1-c.normalizedAnchor.y)):s>=0&&o>=0?l!==0&&(l*=Math.max(u,d)):s<0&&o<0&&(l!==0&&(l*=Math.max(u,d)),a.type==="binding"&&(a.normalizedAnchor.x=1-a.normalizedAnchor.x,a.normalizedAnchor.y=1-a.normalizedAnchor.y),c.type==="binding"&&(c.normalizedAnchor.x=1-c.normalizedAnchor.x,c.normalizedAnchor.y=1-c.normalizedAnchor.y)),{props:{start:a,end:c,bend:l}}});y(this,"onDoubleClickHandle",(n,r)=>{switch(r.id){case"start":return{id:n.id,type:n.type,props:{...n.props,arrowheadStart:n.props.arrowheadStart==="none"?"arrow":"none"}};case"end":return{id:n.id,type:n.type,props:{...n.props,arrowheadEnd:n.props.arrowheadEnd==="none"?"arrow":"none"}}}});y(this,"onEditEnd",n=>{const{id:r,type:s,props:{text:o}}=n;o.trimEnd()!==n.props.text&&this.editor.updateShapes([{id:r,type:s,props:{text:o.trimEnd()}}])})}getDefaultProps(){return{dash:"draw",size:"m",fill:"none",color:"black",labelColor:"black",bend:0,start:{type:"point",x:0,y:0},end:{type:"point",x:0,y:0},arrowheadStart:"none",arrowheadEnd:"arrow",text:"",font:"draw"}}getGeometry(n){const r=this.editor.getArrowInfo(n),s=r.isStraight?new cg({start:P.From(r.start.point),end:P.From(r.end.point)}):new OH({center:P.Cast(r.handleArc.center),radius:r.handleArc.radius,start:P.Cast(r.start.point),end:P.Cast(r.end.point),sweepFlag:r.bodyArc.sweepFlag,largeArcFlag:r.bodyArc.largeArcFlag});if(!n.props.text.trim())return s;const o=s.bounds,{w:i,h:a}=this.editor.textMeasure.measureText(n.props.text,{...Ft,fontFamily:Vs[n.props.font],fontSize:Mo[n.props.size],width:"fit-content"});let c=i,l=a;if(o.width>o.height){c=Math.max(Math.min(i,64),Math.min(o.width-64,i));const{w:d,h}=this.editor.textMeasure.measureText(n.props.text,{...Ft,fontFamily:Vs[n.props.font],fontSize:Mo[n.props.size],width:c+"px"});c=d,l=h}if(c>16*Mo[n.props.size]){c=16*Mo[n.props.size];const{w:d,h}=this.editor.textMeasure.measureText(n.props.text,{...Ft,fontFamily:Vs[n.props.font],fontSize:Mo[n.props.size],width:c+"px"});c=d,l=h}const u=new Ea({x:r.middle.x-c/2-4.25,y:r.middle.y-l/2-4.25,width:c+8.5,height:l+8.5,isFilled:!0});return new Ki({children:[s,u],operation:"union",isSnappable:!1})}getHandles(n){const r=this.editor.getArrowInfo(n);return[{id:"start",type:"vertex",index:"a0",x:r.start.handle.x,y:r.start.handle.y,canBind:!0},{id:"middle",type:"virtual",index:"a2",x:r.middle.x,y:r.middle.y,canBind:!1},{id:"end",type:"vertex",index:"a3",x:r.end.handle.x,y:r.end.handle.y,canBind:!0}]}component(n){const r=$t(),s=this.editor.onlySelectedShape,o=this.editor.isInAny("select.idle","select.pointing_handle","select.dragging_handle","arrow.dragging")&&!this.editor.instanceState.isReadonly,i=this.editor.getArrowInfo(n),a=this.editor.getShapeGeometry(n).bounds,c=Z.useMemo(()=>this.editor.environment.isSafari?_J+=1:0,[n]);if(!(i!=null&&i.isValid))return null;const l=Jt[n.props.size],u=i.start.arrowhead&&Xa(i,"start",l),d=i.end.arrowhead&&Xa(i,"end",l),h=i.isStraight?t0(i):r0(i);let f=null;if(s===n&&o){const{strokeDasharray:E,strokeDashoffset:_}=tn(i.isStraight?P.Dist(i.start.handle,i.end.handle):Math.abs(i.handleArc.length),2,{end:"skip",start:"skip",lengthRatio:2.5});f=n.props.start.type==="binding"||n.props.end.type==="binding"?g.jsx("path",{className:"tl-arrow-hint",d:i.isStraight?aU(i):cU(i),strokeDasharray:E,strokeDashoffset:_,strokeWidth:2,markerStart:n.props.start.type==="binding"?n.props.start.isExact?"":uP(n.props.start.normalizedAnchor)?"url(#arrowhead-cross)":"url(#arrowhead-dot)":"",markerEnd:n.props.end.type==="binding"?n.props.end.isExact?"":uP(n.props.end.normalizedAnchor)?"url(#arrowhead-cross)":"url(#arrowhead-dot)":"",opacity:.16}):null}const{strokeDasharray:p,strokeDashoffset:m}=tn(i.isStraight?i.length:Math.abs(i.bodyArc.length),l,{style:n.props.dash}),v=n.props.text.trim()?this.editor.getShapeGeometry(n).children[1]:null,w=!(i.start.arrowhead==="none"||i.start.arrowhead==="arrow"),x=!(i.end.arrowhead==="none"||i.end.arrowhead==="arrow"),b=(n.id+"_clip_"+c).replace(":","_");return g.jsxs(g.Fragment,{children:[g.jsxs(zn,{id:n.id,style:{minWidth:50,minHeight:50},children:[g.jsx("defs",{children:g.jsxs("mask",{id:b,children:[g.jsx("rect",{x:R(-100+a.minX),y:R(-100+a.minY),width:R(a.width+200),height:R(a.height+200),fill:"white"}),v&&g.jsx("rect",{x:v.x,y:v.y,width:v.w,height:v.h,fill:"black",rx:4,ry:4}),u&&w&&g.jsx("path",{d:u,fill:i.start.arrowhead==="arrow"?"none":"black",stroke:"none"}),d&&x&&g.jsx("path",{d,fill:i.end.arrowhead==="arrow"?"none":"black",stroke:"none"})]})}),g.jsxs("g",{fill:"none",stroke:r[n.props.color].solid,strokeWidth:l,strokeLinejoin:"round",strokeLinecap:"round",pointerEvents:"none",children:[f,g.jsxs("g",{mask:`url(#${b})`,children:[g.jsx("rect",{x:R(a.minX-100),y:R(a.minY-100),width:R(a.width+200),height:R(a.height+200),opacity:0}),g.jsx("path",{d:h,strokeDasharray:p,strokeDashoffset:m})]}),u&&w&&n.props.fill!=="none"&&g.jsx(mt,{theme:r,d:u,color:n.props.color,fill:n.props.fill}),d&&x&&n.props.fill!=="none"&&g.jsx(mt,{theme:r,d,color:n.props.color,fill:n.props.fill}),u&&g.jsx("path",{d:u}),d&&g.jsx("path",{d})]})]}),g.jsx(CJ,{id:n.id,text:n.props.text,font:n.props.font,size:n.props.size,position:i.middle,width:(v==null?void 0:v.w)??0,labelColor:r[n.props.labelColor].solid})]})}indicator(n){const{start:r,end:s}=jr(this.editor,n),o=this.editor.getArrowInfo(n),i=this.editor.getShapeGeometry(n),a=i.bounds,c=n.props.text.trim()?i.children[1]:null;if(!o||P.Equals(r,s))return null;const l=Jt[n.props.size],u=o.start.arrowhead&&Xa(o,"start",l),d=o.end.arrowhead&&Xa(o,"end",l),h=o.isStraight?t0(o):r0(o),f=u&&o.start.arrowhead!=="arrow"||d&&o.end.arrowhead!=="arrow"||!!c,p=(n.id+"_clip").replace(":","_");return g.jsxs("g",{children:[f&&g.jsx("defs",{children:g.jsxs("mask",{id:p,children:[g.jsx("rect",{x:a.minX-100,y:a.minY-100,width:a.w+200,height:a.h+200,fill:"white"}),c&&g.jsx("rect",{x:R(c.x),y:R(c.y),width:c.w,height:c.h,fill:"black",rx:3.5,ry:3.5}),u&&g.jsx("path",{d:u,fill:o.start.arrowhead==="arrow"?"none":"black",stroke:"none"}),d&&g.jsx("path",{d,fill:o.end.arrowhead==="arrow"?"none":"black",stroke:"none"})]})}),g.jsxs("g",{...f?{mask:`url(#${p})`}:void 0,children:[f&&g.jsx("rect",{x:a.minX-100,y:a.minY-100,width:a.width+200,height:a.height+200,opacity:0}),g.jsx("path",{d:h})]}),u&&g.jsx("path",{d:u}),d&&g.jsx("path",{d}),c&&g.jsx("rect",{x:R(c.x),y:R(c.y),width:c.w,height:c.h,rx:3.5,ry:3.5})]})}toSvg(n,r){const s=An({isDarkMode:this.editor.user.isDarkMode});r.addExportDef(tb(n.props.fill,s));const o=s[n.props.color].solid,i=this.editor.getArrowInfo(n),a=Jt[n.props.size],c=document.createElementNS("http://www.w3.org/2000/svg","g");if(!i)return c;const l=i.start.arrowhead&&Xa(i,"start",a),u=i.end.arrowhead&&Xa(i,"end",a),d=this.editor.getShapeGeometry(n),h=d.bounds,f=n.props.text.trim()?d.children[1]:null,p=(n.id+"_clip").replace(":","_");if(l||u||f){const C=document.createElementNS("http://www.w3.org/2000/svg","defs"),E=document.createElementNS("http://www.w3.org/2000/svg","mask");E.id=p;const _=document.createElementNS("http://www.w3.org/2000/svg","rect");if(_.setAttribute("x",h.minX-100+""),_.setAttribute("y",h.minY-100+""),_.setAttribute("width",h.width+200+""),_.setAttribute("height",h.height+200+""),_.setAttribute("fill","white"),E.appendChild(_),l&&E.appendChild(cP(l,i.start.arrowhead)),u&&E.appendChild(cP(u,i.end.arrowhead)),f){const k=document.createElementNS("http://www.w3.org/2000/svg","rect");k.setAttribute("x",f.x+""),k.setAttribute("y",f.y+""),k.setAttribute("width",f.w+""),k.setAttribute("height",f.h+""),k.setAttribute("fill","black"),E.appendChild(k)}C.appendChild(E),c.appendChild(C)}const m=document.createElementNS("http://www.w3.org/2000/svg","g");m.setAttribute("mask",`url(#${p})`),c.appendChild(m);const v=document.createElementNS("http://www.w3.org/2000/svg","rect");v.setAttribute("x","-100"),v.setAttribute("y","-100"),v.setAttribute("width",h.width+200+""),v.setAttribute("height",h.height+200+""),v.setAttribute("fill","transparent"),v.setAttribute("stroke","none"),m.appendChild(v);const w=EJ(i.isStraight?t0(i):r0(i),o,a),{strokeDasharray:x,strokeDashoffset:b}=tn(i.isStraight?i.length:Math.abs(i.bodyArc.length),a,{style:n.props.dash});if(w.setAttribute("stroke-dasharray",x),w.setAttribute("stroke-dashoffset",b),m.appendChild(w),l&&c.appendChild(lP(l,n.props.color,a,n.props.arrowheadStart==="arrow"?"none":n.props.fill,s)),u&&c.appendChild(lP(u,n.props.color,a,n.props.arrowheadEnd==="arrow"?"none":n.props.fill,s)),f){r.addExportDef(Lm(n.props.font));const C={fontSize:Mo[n.props.size],lineHeight:Ft.lineHeight,fontFamily:Md[n.props.font],padding:0,textAlign:"middle",width:f.w-8,verticalTextAlign:"middle",height:f.h,fontStyle:"normal",fontWeight:"normal",overflow:"wrap"},E=Rm(this.editor,this.editor.textMeasure.measureTextSpans(n.props.text,C),C);E.setAttribute("fill",s[n.props.labelColor].solid),Array.from(E.children).forEach(I=>{const $=parseFloat(I.getAttribute("x")||"0"),A=parseFloat(I.getAttribute("y")||"0");I.setAttribute("x",$+4+f.x+"px"),I.setAttribute("y",A+f.y+"px")});const k=E.cloneNode(!0);k.setAttribute("stroke-width","2"),k.setAttribute("fill",s.background),k.setAttribute("stroke",s.background),c.appendChild(k),c.appendChild(E)}return c}getCanvasSvgDefs(){return[nb()]}}y(qf,"type","arrow"),y(qf,"props",Hj),y(qf,"migrations",Kj);function cP(t,e){const n=document.createElementNS("http://www.w3.org/2000/svg","path");return n.setAttribute("d",t),n.setAttribute("fill",e==="arrow"?"none":"black"),n.setAttribute("stroke","none"),n}function EJ(t,e,n){const r=document.createElementNS("http://www.w3.org/2000/svg","path");return r.setAttribute("d",t),r.setAttribute("fill","none"),r.setAttribute("stroke",e),r.setAttribute("stroke-width",n+""),r}function lP(t,e,n,r,s){const o=document.createElementNS("http://www.w3.org/2000/svg","path");o.setAttribute("d",t),o.setAttribute("fill","none"),o.setAttribute("stroke",s[e].solid),o.setAttribute("stroke-width",n+"");const i=er({d:t,fill:r,color:e,theme:s});if(i){const a=document.createElementNS("http://www.w3.org/2000/svg","g");return a.appendChild(i),a.appendChild(o),a}else return o}function uP(t){return t.x!==.5||t.y!==.5}const PJ=[{offsetX:0,offsetY:2,blur:4,spread:0,color:"#00000029"},{offsetX:0,offsetY:3,blur:6,spread:0,color:"#0000001f"}];function sb(t){return PJ.map(n=>{const{offsetX:r,offsetY:s,blur:o,spread:i,color:a}=n,c=new P(r,s),{x:l,y:u}=c.rot(-t);return`${l}px ${u}px ${o}px ${i}px ${a}`}).join(", ")}const kJ=/[\u0590-\u05FF\u0600-\u06FF\u0750-\u077F\u08A0-\u08FF\uFB50-\uFDFF\uFE70-\uFEFF]/;function IJ(t){return kJ.test(t)}function $J(t){return t.replace(/\t/g,wc)}function TJ(t){const e=t.split(`
`);for(;e[0].trim().length===0;)e.shift();let n=1/0;for(const r of e)if(r.trim().length>0){const s=r.length-r.trimStart().length;n=Math.min(n,s)}return e.map(r=>r.slice(n)).join(`
`)}function AJ(t){return t.replace(/[ \t]+$/gm,"").replace(/\n+$/,"")}function MJ(t){return AJ(TJ($J(t)))}const Su=(t,e)=>t.length<=e?t:t.substring(0,e-3)+"...",dP="data:image/svg+xml,%3Csvg xmlns='http://www.w3.org/2000/svg' width='30' height='30' fill='none'%3E%3Cpath stroke='%23000' stroke-linecap='round' stroke-linejoin='round' stroke-width='2' d='M13 5H7a2 2 0 0 0-2 2v16a2 2 0 0 0 2 2h16a2 2 0 0 0 2-2v-6M19 5h6m0 0v6m0-6L13 17'/%3E%3C/svg%3E";function Wd({url:t,zoomLevel:e}){return g.jsx("a",{className:le("tl-hyperlink-button",{"tl-hyperlink-button__hidden":e<.32}),href:t,target:"_blank",rel:"noopener noreferrer",onPointerDown:Vn,onPointerUp:Vn,title:t,draggable:!1,children:g.jsx("div",{className:"tl-hyperlink-button__icon",style:{mask:`url("${dP}") center 100% / 100% no-repeat`,WebkitMask:`url("${dP}") center 100% / 100% no-repeat`}})})}class Qf extends ul{constructor(){super(...arguments);y(this,"canResize",()=>!1);y(this,"hideSelectionBoundsFg",()=>!0);y(this,"onBeforeCreate",n=>{hP(this.editor,n)});y(this,"onBeforeUpdate",(n,r)=>{if(n.props.url!==r.props.url)if(Ow(r.props.url))hP(this.editor,r);else return{...r,props:{...r.props,url:n.props.url}}})}getDefaultProps(){return{url:"",w:300,h:320,assetId:null}}component(n){const r=n.props.assetId?this.editor.getAsset(n.props.assetId):null,s=this.editor.getShapePageTransform(n).rotation(),o=OJ(n);return g.jsx(Xc,{children:g.jsxs("div",{className:"tl-bookmark__container",style:{boxShadow:sb(s)},children:[g.jsxs("div",{className:"tl-bookmark__image_container",children:[r!=null&&r.props.image?g.jsx("img",{className:"tl-bookmark__image",draggable:!1,src:r==null?void 0:r.props.image,alt:(r==null?void 0:r.props.title)||""}):g.jsx("div",{className:"tl-bookmark__placeholder"}),g.jsx(Wd,{url:n.props.url,zoomLevel:this.editor.zoomLevel})]}),g.jsxs("div",{className:"tl-bookmark__copy_container",children:[(r==null?void 0:r.props.title)&&g.jsx("h2",{className:"tl-bookmark__heading",children:Su((r==null?void 0:r.props.title)||"",54)}),(r==null?void 0:r.props.description)&&g.jsx("p",{className:"tl-bookmark__description",children:Su((r==null?void 0:r.props.description)||"",128)}),g.jsx("a",{className:"tl-bookmark__link",href:n.props.url||"",target:"_blank",rel:"noopener noreferrer",onPointerDown:Vn,onPointerUp:Vn,onClick:Vn,children:Su(o,45)})]})]})})}indicator(n){return g.jsx("rect",{width:R(n.props.w),height:R(n.props.h),rx:"8",ry:"8"})}}y(Qf,"type","bookmark"),y(Qf,"props",Vj),y(Qf,"migrations",Wj);const OJ=t=>{try{const e=new URL(t.props.url),n=e.pathname.replace(/\/*$/,"");return`${e.hostname}${n}`}catch{return t.props.url}};function hP(t,e){const{url:n}=e.props,r=$c.createId(Mf(n));t.getAsset(r)?e.props.assetId!==r&&t.updateShapes([{id:e.id,type:e.type,props:{assetId:r}}]):(t.updateShapes([{id:e.id,type:e.type,props:{assetId:null}}]),DJ(t,e))}const DJ=K1(async(t,e)=>{const{url:n}=e.props,r=await t.getAssetForExternalContent({type:"url",url:n});r&&t.batch(()=>{t.createAssets([r]),t.updateShapes([{id:e.id,type:e.type,props:{assetId:r.id}}])})},500);function ta(t,e=!1){const n=t.length;if(n<2)return"";let r=t[0].point,s=t[1].point;if(n===2)return`M${dr(r)}L${dr(s)}`;let o="";for(let i=2,a=n-1;i<a;i++)r=t[i].point,s=t[i+1].point,o+=hr(r,s);return e?`M${hr(t[0].point,t[1].point)}Q${dr(t[1].point)}${hr(t[1].point,t[2].point)}T${o}${hr(t[n-1].point,t[0].point)}${hr(t[0].point,t[1].point)}Z`:`M${dr(t[0].point)}Q${dr(t[1].point)}${hr(t[1].point,t[2].point)}${t.length>3?"T":""}${o}L${dr(t[n-1].point)}`}function Cg(){const t=H();return Y("zoom",()=>t.zoomLevel<.35,[t])}const GM=t=>t*.65+zN(t*$e/2)*.35,RJ=t=>({size:1+t,thinning:.5,streamline:.62+(1+t)/8*.06,smoothing:.62,easing:en.easeOutSine,simulatePressure:!0}),LJ=t=>({size:1+t*1.2,thinning:.62,streamline:.62,smoothing:.62,simulatePressure:!1,easing:GM}),fP=t=>({size:1+t,thinning:0,streamline:.62+(1+t)/8*.06,smoothing:.62,simulatePressure:!1,easing:en.linear});function YM({strokeWidth:t,showAsComplete:e,isPen:n}){return{size:1+t,thinning:.1,streamline:.5,smoothing:.5,simulatePressure:!n,easing:n?GM:en.easeOutSine,last:e}}function tf(t,e,n,r){return{...r?fP(e):t.dash==="draw"?t.isPen?LJ(e):RJ(e):fP(e),last:t.isComplete||n}}function Wi(t){const e=[];for(const n of t)if(n.type==="free"||n.points.length<2)e.push(...n.points.map(P.Cast));else{const r=Math.max(4,Math.floor(P.Dist(n.points[0],n.points[1])/16));e.push(...P.PointsBetween(n.points[0],n.points[1],r))}return e}function pP(t,e){return{draw:"none",solid:"none",dotted:`0.1 ${e*2}`,dashed:`${e*2} ${e*2}`}[t.props.dash]}class Zf extends Hr{constructor(){super(...arguments);y(this,"hideResizeHandles",n=>A0(n));y(this,"hideRotateHandle",n=>A0(n));y(this,"hideSelectionBoundsFg",n=>A0(n));y(this,"onResize",(n,r)=>{const{scaleX:s,scaleY:o}=r,i=[];for(const a of n.props.segments)i.push({...a,points:a.points.map(({x:c,y:l,z:u})=>({x:tg(s*c),y:tg(o*l),z:u}))});return{props:{segments:i}}})}getDefaultProps(){return{segments:[],color:"black",fill:"none",dash:"draw",size:"m",isComplete:!1,isClosed:!1,isPen:!1}}getGeometry(n){const r=Wi(n.props.segments),s=Jt[n.props.size];if(n.props.segments.length===1){const i=ae.FromPoints(r);if(i.width<s*2&&i.height<s*2)return new RH({x:-s,y:-s,radius:s,isFilled:!0})}const o=Ns(r,tf(n.props,s,!0,!0)).map(i=>i.point);return n.props.isClosed?new Mt({points:o,isFilled:n.props.fill!=="none"}):new wi({points:o})}component(n){var h;const r=$t(),s=Cg(),o=Jt[n.props.size],i=Wi(n.props.segments),a=n.props.isComplete||((h=Sn(n.props.segments))==null?void 0:h.type)==="straight";let c=o;!s&&!n.props.isPen&&n.props.dash==="draw"&&i.length===1&&(c+=Jo(n.id)()*(o/6));const l=tf(n.props,c,a,s),u=Ns(i,l),d=u.length>1?ta(u,n.props.isClosed):T0(i[0],c);if(!s&&n.props.dash==="draw"||u.length<2){ld(u,l);const f=cd(u,l);return g.jsxs(zn,{id:n.id,children:[g.jsx(mt,{theme:r,fill:n.props.isClosed?n.props.fill:"none",color:n.props.color,d}),g.jsx("path",{d:Gc(f,!0),strokeLinecap:"round",fill:r[n.props.color].solid})]})}return g.jsxs(zn,{id:n.id,children:[g.jsx(mt,{theme:r,color:n.props.color,fill:n.props.isClosed?n.props.fill:"none",d}),g.jsx("path",{d,strokeLinecap:"round",fill:"none",stroke:r[n.props.color].solid,strokeWidth:o,strokeDasharray:pP(n,o),strokeDashoffset:"0"})]})}indicator(n){var d;const r=Cg(),s=Jt[n.props.size],o=Wi(n.props.segments);let i=s;!r&&!n.props.isPen&&n.props.dash==="draw"&&o.length===1&&(i+=Jo(n.id)()*(s/6));const a=n.props.isComplete||((d=Sn(n.props.segments))==null?void 0:d.type)==="straight",c=tf(n.props,i,a,!0),l=Ns(o,c),u=l.length>1?ta(l,n.props.isClosed):T0(o[0],i);return g.jsx("path",{d:u})}toSvg(n,r){var m;const s=An({isDarkMode:this.editor.user.isDarkMode});r.addExportDef(tb(n.props.fill,s));const{color:o}=n.props,i=Jt[n.props.size],a=Wi(n.props.segments),c=n.props.isComplete||((m=Sn(n.props.segments))==null?void 0:m.type)==="straight";let l=i;!n.props.isPen&&n.props.dash==="draw"&&a.length===1&&(l+=Jo(n.id)()*(i/6));const u=tf(n.props,l,c,!1),d=Ns(a,u),h=d.length>1?ta(d,n.props.isClosed):T0(a[0],l);let f;if(n.props.dash==="draw"||d.length<2){ld(d,u);const v=cd(d,u),w=document.createElementNS("http://www.w3.org/2000/svg","path");w.setAttribute("d",Gc(v,!0)),w.setAttribute("fill",s[o].solid),w.setAttribute("stroke-linecap","round"),f=w}else{const v=document.createElementNS("http://www.w3.org/2000/svg","path");v.setAttribute("d",h),v.setAttribute("stroke",s[o].solid),v.setAttribute("fill","none"),v.setAttribute("stroke-linecap","round"),v.setAttribute("stroke-width",i.toString()),v.setAttribute("stroke-dasharray",pP(n,i)),v.setAttribute("stroke-dashoffset","0"),f=v}const p=er({fill:n.props.isClosed?n.props.fill:"none",d:h,color:n.props.color,theme:s});if(p){const v=document.createElementNS("http://www.w3.org/2000/svg","g");return v.appendChild(p),v.appendChild(f),v}return f}getCanvasSvgDefs(){return[nb()]}expandSelectionOutlinePx(n){const r=n.props.dash==="draw"?1.6:1;return Jt[n.props.size]*r/2}}y(Zf,"type","draw"),y(Zf,"props",Gj),y(Zf,"migrations",Yj);function T0(t,e){const n=(e+1)*.5;return`M ${t.x} ${t.y} m -${n}, 0 a ${n},${n} 0 1,0 ${n*2},0 a ${n},${n} 0 1,0 -${n*2},0`}function A0(t){return t.props.segments.length===1&&t.props.segments[0].points.length<2}function jJ(t){if(typeof t!="string")throw new TypeError("Expected a string");return t.replace(/[|\\{}()[\]^$+*?.]/g,"\\$&").replace(/-/g,"\\x2d")}function NJ(t){const e=new URL(t).host.replace("www.","");for(const n of Wc)if(XM(n.hostnames,e)){const r=n.fromEmbedUrl(t);if(r)return{definition:n,url:r,embedUrl:t}}}const zJ=t=>t.split("*").map(e=>jJ(e)).join(".+"),XM=(t,e)=>!!t.find(n=>{const r=new RegExp(zJ(n));return e.match(r)});function FJ(t){const e=new URL(t).host.replace("www.","");for(const n of Wc)if(XM(n.hostnames,e)){const r=n.toEmbedUrl(t);if(r)return{definition:n,embedUrl:r,url:t}}}function qM(t){return FJ(t)??NJ(t)}function Rs(t){try{return qM(t)}catch(e){console.error(e)}}function BJ(t,e,n={}){const{newPoint:r,handle:s,scaleX:o,scaleY:i}=e,{minWidth:a=1,maxWidth:c=1/0,minHeight:l=1,maxHeight:u=1/0}=n;let d=t.props.w*o,h=t.props.h*i;const f=new P(0,0);if(d>0){if(d<a){switch(s){case"top_left":case"left":case"bottom_left":{f.x=d-a;break}case"top":case"bottom":{f.x=(d-a)/2;break}default:f.x=0}d=a}}else if(f.x=d,d=-d,d<a){switch(s){case"top_left":case"left":case"bottom_left":{f.x=-d;break}default:f.x=-a}d=a}if(h>0){if(h<l){switch(s){case"top_left":case"top":case"top_right":{f.y=h-l;break}case"right":case"left":{f.y=(h-l)/2;break}default:f.y=0}h=l}}else if(f.y=h,h=-h,h<l){switch(s){case"top_left":case"top":case"top_right":{f.y=-h;break}default:f.y=-l}h=l}const{x:p,y:m}=f.rot(t.rotation).add(r);return{x:p,y:m,props:{w:Math.min(c,d),h:Math.min(u,h)}}}const UJ=t=>Object.entries(t).filter(([e,n])=>n).map(([e])=>e).join(" ");class Jf extends ul{constructor(){super(...arguments);y(this,"hideSelectionBoundsFg",n=>!this.canResize(n));y(this,"canEdit",()=>!0);y(this,"canUnmount",n=>{var r,s;return!!((s=(r=Rs(n.props.url))==null?void 0:r.definition)!=null&&s.canUnmount)});y(this,"canResize",n=>{var r,s;return!!((s=(r=Rs(n.props.url))==null?void 0:r.definition)!=null&&s.doesResize)});y(this,"isAspectRatioLocked",n=>{const r=Rs(n.props.url);return(r==null?void 0:r.definition.isAspectRatioLocked)??!1});y(this,"onResize",(n,r)=>{const s=this.isAspectRatioLocked(n),o=Rs(n.props.url);let i=(o==null?void 0:o.definition.minWidth)??200,a=(o==null?void 0:o.definition.minHeight)??200;if(s){const c=n.props.w/n.props.h;c>1?i*=c:a/=c}return BJ(n,r,{minWidth:i,minHeight:a})})}getDefaultProps(){return{w:300,h:300,url:""}}component(n){const{w:r,h:s,url:o}=n.props,i=gx(n.id),a=S.useMemo(()=>qM(o),[o]),c=Y("is hovering",()=>{const{editingShapeId:h,hoveredShapeId:f}=this.editor.currentPageState;if(h&&f!==h){const p=this.editor.getShape(h);if(p&&this.editor.isShapeOfType(p,"embed"))return!0}return!1},[]),l=this.editor.getShapePageTransform(n).rotation(),u=i||c;if((a==null?void 0:a.definition.type)==="github_gist"){const h=a.url.split("/").pop();if(!h)throw Error("No gist id!");return g.jsx(Xc,{className:"tl-embed-container",id:n.id,children:g.jsx(HJ,{id:h,width:R(r),height:R(s),isInteractive:u,pageRotation:l})})}const d=UJ({...Xj,...(a==null?void 0:a.definition.overridePermissions)??{}});return g.jsx(Xc,{className:"tl-embed-container",id:n.id,children:a!=null&&a.definition?g.jsx("iframe",{className:`tl-embed tl-embed-${n.id}`,sandbox:d,src:a.embedUrl,width:R(r),height:R(s),draggable:!1,frameBorder:"0",referrerPolicy:"no-referrer-when-downgrade",style:{border:0,pointerEvents:u?"auto":"none",zIndex:u?"":"-1",boxShadow:sb(l),borderRadius:(a==null?void 0:a.definition.overrideOutlineRadius)??8,background:a==null?void 0:a.definition.backgroundColor}}):null})}indicator(n){const r=S.useMemo(()=>Rs(n.props.url),[n.props.url]);return g.jsx("rect",{width:R(n.props.w),height:R(n.props.h),rx:(r==null?void 0:r.definition.overrideOutlineRadius)??8,ry:(r==null?void 0:r.definition.overrideOutlineRadius)??8})}}y(Jf,"type","embed"),y(Jf,"props",qj),y(Jf,"migrations",Qj);function HJ({id:t,file:e,isInteractive:n,width:r,height:s,style:o,pageRotation:i}){return g.jsx("iframe",{className:"tl-embed",draggable:!1,width:R(r),height:R(s),frameBorder:"0",scrolling:"no",seamless:!0,referrerPolicy:"no-referrer-when-downgrade",style:{...o,pointerEvents:n?"all":"none",zIndex:n?"":"-1",boxShadow:sb(i)},srcDoc:`
			<html>
				<head>
					<base target="_blank">
				</head>
				<body>
					<script src=${`https://gist.github.com/${t}.js${e?`?file=${e}`:""}`}><\/script>
					<style type="text/css">
						* { margin: 0px; }
						table { height: 100%; background-color: red; }
						.gist { background-color: none; height: 100%;  }
						.gist .gist-file { height: calc(100vh - 2px); padding: 0px; display: grid; grid-template-rows: 1fr auto; }
					</style>
				</body>
			</html>`})}const KJ=S.forwardRef(({id:t,name:e,isEditing:n},r)=>{const s=H(),o=S.useCallback(c=>{c.key==="Enter"&&(c.stopPropagation(),c.currentTarget.blur(),s.setEditingShapeId(null))},[s]),i=S.useCallback(c=>{const l=s.getShape(t);if(!l)return;const u=l.props.name,d=c.currentTarget.value.trim();u!==d&&s.updateShapes([{id:t,type:"frame",props:{name:d}}],!0)},[t,s]),a=S.useCallback(c=>{const l=s.getShape(t);if(!l)return;const u=l.props.name,d=c.currentTarget.value;u!==d&&s.updateShapes([{id:t,type:"frame",props:{name:d}}],!0)},[t,s]);return g.jsxs("div",{className:`tl-frame-label ${n?"tl-frame-label__editing":""}`,children:[g.jsx("input",{className:"tl-frame-name-input",ref:r,style:{display:n?void 0:"none"},value:e,autoFocus:!0,onKeyDown:o,onBlur:i,onChange:a}),QM(e,"Frame")+String.fromCharCode(8203)]})}),VJ=function({id:e,name:n,width:r,height:s}){const o=H(),i=Us(o.getShapePageTransform(e).rotation()),a=gx(e),c=S.useRef(null),l=S.useCallback(p=>{const m=vr(p);o.dispatch({type:"pointer",name:"pointer_down",target:"shape",shape:o.getShape(e),...m}),p.preventDefault()},[o,e]);S.useEffect(()=>{const p=c.current;p&&a&&(p.focus(),p.select(),requestAnimationFrame(()=>{document.activeElement!==p&&(p.focus(),p.select())}))},[c,a]);const d=((i+Math.PI/4)*(2/Math.PI)+4)%4,h=["top","left","bottom","right"][Math.floor(d)];let f;switch(h){case"top":f="";break;case"right":f=`translate(${R(r)}px, 0px) rotate(90deg)`;break;case"bottom":f=`translate(${R(r)}px, ${R(s)}px) rotate(180deg)`;break;case"left":f=`translate(0px, ${R(s)}px) rotate(270deg)`;break}return g.jsx("div",{className:"tl-frame-heading",style:{overflow:a?"visible":"hidden",maxWidth:`calc(var(--tl-zoom) * ${Math.ceil(h==="top"||h==="bottom"?r:s)}px + var(--space-5))`,bottom:Math.ceil(s),transform:`${f} scale(var(--tl-scale)) translateX(calc(-1 * var(--space-3))`},onPointerDown:l,children:g.jsx("div",{className:"tl-frame-heading-hit-area",children:g.jsx(KJ,{ref:c,id:e,name:n,isEditing:a})})})};function QM(t,e){return t.match(/^\s*$/)?e:t}class ep extends ul{constructor(){super(...arguments);y(this,"canBind",()=>!0);y(this,"canEdit",()=>!0);y(this,"canReceiveNewChildrenOfType",(n,r)=>!n.isLocked);y(this,"canDropShapes",(n,r)=>!n.isLocked);y(this,"onDragShapesOver",(n,r)=>r.every(s=>s.parentId===n.id)?{shouldHint:!1}:(this.editor.reparentShapes(r.map(s=>s.id),n.id),{shouldHint:!0}));y(this,"onDragShapesOut",(n,r)=>{const s=this.editor.getShape(n.parentId);s&&this.editor.isShapeOfType(s,"group")?this.editor.reparentShapes(r.map(i=>i.id),s.id):this.editor.reparentShapes(r.map(i=>i.id),this.editor.currentPageId)});y(this,"onResizeEnd",n=>{const r=this.editor.getShapePageBounds(n),s=this.editor.getSortedChildIdsForParent(n.id),o=[];for(const i of s){const a=this.editor.getShapePageBounds(i);r.includes(a)||o.push(i)}o.length>0&&this.editor.reparentShapes(o,this.editor.currentPageId)})}getDefaultProps(){return{w:160*2,h:90*2,name:""}}getGeometry(n){return new Ea({width:n.props.w,height:n.props.h,isFilled:!1})}component(n){const r=this.editor.getShapeGeometry(n).bounds,s=$t();return g.jsxs(g.Fragment,{children:[g.jsx(zn,{children:g.jsx("rect",{className:"tl-frame__body",width:r.width,height:r.height,fill:s.solid,stroke:s.text})}),g.jsx(VJ,{id:n.id,name:n.props.name,width:r.width,height:r.height})]})}toSvg(n){const r=An({isDarkMode:this.editor.user.isDarkMode}),s=document.createElementNS("http://www.w3.org/2000/svg","g"),o=document.createElementNS("http://www.w3.org/2000/svg","rect");o.setAttribute("width",n.props.w.toString()),o.setAttribute("height",n.props.h.toString()),o.setAttribute("fill",r.solid),o.setAttribute("stroke",r.black.solid),o.setAttribute("stroke-width","1"),o.setAttribute("rx","1"),o.setAttribute("ry","1"),s.appendChild(o);const c=((Us(this.editor.getShapePageTransform(n.id).rotation())+Math.PI/4)*(2/Math.PI)+4)%4,l=["top","left","bottom","right"][Math.floor(c)];let u;switch(l){case"top":u="";break;case"right":u=`translate(${R(n.props.w)}px, 0px) rotate(90deg)`;break;case"bottom":u=`translate(${R(n.props.w)}px, ${R(n.props.h)}px) rotate(180deg)`;break;case"left":u=`translate(0px, ${R(n.props.h)}px) rotate(270deg)`;break;default:u=""}const d={fontSize:12,fontFamily:"Inter, sans-serif",textAlign:"start",width:n.props.w,height:32,padding:0,lineHeight:1,fontStyle:"normal",fontWeight:"normal",overflow:"truncate-ellipsis",verticalTextAlign:"middle"},h=this.editor.textMeasure.measureTextSpans(QM(n.props.name,"Frame")+String.fromCharCode(8203),d),f=h[0],p=Sn(h),m=p.box.w+p.box.x-f.box.x,v=Rm(this.editor,h,{offsetY:-d.height-2,...d});v.style.setProperty("transform",u);const w=document.createElementNS("http://www.w3.org/2000/svg","rect");return w.setAttribute("x","-8px"),w.setAttribute("y",-d.height-4+"px"),w.setAttribute("width",m+16+"px"),w.setAttribute("height",`${d.height}px`),w.setAttribute("rx","4px"),w.setAttribute("ry","4px"),w.setAttribute("fill",r.background),s.appendChild(w),s.appendChild(v),s}indicator(n){const r=this.editor.getShapeGeometry(n).bounds;return g.jsx("rect",{width:R(r.width),height:R(r.height),className:"tl-frame-indicator"})}providesBackgroundForChildren(){return!0}}y(ep,"type","frame"),y(ep,"props",Zj),y(ep,"migrations",Jj);function WJ(t,e,n,r){if((t==="start-legacy"||t==="end-legacy")&&n.length!==0){const s=ae.From(n[0].box);for(const{box:o}of n)s.union(o);if(t==="start-legacy")return(r-2*e-s.width)/2;if(t==="end-legacy")return-(r-2*e-s.width)/2}}function GJ(t){return t==="start-legacy"||t==="middle-legacy"||t==="end-legacy"}const ZM=Z.memo(function({id:e,type:n,text:r,size:s,labelColor:o,font:i,align:a,verticalAlign:c,wrap:l}){const{rInput:u,isEmpty:d,isEditing:h,isEditableFromHover:f,handleFocus:p,handleChange:m,handleKeyDown:v,handleBlur:w,handleInputPointerDown:x,handleContentPointerDown:b,handleDoubleClick:C}=rb(e,n,r),E=h||f,_=ea.normalizeTextForDom(r),k=_.trim().length>0,I=GJ(a),$=$t();return!E&&!k?null:g.jsx("div",{className:"tl-text-label","data-font":i,"data-align":a,"data-hastext":!d,"data-isediting":h,"data-textwrap":!!l,style:{justifyContent:a==="middle"||I?"center":a,alignItems:c==="middle"?"center":c},children:g.jsxs("div",{className:"tl-text-label__inner",style:{fontSize:Ji[s],lineHeight:Ji[s]*Ft.lineHeight+"px",minHeight:d?Ji[s]*Ft.lineHeight+32:0,minWidth:d?33:0,color:$[o].solid},children:[g.jsx("div",{className:"tl-text tl-text-content",dir:"ltr",onPointerDown:b,children:_}),E&&g.jsx("textarea",{ref:u,className:"tl-text tl-text-input",name:"text",tabIndex:-1,autoComplete:"false",autoCapitalize:"false",autoCorrect:"false",autoSave:"false",autoFocus:h,placeholder:"",spellCheck:"true",wrap:"off",dir:"auto",datatype:"wysiwyg",defaultValue:r,onFocus:p,onChange:m,onKeyDown:v,onBlur:w,onContextMenu:Vn,onPointerDown:x,onDoubleClick:C})]})})});function JM({bounds:t,editor:e,font:n,shape:r}){const o={fontSize:Ji[r.props.size],fontFamily:n,textAlign:r.props.align,verticalTextAlign:r.props.verticalAlign,width:Math.ceil(t.width),height:Math.ceil(t.height),padding:16,lineHeight:Ft.lineHeight,fontStyle:"normal",fontWeight:"normal",overflow:"wrap",offsetX:0},i=e.textMeasure.measureTextSpans(r.props.text,o),a=WJ(r.props.align,16,i,t.width);return a&&(o.offsetX=a),Rm(e,i,o)}function lt(t){return`${R(t.x)},${R(t.y)} `}function e5(t=""){let e=0,n=0,r=0,s=0;function o(){const i=e^e<<11;return e=n,n=r,r=s,s^=(s>>>19^i^i>>>8)>>>0,s/4294967296*2}for(let i=0;i<t.length+64;i++)e^=t.charCodeAt(i)|0,o();return o}function ud(t){let e="M";const n=t.length;let r,s,o;for(let i=0,a=n;i<a;i+=3)r=t[i],s=t[i+1],o=t[i+2],e+=`${lt(r)}L${lt(s)}Q${lt(o)}`;return e+=`${lt(t[0])}`,e}function dd(t,e,n,r,s){const o=[],i=e5(t);let a=e[0],c;const l=e.length;for(let u=0,d=l*s;u<d;u++){c=P.AddXY(e[(u+1)%l],i()*n,i()*n);const h=P.Sub(c,a),f=P.Len(h),p=P.Div(h,f).mul(Math.min(f/4,r));o.push(P.Add(a,p),P.Add(c,p.neg()),c),a=c}return o}function gP(t,e,n){let r=`M ${lt(e[0])}L`,s=`M ${lt(e[0])}L`,o=`M ${lt(e[0])}L`;const i=n/3,a=n*2,c=e5(t);let l=e[0],u,d=e[0],h;const f=e.length;for(let p=0,m=f-1;p<m;p++){u=P.AddXY(e[p+1],c()*i,c()*i),h=P.AddXY(e[p+1],c(),c()*i);const v=P.Sub(u,l),w=P.Len(v),x=P.Div(v,w).mul(Math.min(w/4,a)),b=P.Add(l,x),C=P.Add(u,x.neg()),E=P.Sub(h,d),_=P.Len(E),k=P.Div(E,_).mul(Math.min(_/4,a)),I=P.Add(d,k),$=P.Add(h,k.neg());p===m-1?(r+=`${lt(b)}L ${lt(u)}`,s+=`${lt(b)}L ${lt(u)}`,o+=`${lt(I)}L ${lt(h)}`):(r+=`${lt(b)}L ${lt(C)}Q ${lt(u)}`,s+=`${lt(b)}L ${lt(C)}Q ${lt(u)}`,o+=`${lt(I)}L ${lt($)}Q ${lt(h)}`,l=u,d=h)}return[r,s+o]}function mP(t,e){const n=Math.min(t,e)/2,r=Math.max(t,e)-n*2;return Math.PI*(n*2)+2*r}function YJ(t,e,n){const r=Math.min(t,e)/2,s=Math.max(t,e)-r*2,i=(Math.PI*(r*2)+2*s)/n,a=t>e?[{type:"straight",start:new P(r,0),delta:new P(1,0)},{type:"arc",center:new P(t-r,r),startAngle:-$e/2},{type:"straight",start:new P(t-r,e),delta:new P(-1,0)},{type:"arc",center:new P(r,r),startAngle:$e/2}]:[{type:"straight",start:new P(t,r),delta:new P(0,1)},{type:"arc",center:new P(r,e-r),startAngle:0},{type:"straight",start:new P(0,e-r),delta:new P(0,-1)},{type:"arc",center:new P(r,r),startAngle:$e}];let c=0;const l=[];for(let u=0;u<n;u++){const d=a[0];d.type==="straight"?l.push(P.Add(d.start,P.Mul(d.delta,c))):l.push(Ao(d.center.x,d.center.y,r,d.startAngle+c/r)),c+=i;let h=d.type==="straight"?s:$e*r;for(;c>h;)c-=h,a.push(a.shift()),h=a[0].type==="straight"?s:$e*r}return l}const XJ=(t,e,n,r,s)=>{switch(t){case"s":return e;case"m":return n;case"l":return r;case"xl":return s}};function Gd(t,e,n,r){const s=Jo(n),o=mP(t,e),i=Math.max(Math.ceil(o/XJ(r,50,70,100,130)),6),a=o/i*.2,c=Math.max(t-a*2,1),l=Math.max(e-a*2,1),u=(t-c)/2,d=(e-l)/2,h=mP(c,l)/i,f=YJ(c,l,i).map(w=>w.addXY(u,d)),p=a*.3,m=f.slice(0);for(let w=0;w<Math.floor(i/2);w++)m[w]=P.AddXY(m[w],s()*p,s()*p),m[i-w-1]=P.AddXY(m[i-w-1],s()*p,s()*p);const v=[];for(let w=0;w<m.length;w++){const x=w===m.length-1?0:w+1,b=m[w],C=m[x],E=f[w],_=f[x],k=P.Average([E,_]),I=P.Angle(E,_)-Math.PI/2,$=P.Dist(E,_),A=h-$,L=P.Dist(b,C)/$,j=(Math.max(u,d)+A)*L,M=P.Add(k,P.FromAngle(I,j));M.x<0?M.x=0:M.x>t&&(M.x=t),M.y<0?M.y=0:M.y>e&&(M.y=e);const B=t5(b,C,M),U=P.Dist(B,b);v.push({leftPoint:b,rightPoint:C,arcPoint:M,center:B,radius:U})}return v}function t5(t,e,n){const r=t.x*(e.y-n.y)-t.y*(e.x-n.x)+e.x*n.y-n.x*e.y,s=(t.x*t.x+t.y*t.y)*(n.y-e.y)+(e.x*e.x+e.y*e.y)*(t.y-n.y)+(n.x*n.x+n.y*n.y)*(e.y-t.y),o=(t.x*t.x+t.y*t.y)*(e.x-n.x)+(e.x*e.x+e.y*e.y)*(n.x-t.x)+(n.x*n.x+n.y*n.y)*(t.x-e.x),i=-s/(2*r),a=-o/(2*r);return!Number.isFinite(i)||!Number.isFinite(a)?P.Average([t,e,n]):new P(i,a)}function qJ(t,e,n,r){const s=[],o=Gd(t,e,n,r);for(const{center:i,radius:a,leftPoint:c,rightPoint:l}of o)s.push(...QJ(c,l,i,a,10));return s}function Yd(t,e,n,r){const s=Gd(t,e,n,r);let o=`M${s[0].leftPoint.x},${s[0].leftPoint.y}`;for(const{rightPoint:i,radius:a}of s)o+=` A${a},${a} 0 0,1 ${i.x},${i.y}`;return o+=" Z",o}function n5(t,e,n,r){const s=Jo(n),o=d=>{const h=r==="s"?.5:r==="m"?.7:r==="l"?.9:1.6;return d+s()*h*2},i=d=>new P(o(d.x),o(d.y)),a=Gd(t,e,n,r);let c=`M${a[0].leftPoint.x},${a[0].leftPoint.y}`,l=i(a[0].leftPoint),u=`M${l.x},${l.y}`;for(const{rightPoint:d,radius:h,arcPoint:f}of a){c+=` A${h},${h} 0 0,1 ${d.x},${d.y}`;const p=i(d),m=i(f),v=t5(l,p,m),w=Math.abs(P.Dist(v,l));u+=` A${w},${w} 0 0,1 ${p.x},${p.y}`,l=p}return c+u+" Z"}function QJ(t,e,n,r,s){const o=[],i=P.Angle(n,t),a=P.Angle(n,e),c=os(i,a);for(let l=0;l<s;l++){const u=l/(s-1),d=i+c*u,h=Ao(n.x,n.y,r,d);o.push(h)}return o}const ZJ=S.memo(function({dash:e,fill:n,color:r,strokeWidth:s,w:o,h:i,id:a,size:c}){const l=$t(),u=Yd(o,i,a,c),d=Gd(o,i,a,c);return g.jsxs(g.Fragment,{children:[g.jsx(mt,{theme:l,d:u,fill:n,color:r}),g.jsx("g",{strokeWidth:s,stroke:l[r].solid,fill:"none",pointerEvents:"all",children:d.map(({leftPoint:h,rightPoint:f,center:p,radius:m},v)=>{const w=Us(Us(P.Angle(p,f))-Us(P.Angle(p,h))),x=m*w,{strokeDasharray:b,strokeDashoffset:C}=tn(x,s,{style:e,start:"outset",end:"outset"});return g.jsx("path",{d:`M${h.x},${h.y}A${m},${m},0,0,1,${f.x},${f.y}`,strokeDasharray:b,strokeDashoffset:C},v)})})]})});function JJ({dash:t,fill:e,color:n,theme:r,strokeWidth:s,w:o,h:i,id:a,size:c}){const l=Yd(o,i,a,c),u=Gd(o,i,a,c),d=document.createElementNS("http://www.w3.org/2000/svg","g");d.setAttribute("stroke-width",s.toString()),d.setAttribute("stroke",r[n].solid),d.setAttribute("fill","none");for(const{leftPoint:f,rightPoint:p,center:m,radius:v}of u){const w=Us(Us(P.Angle(m,p))-Us(P.Angle(m,f))),x=v*w,{strokeDasharray:b,strokeDashoffset:C}=tn(x,s,{style:t,start:"outset",end:"outset"}),E=document.createElementNS("http://www.w3.org/2000/svg","path");E.setAttribute("d",`M${f.x},${f.y}A${v},${v},0,0,1,${p.x},${p.y}`),E.setAttribute("stroke-dasharray",b.toString()),E.setAttribute("stroke-dashoffset",C.toString()),d.appendChild(E)}const h=er({d:l,fill:e,color:n,theme:r});return Yr(d,h)}const eee=S.memo(function({w:e,h:n,strokeWidth:r,dash:s,color:o,fill:i}){const a=$t(),c=e/2,l=n/2,u=Math.max(0,c-r/2),d=Math.max(0,l-r/2),h=Zu(u,d),{strokeDasharray:f,strokeDashoffset:p}=tn(h<64?h*2:h,r,{style:s,snap:4,closed:!0}),m=`M${c-u},${l}a${u},${d},0,1,1,${u*2},0a${u},${d},0,1,1,-${u*2},0`;return g.jsxs(g.Fragment,{children:[g.jsx(mt,{theme:a,d:m,color:o,fill:i}),g.jsx("path",{d:m,strokeWidth:r,width:R(e),height:R(n),fill:"none",stroke:a[o].solid,strokeDasharray:f,strokeDashoffset:p,pointerEvents:"all"})]})});function tee({w:t,h:e,strokeWidth:n,dash:r,color:s,theme:o,fill:i}){const a=t/2,c=e/2,l=Math.max(0,a-n/2),u=Math.max(0,c-n/2),d=Zu(l,u),{strokeDasharray:h,strokeDashoffset:f}=tn(d<64?d*2:d,n,{style:r,snap:4,closed:!0}),p=`M${a-l},${c}a${l},${u},0,1,1,${l*2},0a${l},${u},0,1,1,-${l*2},0`,m=document.createElementNS("http://www.w3.org/2000/svg","path");m.setAttribute("d",p),m.setAttribute("stroke-width",n.toString()),m.setAttribute("width",t.toString()),m.setAttribute("height",e.toString()),m.setAttribute("fill","none"),m.setAttribute("stroke",o[s].solid),m.setAttribute("stroke-dasharray",h),m.setAttribute("stroke-dashoffset",f);const v=er({d:p,fill:i,color:s,theme:o});return Yr(m,v)}function r5(t,e){if(e>t){const r=t/2;return`
    M0,${r}
    a${r},${r},0,1,1,${r*2},0
    L${t},${e-r}
    a${r},${r},0,1,1,-${r*2},0
    Z`}const n=e/2;return`
    M${n},0
    L${t-n},0
    a${n},${n},0,1,1,0,${n*2}
    L${n},${e}
    a${n},${n},0,1,1,0,${-n*2}
    Z`}function s5(t,e){if(t>e){const r=e/2;return Zu(r,r)+(t-r*2)*2}const n=t/2;return Zu(n,n)+(e-n*2)*2}const nee=S.memo(function({w:e,h:n,strokeWidth:r,dash:s,color:o,fill:i}){const a=$t(),c=r5(e,n),l=s5(e,n),{strokeDasharray:u,strokeDashoffset:d}=tn(l<64?l*2:l,r,{style:s,snap:4,start:"outset",end:"outset",closed:!0});return g.jsxs(g.Fragment,{children:[g.jsx(mt,{theme:a,d:c,color:o,fill:i}),g.jsx("path",{d:c,strokeWidth:r,width:R(e),height:R(n),fill:"none",stroke:a[o].solid,strokeDasharray:u,strokeDashoffset:d,pointerEvents:"all"})]})});function yP({w:t,h:e,strokeWidth:n,dash:r,color:s,theme:o,fill:i}){const a=r5(t,e),c=s5(t,e),{strokeDasharray:l,strokeDashoffset:u}=tn(c<64?c*2:c,n,{style:r,snap:4,closed:!0}),d=document.createElementNS("http://www.w3.org/2000/svg","path");d.setAttribute("d",a),d.setAttribute("stroke-width",n.toString()),d.setAttribute("width",t.toString()),d.setAttribute("height",e.toString()),d.setAttribute("fill","none"),d.setAttribute("stroke",o[s].solid),d.setAttribute("stroke-dasharray",l),d.setAttribute("stroke-dashoffset",u);const h=er({d:a,fill:i,color:s,theme:o});return Yr(d,h)}const ree=S.memo(function({dash:e,fill:n,color:r,strokeWidth:s,outline:o,lines:i}){const a=$t(),c="M"+o[0]+"L"+o.slice(1)+"Z";return g.jsxs(g.Fragment,{children:[g.jsx(mt,{theme:a,d:c,fill:n,color:r}),g.jsxs("g",{strokeWidth:s,stroke:a[r].solid,fill:"none",pointerEvents:"all",children:[Array.from(Array(o.length)).map((l,u)=>{const d=o[u],h=o[(u+1)%o.length],f=P.Dist(d,h),{strokeDasharray:p,strokeDashoffset:m}=tn(f,s,{style:e,start:"outset",end:"outset"});return g.jsx("line",{x1:d.x,y1:d.y,x2:h.x,y2:h.y,strokeDasharray:p,strokeDashoffset:m},u)}),i&&i.map(([l,u],d)=>{const h=P.Dist(l,u),{strokeDasharray:f,strokeDashoffset:p}=tn(h,s,{style:e,start:"skip",end:"outset",snap:e==="dotted"?4:void 0});return g.jsx("path",{d:`M${l.x},${l.y}L${u.x},${u.y}`,stroke:a[r].solid,strokeWidth:s,fill:"none",strokeDasharray:f,strokeDashoffset:p},`line_fg_${d}`)})]})]})});function see({dash:t,fill:e,color:n,theme:r,strokeWidth:s,outline:o,lines:i}){const a=document.createElementNS("http://www.w3.org/2000/svg","g");if(a.setAttribute("stroke-width",s.toString()),a.setAttribute("stroke",r[n].solid),a.setAttribute("fill","none"),Array.from(Array(o.length)).forEach((l,u)=>{const d=o[u],h=o[(u+1)%o.length],f=P.Dist(d,h),{strokeDasharray:p,strokeDashoffset:m}=tn(f,s,{style:t}),v=document.createElementNS("http://www.w3.org/2000/svg","line");v.setAttribute("x1",d.x.toString()),v.setAttribute("y1",d.y.toString()),v.setAttribute("x2",h.x.toString()),v.setAttribute("y2",h.y.toString()),v.setAttribute("stroke-dasharray",p.toString()),v.setAttribute("stroke-dashoffset",m.toString()),a.appendChild(v)}),i)for(const[l,u]of i){const d=P.Dist(l,u),{strokeDasharray:h,strokeDashoffset:f}=tn(d,s,{style:t,start:"skip",end:"skip",snap:t==="dotted"?4:2}),p=document.createElementNS("http://www.w3.org/2000/svg","line");p.setAttribute("x1",l.x.toString()),p.setAttribute("y1",l.y.toString()),p.setAttribute("x2",u.x.toString()),p.setAttribute("y2",u.y.toString()),p.setAttribute("stroke-dasharray",h.toString()),p.setAttribute("stroke-dashoffset",f.toString()),a.appendChild(p)}const c=er({d:"M"+o[0]+"L"+o.slice(1)+"Z",fill:e,color:n,theme:r});return Yr(a,c)}const oee=S.memo(function({fill:e,color:n,strokeWidth:r,w:s,h:o,id:i,size:a}){const c=$t(),l=n5(s,o,i,a);return g.jsxs(g.Fragment,{children:[g.jsx(mt,{theme:c,d:l,fill:e,color:n}),g.jsx("path",{d:l,stroke:c[n].solid,strokeWidth:r,fill:"none"})]})});function iee({fill:t,color:e,strokeWidth:n,theme:r,w:s,h:o,id:i,size:a}){const c=n5(s,o,i,a),l=document.createElementNS("http://www.w3.org/2000/svg","path");l.setAttribute("d",c),l.setAttribute("stroke-width",n.toString()),l.setAttribute("stroke",r[e].solid),l.setAttribute("fill","none");const u=er({d:c,fill:t,color:e,theme:r});return Yr(l,u)}S.memo(function({id:e,w:n,h:r,strokeWidth:s,fill:o,color:i}){const a=$t(),c=ob(e,n,r,s),l=a5(e,n,r,s);return g.jsxs(g.Fragment,{children:[g.jsx(mt,{theme:a,d:c,color:i,fill:o}),g.jsx("path",{d:l,fill:a[i].solid,strokeWidth:0,pointerEvents:"all"})]})});function aee({id:t,w:e,h:n,strokeWidth:r,fill:s,color:o,theme:i}){const a=document.createElementNS("http://www.w3.org/2000/svg","path");a.setAttribute("d",a5(t,e,n,r)),a.setAttribute("fill",i[o].solid);const c=er({d:ob(t,e,n,r),fill:s,color:o,theme:i});return Yr(a,c)}function o5(t){return{size:1+t,thinning:.25,end:{taper:t},start:{taper:t},streamline:0,smoothing:1,simulatePressure:!1}}function i5(t,e,n,r){const s=Jo(t),o=e/2,i=n/2,a=Zu(o,i),c=[],l=Oe*s(),u=Oe+Te/2+Math.abs(s())*Te,d=Math.max(16,a/10);for(let h=0;h<d;h++){const f=h/(d-1),p=l+f*u,m=Math.cos(p),v=Math.sin(p);c.push(new P(o*m+e*.5+.05*s(),i*v+n/2+.05*s(),Math.min(1,.5+Math.abs(.5-(s()>0?en.easeInOutSine(f):en.easeInExpo(f)))/2)))}return Ns(c,o5(r))}function a5(t,e,n,r){const s=o5(r);return Gc(cd(ld(i5(t,e,n,r),s),s))}function ob(t,e,n,r){return ta(i5(t,e,n,r))}const cee=S.memo(function({id:e,outline:n,lines:r,fill:s,color:o,strokeWidth:i}){const a=$t(),c=dd(e,n,i/3,i*2,2);let l=ud(c);if(r)for(const[h,f]of r)l+=`M${h.x},${h.y}L${f.x},${f.y}`;const u=dd(e,n,0,i*2,1),d=ud(u);return g.jsxs(g.Fragment,{children:[g.jsx(mt,{d,fill:s,color:o,theme:a}),g.jsx("path",{d:l,stroke:a[o].solid,strokeWidth:i,fill:"none"})]})});function lee({id:t,outline:e,lines:n,fill:r,color:s,theme:o,strokeWidth:i}){const a=dd(t,e,i/3,i*2,2);let c=ud(a);if(n)for(const[f,p]of n)c+=`M${f.x},${f.y}L${p.x},${p.y}`;const l=dd(t,e,0,i*2,1),u=ud(l),d=document.createElementNS("http://www.w3.org/2000/svg","path");d.setAttribute("d",c),d.setAttribute("fill","none"),d.setAttribute("stroke",o[s].solid),d.setAttribute("stroke-width",i.toString());const h=er({d:u,fill:r,color:s,theme:o});return Yr(d,h)}const uee=S.memo(function({fill:e,color:n,strokeWidth:r,w:s,h:o,id:i,size:a}){const c=$t(),l=Yd(s,o,i,a);return g.jsxs(g.Fragment,{children:[g.jsx(mt,{theme:c,d:l,fill:e,color:n}),g.jsx("path",{d:l,stroke:c[n].solid,strokeWidth:r,fill:"none"})]})});function dee({fill:t,color:e,strokeWidth:n,theme:r,w:s,h:o,id:i,size:a}){const c=Yd(s,o,i,a),l=document.createElementNS("http://www.w3.org/2000/svg","path");l.setAttribute("d",c),l.setAttribute("stroke-width",n.toString()),l.setAttribute("stroke",r[e].solid),l.setAttribute("fill","none");const u=er({d:c,fill:t,color:e,theme:r});return Yr(l,u)}const vP=S.memo(function({w:e,h:n,strokeWidth:r,fill:s,color:o}){const i=$t(),a=e/2,c=n/2,l=Math.max(0,a),u=Math.max(0,c),d=`M${a-l},${c}a${l},${u},0,1,1,${l*2},0a${l},${u},0,1,1,-${l*2},0`;return g.jsxs(g.Fragment,{children:[g.jsx(mt,{d,color:o,fill:s,theme:i}),g.jsx("path",{d,stroke:i[o].solid,strokeWidth:r,fill:"none"})]})});function hee({w:t,h:e,strokeWidth:n,fill:r,color:s,theme:o}){const i=t/2,a=e/2,c=Math.max(0,i),l=Math.max(0,a),u=`M${i-c},${a}a${c},${l},0,1,1,${c*2},0a${c},${l},0,1,1,-${c*2},0`,d=document.createElementNS("http://www.w3.org/2000/svg","path");d.setAttribute("d",u),d.setAttribute("stroke-width",n.toString()),d.setAttribute("width",t.toString()),d.setAttribute("height",e.toString()),d.setAttribute("fill","none"),d.setAttribute("stroke",o[s].solid);const h=er({d:u,fill:r,color:s,theme:o});return Yr(d,h)}const wP=S.memo(function({w:e,h:n,strokeWidth:r,fill:s,color:o}){const i=$t(),a=ib(e,n);return g.jsxs(g.Fragment,{children:[g.jsx(mt,{d:a,color:o,fill:s,theme:i}),g.jsx("path",{d:a,stroke:i[o].solid,strokeWidth:r,fill:"none"})]})});function fee({w:t,h:e,strokeWidth:n,fill:r,color:s,theme:o}){const i=ib(t,e),a=document.createElementNS("http://www.w3.org/2000/svg","path");a.setAttribute("d",i),a.setAttribute("stroke-width",n.toString()),a.setAttribute("width",t.toString()),a.setAttribute("height",e.toString()),a.setAttribute("fill","none"),a.setAttribute("stroke",o[s].solid);const c=er({d:i,fill:r,color:s,theme:o});return Yr(a,c)}function ib(t,e){let n;if(e>t){const r=t/2;n=`
    M0,${r}
    a${r},${r},0,1,1,${r*2},0
    L${t},${e-r}
    a${r},${r},0,1,1,-${r*2},0
    Z`}else{const r=e/2;n=`
    M${r},0
    L${t-r},0
    a${r},${r},0,1,1,0,${r*2}
    L${r},${e}
    a${r},${r},0,1,1,0,${-r*2}
    Z`}return n}const pee=S.memo(function({outline:e,lines:n,fill:r,color:s,strokeWidth:o}){const i=$t();let a="M"+e[0]+"L"+e.slice(1)+"Z";if(n)for(const[c,l]of n)a+=`M${c.x},${c.y}L${l.x},${l.y}`;return g.jsxs(g.Fragment,{children:[g.jsx(mt,{d:a,fill:r,color:s,theme:i}),g.jsx("path",{d:a,stroke:i[s].solid,strokeWidth:o,fill:"none"})]})});function gee({outline:t,lines:e,fill:n,color:r,strokeWidth:s,theme:o}){const i="M"+t[0]+"L"+t.slice(1)+"Z",a=i;let c=i;if(e)for(const[d,h]of e)c+=`M${d.x},${d.y}L${h.x},${h.y}`;const l=document.createElementNS("http://www.w3.org/2000/svg","path");l.setAttribute("d",c),l.setAttribute("stroke-width",s.toString()),l.setAttribute("stroke",o[r].solid),l.setAttribute("fill","none");const u=er({d:a,fill:n,color:r,theme:o});return Yr(l,u)}const M0=16,or=17*3;class tp extends ul{constructor(){super(...arguments);y(this,"canEdit",()=>!0);y(this,"onEditEnd",n=>{const{id:r,type:s,props:{text:o}}=n;o.trimEnd()!==n.props.text&&this.editor.updateShapes([{id:r,type:s,props:{text:o.trimEnd()}}])});y(this,"onResize",(n,{initialBounds:r,handle:s,newPoint:o,scaleX:i,scaleY:a})=>{let c=r.width*i,l=r.height*a,u=0,d=0;if(n.props.text.trim()){let m=Math.max(Math.abs(c),or),v=Math.max(Math.abs(l),or);m<or&&v===or&&(m=or),m===or&&v<or&&(v=or);const w=O0(this.editor,{...n,props:{...n.props,w:m,h:v}}),x=Math.max(Math.abs(c),w.w)*Math.sign(c),b=Math.max(Math.abs(l),w.h)*Math.sign(l);u=Math.abs(x)-Math.abs(c),d=Math.abs(b)-Math.abs(l),c=x,l=b}const h=new P(0,0);i<0&&(h.x+=c),(s==="left"||s==="top_left"||s==="bottom_left")&&(h.x+=i<0?u:-u),a<0&&(h.y+=l),(s==="top"||s==="top_left"||s==="top_right")&&(h.y+=a<0?d:-d);const{x:f,y:p}=h.rot(n.rotation).add(o);return{x:f,y:p,props:{w:Math.max(Math.abs(c),1),h:Math.max(Math.abs(l),1),growY:0}}});y(this,"onBeforeCreate",n=>{if(!n.props.text)return n.props.growY?{...n,props:{...n.props,growY:0}}:void 0;const r=n.props.h,s=O0(this.editor,n).h;let o=null;if(s>r?o=s-r:n.props.growY&&(o=0),o!==null)return{...n,props:{...n.props,growY:o}}});y(this,"onBeforeUpdate",(n,r)=>{const s=n.props.text.trimEnd(),o=r.props.text.trimEnd();if(s===o&&n.props.font===r.props.font&&n.props.size===r.props.size)return;if(s&&!o)return{...r,props:{...r.props,growY:0}};const i=n.props.w,a=n.props.h,c=O0(this.editor,r),l=c.w,u=c.h;if(!s&&o&&o.length===1){let h=Math.max(i,l),f=Math.max(a,u);return n.props.w<or&&n.props.h<or&&(h=Math.max(h,or),f=Math.max(f,or),h=Math.max(h,f),f=Math.max(h,f)),{...r,props:{...r.props,w:h,h:f,growY:0}}}let d=null;if(u>a?d=u-a:n.props.growY&&(d=0),d!==null)return{...r,props:{...r.props,growY:d,w:Math.max(r.props.w,l)}};if(l>n.props.w)return{...r,props:{...r.props,w:l}}});y(this,"onDoubleClick",n=>{if(this.editor.inputs.altKey)switch(n.props.geo){case"rectangle":return{...n,props:{geo:"check-box"}};case"check-box":return{...n,props:{geo:"rectangle"}}}})}getDefaultProps(){return{w:100,h:100,geo:"rectangle",color:"black",labelColor:"black",fill:"none",dash:"draw",size:"m",font:"draw",text:"",align:"middle",verticalAlign:"middle",growY:0,url:""}}getGeometry(n){const r=Math.max(1,n.props.w),s=Math.max(1,n.props.h+n.props.growY),o=r/2,i=s/2,a=Jt[n.props.size],c=n.props.fill!=="none";let l;switch(n.props.geo){case"cloud":{l=new Mt({points:qJ(r,s,n.id,n.props.size),isFilled:c});break}case"triangle":{l=new Mt({points:[new P(o,0),new P(r,s),new P(0,s)],isFilled:c});break}case"diamond":{l=new Mt({points:[new P(o,0),new P(r,i),new P(o,s),new P(0,i)],isFilled:c});break}case"pentagon":{l=new Mt({points:Wy(r,s,5),isFilled:c});break}case"hexagon":{l=new Mt({points:Wy(r,s,6),isFilled:c});break}case"octagon":{l=new Mt({points:Wy(r,s,8),isFilled:c});break}case"ellipse":{l=new U3({width:r,height:s,isFilled:c});break}case"oval":{l=new jH({width:r,height:s,isFilled:c});break}case"star":{const f=Oe/5/2,p=Math.floor(5/4)*2,m=5*2-p,v=0,w=Math.floor(5/2)*2,x=Math.cos(-Te+p*f)*r/2,b=Math.cos(-Te+m*f)*r/2,C=Math.sin(-Te+v*f)*s/2,E=Math.sin(-Te+w*f)*s/2,_=r-Math.abs(x-b),k=s-Math.abs(E-C),I=r/2+b-(r/2-x),$=s/2+C-(s/2-E),A=1,D=(r-I)/2,L=(s-$)/2,j=(r+_)/2,M=(s+k)/2,B=j*A/2,U=M*A/2;l=new Mt({points:Array.from(Array(5*2)).map((q,N)=>{const F=-Te+N*f;return new P(D+(N%2?B:j)*Math.cos(F),L+(N%2?U:M)*Math.sin(F))}),isFilled:c});break}case"rhombus":{const h=Math.min(r*.38,s*.38);l=new Mt({points:[new P(h,0),new P(r,0),new P(r-h,s),new P(0,s)],isFilled:c});break}case"rhombus-2":{const h=Math.min(r*.38,s*.38);l=new Mt({points:[new P(0,0),new P(r-h,0),new P(r,s),new P(h,s)],isFilled:c});break}case"trapezoid":{const h=Math.min(r*.38,s*.38);l=new Mt({points:[new P(h,0),new P(r-h,0),new P(r,s),new P(0,s)],isFilled:c});break}case"arrow-right":{const h=Math.min(r,s)*.38,f=s*.16;l=new Mt({points:[new P(0,f),new P(r-h,f),new P(r-h,0),new P(r,s/2),new P(r-h,s),new P(r-h,s-f),new P(0,s-f)],isFilled:c});break}case"arrow-left":{const h=Math.min(r,s)*.38,f=s*.16;l=new Mt({points:[new P(h,0),new P(h,f),new P(r,f),new P(r,s-f),new P(h,s-f),new P(h,s),new P(0,s/2)],isFilled:c});break}case"arrow-up":{const h=r*.16,f=Math.min(r,s)*.38;l=new Mt({points:[new P(r/2,0),new P(r,f),new P(r-h,f),new P(r-h,s),new P(h,s),new P(h,f),new P(0,f)],isFilled:c});break}case"arrow-down":{const h=r*.16,f=Math.min(r,s)*.38;l=new Mt({points:[new P(h,0),new P(r-h,0),new P(r-h,s-f),new P(r,s-f),new P(r/2,s),new P(0,s-f),new P(h,s-f)],isFilled:c});break}case"check-box":case"x-box":case"rectangle":{l=new Ea({width:r,height:s,isFilled:c,isSnappable:!0});break}}const u=nf(n.props,a),d=u?u.map(h=>new wi({points:h})):[];return new Ki({children:[l,...d],operation:"union",isSnappable:!1})}component(n){const{id:r,type:s,props:o}=n,i=Jt[o.size],{w:a,color:c,labelColor:l,fill:u,dash:d,growY:h,font:f,align:p,verticalAlign:m,size:v,text:w}=o,x=()=>{const b=o.h+h;switch(o.geo){case"cloud":{if(d==="solid")return g.jsx(uee,{color:c,fill:u,strokeWidth:i,w:a,h:b,id:r,size:v});if(d==="dashed"||d==="dotted")return g.jsx(ZJ,{color:c,fill:u,strokeWidth:i,w:a,h:b,id:r,size:v,dash:d});if(d==="draw")return g.jsx(oee,{color:c,fill:u,strokeWidth:i,w:a,h:b,id:r,size:v});break}case"ellipse":{if(d==="solid")return g.jsx(vP,{strokeWidth:i,w:a,h:b,color:c,fill:u});if(d==="dashed"||d==="dotted")return g.jsx(eee,{id:r,strokeWidth:i,w:a,h:b,dash:d,color:c,fill:u});if(d==="draw")return g.jsx(vP,{strokeWidth:i,w:a,h:b,color:c,fill:u});break}case"oval":{if(d==="solid")return g.jsx(wP,{strokeWidth:i,w:a,h:b,color:c,fill:u});if(d==="dashed"||d==="dotted")return g.jsx(nee,{id:r,strokeWidth:i,w:a,h:b,dash:d,color:c,fill:u});if(d==="draw")return g.jsx(wP,{strokeWidth:i,w:a,h:b,color:c,fill:u});break}default:{const C=this.editor.getShapeGeometry(n),E=C instanceof Ki?C.children[0].vertices:C.vertices,_=nf(n.props,i);if(d==="solid")return g.jsx(pee,{fill:u,color:c,strokeWidth:i,outline:E,lines:_});if(d==="dashed"||d==="dotted")return g.jsx(ree,{dash:d,fill:u,color:c,strokeWidth:i,outline:E,lines:_});if(d==="draw")return g.jsx(cee,{id:r,fill:u,color:c,strokeWidth:i,outline:E,lines:_})}}};return g.jsxs(g.Fragment,{children:[g.jsx(zn,{id:r,children:x()}),g.jsx(ZM,{id:r,type:s,font:f,fill:u,size:v,align:p,verticalAlign:m,text:w,labelColor:l,wrap:!0}),n.props.url&&g.jsx(Wd,{url:n.props.url,zoomLevel:this.editor.zoomLevel})]})}indicator(n){const{id:r,props:s}=n,{w:o,size:i}=s,a=s.h+s.growY,c=Jt[i];switch(s.geo){case"ellipse":return s.dash==="draw"?g.jsx("path",{d:ob(r,o,a,c)}):g.jsx("ellipse",{cx:o/2,cy:a/2,rx:o/2,ry:a/2});case"oval":return g.jsx("path",{d:ib(o,a)});case"cloud":return g.jsx("path",{d:Yd(o,a,r,i)});default:{const l=this.editor.getShapeGeometry(n),u=l instanceof Ki?l.children[0].vertices:l.vertices;let d;if(s.dash==="draw"){const f=dd(r,u,0,c*2,1);d=ud(f)}else d="M"+u[0]+"L"+u.slice(1)+"Z";const h=nf(n.props,c);if(h)for(const[f,p]of h)d+=`M${f.x},${f.y}L${p.x},${p.y}`;return g.jsx("path",{d})}}}toSvg(n,r){const{id:s,props:o}=n,i=Jt[o.size],a=An({isDarkMode:this.editor.user.isDarkMode});r.addExportDef(tb(n.props.fill,a));let c;switch(o.geo){case"ellipse":{switch(o.dash){case"draw":c=aee({id:s,w:o.w,h:o.h,color:o.color,fill:o.fill,strokeWidth:i,theme:a});break;case"solid":c=hee({strokeWidth:i,w:o.w,h:o.h,color:o.color,fill:o.fill,theme:a});break;default:c=tee({id:s,strokeWidth:i,w:o.w,h:o.h,dash:o.dash,color:o.color,fill:o.fill,theme:a});break}break}case"oval":{switch(o.dash){case"draw":c=yP({id:s,strokeWidth:i,w:o.w,h:o.h,dash:o.dash,color:o.color,fill:o.fill,theme:a});break;case"solid":c=fee({strokeWidth:i,w:o.w,h:o.h,color:o.color,fill:o.fill,theme:a});break;default:c=yP({id:s,strokeWidth:i,w:o.w,h:o.h,dash:o.dash,color:o.color,fill:o.fill,theme:a})}break}case"cloud":{switch(o.dash){case"draw":c=iee({id:s,strokeWidth:i,w:o.w,h:o.h,color:o.color,fill:o.fill,size:o.size,theme:a});break;case"solid":c=dee({strokeWidth:i,w:o.w,h:o.h,color:o.color,fill:o.fill,size:o.size,id:s,theme:a});break;default:c=JJ({id:s,strokeWidth:i,w:o.w,h:o.h,dash:o.dash,color:o.color,fill:o.fill,theme:a,size:o.size})}break}default:{const l=this.editor.getShapeGeometry(n),u=l instanceof Ki?l.children[0].vertices:l.vertices,d=nf(n.props,i);switch(o.dash){case"draw":c=lee({id:s,fill:o.fill,color:o.color,strokeWidth:i,outline:u,lines:d,theme:a});break;case"solid":c=gee({fill:o.fill,color:o.color,strokeWidth:i,outline:u,lines:d,theme:a});break;default:c=see({dash:o.dash,fill:o.fill,color:o.color,strokeWidth:i,outline:u,lines:d,theme:a});break}break}}if(o.text){const l=this.editor.getShapeGeometry(n).bounds;r.addExportDef(Lm(n.props.font));const u=JM({editor:this.editor,shape:n,font:Md[n.props.font],bounds:l}),d=u.cloneNode(!0);d.setAttribute("fill",a[n.props.labelColor].solid),d.setAttribute("stroke","none");const h=u.cloneNode(!0);h.setAttribute("stroke-width","2"),h.setAttribute("fill",a.background),h.setAttribute("stroke",a.background);const f=document.createElementNS("http://www.w3.org/2000/svg","g");if(f.append(h),f.append(d),c.nodeName==="g")return c.appendChild(f),c;{const p=document.createElementNS("http://www.w3.org/2000/svg","g");return p.appendChild(c),p.appendChild(f),p}}return c}getCanvasSvgDefs(){return[nb()]}}y(tp,"type","geo"),y(tp,"props",eN),y(tp,"migrations",tN);function O0(t,e){const n=e.props.text.trimEnd();if(!n)return{w:0,h:0};const r=t.textMeasure.measureText("w",{...Ft,fontFamily:Vs[e.props.font],fontSize:Ji[e.props.size],width:"fit-content",maxWidth:"100px"}),s={s:2,m:3.5,l:5,xl:10},o=t.textMeasure.measureText(n,{...Ft,fontFamily:Vs[e.props.font],fontSize:Ji[e.props.size],width:"fit-content",minWidth:r.w+"px",maxWidth:Math.max(0,Math.ceil(r.w+s[e.props.size]),Math.ceil(e.props.w-M0*2))+"px"});return{w:o.w+M0*2,h:o.h+M0*2}}function nf(t,e){switch(t.geo){case"x-box":return mee(t.w,t.h,e,t.dash);case"check-box":return yee(t.w,t.h);default:return}}function mee(t,e,n,r){const s=r==="draw"?.62:0;return r==="dashed"?[[new P(0,0),new P(t/2,e/2)],[new P(t,e),new P(t/2,e/2)],[new P(0,e),new P(t/2,e/2)],[new P(t,0),new P(t/2,e/2)]]:[[new P(n*s,n*s),new P(t-n*s,e-n*s)],[new P(n*s,e-n*s),new P(t-n*s,n*s)]]}function yee(t,e){const n=Math.min(t,e)*.82,r=(t-n)/2,s=(e-n)/2;return[[new P(r+n*.25,s+n*.52),new P(r+n*.45,s+n*.82)],[new P(r+n*.45,s+n*.82),new P(r+n*.82,s+n*.22)]]}function vee(){const[t,e]=S.useState(!1);return S.useEffect(()=>{const r=CSS.supports("color","color(display-p3 1 1 1)"),s=matchMedia("(color-gamut: p3)");e(r&&s.matches);const o=()=>e(r&&s.matches);return s.addEventListener("change",o),()=>s.removeEventListener("change",o)},[]),Y(xt.forceSrgb)||!t?"srgb":"p3"}const SP=.35,xP=.82;class np extends Hr{constructor(){super(...arguments);y(this,"hideResizeHandles",n=>D0(n));y(this,"hideRotateHandle",n=>D0(n));y(this,"hideSelectionBoundsFg",n=>D0(n));y(this,"onResize",(n,r)=>{const{scaleX:s,scaleY:o}=r,i=[];for(const a of n.props.segments)i.push({...a,points:a.points.map(({x:c,y:l,z:u})=>({x:s*c,y:o*l,z:u}))});return{props:{segments:i}}})}getDefaultProps(){return{segments:[],color:"black",size:"m",isComplete:!1,isPen:!1}}getGeometry(n){return new wi({points:Wi(n.props.segments)})}component(n){return g.jsx(bP,{strokeWidth:ec(n),shape:n,opacity:SP})}backgroundComponent(n){return g.jsx(bP,{strokeWidth:ec(n),shape:n,opacity:xP})}indicator(n){var d;const r=Cg(),s=ec(n),o=Wi(n.props.segments);let i=s;!r&&!n.props.isPen&&o.length===1&&(i+=Jo(n.id)()*(s/6));const a=n.props.isComplete||((d=Sn(n.props.segments))==null?void 0:d.type)==="straight",c=YM({strokeWidth:s,showAsComplete:a,isPen:n.props.isPen}),l=Ns(o,c);let u;return l.length<2?u=See(o[0],i):u=ta(l,!1),g.jsx("path",{d:u})}expandSelectionOutlinePx(n){return ec(n)/2}toSvg(n){const r=An({isDarkMode:this.editor.user.isDarkMode});return CP(ec(n),n,SP,r)}toBackgroundSvg(n){const r=An({isDarkMode:this.editor.user.isDarkMode});return CP(ec(n),n,xP,r)}}y(np,"type","highlight"),y(np,"props",sN),y(np,"migrations",oN);function wee(t){return`M ${t.x} ${t.y} m -${.1}, 0 a ${.1},${.1} 0 1,0 ${.1*2},0 a ${.1},${.1} 0 1,0 -${.1*2},0`}function See(t,e){const n=e/2;return`M ${t.x} ${t.y} m -${n}, 0 a ${n},${n} 0 1,0 ${n*2},0 a ${n},${n} 0 1,0 -${n*2},0`}function c5(t,e,n){var l;const r=Wi(t.props.segments),s=t.props.isComplete||((l=Sn(t.props.segments))==null?void 0:l.type)==="straight";let o=e;!n&&!t.props.isPen&&r.length===1&&(o+=Jo(t.id)()*(e/6));const i=YM({strokeWidth:o,showAsComplete:s,isPen:t.props.isPen}),a=Ns(r,i);return{solidStrokePath:a.length>1?ta(a,!1):wee(r[0]),sw:o}}function bP({strokeWidth:t,shape:e,opacity:n}){const r=$t(),s=Cg(),{solidStrokePath:o,sw:i}=c5(e,t,s),a=vee(),c=r[e.props.color].highlight[a];return g.jsx(zn,{id:e.id,style:{opacity:n},children:g.jsx("path",{d:o,strokeLinecap:"round",fill:"none",pointerEvents:"all",stroke:c,strokeWidth:i})})}function CP(t,e,n,r){const{solidStrokePath:s,sw:o}=c5(e,t,!1),i=document.createElementNS("http://www.w3.org/2000/svg","path");return i.setAttribute("d",s),i.setAttribute("fill","none"),i.setAttribute("stroke",r[e.props.color].highlight.srgb),i.setAttribute("stroke-width",`${o}`),i.setAttribute("opacity",`${n}`),i}function ec(t){return Bo[t.props.size]*1.12}function D0(t){return t.props.segments.length===1&&t.props.segments[0].points.length<2}function l5(){const[t,e]=S.useState(!1);return S.useEffect(()=>{const n=window.matchMedia("(prefers-reduced-motion: reduce)"),r=()=>{e(n.matches)};return r(),n.addEventListener("change",r),()=>n.removeEventListener("change",r)},[]),t}const xee=async t=>new Promise((e,n)=>{const r=new Image;r.onload=()=>e(r),r.onerror=()=>n(new Error("Failed to load image")),r.crossOrigin="anonymous",r.src=t}),bee=async t=>{const e=await xee(t),n=document.createElement("canvas");n.width=e.width,n.height=e.height;const r=n.getContext("2d");if(r)return r.drawImage(e,0,0),n.toDataURL()};async function Cee(t){const n=await(await fetch(t)).blob();return new Promise((r,s)=>{const o=new FileReader;o.onloadend=()=>r(o.result),o.onerror=s,o.readAsDataURL(n)})}class rp extends ul{constructor(){super(...arguments);y(this,"isAspectRatioLocked",()=>!0);y(this,"canCrop",()=>!0);y(this,"onDoubleClick",n=>{const r=n.props.assetId?this.editor.getAsset(n.props.assetId):void 0;!r||!(r.props.src&&"mimeType"in r.props&&r.props.mimeType==="image/gif")||this.editor.updateShapes([{type:"image",id:n.id,props:{playing:!n.props.playing}}])});y(this,"onDoubleClickEdge",n=>{const r=n.props;if(!r||this.editor.croppingShapeId!==n.id)return;const s=kn(r.crop)||{topLeft:{x:0,y:0},bottomRight:{x:1,y:1}},o=1/(s.bottomRight.x-s.topLeft.x)*n.props.w,i=1/(s.bottomRight.y-s.topLeft.y)*n.props.h,a=new P(s.topLeft.x*o,s.topLeft.y*i).rot(n.rotation),c={id:n.id,type:n.type,x:n.x-a.x,y:n.y-a.y,props:{crop:{topLeft:{x:0,y:0},bottomRight:{x:1,y:1}},w:o,h:i}};this.editor.updateShapes([c])})}getDefaultProps(){return{w:100,h:100,assetId:null,playing:!0,url:"",crop:null}}component(n){var h,f;const r=_P(n),s=nE(n.id),o=l5(),[i,a]=S.useState(""),c=n.props.assetId?this.editor.getAsset(n.props.assetId):void 0;if((c==null?void 0:c.type)==="bookmark")throw Error("Bookmark assets can't be rendered as images");const u=Y("onlySelectedShape",()=>{var p;return n.id===((p=this.editor.onlySelectedShape)==null?void 0:p.id)},[this.editor])&&s&&this.editor.isInAny("select.crop","select.cropping","select.pointing_crop_handle"),d=o&&(((h=c==null?void 0:c.props.mimeType)==null?void 0:h.includes("video"))||((f=c==null?void 0:c.props.mimeType)==null?void 0:f.includes("gif")));return S.useEffect(()=>{if(c!=null&&c.props.src&&"mimeType"in c.props&&(c==null?void 0:c.props.mimeType)==="image/gif"){let p=!1;return(async()=>{const v=await bee(c.props.src);p||v&&a(v)})(),()=>{p=!0}}},[o,c==null?void 0:c.props]),g.jsxs(g.Fragment,{children:[(c==null?void 0:c.props.src)&&u&&g.jsx("div",{style:r,children:g.jsx("div",{className:`tl-image tl-image-${n.id}-crop`,style:{opacity:.1,backgroundImage:`url(${!n.props.playing||d?i:c.props.src})`},draggable:!1})}),g.jsx(Xc,{id:n.id,style:{overflow:"hidden"},children:g.jsxs("div",{className:"tl-image-container",style:r,children:[c!=null&&c.props.src?g.jsx("div",{className:`tl-image tl-image-${n.id}`,style:{backgroundImage:`url(${!n.props.playing||d?i:c.props.src})`},draggable:!1}):null,(c==null?void 0:c.props.isAnimated)&&!n.props.playing&&g.jsx("div",{className:"tl-image__tg",children:"GIF"})]})}),"url"in n.props&&n.props.url&&g.jsx(Wd,{url:n.props.url,zoomLevel:this.editor.zoomLevel})]})}indicator(n){return nE(n.id)?null:g.jsx("rect",{width:R(n.props.w),height:R(n.props.h)})}async toSvg(n){const r=document.createElementNS("http://www.w3.org/2000/svg","g"),s=n.props.assetId?this.editor.getAsset(n.props.assetId):null;let o=(s==null?void 0:s.props.src)||"";o&&o.startsWith("http")&&(o=await Cee(o)||"");const i=document.createElementNS("http://www.w3.org/2000/svg","image");i.setAttributeNS("http://www.w3.org/1999/xlink","href",o);const a=_P(n),c=n.props.crop;if(a&&c){const{transform:l,width:u,height:d}=a,h=[new P(c.topLeft.x*u,c.topLeft.y*d),new P(c.bottomRight.x*u,c.topLeft.y*d),new P(c.bottomRight.x*u,c.bottomRight.y*d),new P(c.topLeft.x*u,c.bottomRight.y*d)],f=document.createElementNS("http://www.w3.org/2000/svg","g");f.style.clipPath=`polygon(${h.map(p=>`${p.x}px ${p.y}px`).join(",")})`,i.setAttribute("width",u.toString()),i.setAttribute("height",d.toString()),i.style.transform=l,f.appendChild(i),r.appendChild(f)}else i.setAttribute("width",n.props.w.toString()),i.setAttribute("height",n.props.h.toString()),r.appendChild(i);return r}}y(rp,"type","image"),y(rp,"props",aN),y(rp,"migrations",cN);function _P(t){const e=t.props.crop,n=e==null?void 0:e.topLeft;if(!n)return;const r=1/(e.bottomRight.x-e.topLeft.x)*t.props.w,s=1/(e.bottomRight.y-e.topLeft.y)*t.props.h,o=-n.x*r,i=-n.y*s;return{transform:`translate(${o}px, ${i}px)`,width:r,height:s}}function _g(t,e){const{start:n,end:r}=t;return e?`M${n.x},${n.y} L${r.x},${r.y} `:`${r.x},${r.y} `}function Eg(t,e){const{a:n,b:r,c:s,d:o}=t;return P.Equals(n,o)?"":`${e?`M${n.x.toFixed(2)},${n.y.toFixed(2)}C`:""}${r.x.toFixed(2)},${r.y.toFixed(2)} ${s.x.toFixed(2)},${s.y.toFixed(2)} ${o.x.toFixed(2)},${o.y.toFixed(2)}`}function _ee(t,e){let n="";return t.segments.reduce((r,s,o)=>r+Eg(s,o===0),""),e&&(n+="Z"),n}function Eee(t,e){let n=t.segments.reduce((r,s,o)=>r+_g(s,o===0),"");return e&&(n+="Z"),n}function ab(t,e=!1){return t instanceof wi?Eee(t,e):_ee(t,e)}function u5(t){return{size:t,thinning:.4,streamline:0,smoothing:.5,simulatePressure:!0,last:!0}}function d5(t,e,n){const r=e.vertices,s=u5(n);return Ns(r,s)}function Pee(t,e,n){const r=u5(n);return cd(ld(d5(t,e,n),r),r)}function h5(t,e,n){const r=Pee(t,e,n);return Gc(r)}function kee(t,e,n){if(t.props.dash==="draw"){const r=d5(t,e,n);return ta(r)}return ab(e)}function Iee({shape:t,strokeWidth:e,spline:n,color:r}){const s=h5(t,n,e),o=document.createElementNS("http://www.w3.org/2000/svg","path");return o.setAttribute("stroke-width","0"),o.setAttribute("stroke","none"),o.setAttribute("fill",r),o.setAttribute("d",s),o}function $ee({dash:t,strokeWidth:e,spline:n,color:r}){const{segments:s}=n,o=document.createElementNS("http://www.w3.org/2000/svg","g");o.setAttribute("stroke",r),o.setAttribute("stroke-width",e.toString());const i=n instanceof hg?Eg:_g;return s.forEach((a,c)=>{const l=document.createElementNS("http://www.w3.org/2000/svg","path"),{strokeDasharray:u,strokeDashoffset:d}=tn(a.length,e,{style:t,start:c>0?"outset":"none",end:c<s.length-1?"outset":"none"});l.setAttribute("stroke-dasharray",u.toString()),l.setAttribute("stroke-dashoffset",d.toString()),l.setAttribute("d",i(a,c===0)),l.setAttribute("fill","none"),o.appendChild(l)}),o}function Tee({strokeWidth:t,spline:e,color:n}){const r=ab(e),s=document.createElementNS("http://www.w3.org/2000/svg","path");return s.setAttribute("stroke-width",t.toString()),s.setAttribute("stroke",n),s.setAttribute("fill","none"),s.setAttribute("d",r),s}function Aee(t,e,n,r){switch(t.props.dash){case"draw":return Iee({shape:t,strokeWidth:r,spline:e,color:n});case"solid":return Tee({strokeWidth:r,spline:e,color:n});default:return $ee({strokeWidth:r,spline:e,dash:t.props.dash,color:n})}}const Mee=new dx;class sp extends Hr{constructor(){super(...arguments);y(this,"hideResizeHandles",()=>!0);y(this,"hideRotateHandle",()=>!0);y(this,"hideSelectionBoundsFg",()=>!0);y(this,"onResize",(n,r)=>{const{scaleX:s,scaleY:o}=r,i=kn(n.props.handles);return Object.values(n.props.handles).forEach(({id:a,x:c,y:l})=>{i[a].x=c*s,i[a].y=l*o}),{props:{handles:i}}});y(this,"onHandleChange",(n,{handle:r})=>{const s=kn(n);switch(r.id){case"start":case"end":{s.props.handles[r.id]={...s.props.handles[r.id],x:r.x,y:r.y};break}default:{const o="handle:"+r.index,i=n.props.handles[o];i?s.props.handles[o]={...i,x:r.x,y:r.y}:s.props.handles[o]={id:o,type:"vertex",canBind:!1,index:r.index,x:r.x,y:r.y};break}}return s})}getDefaultProps(){return{dash:"draw",size:"m",color:"black",spline:"line",handles:{start:{id:"start",type:"vertex",canBind:!1,index:"a1",x:0,y:0},end:{id:"end",type:"vertex",canBind:!1,index:"a2",x:0,y:0}}}}getGeometry(n){return Vl(n)}getHandles(n){return Mee.get(n.props,()=>{const r=n.props.handles,s=Vl(n),o=Object.values(r).sort(Qt),i=o.slice();for(let a=0;a<s.segments.length;a++){const l=s.segments[a].midPoint(),u=vu(o[a].index,o[a+1].index);i.push({id:`mid-${a}`,type:"create",index:u,x:l.x,y:l.y})}return i.sort(Qt)})}getOutlineSegments(n){return this.editor.getShapeGeometry(n).segments.map(s=>s.vertices)}component(n){const r=$t(),s=Vl(n),o=Jt[n.props.size],{dash:i,color:a}=n.props;if(n.props.spline==="line"){if(i==="solid"){const c=s.points,l="M"+c[0]+"L"+c.slice(1);return g.jsxs(zn,{id:n.id,children:[g.jsx(mt,{d:l,fill:"none",color:a,theme:r}),g.jsx("path",{d:l,stroke:r[a].solid,strokeWidth:o,fill:"none"})]})}if(i==="dashed"||i==="dotted"){const c=s.points,l="M"+c[0]+"L"+c.slice(1),u=s instanceof hg?Eg:_g;return g.jsxs(zn,{id:n.id,children:[g.jsx(mt,{d:l,fill:"none",color:a,theme:r}),g.jsx("g",{stroke:r[a].solid,strokeWidth:o,children:s.segments.map((d,h)=>{const{strokeDasharray:f,strokeDashoffset:p}=tn(d.length,o,{style:i,start:h>0?"outset":"none",end:h<s.segments.length-1?"outset":"none"});return g.jsx("path",{strokeDasharray:f,strokeDashoffset:p,d:u(d,h===0),fill:"none"},h)})})]})}if(i==="draw"){const c=s.points,[l,u]=gP(n.id,c,o);return g.jsxs(zn,{id:n.id,children:[g.jsx(mt,{d:l,fill:"none",color:a,theme:r}),g.jsx("path",{d:u,stroke:r[a].solid,strokeWidth:o,fill:"none"})]})}}if(n.props.spline==="cubic"){const c=ab(s);if(i==="solid")return g.jsxs(zn,{id:n.id,children:[g.jsx(mt,{d:c,fill:"none",color:a,theme:r}),g.jsx("path",{strokeWidth:o,stroke:r[a].solid,fill:"none",d:c})]});if(i==="dashed"||i==="dotted"){const l=s instanceof hg?Eg:_g;return g.jsxs(zn,{id:n.id,children:[g.jsx(mt,{d:c,fill:"none",color:a,theme:r}),g.jsx("g",{stroke:r[a].solid,strokeWidth:o,children:s.segments.map((u,d)=>{const{strokeDasharray:h,strokeDashoffset:f}=tn(u.length,o,{style:i,start:d>0?"outset":"none",end:d<s.segments.length-1?"outset":"none"});return g.jsx("path",{strokeDasharray:h,strokeDashoffset:f,d:l(u,d===0),fill:"none"},d)})})]})}if(i==="draw")return g.jsxs(zn,{id:n.id,children:[g.jsx(mt,{d:c,fill:"none",color:a,theme:r}),g.jsx("path",{d:h5(n,s,o),strokeWidth:1,stroke:r[a].solid,fill:r[a].solid})]})}}indicator(n){const r=Jt[n.props.size],s=Vl(n),{dash:o}=n.props;let i;if(n.props.spline==="line"){const a=s.points;if(o==="solid"||o==="dotted"||o==="dashed")i="M"+a[0]+"L"+a.slice(1);else{const[c]=gP(n.id,a,r);i=c}}else i=kee(n,s,r);return g.jsx("path",{d:i})}toSvg(n){const s=An({isDarkMode:this.editor.user.isDarkMode})[n.props.color].solid,o=Vl(n);return Aee(n,o,s,Jt[n.props.size])}}y(sp,"type","line"),y(sp,"props",dN),y(sp,"migrations",hN);function Vl(t){const{spline:e,handles:n}=t.props,r=Object.values(n).sort(Qt).map(P.From);switch(e){case"cubic":return new hg({points:r});case"line":return new wi({points:r})}}const Os=200;class op extends Hr{constructor(){super(...arguments);y(this,"canEdit",()=>!0);y(this,"hideResizeHandles",()=>!0);y(this,"hideSelectionBoundsFg",()=>!0);y(this,"onBeforeCreate",n=>EP(this.editor,n,n.props.growY));y(this,"onBeforeUpdate",(n,r)=>{if(!(n.props.text===r.props.text&&n.props.font===r.props.font&&n.props.size===r.props.size))return EP(this.editor,r,n.props.growY)});y(this,"onEditEnd",n=>{const{id:r,type:s,props:{text:o}}=n;o.trimEnd()!==n.props.text&&this.editor.updateShapes([{id:r,type:s,props:{text:o.trimEnd()}}])})}getDefaultProps(){return{color:"black",size:"m",text:"",font:"draw",align:"middle",verticalAlign:"middle",growY:0,url:""}}getHeight(n){return Os+n.props.growY}getGeometry(n){const r=this.getHeight(n);return new Ea({width:Os,height:r,isFilled:!0})}component(n){const{id:r,type:s,props:{color:o,font:i,size:a,align:c,text:l,verticalAlign:u}}=n,d=$t(),h=o==="black"?"yellow":o;return g.jsxs(g.Fragment,{children:[g.jsx("div",{style:{position:"absolute",width:Os,height:this.getHeight(n)},children:g.jsxs("div",{className:"tl-note__container",style:{color:d[h].solid,backgroundColor:d[h].solid},children:[g.jsx("div",{className:"tl-note__scrim"}),g.jsx(ZM,{id:r,type:s,font:i,size:a,align:c,verticalAlign:u,text:l,labelColor:"black",wrap:!0})]})}),"url"in n.props&&n.props.url&&g.jsx(Wd,{url:n.props.url,zoomLevel:this.editor.zoomLevel})]})}indicator(n){return g.jsx("rect",{rx:"7",width:R(Os),height:R(this.getHeight(n))})}toSvg(n,r){r.addExportDef(Lm(n.props.font));const s=An({isDarkMode:this.editor.user.isDarkMode}),o=this.editor.getShapeGeometry(n).bounds,i=document.createElementNS("http://www.w3.org/2000/svg","g"),a=n.props.color==="black"?"yellow":n.props.color,c=document.createElementNS("http://www.w3.org/2000/svg","rect");c.setAttribute("rx","10"),c.setAttribute("width",Os.toString()),c.setAttribute("height",o.height.toString()),c.setAttribute("fill",s[a].solid),c.setAttribute("stroke",s[a].solid),c.setAttribute("stroke-width","1"),i.appendChild(c);const l=document.createElementNS("http://www.w3.org/2000/svg","rect");l.setAttribute("rx","10"),l.setAttribute("width",Os.toString()),l.setAttribute("height",o.height.toString()),l.setAttribute("fill",s.background),l.setAttribute("opacity",".28"),i.appendChild(l);const u=JM({editor:this.editor,shape:n,font:Md[n.props.font],bounds:o});return u.setAttribute("fill",s.text),u.setAttribute("stroke","none"),i.appendChild(u),i}}y(op,"type","note"),y(op,"props",fN),y(op,"migrations",pN);function EP(t,e,n=0){const o=t.textMeasure.measureText(e.props.text,{...Ft,fontFamily:Vs[e.props.font],fontSize:Ji[e.props.size],width:Os-34+"px"}).h+17*2;let i=null;if(o>Os?i=o-Os:n&&(i=0),i!==null)return{...e,props:{...e.props,growY:i}}}function Oee(t,{initialBounds:e,scaleX:n,scaleY:r,newPoint:s}){const o=Math.max(.01,Math.min(Math.abs(n),Math.abs(r))),i=new P(0,0);n<0&&(i.x=-(e.width*o)),r<0&&(i.y=-(e.height*o));const{x:a,y:c}=P.Add(s,i.rot(t.rotation));return{x:a,y:c,props:{scale:o*t.props.scale}}}const Dee=new dx;class ip extends Hr{constructor(){super(...arguments);y(this,"canEdit",()=>!0);y(this,"isAspectRatioLocked",()=>!0);y(this,"onResize",(n,r)=>{const{initialBounds:s,initialShape:o,scaleX:i,handle:a}=r;if(r.mode==="scale_shape"||a!=="right"&&a!=="left")return{id:n.id,type:n.type,...Oee(n,r)};{const c=s.width;let l=c*i;const u=new P(0,0);l=Math.max(1,Math.abs(l)),a==="left"?(u.x=c-l,i<0&&(u.x+=l)):i<0&&(u.x-=l);const{x:d,y:h}=u.rot(n.rotation).add(o);return{id:n.id,type:n.type,x:d,y:h,props:{w:l/o.props.scale,autoSize:!1}}}});y(this,"onBeforeCreate",n=>{if(!n.props.autoSize||n.props.text.trim())return;const r=this.getMinDimensions(n);return{...n,x:n.x-r.width/2,y:n.y-r.height/2}});y(this,"onEditEnd",n=>{const{id:r,type:s,props:{text:o}}=n,i=n.props.text.trimEnd();i.length===0?this.editor.deleteShapes([n.id]):i!==n.props.text&&this.editor.updateShapes([{id:r,type:s,props:{text:o.trimEnd()}}])});y(this,"onBeforeUpdate",(n,r)=>{if(!r.props.autoSize)return;const s=n.props.size!==r.props.size||n.props.align!==r.props.align||n.props.font!==r.props.font||n.props.scale!==1&&r.props.scale===1,o=n.props.text!==r.props.text;if(!s&&!o)return;const i=this.getMinDimensions(n),a=PP(this.editor,r.props),c=i.width*n.props.scale,l=i.height*n.props.scale,u=a.width*r.props.scale,d=a.height*r.props.scale;let h;switch(r.props.align){case"middle":{h=new P((u-c)/2,o?0:(d-l)/2);break}case"end":{h=new P(u-c,o?0:(d-l)/2);break}default:{if(o)break;h=new P(0,(d-l)/2);break}}if(h){h.rot(r.rotation);const{x:f,y:p}=r;return{...r,x:f-h.x,y:p-h.y,props:{...r.props,w:u}}}else return{...r,props:{...r.props,w:u}}});y(this,"onDoubleClickEdge",n=>{if(!n.props.autoSize)return{id:n.id,type:n.type,props:{autoSize:!0}};if(n.props.scale!==1)return{id:n.id,type:n.type,props:{scale:1}}})}getDefaultProps(){return{color:"black",size:"m",w:8,text:"",font:"draw",align:"middle",autoSize:!0,scale:1}}getMinDimensions(n){return Dee.get(n.props,r=>PP(this.editor,r))}getGeometry(n){const{scale:r}=n.props,{width:s,height:o}=this.getMinDimensions(n);return new Ea({width:s*r,height:o*r,isFilled:!0})}component(n){const{id:r,type:s,props:{text:o,color:i}}=n,a=An({isDarkMode:this.editor.user.isDarkMode}),{width:c,height:l}=this.getMinDimensions(n),{rInput:u,isEmpty:d,isEditing:h,isEditableFromHover:f,handleFocus:p,handleChange:m,handleKeyDown:v,handleBlur:w,handleInputPointerDown:x,handleContentPointerDown:b}=rb(r,s,o);return g.jsx(Xc,{id:n.id,children:g.jsxs("div",{className:"tl-text-shape__wrapper tl-text-shadow","data-font":n.props.font,"data-align":n.props.align,"data-hastext":!d,"data-isediting":h,"data-textwrap":!0,style:{fontSize:Bo[n.props.size],lineHeight:Bo[n.props.size]*Ft.lineHeight+"px",transform:`scale(${n.props.scale})`,transformOrigin:"top left",width:Math.max(1,c),height:Math.max(Bo[n.props.size]*Ft.lineHeight,l),color:a[i].solid},children:[g.jsx("div",{className:"tl-text tl-text-content",dir:"ltr",onPointerDown:b,children:o}),h||f?g.jsx("textarea",{ref:u,className:"tl-text tl-text-input",name:"text",tabIndex:-1,autoComplete:"false",autoCapitalize:"false",autoCorrect:"false",autoSave:"false",autoFocus:h,placeholder:"",spellCheck:"true",wrap:"off",dir:"ltr",datatype:"wysiwyg",defaultValue:o,onFocus:p,onChange:m,onKeyDown:v,onBlur:w,onTouchEnd:Vn,onContextMenu:Vn,onPointerDown:x}):null]})})}indicator(n){const r=this.editor.getShapeGeometry(n).bounds;return g.jsx("rect",{width:R(r.width),height:R(r.height)})}toSvg(n,r){r.addExportDef(Lm(n.props.font));const s=An({isDarkMode:this.editor.user.isDarkMode}),o=this.editor.getShapeGeometry(n).bounds,i=n.props.text,a=o.width/(n.props.scale??1),c=o.height/(n.props.scale??1),l={fontSize:Bo[n.props.size],fontFamily:Md[n.props.font],textAlign:n.props.align,verticalTextAlign:"middle",width:a,height:c,padding:0,lineHeight:Ft.lineHeight,fontStyle:"normal",fontWeight:"normal",overflow:"wrap"},u=s[n.props.color].solid,d=document.createElementNS("http://www.w3.org/2000/svg","g"),h=Rm(this.editor,this.editor.textMeasure.measureTextSpans(i,l),{...l,stroke:s.background,strokeWidth:2,fill:s.background,padding:0}),f=h.cloneNode(!0);return f.setAttribute("fill",u),f.setAttribute("stroke","none"),d.append(h),d.append(f),d}}y(ip,"type","text"),y(ip,"props",gN),y(ip,"migrations",mN);function PP(t,e){const{font:n,text:r,autoSize:s,size:o,w:i}=e,a=16,c=Bo[o],l=s?"fit-content":Math.floor(Math.max(a,i))+"px",u=t.textMeasure.measureText(r,{...Ft,fontFamily:Vs[n],fontSize:c,width:l});return s&&(u.w+=1),{width:Math.max(a,u.w),height:Math.max(c,u.h)}}class ap extends ul{constructor(){super(...arguments);y(this,"canEdit",()=>!0);y(this,"isAspectRatioLocked",()=>!0)}getDefaultProps(){return{w:100,h:100,assetId:null,time:0,playing:!0,url:""}}component(n){return g.jsx(Lee,{shape:n,videoUtil:this})}indicator(n){return g.jsx("rect",{width:R(n.props.w),height:R(n.props.h)})}toSvg(n){const r=document.createElementNS("http://www.w3.org/2000/svg","g"),s=document.createElementNS("http://www.w3.org/2000/svg","image");return s.setAttributeNS("http://www.w3.org/1999/xlink","href",Ree(n.id)),s.setAttribute("width",n.props.w.toString()),s.setAttribute("height",n.props.h.toString()),r.appendChild(s),r}}y(ap,"type","video"),y(ap,"props",yN),y(ap,"migrations",vN);function Ree(t){const e=t.split(":")[1],n=document.querySelector(`.tl-video-shape-${e}`);if(n){const r=document.createElement("canvas");return r.width=n.videoWidth,r.height=n.videoHeight,r.getContext("2d").drawImage(n,0,0),r.toDataURL("image/png")}else throw new Error("Video with id "+e+" not found")}const Lee=Ee(function(e){const{shape:n,videoUtil:r}=e,s=r.editor.getShapeGeometry(n).bounds.w*r.editor.zoomLevel>=110,o=n.props.assetId?r.editor.getAsset(n.props.assetId):null,{time:i,playing:a}=n.props,c=gx(n.id),l=l5(),u=Z.useRef(null),d=Z.useCallback(w=>{const x=w.currentTarget;r.editor.updateShapes([{type:"video",id:n.id,props:{playing:!0,time:x.currentTime}}])},[n.id,r.editor]),h=Z.useCallback(w=>{const x=w.currentTarget;r.editor.updateShapes([{type:"video",id:n.id,props:{playing:!1,time:x.currentTime}}])},[n.id,r.editor]),f=Z.useCallback(w=>{const x=w.currentTarget;c&&r.editor.updateShapes([{type:"video",id:n.id,props:{time:x.currentTime}}])},[c,n.id,r.editor]),[p,m]=Z.useState(!1),v=Z.useCallback(w=>{const x=w.currentTarget;i!==x.currentTime&&(x.currentTime=i),a||x.pause(),m(!0)},[a,i]);return Z.useEffect(()=>{const w=u.current;w&&p&&!c&&i!==w.currentTime&&(w.currentTime=i)},[c,p,i]),Z.useEffect(()=>{if(l){const w=u.current;w.pause(),w.currentTime=0}},[u,l]),g.jsxs(g.Fragment,{children:[g.jsx(Xc,{id:n.id,children:g.jsx("div",{className:"tl-counter-scaled",children:o!=null&&o.props.src?g.jsx("video",{ref:u,className:`tl-video tl-video-shape-${n.id.split(":")[1]}`,width:"100%",height:"100%",draggable:!1,playsInline:!0,autoPlay:!0,muted:!0,loop:!0,disableRemotePlayback:!0,disablePictureInPicture:!0,controls:c&&s,onPlay:d,onPause:h,onTimeUpdate:f,onLoadedData:v,hidden:!p,children:g.jsx("source",{src:o.props.src})}):null})}),"url"in n.props&&n.props.url&&g.jsx(Wd,{url:n.props.url,zoomLevel:r.editor.zoomLevel})]})}),f5=[ip,Qf,Zf,tp,op,sp,ep,qf,np,Jf,rp,ap];class cb{constructor(e){y(this,"state");y(this,"points");y(this,"size");y(this,"color");y(this,"opacity");y(this,"delay");y(this,"timeoutMs",0);y(this,"delayRemaining",0);y(this,"onUpdate");y(this,"onComplete");y(this,"prev",null);y(this,"next",null);y(this,"resume",()=>{this.state="active"});y(this,"pause",()=>{this.state="starting"});y(this,"stop",()=>{this.delayRemaining=Math.min(this.delayRemaining,200),this.state="stopping"});y(this,"addPoint",(e,n)=>{const{prev:r}=this,s={x:e,y:n,z:.5};r&&P.Dist(r,s)<1||(this.next=s)});y(this,"tick",e=>{this.timeoutMs+=e,this.delayRemaining>0&&(this.delayRemaining=Math.max(0,this.delayRemaining-e)),this.timeoutMs>=16&&(this.timeoutMs=0);const{timeoutMs:n,state:r,prev:s,next:o,points:i}=this;switch(r){case"active":{o&&o!==s?(this.prev=o,i.push(o),this.delayRemaining===0&&i.length>8&&i.shift(),this.updateScribble()):n===0&&(i.length>1?(i.shift(),this.updateScribble()):this.delayRemaining=this.delay);break}case"stopping":{if(this.delayRemaining===0&&n===0){if(i.length===1){this.state="paused",this.onComplete();return}this.size*=.9,i.shift(),this.updateScribble()}break}}});const{size:n=20,color:r="accent",opacity:s=.8,delay:o=0,onComplete:i,onUpdate:a}=e;this.onUpdate=a,this.onComplete=i,this.size=n,this.color=r,this.delay=o,this.opacity=s,this.points=[],this.state="starting",this.prev=null,this.next=null,this.delayRemaining=this.delay,this.resume()}getScribble(){return{state:this.state,size:this.size,color:this.color,opacity:this.opacity,delay:this.delay,points:[...this.points]}}updateScribble(){this.onUpdate(this.getScribble())}}class p5 extends re{constructor(){super(...arguments);y(this,"info",{});y(this,"scribble",{});y(this,"markId","");y(this,"excludedShapeIds",new Set);y(this,"onEnter",n=>{this.markId=this.editor.mark("erase scribble begin"),this.info=n;const{originPagePoint:r}=this.editor.inputs;this.excludedShapeIds=new Set(this.editor.currentPageShapes.filter(s=>this.editor.isShapeOrAncestorLocked(s)||(this.editor.isShapeOfType(s,"group")||this.editor.isShapeOfType(s,"frame"))&&this.editor.isPointInShape(s,r,{hitInside:!0,margin:0})).map(s=>s.id)),this.startScribble(),this.update()});y(this,"startScribble",()=>{var n;this.scribble.tick&&this.editor.off("tick",(n=this.scribble)==null?void 0:n.tick),this.scribble=new cb({onUpdate:this.onScribbleUpdate,onComplete:this.onScribbleComplete,color:"muted-1",size:12}),this.editor.on("tick",this.scribble.tick)});y(this,"pushPointToScribble",()=>{const{x:n,y:r}=this.editor.inputs.currentPagePoint;this.scribble.addPoint(n,r)});y(this,"onScribbleUpdate",n=>{this.editor.updateInstanceState({scribble:n})});y(this,"onScribbleComplete",()=>{this.editor.off("tick",this.scribble.tick),this.editor.updateInstanceState({scribble:null})});y(this,"onExit",()=>{this.scribble.stop()});y(this,"onPointerMove",()=>{this.update()});y(this,"onPointerUp",()=>{this.complete()});y(this,"onCancel",()=>{this.cancel()});y(this,"onComplete",()=>{this.complete()})}update(){const{zoomLevel:n,currentPageShapes:r,erasingShapeIdsSet:s,inputs:{currentPagePoint:o,previousPagePoint:i}}=this.editor,{excludedShapeIds:a}=this;this.pushPointToScribble();const c=new Set(s);for(const l of r){if(this.editor.isShapeOfType(l,"group"))continue;const u=this.editor.getShapeMask(l.id);if(u&&!fs(o,u))continue;const d=this.editor.getShapeGeometry(l),h=this.editor.getPointInShapeSpace(l,i),f=this.editor.getPointInShapeSpace(l,o);d.hitTestLineSegment(h,f,xs/n)&&c.add(this.editor.getOutermostSelectableShape(l).id)}this.editor.setErasingShapeIds([...c].filter(l=>!a.has(l)))}complete(){this.editor.deleteShapes(this.editor.currentPageState.erasingShapeIds),this.editor.setErasingShapeIds([]),this.parent.transition("idle",{})}cancel(){this.editor.setErasingShapeIds([]),this.editor.bailToMark(this.markId),this.parent.transition("idle",this.info)}}y(p5,"id","erasing");var _v;let jee=(_v=class extends re{constructor(){super(...arguments);y(this,"onPointerDown",n=>{this.parent.transition("pointing",n)});y(this,"onCancel",()=>{this.editor.setCurrentTool("select")})}},y(_v,"id","idle"),_v);var Ev;let Nee=(Ev=class extends re{constructor(){super(...arguments);y(this,"onEnter",()=>{const{inputs:{currentPagePoint:n},currentPageShapesSorted:r,zoomLevel:s}=this.editor,o=new Set,i=o.size;for(let a=r.length,c=a-1;c>=0;c--){const l=r[c];if(!this.editor.isShapeOfType(l,"group")&&this.editor.isPointInShape(l,n,{hitInside:!1,margin:xs/s})){const u=this.editor.getOutermostSelectableShape(l);if(this.editor.isShapeOfType(u,"frame")&&o.size>i)break;o.add(u.id)}}this.editor.setErasingShapeIds([...o])});y(this,"onPointerMove",n=>{this.editor.inputs.isDragging&&this.parent.transition("erasing",n)});y(this,"onPointerUp",()=>{this.complete()});y(this,"onCancel",()=>{this.cancel()});y(this,"onComplete",()=>{this.complete()});y(this,"onInterrupt",()=>{this.cancel()})}complete(){const{erasingShapeIds:n}=this.editor;n.length&&(this.editor.mark("erase end"),this.editor.deleteShapes(n)),this.editor.setErasingShapeIds([]),this.parent.transition("idle",{})}cancel(){this.editor.setErasingShapeIds([]),this.parent.transition("idle",{})}},y(Ev,"id","pointing"),Ev);class cp extends re{constructor(){super(...arguments);y(this,"onEnter",()=>{this.editor.updateInstanceState({cursor:{type:"cross",rotation:0}},!0)})}}y(cp,"id","eraser"),y(cp,"initial","idle"),y(cp,"children",()=>[jee,Nee,p5]);class g5 extends re{constructor(){super(...arguments);y(this,"onEnter",()=>{this.update()});y(this,"onPointerMove",()=>{this.update()});y(this,"onPointerUp",()=>{this.complete()});y(this,"onCancel",()=>{this.complete()});y(this,"onComplete",()=>{this.complete()})}update(){const{currentScreenPoint:n,previousScreenPoint:r}=this.editor.inputs,s=P.Sub(n,r);(Math.abs(s.x)>0||Math.abs(s.y)>0)&&this.editor.pan(s)}complete(){this.editor.slideCamera({speed:Math.min(2,this.editor.inputs.pointerVelocity.len()),direction:this.editor.inputs.pointerVelocity,friction:Of}),this.parent.transition("idle",{})}}y(g5,"id","dragging");var Pv;let zee=(Pv=class extends re{constructor(){super(...arguments);y(this,"onEnter",()=>{this.editor.updateInstanceState({cursor:{type:"grab",rotation:0}},!0)});y(this,"onPointerDown",n=>{this.parent.transition("pointing",n)});y(this,"onCancel",()=>{this.editor.setCurrentTool("select")})}},y(Pv,"id","idle"),Pv);var kv;let Fee=(kv=class extends re{constructor(){super(...arguments);y(this,"onEnter",()=>{this.editor.stopCameraAnimation(),this.editor.updateInstanceState({cursor:{type:"grabbing",rotation:0}},!0)});y(this,"onPointerMove",n=>{this.editor.inputs.isDragging&&this.parent.transition("dragging",n)});y(this,"onPointerUp",()=>{this.complete()});y(this,"onCancel",()=>{this.complete()});y(this,"onComplete",()=>{this.complete()});y(this,"onInterrupt",()=>{this.complete()})}complete(){this.parent.transition("idle",{})}},y(kv,"id","pointing"),kv);class lp extends re{constructor(){super(...arguments);y(this,"onDoubleClick",n=>{if(n.phase==="settle"){const{currentScreenPoint:r}=this.editor.inputs;this.editor.zoomIn(r,{duration:220,easing:en.easeOutQuint})}});y(this,"onTripleClick",n=>{if(n.phase==="settle"){const{currentScreenPoint:r}=this.editor.inputs;this.editor.zoomOut(r,{duration:320,easing:en.easeOutQuint})}});y(this,"onQuadrupleClick",n=>{if(n.phase==="settle"){const{zoomLevel:r,inputs:{currentScreenPoint:s}}=this.editor;r===1?this.editor.zoomToFit({duration:400,easing:en.easeOutQuint}):this.editor.resetZoom(s,{duration:320,easing:en.easeOutQuint})}})}}y(lp,"id","hand"),y(lp,"initial","idle"),y(lp,"children",()=>[zee,Fee,g5]);var Iv;let Bee=(Iv=class extends re{constructor(){super(...arguments);y(this,"onPointerDown",n=>{this.parent.transition("lasering",n)})}},y(Iv,"id","idle"),Iv);class m5 extends re{constructor(){super(...arguments);y(this,"scribble",{});y(this,"onEnter",()=>{this.startScribble(),this.pushPointToScribble()});y(this,"onExit",()=>{this.scribble.stop()});y(this,"onPointerMove",()=>{this.pushPointToScribble()});y(this,"onPointerUp",()=>{this.complete()});y(this,"startScribble",()=>{var n;this.scribble.tick&&this.editor.off("tick",(n=this.scribble)==null?void 0:n.tick),this.scribble=new cb({onUpdate:this.onScribbleUpdate,onComplete:this.onScribbleComplete,color:"laser",opacity:.7,size:4,delay:1200}),this.editor.on("tick",this.scribble.tick)});y(this,"pushPointToScribble",()=>{const{x:n,y:r}=this.editor.inputs.currentPagePoint;this.scribble.addPoint(n,r)});y(this,"onScribbleUpdate",n=>{this.editor.updateInstanceState({scribble:n})});y(this,"onScribbleComplete",()=>{this.editor.off("tick",this.scribble.tick),this.editor.updateInstanceState({scribble:null})});y(this,"onCancel",()=>{this.cancel()});y(this,"onComplete",()=>{this.complete()})}complete(){this.parent.transition("idle",{})}cancel(){this.parent.transition("idle",{})}}y(m5,"id","lasering");class up extends re{constructor(){super(...arguments);y(this,"onEnter",()=>{this.editor.updateInstanceState({cursor:{type:"cross",rotation:0}},!0)})}}y(up,"id","laser"),y(up,"initial","idle"),y(up,"children",()=>[Bee,m5]);class y5 extends re{constructor(){super(...arguments);y(this,"info",{});y(this,"brush",new ae);y(this,"initialSelectedShapeIds",[]);y(this,"excludedShapeIds",new Set);y(this,"initialStartShape",null);y(this,"onEnter",n=>{const{altKey:r,currentPagePoint:s}=this.editor.inputs;if(r){this.parent.transition("scribble_brushing",n);return}this.excludedShapeIds=new Set(this.editor.currentPageShapes.filter(o=>this.editor.isShapeOfType(o,"group")||this.editor.isShapeOrAncestorLocked(o)).map(o=>o.id)),this.info=n,this.initialSelectedShapeIds=this.editor.selectedShapeIds.slice(),this.initialStartShape=this.editor.getShapesAtPoint(s)[0],this.onPointerMove()});y(this,"onExit",()=>{this.initialSelectedShapeIds=[],this.editor.updateInstanceState({brush:null})});y(this,"onPointerMove",()=>{this.hitTestShapes()});y(this,"onPointerUp",()=>{this.complete()});y(this,"onComplete",()=>{this.complete()});y(this,"onCancel",n=>{this.editor.setSelectedShapeIds(this.initialSelectedShapeIds,!0),this.parent.transition("idle",n)});y(this,"onKeyDown",n=>{this.editor.inputs.altKey?this.parent.transition("scribble_brushing",n):this.hitTestShapes()});y(this,"onKeyUp",()=>{this.hitTestShapes()});y(this,"onInterrupt",()=>{this.editor.updateInstanceState({brush:null})})}complete(){this.parent.transition("idle",{})}hitTestShapes(){const{zoomLevel:n,currentPageId:r,currentPageShapes:s,inputs:{originPagePoint:o,currentPagePoint:i,shiftKey:a,ctrlKey:c}}=this.editor;this.brush.setTo(ae.FromPoints([o,i]));const l=new Set(a?this.initialSelectedShapeIds:[]);let u,d,h,f,p,m;const{corners:v}=this.brush,{excludedShapeIds:w}=this;e:for(let x=0,b=s.length;x<b;x++){if(h=s[x],w.has(h.id)||l.has(h.id)||(f=this.editor.getShapePageBounds(h),!f))continue e;if(this.brush.contains(f)){this.handleHit(h,i,r,l,v);continue e}if(c||this.editor.isShapeOfType(h,"frame"))continue e;if(this.brush.collides(f)){const C=this.editor.getShapeGeometry(h);if(p=this.editor.getShapePageTransform(h),!p)continue e;m=p.clone().invert().applyToPoints(v);t:for(let E=0;E<m.length;E++)if(u=m[E],d=m[(E+1)%m.length],C.hitTestLineSegment(u,d,xs/n)){this.handleHit(h,i,r,l,v);break t}}}this.editor.updateInstanceState({brush:{...this.brush.toJson()}}),this.editor.setSelectedShapeIds(Array.from(l),!0)}handleHit(n,r,s,o,i){if(n.parentId===s){o.add(n.id);return}const a=this.editor.getOutermostSelectableShape(n),c=this.editor.getShapeMask(a.id);c&&!kB(c,i)&&!fs(r,c)||o.add(a.id)}}y(y5,"id","brushing");function v5(t,e,n){if(!e)throw Error("Needs to translate a cropped shape!");const{crop:r}=e.props;if(!r)return;const s=t.inputs.shiftKey?Math.abs(n.x)<Math.abs(n.y)?"x":"y":null;s==="x"?n.x=0:s==="y"&&(n.y=0),n.rot(-e.rotation);const o=1/(r.bottomRight.x-r.topLeft.x)*e.props.w,i=1/(r.bottomRight.y-r.topLeft.y)*e.props.h,a=r.bottomRight.y-r.topLeft.y,c=r.bottomRight.x-r.topLeft.x,l=kn(r);return l.topLeft.x=Math.min(1-c,Math.max(0,l.topLeft.x-n.x/o)),l.topLeft.y=Math.min(1-a,Math.max(0,l.topLeft.y-n.y/i)),l.bottomRight.x=l.topLeft.x+c,l.bottomRight.y=l.topLeft.y+a,{id:e.id,type:e.type,props:{crop:l}}}var $v;let Uee=($v=class extends re{constructor(){super(...arguments);y(this,"onEnter",()=>{this.editor.updateInstanceState({cursor:{type:"default",rotation:0}},!0);const{onlySelectedShape:n}=this.editor;this.editor.on("change-history",this.cleanupCroppingState),this.editor.mark("crop"),n&&this.editor.setCroppingShapeId(n.id)});y(this,"onExit",()=>{this.editor.updateInstanceState({cursor:{type:"default",rotation:0}},!0),this.editor.off("change-history",this.cleanupCroppingState)});y(this,"onCancel",()=>{this.editor.setCroppingShapeId(null),this.editor.setCurrentTool("select.idle",{})});y(this,"onPointerDown",n=>{var r;if(!this.editor.isMenuOpen){if(n.ctrlKey){this.editor.setCroppingShapeId(null),this.editor.setCurrentTool("select.brushing",n);return}switch(n.target){case"canvas":{const{hoveredShape:s}=this.editor,o=s&&!this.editor.isShapeOfType(s,"group")?s:this.editor.getShapeAtPoint(this.editor.inputs.currentPagePoint);if(o){this.onPointerDown({...n,shape:o,target:"shape"});return}this.cancel();break}case"shape":{if(n.shape.id===this.editor.croppingShapeId){this.editor.setCurrentTool("select.crop.pointing_crop",n);return}else(r=this.editor.getShapeUtil(n.shape))!=null&&r.canCrop(n.shape)?(this.editor.setCroppingShapeId(n.shape.id),this.editor.setSelectedShapeIds([n.shape.id]),this.editor.setCurrentTool("select.crop.pointing_crop",n)):this.cancel();break}case"selection":{switch(n.handle){case"mobile_rotate":case"top_left_rotate":case"top_right_rotate":case"bottom_left_rotate":case"bottom_right_rotate":{this.editor.setCurrentTool("select.pointing_rotate_handle",{...n,onInteractionEnd:"select.crop"});break}case"top":case"right":case"bottom":case"left":{this.editor.setCurrentTool("select.pointing_crop_handle",{...n,onInteractionEnd:"select.crop"});break}case"top_left":case"top_right":case"bottom_left":case"bottom_right":{this.editor.setCurrentTool("select.pointing_crop_handle",{...n,onInteractionEnd:"select.crop"});break}default:this.cancel()}break}}}});y(this,"onDoubleClick",n=>{var o;if(this.editor.inputs.shiftKey||n.phase!=="up"||!this.editor.croppingShapeId)return;const r=this.editor.getShape(this.editor.croppingShapeId);if(!r)return;const s=this.editor.getShapeUtil(r);s&&n.target==="selection"&&((o=s.onDoubleClickEdge)==null||o.call(s,r))});y(this,"onKeyDown",()=>{this.nudgeCroppingImage(!1)});y(this,"onKeyRepeat",()=>{this.nudgeCroppingImage(!0)});y(this,"onKeyUp",n=>{switch(n.code){case"Enter":{this.editor.setCroppingShapeId(null),this.editor.setCurrentTool("select.idle",{});break}}});y(this,"cleanupCroppingState",()=>{this.editor.croppingShapeId||this.editor.setCurrentTool("select.idle",{})})}cancel(){this.editor.setCroppingShapeId(null),this.editor.setCurrentTool("select.idle",{})}nudgeCroppingImage(n=!1){const{editor:{inputs:{keys:r}}}=this,s=r.has("ShiftLeft"),o=new P(0,0);if(r.has("ArrowLeft")&&(o.x+=1),r.has("ArrowRight")&&(o.x-=1),r.has("ArrowUp")&&(o.y+=1),r.has("ArrowDown")&&(o.y-=1),o.equals(new P(0,0)))return;s&&o.mul(10);const i=this.editor.getShape(this.editor.croppingShapeId);if(!i)return;const a=v5(this.editor,i,o);a&&(n||this.editor.mark("translate crop"),this.editor.updateShapes([a]))}},y($v,"id","idle"),$v);class w5 extends re{constructor(){super(...arguments);y(this,"onCancel",()=>{this.editor.setCurrentTool("select.crop.idle",{})});y(this,"onPointerMove",n=>{this.editor.inputs.isDragging&&this.editor.setCurrentTool("select.crop.translating_crop",n)});y(this,"onPointerUp",n=>{this.editor.setCurrentTool("select.crop.idle",n)})}}y(w5,"id","pointing_crop");class S5 extends re{constructor(){super(...arguments);y(this,"info",{});y(this,"markId","translating crop");y(this,"snapshot",{});y(this,"onEnter",n=>{this.info=n,this.snapshot=this.createSnapshot(),this.editor.mark(this.markId),this.editor.updateInstanceState({cursor:{type:"move",rotation:0}},!0),this.updateShapes()});y(this,"onExit",()=>{this.editor.updateInstanceState({cursor:{type:"default",rotation:0}},!0)});y(this,"onPointerMove",()=>{this.updateShapes()});y(this,"onPointerUp",()=>{this.complete()});y(this,"onComplete",()=>{this.complete()});y(this,"onCancel",()=>{this.cancel()});y(this,"onKeyDown",n=>{switch(n.key){case"Alt":case"Shift":{this.updateShapes();return}}});y(this,"onKeyUp",n=>{switch(n.key){case"Enter":{this.complete();return}case"Alt":case"Shift":this.updateShapes()}})}complete(){this.updateShapes(),this.editor.setCurrentTool("select.crop.idle",this.info)}cancel(){this.editor.bailToMark(this.markId),this.editor.setCurrentTool("select.crop.idle",this.info)}createSnapshot(){return{shape:this.editor.onlySelectedShape}}updateShapes(){const n=this.snapshot.shape;if(!n)return;const{originPagePoint:r,currentPagePoint:s}=this.editor.inputs,o=s.clone().sub(r),i=v5(this.editor,n,o);i&&this.editor.updateShapes([i],!0)}}y(S5,"id","translating_crop");class dp extends re{}y(dp,"id","crop"),y(dp,"initial","idle"),y(dp,"children",()=>[Uee,S5,w5]);const ir=8,Qc={bottom:"ns-resize",top:"ns-resize",left:"ew-resize",right:"ew-resize",bottom_left:"nesw-resize",bottom_right:"nwse-resize",top_left:"nwse-resize",top_right:"nesw-resize",bottom_left_rotate:"swne-rotate",bottom_right_rotate:"senw-rotate",top_left_rotate:"nwse-rotate",top_right_rotate:"nesw-rotate",mobile_rotate:"grabbing"};class x5 extends re{constructor(){super(...arguments);y(this,"info",{});y(this,"onEnter",n=>{this.info=n,this.updateCursor()});y(this,"onPointerMove",()=>{this.editor.inputs.isDragging&&this.parent.transition("resizing",this.info)});y(this,"onPointerUp",()=>{this.complete()});y(this,"onCancel",()=>{this.cancel()});y(this,"onComplete",()=>{this.cancel()});y(this,"onInterrupt",()=>{this.cancel()})}updateCursor(){const n=this.editor.selectedShapes,r=Qc[this.info.handle];this.editor.updateInstanceState({cursor:{type:r,rotation:n.length===1?n[0].rotation:0}})}complete(){this.info.onInteractionEnd?this.editor.setCurrentTool(this.info.onInteractionEnd,{}):this.parent.transition("idle",{})}cancel(){this.info.onInteractionEnd?this.editor.setCurrentTool(this.info.onInteractionEnd,{}):this.parent.transition("idle",{})}}y(x5,"id","pointing_resize_handle");class b5 extends re{constructor(){super(...arguments);y(this,"info",{});y(this,"markId","");y(this,"snapshot",{});y(this,"onEnter",n=>{this.info=n,this.markId=this.editor.mark("cropping"),this.snapshot=this.createSnapshot(),this.updateShapes()});y(this,"onPointerMove",()=>{this.updateShapes()});y(this,"onPointerUp",()=>{this.complete()});y(this,"onComplete",()=>{this.complete()});y(this,"onCancel",()=>{this.cancel()});y(this,"getDefaultCrop",()=>({topLeft:{x:0,y:0},bottomRight:{x:1,y:1}}))}updateCursor(){const n=this.editor.selectedShapes[0];if(!n)return;const r=Qc[this.info.handle];this.editor.updateInstanceState({cursor:{type:r,rotation:n.rotation}})}updateShapes(){const{shape:n,cursorHandleOffset:r}=this.snapshot;if(!n||!this.editor.getShapeUtil("image"))return;const o=n.props,i=this.editor.inputs.currentPagePoint.clone().sub(r),a=this.editor.inputs.originPagePoint.clone().sub(r),c=i.clone().sub(a).rot(-n.rotation),l=o.crop??this.getDefaultCrop(),u=kn(l),d=new P(n.x,n.y),h=new P(0,0),f=1/(l.bottomRight.x-l.topLeft.x)*o.w,p=1/(l.bottomRight.y-l.topLeft.y)*o.h;let m=!1;switch(this.info.handle){case"top":case"top_left":case"top_right":{if(p<ir)break;m=!0,u.topLeft.y=u.topLeft.y+c.y/p,p*(u.bottomRight.y-u.topLeft.y)<ir?(u.topLeft.y=u.bottomRight.y-ir/p,h.y=(u.topLeft.y-l.topLeft.y)*p):u.topLeft.y<=0?(u.topLeft.y=0,h.y=(u.topLeft.y-l.topLeft.y)*p):h.y=c.y;break}case"bottom":case"bottom_left":case"bottom_right":{if(p<ir)break;m=!0,u.bottomRight.y=Math.min(1,u.bottomRight.y+c.y/p),p*(u.bottomRight.y-u.topLeft.y)<ir&&(u.bottomRight.y=u.topLeft.y+ir/p);break}}switch(this.info.handle){case"left":case"top_left":case"bottom_left":{if(f<ir)break;m=!0,u.topLeft.x=u.topLeft.x+c.x/f,f*(u.bottomRight.x-u.topLeft.x)<ir?(u.topLeft.x=u.bottomRight.x-ir/f,h.x=(u.topLeft.x-l.topLeft.x)*f):u.topLeft.x<=0?(u.topLeft.x=0,h.x=(u.topLeft.x-l.topLeft.x)*f):h.x=c.x;break}case"right":case"top_right":case"bottom_right":{if(f<ir)break;m=!0,u.bottomRight.x=Math.min(1,u.bottomRight.x+c.x/f),f*(u.bottomRight.x-u.topLeft.x)<ir&&(u.bottomRight.x=u.topLeft.x+ir/f);break}}if(!m)return;d.add(h.rot(n.rotation));const v={id:n.id,type:n.type,x:d.x,y:d.y,props:{crop:u,w:(u.bottomRight.x-u.topLeft.x)*f,h:(u.bottomRight.y-u.topLeft.y)*p}};this.editor.updateShapes([v],!0),this.updateCursor()}complete(){this.info.onInteractionEnd?this.editor.setCurrentTool(this.info.onInteractionEnd,this.info):(this.editor.setCroppingShapeId(null),this.parent.transition("idle",{}))}cancel(){this.editor.bailToMark(this.markId),this.info.onInteractionEnd?this.editor.setCurrentTool(this.info.onInteractionEnd,this.info):(this.editor.setCroppingShapeId(null),this.parent.transition("idle",{}))}createSnapshot(){const{selectionRotation:n,inputs:{originPagePoint:r}}=this.editor,s=this.editor.onlySelectedShape,o=this.editor.selectionRotatedPageBounds,i=P.RotWith(o.getHandlePoint(this.info.handle),o.point,n),a=P.Sub(r,i);return{shape:s,cursorHandleOffset:a}}}y(b5,"id","cropping");class C5 extends re{constructor(){super(...arguments);y(this,"shapeId","");y(this,"initialHandle",{});y(this,"initialAdjacentHandle",null);y(this,"initialPagePoint",{});y(this,"markId","");y(this,"initialPageTransform");y(this,"initialPageRotation");y(this,"info",{});y(this,"isPrecise",!1);y(this,"isPreciseId",null);y(this,"pointingId",null);y(this,"onEnter",n=>{const{shape:r,isCreating:s,handle:o}=n;this.info=n,this.parent.currentToolIdMask=n.onInteractionEnd,this.shapeId=r.id,this.markId=s?`creating:${r.id}`:this.editor.mark("dragging handle"),this.initialHandle=kn(o),this.initialPageTransform=this.editor.getShapePageTransform(r),this.initialPageRotation=this.initialPageTransform.rotation(),this.initialPagePoint=this.editor.inputs.originPagePoint.clone(),this.editor.updateInstanceState({cursor:{type:s?"cross":"grabbing",rotation:0}},!0);const i=this.editor.getShapeHandles(r).sort(Qt),a=i.findIndex(l=>l.id===n.handle.id);this.initialAdjacentHandle=null;for(let l=a+1;l<i.length;l++){const u=i[l];if(u.type==="vertex"&&u.id!=="middle"&&u.id!==n.handle.id){this.initialAdjacentHandle=u;break}}if(!this.initialAdjacentHandle)for(let l=i.length-1;l>=0;l--){const u=i[l];if(u.type==="vertex"&&u.id!=="middle"&&u.id!==n.handle.id){this.initialAdjacentHandle=u;break}}const c=r.props[n.handle.id];this.isPrecise=!1,(c==null?void 0:c.type)==="binding"?(this.editor.setHintingIds([c.boundShapeId]),this.isPrecise=!P.Equals(c.normalizedAnchor,{x:.5,y:.5}),this.isPrecise?this.isPreciseId=c.boundShapeId:this.resetExactTimeout()):this.editor.setHintingIds([]),this.update(),this.editor.select(this.shapeId)});y(this,"exactTimeout",-1);y(this,"onPointerMove",()=>{this.update()});y(this,"onKeyDown",()=>{this.update()});y(this,"onKeyUp",()=>{this.update()});y(this,"onPointerUp",()=>{this.complete()});y(this,"onComplete",()=>{this.complete()});y(this,"onCancel",()=>{this.cancel()});y(this,"onExit",()=>{this.parent.currentToolIdMask=void 0,this.editor.setHintingIds([]),this.editor.snaps.clear(),this.editor.updateInstanceState({cursor:{type:"default",rotation:0}},!0)})}resetExactTimeout(){this.exactTimeout!==-1&&this.clearExactTimeout(),this.exactTimeout=setTimeout(()=>{this.isActive&&!this.isPrecise&&(this.isPrecise=!0,this.isPreciseId=this.pointingId,this.update()),this.exactTimeout=-1},750)}clearExactTimeout(){this.exactTimeout!==-1&&(clearTimeout(this.exactTimeout),this.exactTimeout=-1)}complete(){this.editor.snaps.clear();const{onInteractionEnd:n}=this.info;if(this.editor.instanceState.isToolLocked&&n){this.editor.setCurrentTool(n,{shapeId:this.shapeId});return}this.parent.transition("idle",{})}cancel(){this.editor.bailToMark(this.markId),this.editor.snaps.clear();const{onInteractionEnd:n}=this.info;if(n){this.editor.setCurrentTool(n,{shapeId:this.shapeId});return}this.parent.transition("idle",{})}update(){var E;const{editor:n,shapeId:r,initialPagePoint:s}=this,{initialHandle:o,initialPageRotation:i,initialAdjacentHandle:a}=this,{user:{isSnapMode:c},hintingShapeIds:l,snaps:u,inputs:{currentPagePoint:d,shiftKey:h,ctrlKey:f,altKey:p,pointerVelocity:m}}=n,v=n.getShape(r);if(!v)return;const w=n.getShapeUtil(v);let x=d.clone().sub(s).rot(-i).add(o);if(h&&a&&o.id!=="middle"){const _=P.Angle(a,x),I=eg(_,24)-_;x=P.RotWith(x,a,I)}if(n.snaps.clear(),c?!f:f){const _=n.getShapePageTransform(v.id);if(!_)throw Error("Expected a page transform");const k=w.getOutlineSegments(v).map(A=>te.applyToPoints(_,A)),I=n.getShapeHandles(v).filter(({type:A})=>A==="vertex").sort(Qt).findIndex(({index:A})=>o.index===A);k.splice(I-1,2);const $=u.getSnappingHandleDelta({additionalSegments:k,handlePoint:te.applyToPoint(_,x)});$&&($.rot(-n.getShapeParentTransform(v).rotation()),x.add($))}const b=(E=w.onHandleChange)==null?void 0:E.call(w,v,{handle:{...o,x:x.x,y:x.y},isPrecise:this.isPrecise||p}),C={...v,...b};if(o.canBind){const _=C.props[o.id];(_==null?void 0:_.type)==="binding"?l[0]!==_.boundShapeId&&(n.setHintingIds([_.boundShapeId]),this.pointingId=_.boundShapeId,this.isPrecise=m.len()<.5||p,this.isPreciseId=this.isPrecise?_.boundShapeId:null,this.resetExactTimeout()):l.length>0&&(n.setHintingIds([]),this.pointingId=null,this.isPrecise=!1,this.isPreciseId=null,this.resetExactTimeout())}b&&n.updateShapes([C],!0)}}y(C5,"id","dragging_handle");class _5 extends re{constructor(){super(...arguments);y(this,"onPointerMove",n=>{switch(n.target){case"shape":case"canvas":eb(this.editor)}});y(this,"onExit",()=>{var o;if(!this.editor.currentPageState.editingShapeId)return;const{editingShapeId:n}=this.editor.currentPageState;if(!n)return;this.editor.setEditingShapeId(null);const r=this.editor.getShape(n),s=this.editor.getShapeUtil(r);(o=s.onEditEnd)==null||o.call(s,r)});y(this,"onPointerDown",n=>{var r,s;this.parent.transition("idle",n),(s=(r=this.parent.current.value)==null?void 0:r.onPointerDown)==null||s.call(r,n)});y(this,"onComplete",n=>{this.parent.transition("idle",n)});y(this,"onCancel",n=>{this.parent.transition("idle",n)})}}y(_5,"id","editing_shape");function Hee(t){const{zoomLevel:e,inputs:{currentPagePoint:n}}=t;return t.getShapeAtPoint(n,{hitInside:!1,margin:xs/e})??t.getSelectedShapeAtPoint(n)}function kP(t){const{onlySelectedShape:e}=t;return!!(e&&!t.isShapeOrAncestorLocked(e)&&t.getShapeUtil(e).canCrop(e))}function Pg(t){const{selectedShapeIds:e}=t,{shiftKey:n,altKey:r,currentPagePoint:s}=t.inputs,o=t.getShapeAtPoint(s,{hitInside:!0,margin:xs/t.zoomLevel});if(o){const i=t.getOutermostSelectableShape(o);if(n&&!r)t.cancelDoubleClick(),e.includes(i.id)?(t.mark("deselecting shape"),t.deselect(i)):(t.mark("shift selecting shape"),t.setSelectedShapeIds([...e,i.id]));else{let a;i===o||i.id===t.focusedGroupId||e.includes(i.id)?a=o:a=i,a&&!e.includes(a.id)&&(t.mark("selecting shape"),t.select(a.id))}}else{if(n)return;{e.length>0&&(t.mark("selecting none"),t.selectNone());const{focusedGroupId:i}=t;if(ar(i)){const a=t.getShape(i);t.isPointInShape(a,s,{margin:0,hitInside:!0})||t.setFocusedGroupId(null)}}}}var Tv;let Kee=(Tv=class extends re{constructor(){super(...arguments);y(this,"onEnter",()=>{this.parent.currentToolIdMask=void 0,this.editor.updateInstanceState({cursor:{type:"default",rotation:0}},!0)});y(this,"onPointerMove",()=>{eb(this.editor)});y(this,"onPointerDown",n=>{if(this.editor.isMenuOpen)return;const r=n.ctrlKey&&kP(this.editor);if(n.ctrlKey&&!r){if(n.target==="shape"&&this.isDarwin&&this.editor.inputs.keys.has("ControlLeft")&&!this.editor.isShapeOrAncestorLocked(n.shape)){this.parent.transition("pointing_shape",n);return}this.parent.transition("brushing",n);return}switch(n.target){case"canvas":{const s=Hee(this.editor);if(s){this.onPointerDown({...n,shape:s,target:"shape"});return}const{onlySelectedShape:o,selectedShapeIds:i,inputs:{currentPagePoint:a}}=this.editor;if((i.length>1||o&&!this.editor.getShapeUtil(o).hideSelectionBoundsBg(o))&&Yee(this.editor,a)){this.onPointerDown({...n,target:"selection"});return}this.parent.transition("pointing_canvas",n);break}case"shape":{if(this.editor.isShapeOrAncestorLocked(n.shape))break;this.parent.transition("pointing_shape",n);break}case"handle":{if(this.editor.instanceState.isReadonly)break;this.editor.inputs.altKey?this.parent.transition("pointing_shape",n):this.parent.transition("pointing_handle",n);break}case"selection":{switch(n.handle){case"mobile_rotate":case"top_left_rotate":case"top_right_rotate":case"bottom_left_rotate":case"bottom_right_rotate":{this.parent.transition("pointing_rotate_handle",n);break}case"top":case"right":case"bottom":case"left":{r?this.parent.transition("pointing_crop_handle",n):this.parent.transition("pointing_resize_handle",n);break}case"top_left":case"top_right":case"bottom_left":case"bottom_right":{r?this.parent.transition("pointing_crop_handle",n):this.parent.transition("pointing_resize_handle",n);break}default:{const{hoveredShape:s}=this.editor;if(s&&!this.editor.selectedShapeIds.includes(s.id)){this.onPointerDown({...n,shape:s,target:"shape"});return}this.parent.transition("pointing_selection",n)}}break}}});y(this,"onDoubleClick",n=>{var r,s,o,i;if(!(this.editor.inputs.shiftKey||n.phase!=="up"))switch(n.target){case"canvas":{const{hoveredShape:a}=this.editor,c=a&&!this.editor.isShapeOfType(a,"group")?a:this.editor.getSelectedShapeAtPoint(this.editor.inputs.currentPagePoint)??this.editor.getShapeAtPoint(this.editor.inputs.currentPagePoint,{margin:xs/this.editor.zoomLevel,hitInside:!0}),{focusedGroupId:l}=this.editor;if(c){if(this.editor.isShapeOfType(c,"group")){Pg(this.editor);return}else{const u=this.editor.getShape(c.parentId);if(u&&this.editor.isShapeOfType(u,"group")&&!(l&&u.id===l)){Pg(this.editor);return}}this.onDoubleClick({...n,shape:c,target:"shape"});return}if(!this.editor.inputs.shiftKey){if(this.editor.instanceState.isReadonly)break;this.handleDoubleClickOnCanvas(n)}break}case"selection":{if(this.editor.instanceState.isReadonly)break;const{onlySelectedShape:a}=this.editor;if(a){const c=this.editor.getShapeUtil(a);if(n.handle==="right"||n.handle==="left"||n.handle==="top"||n.handle==="bottom"){const l=(r=c.onDoubleClickEdge)==null?void 0:r.call(c,a);if(l){this.editor.mark("double click edge"),this.editor.updateShapes([l]);return}}if(c.canCrop(a)&&!this.editor.isShapeOrAncestorLocked(a)){this.parent.transition("crop",n);return}this.shouldStartEditingShape(a)&&this.startEditingShape(a,n)}break}case"shape":{const{shape:a}=n,c=this.editor.getShapeUtil(a);if(a.type!=="video"&&a.type!=="embed"&&this.editor.instanceState.isReadonly)break;if(c.onDoubleClick){const l=(s=c.onDoubleClick)==null?void 0:s.call(c,a);if(l){this.editor.updateShapes([l]);return}else if(c.canCrop(a)&&!this.editor.isShapeOrAncestorLocked(a)){this.editor.mark("select and crop"),this.editor.select((o=n.shape)==null?void 0:o.id),this.parent.transition("crop",n);return}}this.shouldStartEditingShape(a)?this.startEditingShape(a,n):this.handleDoubleClickOnCanvas(n);break}case"handle":{if(this.editor.instanceState.isReadonly)break;const{shape:a,handle:c}=n,l=this.editor.getShapeUtil(a),u=(i=l.onDoubleClickHandle)==null?void 0:i.call(l,a,c);u?this.editor.updateShapes([u]):this.shouldStartEditingShape(a)&&this.startEditingShape(a,n)}}});y(this,"onRightClick",n=>{switch(n.target){case"canvas":{const{hoveredShape:r}=this.editor,s=r&&!this.editor.isShapeOfType(r,"group")?r:this.editor.getShapeAtPoint(this.editor.inputs.currentPagePoint);if(s){this.onRightClick({...n,shape:s,target:"shape"});return}this.editor.selectNone();break}case"shape":{const{selectedShapeIds:r}=this.editor.currentPageState,{shape:s}=n,o=this.editor.getOutermostSelectableShape(s,i=>!r.includes(i.id));r.includes(o.id)||(this.editor.mark("selecting shape"),this.editor.setSelectedShapeIds([o.id]));break}}});y(this,"onCancel",()=>{this.editor.focusedGroupId!==this.editor.currentPageId&&this.editor.selectedShapeIds.length>0?this.editor.popFocusLayer():(this.editor.mark("clearing selection"),this.editor.selectNone())});y(this,"onKeyDown",n=>{switch(n.code){case"ArrowLeft":case"ArrowRight":case"ArrowUp":case"ArrowDown":{this.nudgeSelectedShapes(!1);break}}});y(this,"onKeyRepeat",n=>{switch(n.code){case"ArrowLeft":case"ArrowRight":case"ArrowUp":case"ArrowDown":{this.nudgeSelectedShapes(!0);break}}});y(this,"onKeyUp",n=>{if(this.editor.instanceState.isReadonly)switch(n.code){case"Enter":{const{onlySelectedShape:r}=this.editor;if(r&&this.shouldStartEditingShape()){this.startEditingShape(r,{...n,target:"shape",shape:r});return}break}}else switch(n.code){case"Enter":{const{selectedShapes:r}=this.editor;if(r.every(o=>this.editor.isShapeOfType(o,"group"))){this.editor.setSelectedShapeIds(r.flatMap(o=>this.editor.getSortedChildIdsForParent(o.id)));return}const{onlySelectedShape:s}=this.editor;if(s&&this.shouldStartEditingShape(s)){this.startEditingShape(s,{...n,target:"shape",shape:s});return}kP(this.editor)&&this.parent.transition("crop",n);break}}});y(this,"isDarwin",window.navigator.userAgent.toLowerCase().indexOf("mac")>-1)}shouldStartEditingShape(n=this.editor.onlySelectedShape){return!n||this.editor.isShapeOrAncestorLocked(n)&&n.type!=="embed"?!1:this.editor.getShapeUtil(n).canEdit(n)}startEditingShape(n,r){this.editor.isShapeOrAncestorLocked(n)&&n.type!=="embed"||(this.editor.mark("editing shape"),this.editor.setEditingShapeId(n.id),this.parent.transition("editing_shape",r))}handleDoubleClickOnCanvas(n){this.editor.mark("creating text shape");const r=Ke(),{x:s,y:o}=this.editor.inputs.currentPagePoint;this.editor.createShapes([{id:r,type:"text",x:s,y:o,props:{text:"",autoSize:!0}}]),this.editor.getShape(r)&&(this.editor.setEditingShapeId(r),this.editor.select(r),this.parent.transition("editing_shape",n))}nudgeSelectedShapes(n=!1){const{editor:{inputs:{keys:r}}}=this,s=r.has("ShiftLeft"),o=new P(0,0);if(r.has("ArrowLeft")&&(o.x-=1),r.has("ArrowRight")&&(o.x+=1),r.has("ArrowUp")&&(o.y-=1),r.has("ArrowDown")&&(o.y+=1),o.equals(new P(0,0)))return;n||this.editor.mark("nudge shapes");const{gridSize:i}=this.editor.documentSettings,a=this.editor.instanceState.isGridMode?s?i*Gee:i:s?Vee:Wee;this.editor.nudgeShapes(this.editor.selectedShapeIds,o.mul(a))}},y(Tv,"id","idle"),Tv);const Vee=10,Wee=1,Gee=5;function Yee(t,e){const{selectionRotatedPageBounds:n}=t;if(!n)return!1;const{selectionRotation:r}=t;return r?fs(e,n.corners.map(s=>P.RotWith(s,n.point,r))):n.containsPoint(e)}class E5 extends re{constructor(){super(...arguments);y(this,"onEnter",()=>{const{inputs:n}=this.editor;n.shiftKey||this.editor.selectedShapeIds.length>0&&(this.editor.mark("selecting none"),this.editor.selectNone())});y(this,"onPointerMove",n=>{this.editor.inputs.isDragging&&this.parent.transition("brushing",n)});y(this,"onPointerUp",()=>{Pg(this.editor),this.complete()});y(this,"onComplete",()=>{this.complete()});y(this,"onInterrupt",()=>{this.parent.transition("idle",{})})}complete(){this.parent.transition("idle",{})}}y(E5,"id","pointing_canvas");class P5 extends re{constructor(){super(...arguments);y(this,"info",{});y(this,"onEnter",n=>{this.info=n,this.parent.currentToolIdMask=n.onInteractionEnd;const r=this.editor.selectedShapes[0];r&&(this.updateCursor(r),this.editor.setCroppingShapeId(r.id))});y(this,"onExit",()=>{this.editor.updateInstanceState({cursor:{type:"default",rotation:0}},!0),this.parent.currentToolIdMask=void 0});y(this,"onPointerMove",()=>{this.editor.inputs.isDragging&&this.parent.transition("cropping",{...this.info,onInteractionEnd:this.info.onInteractionEnd})});y(this,"onPointerUp",()=>{this.info.onInteractionEnd?this.editor.setCurrentTool(this.info.onInteractionEnd,this.info):(this.editor.setCroppingShapeId(null),this.parent.transition("idle",{}))});y(this,"onCancel",()=>{this.cancel()});y(this,"onComplete",()=>{this.cancel()});y(this,"onInterrupt",()=>{this.cancel()})}updateCursor(n){const r=Qc[this.info.handle];this.editor.updateInstanceState({cursor:{type:r,rotation:n.rotation}})}cancel(){this.info.onInteractionEnd?this.editor.setCurrentTool(this.info.onInteractionEnd,this.info):(this.editor.setCroppingShapeId(null),this.parent.transition("idle",{}))}}y(P5,"id","pointing_crop_handle");class k5 extends re{constructor(){super(...arguments);y(this,"info",{});y(this,"onEnter",n=>{this.info=n;const r=n.shape.props[n.handle.id];(r==null?void 0:r.type)==="binding"&&this.editor.setHintingIds([r.boundShapeId]),this.editor.updateInstanceState({cursor:{type:"grabbing",rotation:0}},!0)});y(this,"onExit",()=>{this.editor.setHintingIds([]),this.editor.updateInstanceState({cursor:{type:"default",rotation:0}},!0)});y(this,"onPointerUp",()=>{this.parent.transition("idle",this.info)});y(this,"onPointerMove",()=>{this.editor.inputs.isDragging&&this.parent.transition("dragging_handle",this.info)});y(this,"onCancel",()=>{this.cancel()});y(this,"onComplete",()=>{this.cancel()});y(this,"onInterrupt",()=>{this.cancel()})}cancel(){this.parent.transition("idle",{})}}y(k5,"id","pointing_handle");class I5 extends re{constructor(){super(...arguments);y(this,"info",{});y(this,"onEnter",n=>{this.parent.currentToolIdMask=n.onInteractionEnd,this.info=n,this.updateCursor()});y(this,"onExit",()=>{this.parent.currentToolIdMask=void 0,this.editor.updateInstanceState({cursor:{type:"default",rotation:0}},!0)});y(this,"onPointerMove",()=>{const{isDragging:n}=this.editor.inputs;n&&this.parent.transition("rotating",this.info)});y(this,"onPointerUp",()=>{this.complete()});y(this,"onCancel",()=>{this.cancel()});y(this,"onComplete",()=>{this.cancel()});y(this,"onInterrupt",()=>{this.cancel()})}updateCursor(){const{selectionRotation:n}=this.editor;this.editor.updateInstanceState({cursor:{type:Qc[this.info.handle],rotation:n}})}complete(){this.info.onInteractionEnd?this.editor.setCurrentTool(this.info.onInteractionEnd,{}):this.parent.transition("idle",{})}cancel(){this.info.onInteractionEnd?this.editor.setCurrentTool(this.info.onInteractionEnd,{}):this.parent.transition("idle",{})}}y(I5,"id","pointing_rotate_handle");class $5 extends re{constructor(){super(...arguments);y(this,"info",{});y(this,"onEnter",n=>{this.info=n});y(this,"onPointerUp",n=>{Pg(this.editor),this.parent.transition("idle",n)});y(this,"onPointerMove",n=>{if(this.editor.inputs.isDragging){if(this.editor.instanceState.isReadonly)return;this.parent.transition("translating",n)}});y(this,"onDoubleClick",n=>{var o,i;const{hoveredShape:r}=this.editor,s=r&&!this.editor.isShapeOfType(r,"group")?r:this.editor.getShapeAtPoint(this.editor.inputs.currentPagePoint,{hitInside:!0,margin:0});if(s){this.parent.transition("idle",{}),(i=(o=this.parent).onDoubleClick)==null||i.call(o,{...n,target:"shape",shape:this.editor.getShape(s)});return}});y(this,"onCancel",()=>{this.cancel()});y(this,"onComplete",()=>{this.cancel()});y(this,"onInterrupt",()=>{this.cancel()})}cancel(){this.parent.transition("idle",{})}}y($5,"id","pointing_selection");class T5 extends re{constructor(){super(...arguments);y(this,"hitShape",{});y(this,"hitShapeForPointerUp",{});y(this,"didSelectOnEnter",!1);y(this,"onEnter",n=>{const{selectedShapeIds:r,focusedGroupId:s,selectionRotatedPageBounds:o,inputs:{currentPagePoint:i,shiftKey:a,altKey:c}}=this.editor;this.hitShape=n.shape;const l=this.editor.getOutermostSelectableShape(n.shape);if(this.editor.getShapeUtil(n.shape).onClick||l.id===s||r.includes(l.id)||this.editor.isAncestorSelected(l.id)||r.length>1&&(o!=null&&o.containsPoint(i))){this.didSelectOnEnter=!1,this.hitShapeForPointerUp=l;return}this.didSelectOnEnter=!0,a&&!c?(this.editor.cancelDoubleClick(),r.includes(l.id)||(this.editor.mark("shift selecting shape"),this.editor.setSelectedShapeIds([...r,l.id]))):(this.editor.mark("selecting shape"),this.editor.setSelectedShapeIds([l.id]))});y(this,"onPointerUp",n=>{var u;const{zoomLevel:r,focusedGroupId:s,selectedShapeIds:o,inputs:{currentPagePoint:i,shiftKey:a}}=this.editor,c=this.editor.getShapeAtPoint(i,{margin:xs/r,hitInside:!0})??this.hitShape,l=c?this.editor.getOutermostSelectableShape(c):this.hitShapeForPointerUp;if(l){const d=this.editor.getShapeUtil(l);if(d.onClick){const h=(u=d.onClick)==null?void 0:u.call(d,l);if(h){this.editor.mark("shape on click"),this.editor.updateShapes([h]),this.parent.transition("idle",n);return}}if(l.id===s){o.length>0?(this.editor.mark("clearing shape ids"),this.editor.setSelectedShapeIds([])):this.editor.popFocusLayer(),this.parent.transition("idle",n);return}}if(!this.didSelectOnEnter){const d=this.editor.getOutermostSelectableShape(c,h=>!o.includes(h.id));if(o.includes(d.id))a?(this.editor.mark("deselecting on pointer up"),this.editor.deselect(l)):(this.editor.mark("selecting on pointer up"),this.editor.select(l));else if(a){const h=this.editor.getShapeAncestors(d);this.editor.mark("shift deselecting on pointer up"),this.editor.setSelectedShapeIds([...this.editor.selectedShapeIds.filter(f=>!h.find(p=>p.id===f)),d.id])}else this.editor.mark("selecting on pointer up"),this.editor.setSelectedShapeIds([d.id])}this.parent.transition("idle",n)});y(this,"onPointerMove",n=>{if(this.editor.inputs.isDragging){if(this.editor.instanceState.isReadonly)return;this.parent.transition("translating",n)}});y(this,"onCancel",()=>{this.cancel()});y(this,"onComplete",()=>{this.cancel()});y(this,"onInterrupt",()=>{this.cancel()})}cancel(){this.parent.transition("idle",{})}}y(T5,"id","pointing_shape");class A5 extends re{constructor(){super(...arguments);y(this,"info",{});y(this,"markId","");y(this,"creationCursorOffset",{x:0,y:0});y(this,"editAfterComplete",!1);y(this,"snapshot",{});y(this,"onEnter",n=>{const{isCreating:r=!1,editAfterComplete:s=!1,creationCursorOffset:o={x:0,y:0}}=n;this.info=n,this.parent.currentToolIdMask=n.onInteractionEnd,this.editAfterComplete=s,this.creationCursorOffset=o,n.isCreating&&this.editor.updateInstanceState({cursor:{type:"cross",rotation:0}},!0),this.snapshot=this._createSnapshot(),this.markId=r?`creating:${this.editor.onlySelectedShape.id}`:this.editor.mark("starting resizing"),this.handleResizeStart(),this.updateShapes()});y(this,"onPointerMove",()=>{this.updateShapes()});y(this,"onKeyDown",()=>{this.updateShapes()});y(this,"onKeyUp",()=>{this.updateShapes()});y(this,"onPointerUp",()=>{this.complete()});y(this,"onComplete",()=>{this.complete()});y(this,"onCancel",()=>{this.cancel()});y(this,"onExit",()=>{this.parent.currentToolIdMask=void 0,this.editor.updateInstanceState({cursor:{type:"default",rotation:0}},!0),this.editor.snaps.clear()});y(this,"_createSnapshot",()=>{const{selectedShapeIds:n,selectionRotation:r,inputs:{originPagePoint:s}}=this.editor,o=this.editor.selectionRotatedPageBounds,i=P.RotWith(o.getHandlePoint(this.info.handle),o.point,r),a=P.Sub(s,i),c=new Map;n.forEach(u=>{const d=this.editor.getShape(u);if(d){if(c.set(d.id,this._createShapeSnapshot(d)),this.editor.isShapeOfType(d,"frame")&&n.length===1)return;this.editor.visitDescendants(d.id,h=>{const f=this.editor.getShape(h);if(f&&(c.set(f.id,this._createShapeSnapshot(f)),this.editor.isShapeOfType(f,"frame")))return!1})}});const l=![...c.values()].some(u=>!YT(u.pageRotation,r)||u.isAspectRatioLocked);return{shapeSnapshots:c,selectionBounds:o,cursorHandleOffset:a,selectionRotation:r,selectedShapeIds:n,canShapesDeform:l,initialSelectionPageBounds:this.editor.selectionPageBounds}});y(this,"_createShapeSnapshot",n=>{const r=this.editor.getShapePageTransform(n),s=this.editor.getShapeUtil(n);return{shape:n,bounds:this.editor.getShapeGeometry(n).bounds,pageTransform:r,pageRotation:te.Decompose(r).rotation,isAspectRatioLocked:s.isAspectRatioLocked(n)}})}cancel(){this.editor.bailToMark(this.markId),this.info.onInteractionEnd?this.editor.setCurrentTool(this.info.onInteractionEnd,{}):this.parent.transition("idle",{})}complete(){if(this.handleResizeEnd(),this.editAfterComplete&&this.editor.onlySelectedShape){this.editor.setEditingShapeId(this.editor.onlySelectedShape.id),this.editor.setCurrentTool("select"),this.editor.root.current.value.transition("editing_shape",{});return}if(this.editor.instanceState.isToolLocked&&this.info.onInteractionEnd){this.editor.setCurrentTool(this.info.onInteractionEnd,{});return}this.parent.transition("idle",{})}handleResizeStart(){const{shapeSnapshots:n}=this.snapshot,r=[];n.forEach(({shape:s})=>{var a;const o=this.editor.getShapeUtil(s),i=(a=o.onResizeStart)==null?void 0:a.call(o,s);i&&r.push(i)}),r.length>0&&this.editor.updateShapes(r)}handleResizeEnd(){const{shapeSnapshots:n}=this.snapshot,r=[];n.forEach(({shape:s})=>{var c;const o=this.editor.getShape(s.id),i=this.editor.getShapeUtil(s),a=(c=i.onResizeEnd)==null?void 0:c.call(i,s,o);a&&r.push(a)}),r.length>0&&this.editor.updateShapes(r)}updateShapes(){const{altKey:n,shiftKey:r}=this.editor.inputs,{shapeSnapshots:s,selectionBounds:o,cursorHandleOffset:i,selectedShapeIds:a,selectionRotation:c,canShapesDeform:l}=this.snapshot,u=r||!l,{ctrlKey:d}=this.editor.inputs,h=this.editor.inputs.currentPagePoint.clone().sub(i).sub(this.creationCursorOffset),f=this.editor.inputs.originPagePoint.clone().sub(i);if(this.editor.instanceState.isGridMode&&!d){const{gridSize:k}=this.editor.documentSettings;h.snapToGrid(k)}const p=this.info.handle,m=IP(p,Math.PI);if(this.editor.snaps.clear(),(this.editor.user.isSnapMode?!d:d)&&c%Te===0){const{nudge:k}=this.editor.snaps.snapResize({dragDelta:P.Sub(h,f),initialSelectionPageBounds:this.snapshot.initialSelectionPageBounds,handle:IP(p,c),isAspectRatioLocked:u,isResizingFromCenter:n});h.add(k)}const w=P.RotWith(n?o.center:o.getHandlePoint(m),o.point,c),x=P.Sub(h,w).rot(-c),b=P.Sub(f,w).rot(-c),C=P.DivV(x,b);Number.isFinite(C.x)||(C.x=1),Number.isFinite(C.y)||(C.y=1);const E=p==="top"||p==="bottom",_=p==="left"||p==="right";u?_?C.y=Math.abs(C.x):E?C.x=Math.abs(C.y):Math.abs(C.x)>Math.abs(C.y)?C.y=Math.abs(C.x)*(C.y<0?-1:1):C.x=Math.abs(C.y)*(C.x<0?-1:1):(E&&(C.x=1),_&&(C.y=1)),this.info.isCreating||this.updateCursor({dragHandle:p,isFlippedX:C.x<0,isFlippedY:C.y<0,rotation:c});for(const k of s.keys()){const I=s.get(k);this.editor.resizeShape(k,C,{initialShape:I.shape,initialBounds:I.bounds,initialPageTransform:I.pageTransform,dragHandle:p,mode:a.length===1&&k===a[0]?"resize_bounds":"scale_shape",scaleOrigin:w,scaleAxisRotation:c})}}updateCursor({dragHandle:n,isFlippedX:r,isFlippedY:s,rotation:o}){const i={...this.editor.instanceState.cursor};switch(n){case"top_left":case"bottom_right":{i.type="nwse-resize",r!==s&&(i.type="nesw-resize");break}case"top_right":case"bottom_left":{i.type="nesw-resize",r!==s&&(i.type="nwse-resize");break}}i.rotation=o,this.editor.updateInstanceState({cursor:i})}}y(A5,"id","resizing");const R0=["top","top_right","right","bottom_right","bottom","bottom_left","left","top_left"];function IP(t,e){e=e%Oe;const n=Math.round(e/($e/4)),r=R0.indexOf(t);return R0[(r+n)%R0.length]}class M5 extends re{constructor(){super(...arguments);y(this,"snapshot",{});y(this,"info",{});y(this,"markId","");y(this,"onEnter",n=>{this.info=n,this.parent.currentToolIdMask=n.onInteractionEnd,this.markId=this.editor.mark("rotate start");const r=M3({editor:this.editor});if(!r)return this.parent.transition("idle",this.info);this.snapshot=r,this.handleStart()});y(this,"onExit",()=>{this.editor.updateInstanceState({cursor:{type:"none",rotation:0}},!0),this.parent.currentToolIdMask=void 0,this.snapshot={}});y(this,"onPointerMove",()=>{this.update()});y(this,"onKeyDown",()=>{this.update()});y(this,"onKeyUp",()=>{this.update()});y(this,"onPointerUp",()=>{this.complete()});y(this,"onComplete",()=>{this.complete()});y(this,"onCancel",()=>{this.cancel()});y(this,"update",()=>{const n=this._getRotationFromPointerPosition({snapToNearestDegree:!1});Lf({editor:this.editor,delta:n,snapshot:this.snapshot,stage:"update"}),this.editor.updateInstanceState({cursor:{type:Qc[this.info.handle],rotation:n+this.snapshot.initialSelectionRotation}})});y(this,"cancel",()=>{this.editor.bailToMark(this.markId),this.info.onInteractionEnd?this.editor.setCurrentTool(this.info.onInteractionEnd,this.info):this.parent.transition("idle",this.info)});y(this,"complete",()=>{Lf({editor:this.editor,delta:this._getRotationFromPointerPosition({snapToNearestDegree:!0}),snapshot:this.snapshot,stage:"end"}),this.info.onInteractionEnd?this.editor.setCurrentTool(this.info.onInteractionEnd,this.info):this.parent.transition("idle",this.info)})}handleStart(){const n=this._getRotationFromPointerPosition({snapToNearestDegree:!1});Lf({editor:this.editor,delta:this._getRotationFromPointerPosition({snapToNearestDegree:!1}),snapshot:this.snapshot,stage:"start"}),this.editor.updateInstanceState({cursor:{type:Qc[this.info.handle],rotation:n+this.snapshot.initialSelectionRotation}})}_getRotationFromPointerPosition({snapToNearestDegree:n}){const{selectionRotatedPageBounds:r,selectionRotation:s,inputs:{shiftKey:o,currentPagePoint:i}}=this.editor,{initialCursorAngle:a,initialSelectionRotation:c}=this.snapshot;if(!r)return c;const u=r.center.clone().rotWith(r.point,s).angle(i)-a;let d=c+u;if(o)d=eg(d,24);else if(n&&(d=Math.round(d/d_)*d_,this.editor.instanceState.isCoarsePointer)){const h=eg(d,4),f=GT(d,h);Math.abs(f)<BN(5)&&(d=h)}return d-c}}y(M5,"id","rotating");class O5 extends re{constructor(){super(...arguments);y(this,"hits",new Set);y(this,"size",0);y(this,"scribble",{});y(this,"initialSelectedShapeIds",new Set);y(this,"newlySelectedShapeIds",new Set);y(this,"onEnter",()=>{this.initialSelectedShapeIds=new Set(this.editor.inputs.shiftKey?this.editor.selectedShapeIds:[]),this.newlySelectedShapeIds=new Set,this.size=0,this.hits.clear(),this.startScribble(),this.updateScribbleSelection(!0),requestAnimationFrame(()=>{this.editor.updateInstanceState({brush:null})})});y(this,"onExit",()=>{this.scribble.stop()});y(this,"onPointerMove",()=>{this.updateScribbleSelection(!0)});y(this,"onPointerUp",()=>{this.complete()});y(this,"onKeyDown",()=>{this.updateScribbleSelection(!1)});y(this,"onKeyUp",()=>{this.editor.inputs.altKey?this.updateScribbleSelection(!1):this.parent.transition("brushing",{})});y(this,"onCancel",()=>{this.cancel()});y(this,"onComplete",()=>{this.complete()});y(this,"startScribble",()=>{var n;this.scribble.tick&&this.editor.off("tick",(n=this.scribble)==null?void 0:n.tick),this.scribble=new cb({onUpdate:this.onScribbleUpdate,onComplete:this.onScribbleComplete,color:"selection-stroke",opacity:.32,size:12}),this.editor.on("tick",this.scribble.tick)});y(this,"pushPointToScribble",()=>{const{x:n,y:r}=this.editor.inputs.currentPagePoint;this.scribble.addPoint(n,r)});y(this,"onScribbleUpdate",n=>{this.editor.updateInstanceState({scribble:n})});y(this,"onScribbleComplete",()=>{this.editor.off("tick",this.scribble.tick),this.editor.updateInstanceState({scribble:null})})}updateScribbleSelection(n){const{zoomLevel:r,currentPageShapes:s,inputs:{shiftKey:o,originPagePoint:i,previousPagePoint:a,currentPagePoint:c}}=this.editor,{newlySelectedShapeIds:l,initialSelectedShapeIds:u}=this;n&&this.pushPointToScribble();const d=s;let h,f,p,m;for(let v=0,w=d.length;v<w;v++)if(h=d[v],f=this.editor.getShapeGeometry(h),!(this.editor.isShapeOfType(h,"group")||l.has(h.id)||this.editor.isShapeOfType(h,"frame")&&f.hitTestPoint(this.editor.getPointInShapeSpace(h,i),0,!1)||this.editor.isShapeOrAncestorLocked(h))&&(p=this.editor.getPointInShapeSpace(h,a),m=this.editor.getPointInShapeSpace(h,c),f.hitTestLineSegment(p,m,xs/r))){const x=this.editor.getOutermostSelectableShape(h),b=this.editor.getShapeMask(x.id);if(b&&_3(a,c,b)!==null&&!fs(c,b))continue;l.add(x.id)}this.editor.setSelectedShapeIds([...new Set(o?[...l,...u]:[...l])],!0)}complete(){this.parent.transition("idle",{})}cancel(){this.editor.setSelectedShapeIds([...this.initialSelectedShapeIds],!0),this.parent.transition("idle",{})}}y(O5,"id","scribble_brushing");const $P=100;class Xee{constructor(e){y(this,"prevDroppingShapeId",null);y(this,"currDroppingShapeId",null);y(this,"droppingNodeTimer",null);y(this,"dispose",()=>{this.clear()});this.editor=e,e.disposables.add(this.dispose)}updateDroppingNode(e,n){var r;if(this.droppingNodeTimer===null){const{currentPagePoint:s}=this.editor.inputs;this.currDroppingShapeId=((r=this.editor.getDroppingOverShape(s,e))==null?void 0:r.id)??null,this.setDragTimer(e,$P*10,n)}else this.editor.inputs.pointerVelocity.len()>.5&&(clearInterval(this.droppingNodeTimer),this.setDragTimer(e,$P,n))}setDragTimer(e,n,r){this.droppingNodeTimer=setTimeout(()=>{this.editor.batch(()=>{this.handleDrag(e,r)}),this.droppingNodeTimer=null},n)}handleDrag(e,n){var c,l,u,d,h;const{currentPagePoint:r}=this.editor.inputs;e=me(e.map(f=>this.editor.getShape(f.id)));const s=((c=this.editor.getDroppingOverShape(r,e))==null?void 0:c.id)??null;s!==this.currDroppingShapeId&&(this.prevDroppingShapeId=this.currDroppingShapeId,this.currDroppingShapeId=s);const{prevDroppingShapeId:o}=this;if(s===o)return;const i=o&&this.editor.getShape(o),a=s&&this.editor.getShape(s);if(this.prevDroppingShapeId=this.currDroppingShapeId,i&&((u=(l=this.editor.getShapeUtil(i)).onDragShapesOut)==null||u.call(l,i,e)),a){const f=(h=(d=this.editor.getShapeUtil(a)).onDragShapesOver)==null?void 0:h.call(d,a,e);f&&f.shouldHint&&this.editor.setHintingIds([a.id])}else this.editor.setHintingIds([]);n==null||n()}dropShapes(e){var r,s;const{currDroppingShapeId:n}=this;if(this.handleDrag(e),n){const o=this.editor.getShape(n);if(!o)return;(s=(r=this.editor.getShapeUtil(o)).onDropShapesOver)==null||s.call(r,o,e)}}clear(){this.prevDroppingShapeId=null,this.currDroppingShapeId=null,this.droppingNodeTimer!==null&&clearInterval(this.droppingNodeTimer),this.droppingNodeTimer=null,this.editor.setHintingIds([])}}class D5 extends re{constructor(){super(...arguments);y(this,"info",{});y(this,"selectionSnapshot",{});y(this,"snapshot",{});y(this,"markId","");y(this,"isCloning",!1);y(this,"isCreating",!1);y(this,"editAfterComplete",!1);y(this,"dragAndDropManager",new Xee(this.editor));y(this,"onEnter",n=>{const{isCreating:r=!1,editAfterComplete:s=!1}=n;this.info=n,this.parent.currentToolIdMask=n.onInteractionEnd,this.isCreating=r,this.editAfterComplete=s,this.markId=r?this.editor.mark(`creating:${this.editor.onlySelectedShape.id}`):this.editor.mark("translating"),this.handleEnter(n),this.editor.on("tick",this.updateParent)});y(this,"onExit",()=>{this.parent.currentToolIdMask=void 0,this.editor.off("tick",this.updateParent),this.selectionSnapshot={},this.snapshot={},this.editor.snaps.clear(),this.editor.updateInstanceState({cursor:{type:"default",rotation:0}},!0),this.dragAndDropManager.clear()});y(this,"onPointerMove",()=>{this.updateShapes()});y(this,"onKeyDown",()=>{if(this.editor.inputs.altKey&&!this.isCloning){this.startCloning();return}this.updateShapes()});y(this,"onKeyUp",()=>{if(!this.editor.inputs.altKey&&this.isCloning){this.stopCloning();return}this.updateShapes()});y(this,"onPointerUp",()=>{this.complete()});y(this,"onComplete",()=>{this.complete()});y(this,"onCancel",()=>{this.cancel()});y(this,"updateParent",()=>{const{snapshot:n}=this;this.dragAndDropManager.updateDroppingNode(n.movingShapes,this.updateParentTransforms)});y(this,"updateParentTransforms",()=>{const{editor:n,snapshot:{shapeSnapshots:r}}=this;r.forEach(s=>{const o=n.getShape(s.shape.id);if(!o)return null;const i=wn(o.parentId)?null:te.Inverse(n.getShapePageTransform(o.parentId));s.parentTransform=i})})}startCloning(){this.isCreating||(this.isCloning=!0,this.reset(),this.markId=this.editor.mark("translating"),this.editor.duplicateShapes(Array.from(this.editor.selectedShapeIds)),this.snapshot=TP(this.editor),this.handleStart(),this.updateShapes())}stopCloning(){this.isCloning=!1,this.snapshot=this.selectionSnapshot,this.reset(),this.markId=this.editor.mark("translating"),this.updateShapes()}reset(){this.editor.bailToMark(this.markId)}complete(){if(this.updateShapes(),this.dragAndDropManager.dropShapes(this.snapshot.movingShapes),this.handleEnd(),this.editor.instanceState.isToolLocked&&this.info.onInteractionEnd)this.editor.setCurrentTool(this.info.onInteractionEnd);else if(this.editAfterComplete){const n=this.editor.onlySelectedShape;n&&(this.editor.setEditingShapeId(n.id),this.editor.setCurrentTool("select"),this.editor.root.current.value.transition("editing_shape",{}))}else this.parent.transition("idle",{})}cancel(){this.reset(),this.info.onInteractionEnd?this.editor.setCurrentTool(this.info.onInteractionEnd):this.parent.transition("idle",this.info)}handleEnter(n){if(this.isCloning=!1,this.info=n,this.editor.updateInstanceState({cursor:{type:"move",rotation:0}},!0),this.selectionSnapshot=TP(this.editor),!this.isCreating&&this.editor.inputs.altKey){this.startCloning();return}this.snapshot=this.selectionSnapshot,this.handleStart(),this.updateShapes()}handleStart(){const{movingShapes:n}=this.snapshot,r=[];n.forEach(s=>{var a;const o=this.editor.getShapeUtil(s),i=(a=o.onTranslateStart)==null?void 0:a.call(o,s);i&&r.push(i)}),r.length>0&&this.editor.updateShapes(r)}handleEnd(){const{movingShapes:n}=this.snapshot,r=[];n.forEach(s=>{var c;const o=this.editor.getShape(s.id),i=this.editor.getShapeUtil(s),a=(c=i.onTranslateEnd)==null?void 0:c.call(i,s,o);a&&r.push(a)}),r.length>0&&this.editor.updateShapes(r)}handleChange(){const{movingShapes:n}=this.snapshot,r=[];n.forEach(s=>{var c;const o=this.editor.getShape(s.id),i=this.editor.getShapeUtil(s),a=(c=i.onTranslate)==null?void 0:c.call(i,s,o);a&&r.push(a)}),r.length>0&&this.editor.updateShapes(r)}updateShapes(){const{snapshot:n}=this;this.dragAndDropManager.updateDroppingNode(n.movingShapes,this.updateParentTransforms),qee({editor:this.editor,shapeSnapshots:n.shapeSnapshots,averagePagePoint:n.averagePagePoint,initialSelectionPageBounds:n.initialPageBounds,initialSelectionSnapPoints:n.initialSnapPoints}),this.handleChange()}}y(D5,"id","translating");function TP(t){const e=[],n=[],r=me(t.selectedShapeIds.map(s=>{const o=t.getShape(s);if(!o)return null;e.push(o);const i=t.getShapePageTransform(s).point();if(!i)return null;n.push(i);const a=Un.isId(o.parentId)?null:te.Inverse(t.getShapePageTransform(o.parentId));return{shape:o,pagePoint:i,parentTransform:a}}));return{averagePagePoint:P.Average(n),movingShapes:e,shapeSnapshots:r,initialPageBounds:t.selectionPageBounds,initialSnapPoints:t.selectedShapeIds.length===1?t.snaps.snapPointsCache.get(t.selectedShapeIds[0]):t.selectionPageBounds?t.selectionPageBounds.snapPoints.map((s,o)=>({id:"selection:"+o,x:s.x,y:s.y})):[]}}function qee({editor:t,shapeSnapshots:e,averagePagePoint:n,initialSelectionPageBounds:r,initialSelectionSnapPoints:s}){const{inputs:o,instanceState:{isGridMode:i},documentSettings:{gridSize:a}}=t,c=P.Sub(o.currentPagePoint,o.originPagePoint),l=t.inputs.shiftKey?Math.abs(c.x)<Math.abs(c.y)?"x":"y":null;if(l==="x"?c.x=0:l==="y"&&(c.y=0),t.snaps.clear(),(t.user.isSnapMode?!o.ctrlKey:o.ctrlKey)&&t.inputs.pointerVelocity.len()<.5){const{nudge:f}=t.snaps.snapTranslate({dragDelta:c,initialSelectionPageBounds:r,lockedAxis:l,initialSelectionSnapPoints:s});c.add(f)}const d=P.Add(n,c);i&&!o.ctrlKey&&d.snapToGrid(a);const h=P.Sub(d,n);t.updateShapes(me(e.map(({shape:f,pagePoint:p,parentTransform:m})=>{const v=P.Add(p,h),w=m?te.applyToPoint(m,v):v;return{id:f.id,type:f.type,x:w.x,y:w.y}})),!0)}class hp extends re{constructor(){super(...arguments);y(this,"onExit",()=>{this.editor.currentPageState.editingShapeId&&this.editor.setEditingShapeId(null)})}}y(hp,"id","select"),y(hp,"initial","idle"),y(hp,"children",()=>[dp,b5,Kee,E5,T5,D5,y5,O5,P5,$5,x5,_5,A5,M5,I5,k5,C5]);class R5 extends re{constructor(){super(...arguments);y(this,"info",{});y(this,"onEnter",n=>{this.info=n});y(this,"onPointerDown",()=>{this.parent.transition("pointing",this.info)})}}y(R5,"id","idle");class L5 extends re{constructor(){super(...arguments);y(this,"info",{});y(this,"onEnter",n=>{this.info=n});y(this,"onPointerUp",()=>{this.complete()});y(this,"onPointerMove",()=>{this.editor.inputs.isDragging&&this.parent.transition("zoom_brushing",this.info)});y(this,"onCancel",()=>{this.cancel()})}complete(){const{currentScreenPoint:n}=this.editor.inputs;this.editor.inputs.altKey?this.editor.zoomOut(n,{duration:220}):this.editor.zoomIn(n,{duration:220}),this.parent.transition("idle",this.info)}cancel(){this.parent.transition("idle",this.info)}}y(L5,"id","pointing");class j5 extends re{constructor(){super(...arguments);y(this,"info",{});y(this,"zoomBrush",new ae);y(this,"onEnter",n=>{this.info=n,this.update()});y(this,"onExit",()=>{this.editor.updateInstanceState({zoomBrush:null})});y(this,"onPointerMove",()=>{this.update()});y(this,"onPointerUp",()=>{this.complete()});y(this,"onCancel",()=>{this.cancel()})}update(){const{inputs:{originPagePoint:n,currentPagePoint:r}}=this.editor;this.zoomBrush.setTo(ae.FromPoints([n,r])),this.editor.updateInstanceState({zoomBrush:this.zoomBrush.toJson()})}cancel(){this.parent.transition("idle",this.info)}complete(){const{zoomBrush:n}=this,r=8/this.editor.zoomLevel;if(n.width<r&&n.height<r){const s=this.editor.inputs.currentScreenPoint;this.editor.inputs.altKey?this.editor.zoomOut(s,{duration:220}):this.editor.zoomIn(s,{duration:220})}else{const s=this.editor.inputs.altKey?this.editor.zoomLevel/2:void 0;this.editor.zoomToBounds(n,s,{duration:220})}this.parent.transition("idle",this.info)}}y(j5,"id","zoom_brushing");class fp extends re{constructor(){super(...arguments);y(this,"info",{});y(this,"onEnter",n=>{this.info=n,this.currentToolIdMask=n.onInteractionEnd,this.updateCursor()});y(this,"onExit",()=>{this.currentToolIdMask=void 0,this.editor.updateInstanceState({zoomBrush:null,cursor:{type:"default",rotation:0}},!0),this.currentToolIdMask=void 0});y(this,"onKeyDown",()=>{this.updateCursor()});y(this,"onKeyUp",n=>{this.updateCursor(),n.code==="KeyZ"&&this.complete()});y(this,"onInterrupt",()=>{this.complete()})}complete(){this.info.onInteractionEnd&&this.info.onInteractionEnd!=="select"?this.editor.setCurrentTool(this.info.onInteractionEnd,this.info):this.parent.transition("select",{})}updateCursor(){this.editor.inputs.altKey?this.editor.updateInstanceState({cursor:{type:"zoom-out",rotation:0}},!0):this.editor.updateInstanceState({cursor:{type:"zoom-in",rotation:0}},!0)}}y(fp,"id","zoom"),y(fp,"initial","idle"),y(fp,"children",()=>[R5,j5,L5]);const Qee=[cp,lp,up,fp,hp],N5=S.forwardRef((t,e)=>S.createElement(Fe.span,W({},t,{ref:e,style:{position:"absolute",border:0,width:1,height:1,padding:0,margin:-1,overflow:"hidden",clip:"rect(0, 0, 0, 0)",whiteSpace:"nowrap",wordWrap:"normal",...t.style}}))),z5="ToastProvider",[lb,Zee,Jee]=$m("Toast"),[F5,Jle]=oo("Toast",[Jee]),[ete,jm]=F5(z5),B5=t=>{const{__scopeToast:e,label:n="Notification",duration:r=5e3,swipeDirection:s="right",swipeThreshold:o=50,children:i}=t,[a,c]=S.useState(null),[l,u]=S.useState(0),d=S.useRef(!1),h=S.useRef(!1);return S.createElement(lb.Provider,{scope:e},S.createElement(ete,{scope:e,label:n,duration:r,swipeDirection:s,swipeThreshold:o,toastCount:l,viewport:a,onViewportChange:c,onToastAdd:S.useCallback(()=>u(f=>f+1),[]),onToastRemove:S.useCallback(()=>u(f=>f-1),[]),isFocusedToastEscapeKeyDownRef:d,isClosePausedRef:h},i))};B5.propTypes={label(t){if(t.label&&typeof t.label=="string"&&!t.label.trim()){const e=`Invalid prop \`label\` supplied to \`${z5}\`. Expected non-empty \`string\`.`;return new Error(e)}return null}};const tte="ToastViewport",nte=["F8"],pS="toast.viewportPause",gS="toast.viewportResume",rte=S.forwardRef((t,e)=>{const{__scopeToast:n,hotkey:r=nte,label:s="Notifications ({hotkey})",...o}=t,i=jm(tte,n),a=Zee(n),c=S.useRef(null),l=S.useRef(null),u=S.useRef(null),d=S.useRef(null),h=et(e,d,i.onViewportChange),f=r.join("+").replace(/Key/g,"").replace(/Digit/g,""),p=i.toastCount>0;S.useEffect(()=>{const v=w=>{var x;r.every(C=>w[C]||w.code===C)&&((x=d.current)===null||x===void 0||x.focus())};return document.addEventListener("keydown",v),()=>document.removeEventListener("keydown",v)},[r]),S.useEffect(()=>{const v=c.current,w=d.current;if(p&&v&&w){const x=()=>{if(!i.isClosePausedRef.current){const _=new CustomEvent(pS);w.dispatchEvent(_),i.isClosePausedRef.current=!0}},b=()=>{if(i.isClosePausedRef.current){const _=new CustomEvent(gS);w.dispatchEvent(_),i.isClosePausedRef.current=!1}},C=_=>{!v.contains(_.relatedTarget)&&b()},E=()=>{v.contains(document.activeElement)||b()};return v.addEventListener("focusin",x),v.addEventListener("focusout",C),v.addEventListener("pointermove",x),v.addEventListener("pointerleave",E),window.addEventListener("blur",x),window.addEventListener("focus",b),()=>{v.removeEventListener("focusin",x),v.removeEventListener("focusout",C),v.removeEventListener("pointermove",x),v.removeEventListener("pointerleave",E),window.removeEventListener("blur",x),window.removeEventListener("focus",b)}}},[p,i.isClosePausedRef]);const m=S.useCallback(({tabbingDirection:v})=>{const x=a().map(b=>{const C=b.ref.current,E=[C,...wte(C)];return v==="forwards"?E:E.reverse()});return(v==="forwards"?x.reverse():x).flat()},[a]);return S.useEffect(()=>{const v=d.current;if(v){const w=x=>{const b=x.altKey||x.ctrlKey||x.metaKey;if(x.key==="Tab"&&!b){const I=document.activeElement,$=x.shiftKey;if(x.target===v&&$){var E;(E=l.current)===null||E===void 0||E.focus();return}const L=m({tabbingDirection:$?"backwards":"forwards"}),j=L.findIndex(M=>M===I);if(L0(L.slice(j+1)))x.preventDefault();else{var _,k;$?(_=l.current)===null||_===void 0||_.focus():(k=u.current)===null||k===void 0||k.focus()}}};return v.addEventListener("keydown",w),()=>v.removeEventListener("keydown",w)}},[a,m]),S.createElement(fL,{ref:c,role:"region","aria-label":s.replace("{hotkey}",f),tabIndex:-1,style:{pointerEvents:p?void 0:"none"}},p&&S.createElement(AP,{ref:l,onFocusFromOutsideViewport:()=>{const v=m({tabbingDirection:"forwards"});L0(v)}}),S.createElement(lb.Slot,{scope:n},S.createElement(Fe.ol,W({tabIndex:-1},o,{ref:h}))),p&&S.createElement(AP,{ref:u,onFocusFromOutsideViewport:()=>{const v=m({tabbingDirection:"backwards"});L0(v)}}))}),ste="ToastFocusProxy",AP=S.forwardRef((t,e)=>{const{__scopeToast:n,onFocusFromOutsideViewport:r,...s}=t,o=jm(ste,n);return S.createElement(N5,W({"aria-hidden":!0,tabIndex:0},s,{ref:e,style:{position:"fixed"},onFocus:i=>{var a;const c=i.relatedTarget;!((a=o.viewport)!==null&&a!==void 0&&a.contains(c))&&r()}}))}),Nm="Toast",ote="toast.swipeStart",ite="toast.swipeMove",ate="toast.swipeCancel",cte="toast.swipeEnd",lte=S.forwardRef((t,e)=>{const{forceMount:n,open:r,defaultOpen:s,onOpenChange:o,...i}=t,[a=!0,c]=Ca({prop:r,defaultProp:s,onChange:o});return S.createElement(io,{present:n||a},S.createElement(U5,W({open:a},i,{ref:e,onClose:()=>c(!1),onPause:rn(t.onPause),onResume:rn(t.onResume),onSwipeStart:oe(t.onSwipeStart,l=>{l.currentTarget.setAttribute("data-swipe","start")}),onSwipeMove:oe(t.onSwipeMove,l=>{const{x:u,y:d}=l.detail.delta;l.currentTarget.setAttribute("data-swipe","move"),l.currentTarget.style.setProperty("--radix-toast-swipe-move-x",`${u}px`),l.currentTarget.style.setProperty("--radix-toast-swipe-move-y",`${d}px`)}),onSwipeCancel:oe(t.onSwipeCancel,l=>{l.currentTarget.setAttribute("data-swipe","cancel"),l.currentTarget.style.removeProperty("--radix-toast-swipe-move-x"),l.currentTarget.style.removeProperty("--radix-toast-swipe-move-y"),l.currentTarget.style.removeProperty("--radix-toast-swipe-end-x"),l.currentTarget.style.removeProperty("--radix-toast-swipe-end-y")}),onSwipeEnd:oe(t.onSwipeEnd,l=>{const{x:u,y:d}=l.detail.delta;l.currentTarget.setAttribute("data-swipe","end"),l.currentTarget.style.removeProperty("--radix-toast-swipe-move-x"),l.currentTarget.style.removeProperty("--radix-toast-swipe-move-y"),l.currentTarget.style.setProperty("--radix-toast-swipe-end-x",`${u}px`),l.currentTarget.style.setProperty("--radix-toast-swipe-end-y",`${d}px`),c(!1)})})))}),[ute,dte]=F5(Nm,{onClose(){}}),U5=S.forwardRef((t,e)=>{const{__scopeToast:n,type:r="foreground",duration:s,open:o,onClose:i,onEscapeKeyDown:a,onPause:c,onResume:l,onSwipeStart:u,onSwipeMove:d,onSwipeCancel:h,onSwipeEnd:f,...p}=t,m=jm(Nm,n),[v,w]=S.useState(null),x=et(e,M=>w(M)),b=S.useRef(null),C=S.useRef(null),E=s||m.duration,_=S.useRef(0),k=S.useRef(E),I=S.useRef(0),{onToastAdd:$,onToastRemove:A}=m,D=rn(()=>{var M;(v==null?void 0:v.contains(document.activeElement))&&((M=m.viewport)===null||M===void 0||M.focus()),i()}),L=S.useCallback(M=>{!M||M===1/0||(window.clearTimeout(I.current),_.current=new Date().getTime(),I.current=window.setTimeout(D,M))},[D]);S.useEffect(()=>{const M=m.viewport;if(M){const B=()=>{L(k.current),l==null||l()},U=()=>{const q=new Date().getTime()-_.current;k.current=k.current-q,window.clearTimeout(I.current),c==null||c()};return M.addEventListener(pS,U),M.addEventListener(gS,B),()=>{M.removeEventListener(pS,U),M.removeEventListener(gS,B)}}},[m.viewport,E,c,l,L]),S.useEffect(()=>{o&&!m.isClosePausedRef.current&&L(E)},[o,E,m.isClosePausedRef,L]),S.useEffect(()=>($(),()=>A()),[$,A]);const j=S.useMemo(()=>v?W5(v):null,[v]);return m.viewport?S.createElement(S.Fragment,null,j&&S.createElement(hte,{__scopeToast:n,role:"status","aria-live":r==="foreground"?"assertive":"polite","aria-atomic":!0},j),S.createElement(ute,{scope:n,onClose:D},so.createPortal(S.createElement(lb.ItemSlot,{scope:n},S.createElement(hL,{asChild:!0,onEscapeKeyDown:oe(a,()=>{m.isFocusedToastEscapeKeyDownRef.current||D(),m.isFocusedToastEscapeKeyDownRef.current=!1})},S.createElement(Fe.li,W({role:"status","aria-live":"off","aria-atomic":!0,tabIndex:0,"data-state":o?"open":"closed","data-swipe-direction":m.swipeDirection},p,{ref:x,style:{userSelect:"none",touchAction:"none",...t.style},onKeyDown:oe(t.onKeyDown,M=>{M.key==="Escape"&&(a==null||a(M.nativeEvent),M.nativeEvent.defaultPrevented||(m.isFocusedToastEscapeKeyDownRef.current=!0,D()))}),onPointerDown:oe(t.onPointerDown,M=>{M.button===0&&(b.current={x:M.clientX,y:M.clientY})}),onPointerMove:oe(t.onPointerMove,M=>{if(!b.current)return;const B=M.clientX-b.current.x,U=M.clientY-b.current.y,q=!!C.current,N=["left","right"].includes(m.swipeDirection),F=["left","up"].includes(m.swipeDirection)?Math.min:Math.max,K=N?F(0,B):0,Q=N?0:F(0,U),ne=M.pointerType==="touch"?10:2,we={x:K,y:Q},ke={originalEvent:M,delta:we};q?(C.current=we,rf(ite,d,ke,{discrete:!1})):MP(we,m.swipeDirection,ne)?(C.current=we,rf(ote,u,ke,{discrete:!1}),M.target.setPointerCapture(M.pointerId)):(Math.abs(B)>ne||Math.abs(U)>ne)&&(b.current=null)}),onPointerUp:oe(t.onPointerUp,M=>{const B=C.current,U=M.target;if(U.hasPointerCapture(M.pointerId)&&U.releasePointerCapture(M.pointerId),C.current=null,b.current=null,B){const q=M.currentTarget,N={originalEvent:M,delta:B};MP(B,m.swipeDirection,m.swipeThreshold)?rf(cte,f,N,{discrete:!0}):rf(ate,h,N,{discrete:!0}),q.addEventListener("click",F=>F.preventDefault(),{once:!0})}})})))),m.viewport))):null});U5.propTypes={type(t){if(t.type&&!["foreground","background"].includes(t.type)){const e=`Invalid prop \`type\` supplied to \`${Nm}\`. Expected \`foreground | background\`.`;return new Error(e)}return null}};const hte=t=>{const{__scopeToast:e,children:n,...r}=t,s=jm(Nm,e),[o,i]=S.useState(!1),[a,c]=S.useState(!1);return yte(()=>i(!0)),S.useEffect(()=>{const l=window.setTimeout(()=>c(!0),1e3);return()=>window.clearTimeout(l)},[]),a?null:S.createElement(N1,{asChild:!0},S.createElement(N5,r,o&&S.createElement(S.Fragment,null,s.label," ",n)))},fte=S.forwardRef((t,e)=>{const{__scopeToast:n,...r}=t;return S.createElement(Fe.div,W({},r,{ref:e}))}),pte=S.forwardRef((t,e)=>{const{__scopeToast:n,...r}=t;return S.createElement(Fe.div,W({},r,{ref:e}))}),gte="ToastAction",H5=S.forwardRef((t,e)=>{const{altText:n,...r}=t;return n?S.createElement(V5,{altText:n,asChild:!0},S.createElement(K5,W({},r,{ref:e}))):null});H5.propTypes={altText(t){return t.altText?null:new Error(`Missing prop \`altText\` expected on \`${gte}\``)}};const mte="ToastClose",K5=S.forwardRef((t,e)=>{const{__scopeToast:n,...r}=t,s=dte(mte,n);return S.createElement(V5,{asChild:!0},S.createElement(Fe.button,W({type:"button"},r,{ref:e,onClick:oe(t.onClick,s.onClose)})))}),V5=S.forwardRef((t,e)=>{const{__scopeToast:n,altText:r,...s}=t;return S.createElement(Fe.div,W({"data-radix-toast-announce-exclude":"","data-radix-toast-announce-alt":r||void 0},s,{ref:e}))});function W5(t){const e=[];return Array.from(t.childNodes).forEach(r=>{if(r.nodeType===r.TEXT_NODE&&r.textContent&&e.push(r.textContent),vte(r)){const s=r.ariaHidden||r.hidden||r.style.display==="none",o=r.dataset.radixToastAnnounceExclude==="";if(!s)if(o){const i=r.dataset.radixToastAnnounceAlt;i&&e.push(i)}else e.push(...W5(r))}}),e}function rf(t,e,n,{discrete:r}){const s=n.originalEvent.currentTarget,o=new CustomEvent(t,{bubbles:!0,cancelable:!0,detail:n});e&&s.addEventListener(t,e,{once:!0}),r?L1(s,o):s.dispatchEvent(o)}const MP=(t,e,n=0)=>{const r=Math.abs(t.x),s=Math.abs(t.y),o=r>s;return e==="left"||e==="right"?o&&r>n:!o&&s>n};function yte(t=()=>{}){const e=rn(t);ua(()=>{let n=0,r=0;return n=window.requestAnimationFrame(()=>r=window.requestAnimationFrame(e)),()=>{window.cancelAnimationFrame(n),window.cancelAnimationFrame(r)}},[e])}function vte(t){return t.nodeType===t.ELEMENT_NODE}function wte(t){const e=[],n=document.createTreeWalker(t,NodeFilter.SHOW_ELEMENT,{acceptNode:r=>{const s=r.tagName==="INPUT"&&r.type==="hidden";return r.disabled||r.hidden||s?NodeFilter.FILTER_SKIP:r.tabIndex>=0?NodeFilter.FILTER_ACCEPT:NodeFilter.FILTER_SKIP}});for(;n.nextNode();)e.push(n.currentNode);return e}function L0(t){const e=document.activeElement;return t.some(n=>n===e?!0:(n.focus(),document.activeElement!==e))}const Ste=lte,xte=fte,bte=pte,Cte=H5,OP=K5,Gi="2.0.0-canary.c7ae756c0b81";let mS={fonts:{draw:`https://unpkg.com/@tldraw/assets@${Gi}/fonts/Shantell_Sans-Normal-SemiBold.woff2`,serif:`https://unpkg.com/@tldraw/assets@${Gi}/fonts/IBMPlexSerif-Medium.woff2`,sansSerif:`https://unpkg.com/@tldraw/assets@${Gi}/fonts/IBMPlexSans-Medium.woff2`,monospace:`https://unpkg.com/@tldraw/assets@${Gi}/fonts/IBMPlexMono-Medium.woff2`}};function _te(t){return S.useMemo(()=>t?{fonts:{...mS.fonts,...t==null?void 0:t.fonts}}:mS,[t])}const Ete=["align-bottom-center","align-bottom-left","align-bottom-right","align-bottom","align-center-center","align-center-horizontal","align-center-left","align-center-right","align-center-vertical","align-left","align-right","align-top-center","align-top-left","align-top-right","align-top","arrow-left","arrowhead-arrow","arrowhead-bar","arrowhead-diamond","arrowhead-dot","arrowhead-none","arrowhead-square","arrowhead-triangle-inverted","arrowhead-triangle","aspect-ratio","avatar","blob","bring-forward","bring-to-front","check","checkbox-checked","checkbox-empty","chevron-down","chevron-left","chevron-right","chevron-up","chevrons-ne","chevrons-sw","clipboard-copied","clipboard-copy","code","collab","color","comment","cross-2","cross","dash-dashed","dash-dotted","dash-draw","dash-solid","discord","distribute-horizontal","distribute-vertical","dot","dots-horizontal","dots-vertical","drag-handle-dots","duplicate","edit","external-link","file","fill-none","fill-pattern","fill-semi","fill-solid","follow","following","font-draw","font-mono","font-sans","font-serif","geo-arrow-down","geo-arrow-left","geo-arrow-right","geo-arrow-up","geo-check-box","geo-cloud","geo-diamond","geo-ellipse","geo-hexagon","geo-octagon","geo-oval","geo-pentagon","geo-rectangle","geo-rhombus-2","geo-rhombus","geo-star","geo-trapezoid","geo-triangle","geo-x-box","github","group","hidden","image","info-circle","leading","link","lock-small","lock","menu","minus","mixed","pack","page","plus","question-mark-circle","question-mark","redo","reset-zoom","rotate-ccw","rotate-cw","ruler","search","send-backward","send-to-back","settings-horizontal","settings-vertical-1","settings-vertical","share-1","share-2","size-extra-large","size-large","size-medium","size-small","spline-cubic","spline-line","stack-horizontal","stack-vertical","stretch-horizontal","stretch-vertical","text-align-center","text-align-justify","text-align-left","text-align-right","tool-arrow","tool-embed","tool-eraser","tool-frame","tool-hand","tool-highlight","tool-laser","tool-line","tool-media","tool-note","tool-pencil","tool-pointer","tool-text","trash","triangle-down","triangle-up","twitter","undo","ungroup","unlock-small","unlock","vertical-align-center","vertical-align-end","vertical-align-start","visible","warning-triangle","zoom-in","zoom-out"];let Wl={...mS,icons:Object.fromEntries(Ete.map(t=>[t,`https://unpkg.com/@tldraw/assets@${Gi}/icons/icon/${t}.svg`])),translations:Object.fromEntries(qu.map(t=>[t.locale,`https://unpkg.com/@tldraw/assets@${Gi}/translations/${t.locale}.json`])),embedIcons:Object.fromEntries(Wc.map(t=>[t.type,`https://unpkg.com/@tldraw/assets@${Gi}/embed-icons/${t.type}.png`]))};function Pte(t){return t?{fonts:Object.assign({...Wl.fonts},{...t==null?void 0:t.fonts}),icons:Object.assign({...Wl.icons},{...t==null?void 0:t.icons}),embedIcons:Object.assign({...Wl.embedIcons},{...t==null?void 0:t.embedIcons}),translations:Object.assign({...Wl.translations},{...t==null?void 0:t.translations})}:Wl}const ub=S.forwardRef(function({className:e,label:n,icon:r,iconLeft:s,autoselect:o=!1,autofocus:i=!1,defaultValue:a,placeholder:c,onComplete:l,onValueChange:u,onCancel:d,onBlur:h,shouldManuallyMaintainScrollPositionWhenFocused:f=!1,children:p,value:m},v){const w=H(),x=S.useRef(null);S.useImperativeHandle(v,()=>x.current);const b=be(),C=S.useRef(a??""),E=S.useRef(a??""),[_,k]=S.useState(!1),I=S.useCallback(L=>{k(!0);const j=L.currentTarget;E.current=j.value,requestAnimationFrame(()=>{o&&j.select()})},[o]),$=S.useCallback(L=>{const j=L.currentTarget.value;E.current=j,u==null||u(j)},[u]),A=S.useCallback(L=>{switch(L.key){case"Enter":{L.currentTarget.blur(),L.stopPropagation(),l==null||l(L.currentTarget.value);break}case"Escape":{L.currentTarget.value=C.current,L.currentTarget.blur(),L.stopPropagation(),d==null||d(L.currentTarget.value);break}}},[l,d]),D=S.useCallback(L=>{k(!1);const j=L.currentTarget.value;h==null||h(j)},[h]);return S.useEffect(()=>{if(!w.environment.isIos)return;const L=window.visualViewport;if(_&&f&&L){const j=()=>{var M;(M=x.current)==null||M.scrollIntoView({block:"center"})};return L.addEventListener("resize",j),L.addEventListener("scroll",j),requestAnimationFrame(()=>{var M;(M=x.current)==null||M.scrollIntoView({block:"center"})}),()=>{L.removeEventListener("resize",j),L.removeEventListener("scroll",j)}}},[w,_,f]),g.jsxs("div",{draggable:!1,className:"tlui-input__wrapper",children:[p,n&&g.jsx("label",{children:b(n)}),s&&g.jsx(In,{icon:s,className:"tlui-icon-left",small:!0}),g.jsx("input",{ref:x,className:le("tlui-input",e),type:"text",defaultValue:a,onKeyUp:A,onChange:$,onFocus:I,onBlur:D,autoFocus:i,placeholder:c,value:m}),r&&g.jsx(In,{icon:r,small:!!n})]})});function DP(t){return Ow(t)?{isValid:!0,hasProtocol:!0}:Ow("https://"+t)?{isValid:!0,hasProtocol:!1}:{isValid:!1,hasProtocol:!1}}const kte=Ee(function({onClose:e}){const r=H().onlySelectedShape;return r&&"url"in r.props&&typeof r.props.url=="string"?g.jsx(Ite,{onClose:e,selectedShape:r}):null}),Ite=Ee(function({onClose:e,selectedShape:n}){const r=H(),s=be(),o=S.useRef(null);S.useEffect(()=>{requestAnimationFrame(()=>{var p;return(p=o.current)==null?void 0:p.focus()})},[]);const i=S.useRef(n.props.url),[a,c]=S.useState(()=>{const p=DP(n.props.url),m=p.isValid===!0?p.hasProtocol?n.props.url:"https://"+n.props.url:"https://";return{actual:m,safe:m,valid:!0}}),l=S.useCallback(p=>{const m=p.replace(/https?:\/\/(https?:\/\/)/,(x,b)=>b),v=DP(m),w=v.isValid===!0?v.hasProtocol?m:"https://"+m:"https://";c({actual:m,safe:w,valid:v.isValid})},[]),u=S.useCallback(()=>{const{onlySelectedShape:p}=r;p&&(r.updateShapes([{id:p.id,type:p.type,props:{url:""}}]),e())},[r,e]),d=S.useCallback(()=>{const{onlySelectedShape:p}=r;p&&(p&&"url"in p.props&&p.props.url!==a.safe&&r.updateShapes([{id:p.id,type:p.type,props:{url:a.safe}}]),e())},[r,e,a]),h=S.useCallback(()=>{e()},[e]);if(!n)return e(),null;const f=i.current&&!a.valid;return g.jsxs(g.Fragment,{children:[g.jsxs(Pm,{children:[g.jsx(km,{children:s("edit-link-dialog.title")}),g.jsx(Im,{})]}),g.jsx(rd,{children:g.jsxs("div",{className:"tlui-edit-link-dialog",children:[g.jsx(ub,{ref:o,className:"tlui-edit-link-dialog__input",label:"edit-link-dialog.url",autofocus:!0,value:a.actual,onValueChange:l,onComplete:d,onCancel:h}),g.jsx("div",{children:a.valid?s("edit-link-dialog.detail"):s("edit-link-dialog.invalid-url")})]})}),g.jsxs(Nx,{className:"tlui-dialog__footer__actions",children:[g.jsx(se,{onClick:h,onTouchEnd:h,children:s("edit-link-dialog.cancel")}),f?g.jsx(se,{type:"danger",onTouchEnd:u,onClick:u,children:s("edit-link-dialog.clear")}):g.jsx(se,{type:"primary",disabled:!a.valid,onTouchEnd:d,onClick:d,children:s("edit-link-dialog.save")})]})]})}),G5=Ee(function({onClose:e}){const n=H(),r=be(),s=jx(),[o,i]=S.useState(null),[a,c]=S.useState(""),[l,u]=S.useState(null),[d,h]=S.useState(!1),f=S.useRef(-1);return g.jsxs(g.Fragment,{children:[g.jsxs(Pm,{children:[g.jsx(km,{children:o?`${r("embed-dialog.title")}  ${o.title}`:r("embed-dialog.title")}),g.jsx(Im,{})]}),o?g.jsxs(g.Fragment,{children:[g.jsxs(rd,{className:"tlui-embed-dialog__enter",children:[g.jsx(ub,{className:"tlui-embed-dialog__input",label:"embed-dialog.url",placeholder:"http://example.com",autofocus:!0,onValueChange:p=>{c(p);const m=Rs(p);u(m&&m.definition.type===o.type?m:null),h(!1),clearTimeout(f.current),f.current=setTimeout(()=>h(!m),320)}}),a===""?g.jsxs("div",{className:"tlui-embed-dialog__instruction",children:[g.jsx("span",{children:r("embed-dialog.instruction")})," ",o.instructionLink&&g.jsxs("a",{target:"_blank",rel:"noopener noreferrer",href:o.instructionLink,className:"tlui-embed-dialog__instruction__link",children:["Learn more.",g.jsx(In,{icon:"external-link",small:!0})]})]}):g.jsx("div",{className:"tlui-embed-dialog__warning",children:d?r("embed-dialog.invalid-url"):""})]}),g.jsxs(Nx,{className:"tlui-dialog__footer__actions",children:[g.jsx(se,{onClick:()=>{i(null),u(null),c("")},label:"embed-dialog.back"}),g.jsx("div",{className:"tlui-embed__spacer"}),g.jsx(se,{label:"embed-dialog.cancel",onClick:e}),g.jsx(se,{type:"primary",disabled:!l,label:"embed-dialog.create",onClick:()=>{l&&(n.putExternalContent({type:"embed",url:a,point:n.viewportPageCenter,embed:l.definition}),e())}})]})]}):g.jsxs(g.Fragment,{children:[g.jsx(rd,{className:"tlui-embed-dialog__list",children:Wc.map(p=>g.jsxs("button",{className:"tlui-embed-dialog__item",onClick:()=>i(p),children:[g.jsx("div",{className:"tlui-embed-dialog__item__image",children:g.jsx("div",{className:"tlui-embed-dialog__item__image__img",style:{backgroundImage:`url(${s.embedIcons[p.type]})`}})}),g.jsx("div",{className:"tlui-embed-dialog__item__title",children:p.title})]},p.type))}),g.jsx("div",{className:"tlui-dialog__scrim"})]})]})});var db={exports:{}};db.exports;(function(t){var e=function(){var n=String.fromCharCode,r="ABCDEFGHIJKLMNOPQRSTUVWXYZabcdefghijklmnopqrstuvwxyz0123456789+/=",s="ABCDEFGHIJKLMNOPQRSTUVWXYZabcdefghijklmnopqrstuvwxyz0123456789+-$",o={};function i(c,l){if(!o[c]){o[c]={};for(var u=0;u<c.length;u++)o[c][c.charAt(u)]=u}return o[c][l]}var a={compressToBase64:function(c){if(c==null)return"";var l=a._compress(c,6,function(u){return r.charAt(u)});switch(l.length%4){default:case 0:return l;case 1:return l+"===";case 2:return l+"==";case 3:return l+"="}},decompressFromBase64:function(c){return c==null?"":c==""?null:a._decompress(c.length,32,function(l){return i(r,c.charAt(l))})},compressToUTF16:function(c){return c==null?"":a._compress(c,15,function(l){return n(l+32)})+" "},decompressFromUTF16:function(c){return c==null?"":c==""?null:a._decompress(c.length,16384,function(l){return c.charCodeAt(l)-32})},compressToUint8Array:function(c){for(var l=a.compress(c),u=new Uint8Array(l.length*2),d=0,h=l.length;d<h;d++){var f=l.charCodeAt(d);u[d*2]=f>>>8,u[d*2+1]=f%256}return u},decompressFromUint8Array:function(c){if(c==null)return a.decompress(c);for(var l=new Array(c.length/2),u=0,d=l.length;u<d;u++)l[u]=c[u*2]*256+c[u*2+1];var h=[];return l.forEach(function(f){h.push(n(f))}),a.decompress(h.join(""))},compressToEncodedURIComponent:function(c){return c==null?"":a._compress(c,6,function(l){return s.charAt(l)})},decompressFromEncodedURIComponent:function(c){return c==null?"":c==""?null:(c=c.replace(/ /g,"+"),a._decompress(c.length,32,function(l){return i(s,c.charAt(l))}))},compress:function(c){return a._compress(c,16,function(l){return n(l)})},_compress:function(c,l,u){if(c==null)return"";var d,h,f={},p={},m="",v="",w="",x=2,b=3,C=2,E=[],_=0,k=0,I;for(I=0;I<c.length;I+=1)if(m=c.charAt(I),Object.prototype.hasOwnProperty.call(f,m)||(f[m]=b++,p[m]=!0),v=w+m,Object.prototype.hasOwnProperty.call(f,v))w=v;else{if(Object.prototype.hasOwnProperty.call(p,w)){if(w.charCodeAt(0)<256){for(d=0;d<C;d++)_=_<<1,k==l-1?(k=0,E.push(u(_)),_=0):k++;for(h=w.charCodeAt(0),d=0;d<8;d++)_=_<<1|h&1,k==l-1?(k=0,E.push(u(_)),_=0):k++,h=h>>1}else{for(h=1,d=0;d<C;d++)_=_<<1|h,k==l-1?(k=0,E.push(u(_)),_=0):k++,h=0;for(h=w.charCodeAt(0),d=0;d<16;d++)_=_<<1|h&1,k==l-1?(k=0,E.push(u(_)),_=0):k++,h=h>>1}x--,x==0&&(x=Math.pow(2,C),C++),delete p[w]}else for(h=f[w],d=0;d<C;d++)_=_<<1|h&1,k==l-1?(k=0,E.push(u(_)),_=0):k++,h=h>>1;x--,x==0&&(x=Math.pow(2,C),C++),f[v]=b++,w=String(m)}if(w!==""){if(Object.prototype.hasOwnProperty.call(p,w)){if(w.charCodeAt(0)<256){for(d=0;d<C;d++)_=_<<1,k==l-1?(k=0,E.push(u(_)),_=0):k++;for(h=w.charCodeAt(0),d=0;d<8;d++)_=_<<1|h&1,k==l-1?(k=0,E.push(u(_)),_=0):k++,h=h>>1}else{for(h=1,d=0;d<C;d++)_=_<<1|h,k==l-1?(k=0,E.push(u(_)),_=0):k++,h=0;for(h=w.charCodeAt(0),d=0;d<16;d++)_=_<<1|h&1,k==l-1?(k=0,E.push(u(_)),_=0):k++,h=h>>1}x--,x==0&&(x=Math.pow(2,C),C++),delete p[w]}else for(h=f[w],d=0;d<C;d++)_=_<<1|h&1,k==l-1?(k=0,E.push(u(_)),_=0):k++,h=h>>1;x--,x==0&&(x=Math.pow(2,C),C++)}for(h=2,d=0;d<C;d++)_=_<<1|h&1,k==l-1?(k=0,E.push(u(_)),_=0):k++,h=h>>1;for(;;)if(_=_<<1,k==l-1){E.push(u(_));break}else k++;return E.join("")},decompress:function(c){return c==null?"":c==""?null:a._decompress(c.length,32768,function(l){return c.charCodeAt(l)})},_decompress:function(c,l,u){var d=[],h=4,f=4,p=3,m="",v=[],w,x,b,C,E,_,k,I={val:u(0),position:l,index:1};for(w=0;w<3;w+=1)d[w]=w;for(b=0,E=Math.pow(2,2),_=1;_!=E;)C=I.val&I.position,I.position>>=1,I.position==0&&(I.position=l,I.val=u(I.index++)),b|=(C>0?1:0)*_,_<<=1;switch(b){case 0:for(b=0,E=Math.pow(2,8),_=1;_!=E;)C=I.val&I.position,I.position>>=1,I.position==0&&(I.position=l,I.val=u(I.index++)),b|=(C>0?1:0)*_,_<<=1;k=n(b);break;case 1:for(b=0,E=Math.pow(2,16),_=1;_!=E;)C=I.val&I.position,I.position>>=1,I.position==0&&(I.position=l,I.val=u(I.index++)),b|=(C>0?1:0)*_,_<<=1;k=n(b);break;case 2:return""}for(d[3]=k,x=k,v.push(k);;){if(I.index>c)return"";for(b=0,E=Math.pow(2,p),_=1;_!=E;)C=I.val&I.position,I.position>>=1,I.position==0&&(I.position=l,I.val=u(I.index++)),b|=(C>0?1:0)*_,_<<=1;switch(k=b){case 0:for(b=0,E=Math.pow(2,8),_=1;_!=E;)C=I.val&I.position,I.position>>=1,I.position==0&&(I.position=l,I.val=u(I.index++)),b|=(C>0?1:0)*_,_<<=1;d[f++]=n(b),k=f-1,h--;break;case 1:for(b=0,E=Math.pow(2,16),_=1;_!=E;)C=I.val&I.position,I.position>>=1,I.position==0&&(I.position=l,I.val=u(I.index++)),b|=(C>0?1:0)*_,_<<=1;d[f++]=n(b),k=f-1,h--;break;case 2:return v.join("")}if(h==0&&(h=Math.pow(2,p),p++),d[k])m=d[k];else if(k===f)m=x+x.charAt(0);else return null;v.push(m),d[f++]=x+m.charAt(0),h--,x=m,h==0&&(h=Math.pow(2,p),p++)}}};return a}();t!=null?t.exports=e:typeof angular<"u"&&angular!=null&&angular.module("LZString",[]).factory("LZString",function(){return e})})(db);var Y5=db.exports;async function $te(t,e,n){var w,x,b;const{elements:r,files:s}=e,o={shapes:[],rootShapeIds:[],assets:[],schema:t.store.schema.serialize()},i=new Map,a=new Map,{currentPageId:c}=t,l=new Map,u=[],d=new Set;r.forEach(C=>{if(l.set(C.id,Ke()),C.boundElements!==null)for(const E of C.boundElements)E.type==="text"&&d.add(E.id)});let h="a1";for(const C of r){if(d.has(C.id))continue;const E=l.get(C.id),_={id:E,typeName:"shape",parentId:c,index:h,x:C.x,y:C.y,rotation:0,isLocked:C.locked,opacity:Tte(C.opacity),meta:{}};switch(C.angle!==0&&a.set(E,C.angle),C.groupIds&&C.groupIds.length>0?i.has(C.groupIds[0])?(w=i.get(C.groupIds[0]))==null||w.push(E):i.set(C.groupIds[0],[E]):u.push(E),C.type){case"rectangle":case"ellipse":case"diamond":{let k="",I="middle";if(C.boundElements!==null){for(const A of C.boundElements)if(A.type==="text"){const D=r.find(L=>L.id===A.id);D&&(k=D.text,I=RP[D.textAlign])}}const $=C.backgroundColor==="transparent"?C.strokeColor:C.backgroundColor;o.shapes.push({..._,type:"geo",props:{geo:C.type,url:C.link??"",w:C.width,h:C.height,size:sf[C.strokeWidth]??"draw",color:Gl[$]??"black",text:k,align:I,dash:of(C),fill:jte(C)}});break}case"freedraw":{o.shapes.push({..._,type:"draw",props:{dash:of(C),size:sf[C.strokeWidth],color:Gl[C.strokeColor]??"black",segments:[{type:"free",points:C.points.map(([k,I,$=.5])=>({x:k,y:I,z:$}))}]}});break}case"line":{const k=C.points[0],I=C.points[C.points.length-1],$=A3(C.points.length);o.shapes.push({..._,type:"line",props:{dash:of(C),size:sf[C.strokeWidth],color:Gl[C.strokeColor]??"black",spline:C.roundness?"cubic":"line",handles:{start:{id:"start",type:"vertex",index:$[0],x:k[0],y:k[1]},end:{id:"end",type:"vertex",index:$[$.length-1],x:I[0],y:I[1]},...Object.fromEntries(C.points.slice(1,-1).map(([A,D],L)=>{const j=Ze();return[j,{id:j,type:"vertex",index:$[L+1],x:A,y:D}]}))}}});break}case"arrow":{let k="";if(C.boundElements!==null){for(const L of C.boundElements)if(L.type==="text"){const j=r.find(M=>M.id===L.id);j&&(k=j.text)}}const I=C.points[0],$=C.points[C.points.length-1],A=l.get((x=C.startBinding)==null?void 0:x.elementId),D=l.get((b=C.endBinding)==null?void 0:b.elementId);o.shapes.push({..._,type:"arrow",props:{text:k,bend:Lte(C,I,$),dash:of(C),size:sf[C.strokeWidth]??"m",color:Gl[C.strokeColor]??"black",start:A?{type:"binding",boundShapeId:A,normalizedAnchor:{x:.5,y:.5},isExact:!1}:{type:"point",x:I[0],y:I[1]},end:D?{type:"binding",boundShapeId:D,normalizedAnchor:{x:.5,y:.5},isExact:!1}:{type:"point",x:$[0],y:$[1]},arrowheadEnd:LP[C.endArrowhead]??"none",arrowheadStart:LP[C.startArrowhead]??"none"}});break}case"text":{const{size:k,scale:I}=Mte(C.fontSize);o.shapes.push({..._,type:"text",props:{size:k,scale:I,font:Ote[C.fontFamily]??"draw",color:Gl[C.strokeColor]??"black",text:C.text,align:RP[C.textAlign]}});break}case"image":{const k=s[C.fileId];if(!k)break;const I=$c.createId();o.assets.push({id:I,typeName:"asset",type:"image",props:{w:C.width,h:C.height,name:C.id??"Untitled",isAnimated:!1,mimeType:k.mimeType,src:k.dataURL},meta:{}}),o.shapes.push({..._,type:"image",props:{w:C.width,h:C.height,assetId:I}})}}h=Ms(h)}const f=n??(t.inputs.shiftKey?t.inputs.currentPagePoint:void 0);t.mark("paste"),t.putContent(o,{point:f,select:!1,preserveIds:!0});for(const C of i.values())if(C.length>1){t.groupShapes(C);const E=t.getShape(C[0]);E!=null&&E.parentId&&ar(E.parentId)&&u.push(E.parentId)}for(const[C,E]of a)t.select(C),t.rotateShapesBy([C],E);const p=me(u.map(C=>t.getShape(C))),m=ae.Common(p.map(C=>t.getShapePageBounds(C))),v=t.viewportPageBounds.center;t.updateShapes(p.map(C=>{const E={x:(C.x??0)-(m.x+m.w/2),y:(C.y??0)-(m.y+m.h/2)};return{id:C.id,type:C.type,x:v.x+E.x,y:v.y+E.y}})),t.setSelectedShapeIds(u)}const Tte=t=>{const e=t/100;return e<.2?.1:e<.4?.25:e<.6?.5:e<.8?.75:1},sf={1:"s",2:"m",3:"l",4:"xl"},Ate={16:"s",20:"m",28:"l",36:"xl"};function Mte(t){const e=Ate[t];return e?{size:e,scale:1}:t<16?{size:"s",scale:t/16}:t>36?{size:"xl",scale:t/36}:{size:"m",scale:1}}const Ote={1:"draw",2:"sans",3:"mono"},Gl={"#ffffff":"grey","#000000":"black","#343a40":"black","#495057":"grey","#c92a2a":"red","#a61e4d":"light-red","#862e9c":"violet","#5f3dc4":"light-violet","#364fc7":"blue","#1864ab":"light-blue","#0b7285":"light-green","#087f5b":"light-green","#2b8a3e":"green","#5c940d":"light-green","#e67700":"yellow","#d9480f":"orange","#ced4da":"grey","#868e96":"grey","#fa5252":"light-red","#e64980":"red","#be4bdb":"light-violet","#7950f2":"violet","#4c6ef5":"blue","#228be6":"light-blue","#15aabf":"light-green","#12b886":"green","#40c057":"green","#82c91e":"light-green","#fab005":"yellow","#fd7e14":"orange","#212529":"grey"},Dte={solid:"draw",dashed:"dashed",dotted:"dotted"},Rte={"cross-hatch":"pattern",hachure:"pattern",solid:"solid"},RP={left:"start",center:"middle",right:"end"},LP={arrow:"arrow",dot:"dot",triangle:"triangle",bar:"pipe"};function Lte(t,e,n){let r=0;if(t.points.length>2){const s=new P(e[0],e[1]),o=new P(n[0],n[1]),i=new P(t.points[1][0],t.points[1][1]),a=P.Sub(o,s),c=P.Per(a),l=P.Med(o,s),u=P.Sub(l,c),d=P.Add(l,c),h=P.NearestPointOnLineSegment(u,d,i,!1);r=P.Dist(h,l),P.Clockwise(h,o,l)&&(r*=-1)}return r}const of=t=>{let e=Dte[t.strokeStyle]??"draw";return e==="draw"&&t.roughness===0&&(e="solid"),e},jte=t=>t.backgroundColor==="transparent"?"none":Rte[t.fillStyle]??"solid";async function X5(t,e,n){const s=(await Promise.all(e.map(async o=>await(await fetch(o)).blob()))).map(o=>new File([o],"tldrawFile",{type:o.type}));t.mark("paste"),await t.putExternalContent({type:"files",files:s,point:n,ignoreParent:!1}),e.forEach(o=>URL.revokeObjectURL(o))}function Nte(t,e,n){const r=n??(t.inputs.shiftKey?t.inputs.currentPagePoint:void 0);t.mark("paste"),t.putContent(e,{point:r,select:!0})}async function yS(t,e,n){var r;try{if((r=(await fetch(e)).headers.get("content-type"))!=null&&r.match(/^image\//)){t.mark("paste"),X5(t,[e]);return}}catch(s){s.message!=="Failed to fetch"&&console.error(s)}return t.mark("paste"),await t.putExternalContent({type:"url",point:n,url:e})}const zte=t=>{try{const e=new URL(t);return e.protocol==="http:"||e.protocol==="https:"}catch{return!1}},Fte=t=>{const e=t.split(/[\n\s]/);for(const n of e)try{const r=new URL(n);if(!(r.protocol==="http:"||r.protocol==="https:"))return}catch{return}return p3(e)},Bte=t=>/^<svg/.test(t),Ute=["input","select","textarea"];function pp(t){const{activeElement:e}=document;return t.isMenuOpen||e&&(e.getAttribute("contenteditable")||Ute.indexOf(e.tagName.toLowerCase())>-1)}async function j0(t){return new Promise((e,n)=>{const r=new FileReader;r.addEventListener("loadend",()=>{const s=r.result;e(s)}),r.addEventListener("error",()=>{n(r.error)}),r.readAsText(t)})}function Hte(t){const e=document.implementation.createHTMLDocument("");return e.documentElement.innerHTML=t.trim(),e.body.textContent||e.body.innerText||""}const Kte=t=>t.types.find(e=>e.match(/^image\//)),N0=(t,e,n)=>{const r=Fte(e);if(r)for(const s of r)yS(t,s,n);else zte(e)?yS(t,e,n):Bte(e)?(t.mark("paste"),t.putExternalContent({type:"svg-text",text:e,point:n})):(t.mark("paste"),t.putExternalContent({type:"text",text:e,point:n}))},Vte=async(t,e,n)=>{if(t.editingShapeId!==null)return;if(!e)throw Error("No clipboard data");const r=[];for(const s of Object.values(e.items))switch(s.kind){case"file":{r.push({type:"file",source:new Promise(o=>o(s.getAsFile()))});break}case"string":{s.type==="text/html"?r.push({type:"html",source:new Promise(o=>s.getAsString(o))}):s.type==="text/plain"?r.push({type:"text",source:new Promise(o=>s.getAsString(o))}):r.push({type:s.type,source:new Promise(o=>s.getAsString(o))});break}}Q5(t,r,n)},q5=async(t,e,n)=>{const r=[];for(const s of e){if(Kte(s))for(const o of s.types)o.match(/^image\//)&&r.push({type:"blob",source:s.getType(o)});s.types.includes("text/html")&&r.push({type:"html",source:new Promise(o=>s.getType("text/html").then(i=>j0(i).then(o)))}),s.types.includes("text/uri-list")&&r.push({type:"url",source:new Promise(o=>s.getType("text/uri-list").then(i=>j0(i).then(o)))}),s.types.includes("text/plain")&&r.push({type:"text",source:new Promise(o=>s.getType("text/plain").then(i=>j0(i).then(o)))})}return await Q5(t,r,n)};async function Q5(t,e,n){const r=e.filter(o=>(o.type==="file"||o.type==="blob")&&o.source!==null);if(r.length){const i=(await Promise.all(r.map(a=>a.source))).filter(Boolean).map(a=>URL.createObjectURL(a));return await X5(t,i,n)}const s=await Promise.all(e.filter(o=>o.type!=="file").map(o=>new Promise(i=>{const a=o;if(a.type==="file"){i({type:"error",data:null,reason:"unexpected file"});return}a.source.then(c=>{var u;const l=(u=c.match(/<tldraw[^>]*>(.*)<\/tldraw>/))==null?void 0:u[1];if(l)try{const d=Y5.decompressFromBase64(l);if(d===null){i({type:"error",data:d,reason:"found tldraw data comment but could not parse base64"});return}else{const h=JSON.parse(d);if(h.type!=="application/tldraw"&&i({type:"error",data:h,reason:`found tldraw data comment but JSON was of a different type: ${h.type}`}),typeof h.data=="string"){i({type:"error",data:h,reason:"found tldraw json but data was a string instead of a TLClipboardModel object"});return}i({type:"tldraw",data:h.data});return}}catch{i({type:"error",data:l,reason:"found tldraw json but data was a string instead of a TLClipboardModel object"});return}else{if(a.type==="html"){i({type:"text",data:c,subtype:"html"});return}if(a.type==="url"){i({type:"text",data:c,subtype:"url"});return}try{const d=JSON.parse(c);if(d.type==="excalidraw/clipboard"){i({type:"excalidraw",data:d});return}else{i({type:"text",data:c,subtype:"json"});return}}catch{i({type:"text",data:c,subtype:"text"});return}}i({type:"error",data:c,reason:"unhandled case"})})})));for(const o of s)if(o.type==="tldraw"){Nte(t,o.data,n);return}for(const o of s)if(o.type==="excalidraw"){$te(t,o.data,n);return}for(const o of s)if(o.type==="text"&&o.subtype==="html"){const a=new DOMParser().parseFromString(o.data,"text/html").querySelector("body");if(a&&Array.from(a.children).filter(l=>l.nodeType===1).length===1&&a.firstElementChild&&a.firstElementChild.tagName==="A"&&a.firstElementChild.hasAttribute("href")&&a.firstElementChild.getAttribute("href")!==""){const l=a.firstElementChild.getAttribute("href");N0(t,l,n);return}if(!s.some(l=>l.type==="text"&&l.subtype!=="html")&&o.data.trim()){N0(t,Hte(o.data),n);return}}for(const o of s)if(o.type==="text"&&o.subtype==="url"){yS(t,o.data,n);return}for(const o of s)if(o.type==="text"&&o.subtype==="text"&&o.data.trim()){N0(t,o.data,n);return}}const kg=t=>{var r;const e=t.getContent(t.selectedShapeIds);if(!e){navigator&&navigator.clipboard&&navigator.clipboard.writeText("");return}const n=Y5.compressToBase64(JSON.stringify({type:"application/tldraw",kind:"content",data:e}));if(!(typeof navigator>"u")){const s=e.shapes.map(o=>t.isShapeOfType(o,"text")||t.isShapeOfType(o,"geo")||t.isShapeOfType(o,"arrow")?o.props.text:t.isShapeOfType(o,"bookmark")||t.isShapeOfType(o,"embed")?o.props.url:null).filter(U7);if((r=navigator.clipboard)!=null&&r.write){const o=new Blob([`<tldraw>${n}</tldraw>`],{type:"text/html"});let i=s.join(" ");i===""&&(i=" "),navigator.clipboard.write([new ClipboardItem({"text/html":o,"text/plain":new Blob([i],{type:"text/plain"})})])}else navigator.clipboard.writeText&&navigator.clipboard.writeText(`<tldraw>${n}</tldraw>`)}};function Wte(){const t=H(),e=yl(),n=S.useCallback(function(i){t.selectedShapeIds.length!==0&&(kg(t),e("copy",{source:i}))},[t,e]),r=S.useCallback(function(i){t.selectedShapeIds.length!==0&&(kg(t),t.deleteShapes(t.selectedShapeIds),e("cut",{source:i}))},[t,e]),s=S.useCallback(async function(i,a,c){t.editingShapeId!==null||pp(t)||(Array.isArray(i)&&i[0]instanceof ClipboardItem?(q5(t,i,c),e("paste",{source:"menu"})):navigator.clipboard.read().then(l=>{s(l,a,c)}))},[t,e]);return{copy:n,cut:r,paste:s}}function Gte(){const t=H(),e=yl(),n=Y("editor.isFocused",()=>t.instanceState.isFocused,[t]);S.useEffect(()=>{if(!n)return;const r=()=>{t.selectedShapeIds.length===0||t.editingShapeId!==null||pp(t)||(kg(t),e("copy",{source:"kbd"}))};function s(){t.selectedShapeIds.length===0||t.editingShapeId!==null||pp(t)||(kg(t),t.deleteShapes(t.selectedShapeIds),e("cut",{source:"kbd"}))}let o=!1;const i=c=>{c.button===1&&(o=!0,requestAnimationFrame(()=>{o=!1}))},a=c=>{if(o){c.stopPropagation();return}t.editingShapeId!==null||pp(t)||(c.clipboardData&&!t.inputs.shiftKey?Vte(t,c.clipboardData):navigator.clipboard.read().then(l=>{Array.isArray(l)&&l[0]instanceof ClipboardItem&&q5(t,l,t.inputs.currentPagePoint)}),e("paste",{source:"kbd"}))};return document.addEventListener("copy",r),document.addEventListener("cut",s),document.addEventListener("paste",a),document.addEventListener("pointerup",i),()=>{document.removeEventListener("copy",r),document.removeEventListener("cut",s),document.removeEventListener("paste",a),document.removeEventListener("pointerup",i)}},[t,e,n])}/*!
 * canvas-size
 * v1.2.6
 * https://github.com/jhildenbiddle/canvas-size
 * (c) 2015-2023 John Hildenbiddle <http://hildenbiddle.com>
 * MIT license
 */function Yte(t,e){var n=t==null?null:typeof Symbol<"u"&&t[Symbol.iterator]||t["@@iterator"];if(n!=null){var r,s,o,i,a=[],c=!0,l=!1;try{if(o=(n=n.call(t)).next,e===0){if(Object(n)!==n)return;c=!1}else for(;!(c=(r=o.call(n)).done)&&(a.push(r.value),a.length!==e);c=!0);}catch(u){l=!0,s=u}finally{try{if(!c&&n.return!=null&&(i=n.return(),Object(i)!==i))return}finally{if(l)throw s}}return a}}function jP(t,e){var n=Object.keys(t);if(Object.getOwnPropertySymbols){var r=Object.getOwnPropertySymbols(t);e&&(r=r.filter(function(s){return Object.getOwnPropertyDescriptor(t,s).enumerable})),n.push.apply(n,r)}return n}function jn(t){for(var e=1;e<arguments.length;e++){var n=arguments[e]!=null?arguments[e]:{};e%2?jP(Object(n),!0).forEach(function(r){Xte(t,r,n[r])}):Object.getOwnPropertyDescriptors?Object.defineProperties(t,Object.getOwnPropertyDescriptors(n)):jP(Object(n)).forEach(function(r){Object.defineProperty(t,r,Object.getOwnPropertyDescriptor(n,r))})}return t}function Xte(t,e,n){return e=sne(e),e in t?Object.defineProperty(t,e,{value:n,enumerable:!0,configurable:!0,writable:!0}):t[e]=n,t}function qte(t,e){if(t==null)return{};var n={},r=Object.keys(t),s,o;for(o=0;o<r.length;o++)s=r[o],!(e.indexOf(s)>=0)&&(n[s]=t[s]);return n}function Qte(t,e){if(t==null)return{};var n=qte(t,e),r,s;if(Object.getOwnPropertySymbols){var o=Object.getOwnPropertySymbols(t);for(s=0;s<o.length;s++)r=o[s],!(e.indexOf(r)>=0)&&Object.prototype.propertyIsEnumerable.call(t,r)&&(n[r]=t[r])}return n}function NP(t,e){return Jte(t)||Yte(t,e)||Z5(t,e)||nne()}function af(t){return Zte(t)||ene(t)||Z5(t)||tne()}function Zte(t){if(Array.isArray(t))return vS(t)}function Jte(t){if(Array.isArray(t))return t}function ene(t){if(typeof Symbol<"u"&&t[Symbol.iterator]!=null||t["@@iterator"]!=null)return Array.from(t)}function Z5(t,e){if(t){if(typeof t=="string")return vS(t,e);var n=Object.prototype.toString.call(t).slice(8,-1);if(n==="Object"&&t.constructor&&(n=t.constructor.name),n==="Map"||n==="Set")return Array.from(t);if(n==="Arguments"||/^(?:Ui|I)nt(?:8|16|32)(?:Clamped)?Array$/.test(n))return vS(t,e)}}function vS(t,e){(e==null||e>t.length)&&(e=t.length);for(var n=0,r=new Array(e);n<e;n++)r[n]=t[n];return r}function tne(){throw new TypeError(`Invalid attempt to spread non-iterable instance.
In order to be iterable, non-array objects must have a [Symbol.iterator]() method.`)}function nne(){throw new TypeError(`Invalid attempt to destructure non-iterable instance.
In order to be iterable, non-array objects must have a [Symbol.iterator]() method.`)}function rne(t,e){if(typeof t!="object"||t===null)return t;var n=t[Symbol.toPrimitive];if(n!==void 0){var r=n.call(t,e||"default");if(typeof r!="object")return r;throw new TypeError("@@toPrimitive must return a primitive value.")}return(e==="string"?String:Number)(t)}function sne(t){var e=rne(t,"string");return typeof e=="symbol"?e:String(e)}function xu(t){var e=t.sizes.shift(),n=Math.max(Math.ceil(e[0]),1),r=Math.max(Math.ceil(e[1]),1),s=[n-1,r-1,1,1],o=Date.now(),i=typeof WorkerGlobalScope<"u"&&self instanceof WorkerGlobalScope,a,c;i?(a=new OffscreenCanvas(1,1),c=new OffscreenCanvas(n,r)):(a=document.createElement("canvas"),a.width=1,a.height=1,c=document.createElement("canvas"),c.width=n,c.height=r);var l=a.getContext("2d"),u=c.getContext("2d");u&&(u.fillRect.apply(u,s),l.drawImage(c,n-1,r-1,1,1,0,0,1,1));var d=l&&l.getImageData(0,0,1,1).data[3]!==0,h=Date.now()-o;return[a,c].forEach(function(f){f.height=0,f.width=0}),i?(postMessage({width:n,height:r,benchmark:h,isTestPass:d}),!d&&t.sizes.length&&xu(t)):d?t.onSuccess(n,r,h):(t.onError(n,r,h),t.sizes.length&&xu(t)),d}var z0={area:[16384,14188,11402,11180,10836,8192,4096,1],height:[8388607,65535,32767,16384,8192,4096,1],width:[4194303,65535,32767,16384,8192,4096,1]},one=["onError","onSuccess"],Sc={max:null,min:1,sizes:[],step:1024,usePromise:!1,useWorker:!1,onError:Function.prototype,onSuccess:Function.prototype},Yl={};function F0(t){var e=t.width===t.height,n=t.height===1,r=t.width===1,s=[];if(!t.width||!t.height)t.sizes.forEach(function(u){var d=e||n?u:1,h=e||r?u:1;s.push([d,h])});else for(var o=t.min||Sc.min,i=t.step||Sc.step,a=Math.max(t.width,t.height);a>=o;){var c=e||n?a:1,l=e||r?a:1;s.push([c,l]),a-=i}return s}function cf(t){var e=window&&"HTMLCanvasElement"in window,n=window&&"OffscreenCanvas"in window,r=Date.now(),s=t.onError,o=t.onSuccess,i=Qte(t,one),a=null;if(!e)return!1;if(t.useWorker&&n){var c=`
            var canvasTest = `.concat(xu.toString(),`;
            onmessage = function(e) {
                canvasTest(e.data);
            };
        `),l=new Blob([c],{type:"application/javascript"}),u=URL.createObjectURL(l);a=new Worker(u),URL.revokeObjectURL(u),a.onmessage=function(d){var h=d.data,f=h.width,p=h.height,m=h.benchmark,v=h.isTestPass;v?(Yl[r].onSuccess(f,p,m),delete Yl[r]):Yl[r].onError(f,p,m)}}if(t.usePromise)return new Promise(function(d,h){var f=jn(jn({},t),{},{onError:function(w,x,b){var C;if(t.sizes.length===0)C=!0;else{var E=t.sizes.slice(-1),_=NP(E,1),k=NP(_[0],2),I=k[0],$=k[1];C=w===I&&x===$}s(w,x,b),C&&h({width:w,height:x,benchmark:b})},onSuccess:function(w,x,b){o(w,x,b),d({width:w,height:x,benchmark:b})}});if(a){var p=f.onError,m=f.onSuccess;Yl[r]={onError:p,onSuccess:m},a.postMessage(i)}else xu(f)});if(a)Yl[r]={onError:s,onSuccess:o},a.postMessage(i);else return xu(t)}var B0={maxArea:function(){var e=arguments.length>0&&arguments[0]!==void 0?arguments[0]:{},n=F0({width:e.max,height:e.max,min:e.min,step:e.step,sizes:af(z0.area)}),r=jn(jn(jn({},Sc),e),{},{sizes:n});return cf(r)},maxHeight:function(){var e=arguments.length>0&&arguments[0]!==void 0?arguments[0]:{},n=F0({width:1,height:e.max,min:e.min,step:e.step,sizes:af(z0.height)}),r=jn(jn(jn({},Sc),e),{},{sizes:n});return cf(r)},maxWidth:function(){var e=arguments.length>0&&arguments[0]!==void 0?arguments[0]:{},n=F0({width:e.max,height:1,min:e.min,step:e.step,sizes:af(z0.width)}),r=jn(jn(jn({},Sc),e),{},{sizes:n});return cf(r)},test:function(){var e=arguments.length>0&&arguments[0]!==void 0?arguments[0]:{},n=jn(jn({},Sc),e);return n.sizes=af(n.sizes),n.width&&n.height&&(n.sizes=[[n.width,n.height]]),cf(n)}};let U0=null;function ine(){return U0||(U0=ane()),U0}async function ane(){const t=await B0.maxWidth({usePromise:!0}),e=await B0.maxHeight({usePromise:!0}),n=await B0.maxArea({usePromise:!0});return{maxWidth:t.width,maxHeight:e.height,maxArea:n.width*n.height}}function J5(t){const e=t.cloneNode(!0);return t.setAttribute("width",+t.getAttribute("width")+""),t.setAttribute("height",+t.getAttribute("height")+""),new XMLSerializer().serializeToString(e).replaceAll("&#10;      ","").replaceAll(/((\s|")[0-9]*\.[0-9]{2})([0-9]*)(\b|"|\))/g,"$1")}async function eO(t,e){const{type:n,quality:r,scale:s}=e,o=+t.getAttribute("width"),i=+t.getAttribute("height");let a=o*s,c=i*s;const l=await tO(t),u=await ine();if(o>u.maxWidth&&(a=u.maxWidth,c=a/o*i),i>u.maxHeight&&(c=u.maxHeight,a=c/i*o),a*c>u.maxArea){const m=Math.sqrt(u.maxArea/(a*c));a*=m,c*=m}a=Math.floor(a),c=Math.floor(c);const d=a/o,h=await new Promise(m=>{const v=new Image;v.crossOrigin="anonymous",v.onload=async()=>{await new Promise(b=>setTimeout(b,250));const w=document.createElement("canvas"),x=w.getContext("2d");w.width=a,w.height=c,x.imageSmoothingEnabled=!0,x.imageSmoothingQuality="high",x.drawImage(v,0,0,a,c),URL.revokeObjectURL(l),m(w)},v.onerror=()=>{m(null)},v.src=l});if(!h)return null;const f=await new Promise(m=>h.toBlob(v=>{(!v||xt.throwToBlob.value)&&m(null),m(v)},"image/"+n,r));if(!f)return null;const p=new DataView(await f.arrayBuffer());return ss.setPhysChunk(p,d,{type:"image/"+n})}async function tO(t){const e=t.cloneNode(!0);e.setAttribute("encoding",'UTF-8"');const n=new FileReader,r=Array.from(e.querySelectorAll("image"));for(const s of r){const o=s.getAttribute("xlink:href");if(o&&!o.startsWith("data:")){const i=await(await fetch(o)).blob(),a=await new Promise((c,l)=>{n.onload=()=>c(n.result),n.onerror=()=>l(n.error),n.readAsDataURL(i)});s.setAttribute("xlink:href",a)}}return cne(e)}function cne(t){const e=new XMLSerializer().serializeToString(t);return`data:image/svg+xml;base64,${window.btoa(unescape(encodeURIComponent(e)))}`}function H0(t,e){const n=document.createElement("a");n.href=t,n.download=e,n.click()}const nO=S.createContext({});function lne({children:t}){const[e,n]=S.useState([]),r=S.useCallback(i=>{const a=i.id??Ze();return n(c=>[...c.filter(l=>l.id!==i.id),{...i,id:a}]),a},[]),s=S.useCallback(i=>(n(a=>a.filter(c=>c.id!==i)),i),[]),o=S.useCallback(()=>{n(()=>[])},[]);return g.jsx(nO.Provider,{value:{toasts:e,addToast:r,removeToast:s,clearToasts:o},children:t})}function bs(){const t=S.useContext(nO);if(!t)throw new Error("useToasts must be used within a ToastsProvider");return t}function une(){const t=H(),{addToast:e}=bs(),n=be();return S.useCallback(function(s=t.selectedShapeIds,o="svg"){if(s.length===0&&(s=[...t.currentPageShapeIds]),s.length!==0)switch(o){case"svg":{window.navigator.clipboard&&(window.navigator.clipboard.write?window.navigator.clipboard.write([new ClipboardItem({"text/plain":dne(t,s)})]):zP(async()=>J5(await hb(t,s))));break}case"jpeg":case"png":{const i=o==="jpeg"?"image/jpeg":"image/png",a=hne(t,s,o).then(c=>{if(c){if(window.navigator.clipboard)return c;throw new Error("Copy not supported")}else throw e({id:"copy-fail",icon:"warning-triangle",title:n("toast.error.copy-fail.title"),description:n("toast.error.copy-fail.desc")}),new Error("Copy not possible")});window.navigator.clipboard.write([new ClipboardItem({[i]:a})]).catch(c=>{c.toString().match(/^TypeError: DOMString not supported/)||console.error(c),a.then(l=>{window.navigator.clipboard.write([new ClipboardItem({[i]:l})])})});break}case"json":{const i=t.getContent(s);if(window.navigator.clipboard){const a=JSON.stringify(i);window.navigator.clipboard.write?window.navigator.clipboard.write([new ClipboardItem({"text/plain":new Blob([a],{type:"text/plain"})})]):zP(async()=>a)}break}default:throw new Error(`Copy type ${o} not supported.`)}},[t,e,n])}async function hb(t,e){const n=await t.getSvg(e,{scale:1,background:t.instanceState.exportBackground});if(!n)throw new Error("Could not construct SVG.");return n}async function dne(t,e){return new Blob([J5(await hb(t,e))],{type:"text/plain"})}async function hne(t,e,n){return await eO(await hb(t,e),{type:n,quality:1,scale:2})}async function zP(t){navigator&&navigator.clipboard&&navigator.clipboard.writeText(await t())}const rO=S.createContext({});function fne({children:t}){const e=H(),n=yl(),[r,s]=S.useState([]),o=S.useCallback(l=>{const u=l.id??Ze();return s(d=>[...d.filter(h=>h.id!==l.id),{...l,id:u}]),n("open-menu",{source:"dialog",id:u}),e.addOpenMenu(u),u},[e,n]),i=S.useCallback((l,u)=>(s(d=>d.map(h=>h.id===l?{...h,...u}:h)),n("open-menu",{source:"dialog",id:l}),e.addOpenMenu(l),l),[e,n]),a=S.useCallback(l=>(s(u=>u.filter(d=>{var h;return d.id===l?((h=d.onClose)==null||h.call(d),!1):!0})),n("close-menu",{source:"dialog",id:l}),e.deleteOpenMenu(l),l),[e,n]),c=S.useCallback(()=>{s(l=>(l.forEach(u=>{var d;(d=u.onClose)==null||d.call(u),n("close-menu",{source:"dialog",id:u.id}),e.deleteOpenMenu(u.id)}),[]))},[e,n]);return g.jsx(rO.Provider,{value:{dialogs:r,addDialog:o,removeDialog:a,clearDialogs:c,updateDialog:i},children:t})}function Ma(){const t=S.useContext(rO);if(!t)throw new Error("useDialogs must be used within a DialogsProvider");return t}function pne(){const t=H(),{addToast:e}=bs(),n=be();return S.useCallback(async function(s=t.selectedShapeIds,o="png"){if(s.length===0&&(s=[...t.currentPageShapeIds]),s.length===0)return;const i=await t.getSvg(s,{scale:1,background:t.instanceState.exportBackground});if(!i)throw new Error("Could not construct SVG.");let a="shapes";if(s.length===1){const c=t.getShape(s[0]);t.isShapeOfType(c,"frame")?a=c.props.name??"frame":a=c.id.replace(/:/,"_")}switch(o){case"svg":{const c=await tO(i);H0(c,`${a||"shapes"}.svg`);return}case"webp":case"png":{const c=await eO(i,{type:o,quality:1,scale:2});if(!c){e({id:"export-fail",title:n("toast.error.export-fail.title"),description:n("toast.error.export-fail.desc")});return}const l=URL.createObjectURL(c);H0(l,`${a||"shapes"}.${o}`),URL.revokeObjectURL(l);return}case"json":{const c=t.getContent(s),l=URL.createObjectURL(new Blob([JSON.stringify(c,null,4)],{type:"application/json"}));H0(l,`${a||"shapes"}.json`),URL.revokeObjectURL(l);return}default:throw new Error(`Export type ${o} not supported.`)}},[t,e,n])}function sO(){const t=H(),e=S.useRef();return S.useEffect(()=>{const n=window.document.createElement("input");n.type="file",n.accept="image/jpeg,image/png,image/gif,image/svg+xml,video/mp4,video/quicktime",n.multiple=!0,e.current=n;async function r(s){const o=s.target.files;!o||o.length===0||(await t.putExternalContent({type:"files",files:Array.from(o),point:t.viewportPageBounds.center,ignoreParent:!1}),n.value="")}return n.addEventListener("change",r),()=>{e.current=void 0,n.removeEventListener("change",r)}},[t]),S.useCallback(()=>{var n;(n=e.current)==null||n.click()},[e])}function gne(){const t=H(),e=S.useRef(null),n=S.useRef(null);return S.useCallback(async function(){const s=document.createElement("div"),o=document.createElement("style"),i=(w,x)=>{w&&(w.innerHTML=""),x&&document.head.contains(x)&&document.head.removeChild(x),w&&document.body.contains(w)&&document.body.removeChild(w)};i(e.current,n.current),e.current=s,n.current=o;const a=`tl-print-surface-${Ze()}`;s.className=a,o.innerHTML=`
			.${a} {
				display: none;
			}

			.${a} svg {
				max-width: 100%;
				height: 100%;
				display: block;
			}

			@media print {				  
				html, body {
					min-height: 100%;
					height: 100%;
					margin: 0;
				}

				body {
					position: relative;
				}

				body > * {
					display: none;
				}

				.${a} {
					display: block !important;
					background: white;
					min-height: 100%;
					height: 100%;
					max-width: 100%;
				}

				.${a}__item {
					padding: 10mm;
					display: flex;
					min-height: 100%;
					flex-direction: column;
					page-break-after: always;
					position: relative;
					overflow: hidden;
					height: 100%;
				}

				.${a}__item__main {
					flex: 1;
					display: flex;
					align-items: center;
					justify-content: center;
					max-height: 100%;
				}

				.${a}__item__header {
					display: none;
				}

				.${a}__item__footer {
					display: none;
					text-align: right;
				}

				.${a}__item__footer__hide {
					display: none;
				}

				
			}

		`;const c=()=>{document.head.appendChild(o),document.body.appendChild(s)},l=()=>{t.once("change-history",()=>{i(s,o)})};window.addEventListener("beforeprint",c),window.addEventListener("afterprint",l);function u(w,x,b){try{s.innerHTML+=`<div class="${a}__item">
        <div class="${a}__item__header">
          ${w.replace(/</g,"&lt;").replace(/>/g,"&gt;")}
        </div>
        <div class="${a}__item__main">
          ${b.outerHTML}
        </div>
        <div class="${a}__item__footer ${a}__item__footer__${x?"":"hide"}">
          ${x??""}
        </div>
      </div>`}catch(C){console.error(C)}}function d(){t.environment.isChromeForIos?(c(),window.print()):t.environment.isSafari?(c(),document.execCommand("print",!1)):window.print()}const{pages:h,currentPageId:f,selectedShapeIds:p}=t,v={scale:1,background:!1,darkMode:!1,preserveAspectRatio:"xMidYMid meet"};if(t.selectedShapeIds.length>0){const w=await t.getSvg(p,v);if(w){const x=h.find(b=>b.id===f);u(`tldraw  ${x==null?void 0:x.name}`,null,w),d()}}else{const w=t.currentPage,x=await t.getSvg(t.getSortedChildIdsForParent(w.id),v);x&&(u(`tldraw  ${w.name}`,null,x),d())}window.removeEventListener("beforeprint",c),window.removeEventListener("afterprint",l)},[t])}const oO=S.createContext({});function mne(t){return Object.fromEntries(t.map(e=>[e.id,e]))}function yne({overrides:t,children:e}){const n=H(),{addDialog:r,clearDialogs:s}=Ma(),{clearToasts:o}=bs(),i=sO(),a=gne(),{cut:c,copy:l,paste:u}=Wte(),d=une(),h=pne(),f=yl(),p=S.useMemo(()=>{const m=mne([{id:"edit-link",label:"action.edit-link",icon:"link",readonlyOk:!1,onSelect(v){f("edit-link",{source:v}),n.mark("edit-link"),r({component:kte})}},{id:"insert-embed",label:"action.insert-embed",readonlyOk:!1,kbd:"$i",onSelect(v){f("insert-embed",{source:v}),r({component:G5})}},{id:"insert-media",label:"action.insert-media",kbd:"$u",readonlyOk:!1,onSelect(v){f("insert-media",{source:v}),i()}},{id:"undo",label:"action.undo",icon:"undo",kbd:"$z",readonlyOk:!1,onSelect(v){f("undo",{source:v}),n.undo()}},{id:"redo",label:"action.redo",icon:"redo",kbd:"$!z",readonlyOk:!1,onSelect(v){f("redo",{source:v}),n.redo()}},{id:"export-as-svg",label:"action.export-as-svg",menuLabel:"action.export-as-svg.short",contextMenuLabel:"action.export-as-svg.short",readonlyOk:!0,onSelect(v){f("export-as",{format:"svg",source:v}),h(n.selectedShapeIds,"svg")}},{id:"export-as-png",label:"action.export-as-png",menuLabel:"action.export-as-png.short",contextMenuLabel:"action.export-as-png.short",readonlyOk:!0,onSelect(v){f("export-as",{format:"png",source:v}),h(n.selectedShapeIds,"png")}},{id:"export-as-json",label:"action.export-as-json",menuLabel:"action.export-as-json.short",contextMenuLabel:"action.export-as-json.short",readonlyOk:!0,onSelect(v){f("export-as",{format:"json",source:v}),h(n.selectedShapeIds,"json")}},{id:"copy-as-svg",label:"action.copy-as-svg",menuLabel:"action.copy-as-svg.short",contextMenuLabel:"action.copy-as-svg.short",kbd:"$!c",readonlyOk:!0,onSelect(v){f("copy-as",{format:"svg",source:v}),d(n.selectedShapeIds,"svg")}},{id:"copy-as-png",label:"action.copy-as-png",menuLabel:"action.copy-as-png.short",contextMenuLabel:"action.copy-as-png.short",readonlyOk:!0,onSelect(v){f("copy-as",{format:"png",source:v}),d(n.selectedShapeIds,"png")}},{id:"copy-as-json",label:"action.copy-as-json",menuLabel:"action.copy-as-json.short",contextMenuLabel:"action.copy-as-json.short",readonlyOk:!0,onSelect(v){f("copy-as",{format:"json",source:v}),d(n.selectedShapeIds,"json")}},{id:"toggle-auto-size",label:"action.toggle-auto-size",readonlyOk:!1,onSelect(v){f("toggle-auto-size",{source:v}),n.mark(),n.updateShapes(n.selectedShapes.filter(w=>n.isShapeOfType(w,"text")&&w.props.autoSize===!1).map(w=>({id:w.id,type:w.type,props:{...w.props,w:8,autoSize:!0}})))}},{id:"open-embed-link",label:"action.open-embed-link",readonlyOk:!0,onSelect(v){f("open-embed-link",{source:v});const w=n.selectedShapeIds,x="No embed shapes selected";if(w.length!==1){console.error(x);return}const b=n.getShape(w[0]);if(!b||!n.isShapeOfType(b,"embed")){console.error(x);return}zH(b.props.url,"_blank")}},{id:"select-zoom-tool",readonlyOk:!0,kbd:"z",onSelect(v){var w,x;if(((w=n.root.current.value)==null?void 0:w.id)!=="zoom"&&(f("zoom-tool",{source:v}),!(n.inputs.shiftKey||n.inputs.ctrlKey))){const b=n.root.current.value;b&&((x=b.current.value)==null?void 0:x.id)==="idle"&&n.setCurrentTool("zoom",{onInteractionEnd:b.id,maskAs:"zoom"})}}},{id:"convert-to-bookmark",label:"action.convert-to-bookmark",readonlyOk:!1,onSelect(v){f("convert-to-bookmark",{source:v});const w=n.selectedShapes,x=[],b=[];for(const C of w){if(!C||!n.isShapeOfType(C,"embed")||!C.props.url)continue;const E=new P(C.x,C.y);E.rot(-C.rotation),E.add(new P(C.props.w/2-150,C.props.h/2-160)),E.rot(C.rotation);const _={id:Ke(),type:"bookmark",rotation:C.rotation,x:E.x,y:E.y,opacity:1,props:{url:C.props.url}};x.push(_),b.push(C.id)}n.mark("convert shapes to bookmark"),n.deleteShapes(b),n.createShapes(x)}},{id:"convert-to-embed",label:"action.convert-to-embed",readonlyOk:!1,onSelect(v){f("convert-to-embed",{source:v});const w=n.selectedShapeIds,x=me(w.map(E=>n.getShape(E))),b=[],C=[];for(const E of x){if(!n.isShapeOfType(E,"bookmark"))continue;const{url:_}=E.props,k=Rs(E.props.url);if(!k||!k.definition)continue;const{width:I,height:$}=k.definition,A=new P(E.x,E.y);A.rot(-E.rotation),A.add(new P(E.props.w/2-I/2,E.props.h/2-$/2)),A.rot(E.rotation);const D={id:Ke(),type:"embed",x:A.x,y:A.y,rotation:E.rotation,props:{url:_,w:I,h:$}};b.push(D),C.push(E.id)}n.mark("convert shapes to embed"),n.deleteShapes(C),n.createShapes(b)}},{id:"duplicate",kbd:"$d",label:"action.duplicate",icon:"duplicate",readonlyOk:!1,onSelect(v){if(n.currentToolId!=="select")return;f("duplicate-shapes",{source:v});const w=n.selectedShapeIds,x=ae.Common(me(w.map(C=>n.getShapePageBounds(C)))),b=n.instanceState.canMoveCamera?{x:x.width+10,y:0}:{x:16/n.zoomLevel,y:16/n.zoomLevel};n.mark("duplicate shapes"),n.duplicateShapes(w,b)}},{id:"ungroup",label:"action.ungroup",kbd:"$!g",icon:"ungroup",readonlyOk:!1,onSelect(v){f("ungroup-shapes",{source:v}),n.mark("ungroup"),n.ungroupShapes(n.selectedShapeIds)}},{id:"group",label:"action.group",kbd:"$g",icon:"group",readonlyOk:!1,onSelect(v){f("group-shapes",{source:v});const{onlySelectedShape:w}=n;w&&n.isShapeOfType(w,"group")?(n.mark("ungroup"),n.ungroupShapes(n.selectedShapeIds)):(n.mark("group"),n.groupShapes(n.selectedShapeIds))}},{id:"align-left",label:"action.align-left",kbd:"?A",icon:"align-left",readonlyOk:!1,onSelect(v){f("align-shapes",{operation:"left",source:v}),n.mark("align left"),n.alignShapes(n.selectedShapeIds,"left")}},{id:"align-center-horizontal",label:"action.align-center-horizontal",contextMenuLabel:"action.align-center-horizontal.short",kbd:"?H",icon:"align-center-horizontal",readonlyOk:!1,onSelect(v){f("align-shapes",{operation:"center-horizontal",source:v}),n.mark("align center horizontal"),n.alignShapes(n.selectedShapeIds,"center-horizontal")}},{id:"align-right",label:"action.align-right",kbd:"?D",icon:"align-right",readonlyOk:!1,onSelect(v){f("align-shapes",{operation:"right",source:v}),n.mark("align right"),n.alignShapes(n.selectedShapeIds,"right")}},{id:"align-center-vertical",label:"action.align-center-vertical",contextMenuLabel:"action.align-center-vertical.short",kbd:"?V",icon:"align-center-vertical",readonlyOk:!1,onSelect(v){f("align-shapes",{operation:"center-vertical",source:v}),n.mark("align center vertical"),n.alignShapes(n.selectedShapeIds,"center-vertical")}},{id:"align-top",label:"action.align-top",icon:"align-top",kbd:"?W",readonlyOk:!1,onSelect(v){f("align-shapes",{operation:"top",source:v}),n.mark("align top"),n.alignShapes(n.selectedShapeIds,"top")}},{id:"align-bottom",label:"action.align-bottom",icon:"align-bottom",kbd:"?S",readonlyOk:!1,onSelect(v){f("align-shapes",{operation:"bottom",source:v}),n.mark("align bottom"),n.alignShapes(n.selectedShapeIds,"bottom")}},{id:"distribute-horizontal",label:"action.distribute-horizontal",contextMenuLabel:"action.distribute-horizontal.short",icon:"distribute-horizontal",kbd:"?!h",readonlyOk:!1,onSelect(v){f("distribute-shapes",{operation:"horizontal",source:v}),n.mark("distribute horizontal"),n.distributeShapes(n.selectedShapeIds,"horizontal")}},{id:"distribute-vertical",label:"action.distribute-vertical",contextMenuLabel:"action.distribute-vertical.short",icon:"distribute-vertical",kbd:"?!V",readonlyOk:!1,onSelect(v){f("distribute-shapes",{operation:"vertical",source:v}),n.mark("distribute vertical"),n.distributeShapes(n.selectedShapeIds,"vertical")}},{id:"stretch-horizontal",label:"action.stretch-horizontal",contextMenuLabel:"action.stretch-horizontal.short",icon:"stretch-horizontal",readonlyOk:!1,onSelect(v){f("stretch-shapes",{operation:"horizontal",source:v}),n.mark("stretch horizontal"),n.stretchShapes(n.selectedShapeIds,"horizontal")}},{id:"stretch-vertical",label:"action.stretch-vertical",contextMenuLabel:"action.stretch-vertical.short",icon:"stretch-vertical",readonlyOk:!1,onSelect(v){f("stretch-shapes",{operation:"vertical",source:v}),n.mark("stretch vertical"),n.stretchShapes(n.selectedShapeIds,"vertical")}},{id:"flip-horizontal",label:"action.flip-horizontal",contextMenuLabel:"action.flip-horizontal.short",kbd:"!h",readonlyOk:!1,onSelect(v){f("flip-shapes",{operation:"horizontal",source:v}),n.mark("flip horizontal"),n.flipShapes(n.selectedShapeIds,"horizontal")}},{id:"flip-vertical",label:"action.flip-vertical",contextMenuLabel:"action.flip-vertical.short",kbd:"!v",readonlyOk:!1,onSelect(v){f("flip-shapes",{operation:"vertical",source:v}),n.mark("flip vertical"),n.flipShapes(n.selectedShapeIds,"vertical")}},{id:"pack",label:"action.pack",icon:"pack",readonlyOk:!1,onSelect(v){f("pack-shapes",{source:v}),n.mark("pack"),n.packShapes(n.selectedShapeIds,16)}},{id:"stack-vertical",label:"action.stack-vertical",contextMenuLabel:"action.stack-vertical.short",icon:"stack-vertical",readonlyOk:!1,onSelect(v){f("stack-shapes",{operation:"vertical",source:v}),n.mark("stack-vertical"),n.stackShapes(n.selectedShapeIds,"vertical",16)}},{id:"stack-horizontal",label:"action.stack-horizontal",contextMenuLabel:"action.stack-horizontal.short",icon:"stack-horizontal",readonlyOk:!1,onSelect(v){f("stack-shapes",{operation:"horizontal",source:v}),n.mark("stack-horizontal"),n.stackShapes(n.selectedShapeIds,"horizontal",16)}},{id:"bring-to-front",label:"action.bring-to-front",kbd:"]",icon:"bring-to-front",readonlyOk:!1,onSelect(v){f("reorder-shapes",{operation:"toFront",source:v}),n.mark("bring to front"),n.bringToFront(n.selectedShapeIds)}},{id:"bring-forward",label:"action.bring-forward",icon:"bring-forward",kbd:"?]",readonlyOk:!1,onSelect(v){f("reorder-shapes",{operation:"forward",source:v}),n.mark("bring forward"),n.bringForward(n.selectedShapeIds)}},{id:"send-backward",label:"action.send-backward",icon:"send-backward",kbd:"?[",readonlyOk:!1,onSelect(v){f("reorder-shapes",{operation:"backward",source:v}),n.mark("send backward"),n.sendBackward(n.selectedShapeIds)}},{id:"send-to-back",label:"action.send-to-back",icon:"send-to-back",kbd:"[",readonlyOk:!1,onSelect(v){f("reorder-shapes",{operation:"toBack",source:v}),n.mark("send to back"),n.sendToBack(n.selectedShapeIds)}},{id:"cut",label:"action.cut",kbd:"$x",readonlyOk:!1,onSelect(v){n.mark("cut"),c(v)}},{id:"copy",label:"action.copy",kbd:"$c",readonlyOk:!0,onSelect(v){l(v)}},{id:"paste",label:"action.paste",kbd:"$v",readonlyOk:!1,onSelect(v){var w;(w=navigator.clipboard)==null||w.read().then(x=>{u(x,v,v==="context-menu"?n.inputs.currentPagePoint:void 0)})}},{id:"select-all",label:"action.select-all",kbd:"$a",readonlyOk:!0,onSelect(v){f("select-all-shapes",{source:v}),n.currentToolId!=="select"&&(n.cancel(),n.setCurrentTool("select")),n.mark("select all kbd"),n.selectAll()}},{id:"select-none",label:"action.select-none",readonlyOk:!0,onSelect(v){f("select-none-shapes",{source:v}),n.mark("select none"),n.selectNone()}},{id:"delete",label:"action.delete",kbd:",del,backspace",icon:"trash",readonlyOk:!1,onSelect(v){n.currentToolId==="select"&&(f("delete-shapes",{source:v}),n.mark("delete"),n.deleteShapes(n.selectedShapeIds))}},{id:"rotate-cw",label:"action.rotate-cw",icon:"rotate-cw",readonlyOk:!1,onSelect(v){if(n.selectedShapeIds.length===0)return;f("rotate-cw",{source:v}),n.mark("rotate-cw");const w=n.selectionRotation%(Te/2),x=yu(w,0)||yu(w,Te/2);n.rotateShapesBy(n.selectedShapeIds,Te/2-(x?0:w))}},{id:"rotate-ccw",label:"action.rotate-ccw",icon:"rotate-ccw",readonlyOk:!1,onSelect(v){if(n.selectedShapeIds.length===0)return;f("rotate-ccw",{source:v}),n.mark("rotate-ccw");const w=n.selectionRotation%(Te/2),x=yu(w,0);n.rotateShapesBy(n.selectedShapeIds,x?-(Te/2):-w)}},{id:"zoom-in",label:"action.zoom-in",kbd:"$=,=",readonlyOk:!0,onSelect(v){f("zoom-in",{source:v}),n.zoomIn(n.viewportScreenCenter,{duration:Ds})}},{id:"zoom-out",label:"action.zoom-out",kbd:"$-,-",readonlyOk:!0,onSelect(v){f("zoom-out",{source:v}),n.zoomOut(n.viewportScreenCenter,{duration:Ds})}},{id:"zoom-to-100",label:"action.zoom-to-100",icon:"reset-zoom",kbd:"!0",readonlyOk:!0,onSelect(v){f("reset-zoom",{source:v}),n.resetZoom(n.viewportScreenCenter,{duration:Ds})}},{id:"zoom-to-fit",label:"action.zoom-to-fit",kbd:"!1",readonlyOk:!0,onSelect(v){f("zoom-to-fit",{source:v}),n.zoomToFit({duration:Ds})}},{id:"zoom-to-selection",label:"action.zoom-to-selection",kbd:"!2",readonlyOk:!0,onSelect(v){f("zoom-to-selection",{source:v}),n.zoomToSelection({duration:Ds})}},{id:"toggle-snap-mode",label:"action.toggle-snap-mode",menuLabel:"action.toggle-snap-mode.menu",readonlyOk:!1,onSelect(v){f("toggle-snap-mode",{source:v}),n.user.updateUserPreferences({isSnapMode:!n.user.isSnapMode})},checkbox:!0},{id:"toggle-dark-mode",label:"action.toggle-dark-mode",menuLabel:"action.toggle-dark-mode.menu",kbd:"$/",readonlyOk:!0,onSelect(v){f("toggle-dark-mode",{source:v}),n.user.updateUserPreferences({isDarkMode:!n.user.isDarkMode})},checkbox:!0},{id:"toggle-reduce-motion",label:"action.toggle-reduce-motion",menuLabel:"action.toggle-reduce-motion.menu",readonlyOk:!0,onSelect(v){f("toggle-reduce-motion",{source:v}),n.user.updateUserPreferences({animationSpeed:n.user.animationSpeed===0?1:0})},checkbox:!0},{id:"toggle-transparent",label:"action.toggle-transparent",menuLabel:"action.toggle-transparent.menu",contextMenuLabel:"action.toggle-transparent.context-menu",readonlyOk:!0,onSelect(v){f("toggle-transparent",{source:v}),n.updateInstanceState({exportBackground:!n.instanceState.exportBackground},!0)},checkbox:!0},{id:"toggle-tool-lock",label:"action.toggle-tool-lock",menuLabel:"action.toggle-tool-lock.menu",readonlyOk:!1,kbd:"q",onSelect(v){f("toggle-tool-lock",{source:v}),n.updateInstanceState({isToolLocked:!n.instanceState.isToolLocked})},checkbox:!0},{id:"toggle-focus-mode",label:"action.toggle-focus-mode",menuLabel:"action.toggle-focus-mode.menu",readonlyOk:!0,kbd:"$.",checkbox:!0,onSelect(v){requestAnimationFrame(()=>{n.batch(()=>{f("toggle-focus-mode",{source:v}),s(),o(),n.updateInstanceState({isFocusMode:!n.instanceState.isFocusMode})})})}},{id:"toggle-grid",label:"action.toggle-grid",menuLabel:"action.toggle-grid.menu",readonlyOk:!0,kbd:"$'",onSelect(v){f("toggle-grid-mode",{source:v}),n.updateInstanceState({isGridMode:!n.instanceState.isGridMode})},checkbox:!0},{id:"toggle-debug-mode",label:"action.toggle-debug-mode",menuLabel:"action.toggle-debug-mode.menu",readonlyOk:!0,onSelect(v){f("toggle-debug-mode",{source:v}),n.updateInstanceState({isDebugMode:!n.instanceState.isDebugMode},!0)},checkbox:!0},{id:"print",label:"action.print",kbd:"$p",readonlyOk:!0,onSelect(v){f("print",{source:v}),a()}},{id:"exit-pen-mode",label:"action.exit-pen-mode",icon:"cross-2",readonlyOk:!0,onSelect(v){f("exit-pen-mode",{source:v}),n.instanceState.isPenMode=!1}},{id:"stop-following",label:"action.stop-following",icon:"cross-2",readonlyOk:!0,onSelect(v){f("stop-following",{source:v}),n.stopFollowingUser()}},{id:"back-to-content",label:"action.back-to-content",icon:"arrow-left",readonlyOk:!0,onSelect(v){f("zoom-to-content",{source:v}),n.zoomToContent()}},{id:"toggle-lock",label:"action.toggle-lock",readonlyOk:!1,kbd:"!l",onSelect(v){f("toggle-lock",{source:v}),n.toggleLock(n.selectedShapeIds)}}]);return t?t(n,m,void 0):m},[f,t,n,r,i,h,d,c,l,u,s,o,a]);return g.jsx(oO.Provider,{value:p,children:e})}function an(){const t=S.useContext(oO);if(!t)throw new Error("useTools must be used within a ToolProvider");return t}function fb(t){return t.filter(e=>e!=null&&e!==!1)}function ve(t,...e){const n=fb(e);return n.length===0?null:{id:t,type:"group",checkbox:n.every(r=>r.type==="item"&&r.actionItem.checkbox),disabled:n.every(r=>r.disabled),readonlyOk:n.some(r=>r.readonlyOk),children:n}}function ts(t,e,...n){const r=fb(n);return r.length===0?null:{id:t,type:"submenu",label:e,children:r,disabled:r.every(s=>s.disabled),readonlyOk:r.some(s=>s.readonlyOk)}}function pb(t,e={}){const{readonlyOk:n=!0,disabled:r=!1}=e;return{id:t,type:"custom",disabled:r,readonlyOk:n}}function z(t,e={}){if(!t)throw Error("No action item provided to menuItem");if(!t.label)throw Error("Trying to create menu item for action item that doesn't have a label");const{checked:n=!1,disabled:r=!1}=e;return{id:t.id,type:"item",actionItem:t,disabled:r,checked:n,readonlyOk:t.readonlyOk}}function iO(t){const{selectedShapeIds:e}=t;return e.map(r=>t.getShape(r)).filter(r=>!(!r||t.isShapeOfType(r,"arrow")&&r.props.start.type==="binding"||t.isShapeOfType(r,"arrow")&&r.props.end.type==="binding"))}const aO=()=>{const t=H();return Y("threeStackableItems",()=>iO(t).length>2,[t])},gb=()=>{const t=H();return Y("allowGroup",()=>iO(t).length>1,[t])},mb=()=>{const t=H();return Y("allowUngroup",()=>t.selectedShapeIds.some(e=>{var n;return((n=t.getShape(e))==null?void 0:n.type)==="group"}),[])},cO=typeof window<"u"&&"navigator"in window&&!!navigator.clipboard&&!!navigator.clipboard.read,vne=[0,380,420,460,580,640,840,1023],lO=Z.createContext(0);function wne({children:t}){const e=H(),n=Y("breakpoint",()=>{const{width:r}=e.viewportScreenBounds,s=vne;for(let o=0;o<s.length-1;o++)if(r>s[o]&&r<=s[o+1])return o;return s.length},[e]);return g.jsx(lO.Provider,{value:n,children:t})}function _r(){let t=S.useContext(lO);const e=new URL(window.location.href).searchParams.get("layout");return e==="desktop"?t=7:e==="mobile"&&(t=1),t}function yb(){const t=H();return Y("hasLinkShapeSelected",()=>{const{selectedShapes:e}=t;return e.length===1&&"url"in e[0].props&&e[0].type!=="embed"},[t])}const uO=Z.createContext({}),Sne=Ee(function({overrides:e,children:n}){const r=H(),s=an(),o=r.selectedShapeIds.length,i=o>0,a=o>1,c=o>2,l=aO(),u=gb(),d=mb(),h=yb(),f=_r(),p=r.zoomLevel===1,m=S.useMemo(()=>{const v=[z(s["align-left"],{disabled:!a}),z(s["align-center-horizontal"],{disabled:!a}),z(s["align-right"],{disabled:!a}),z(s["stretch-horizontal"],{disabled:!a}),z(s["align-top"],{disabled:!a}),z(s["align-center-vertical"],{disabled:!a}),z(s["align-bottom"],{disabled:!a}),z(s["stretch-vertical"],{disabled:!a}),z(s["distribute-horizontal"],{disabled:!c}),z(s["distribute-vertical"],{disabled:!c}),z(s["stack-horizontal"],{disabled:!l}),z(s["stack-vertical"],{disabled:!l}),z(s["send-to-back"],{disabled:!i}),z(s["send-backward"],{disabled:!i}),z(s["bring-forward"],{disabled:!i}),z(s["bring-to-front"],{disabled:!i}),f<5?z(s["zoom-to-100"],{disabled:!!p}):z(s["rotate-ccw"],{disabled:!i}),z(s["rotate-cw"],{disabled:!i}),z(s["edit-link"],{disabled:!h}),u?z(s.group,{disabled:!a}):d?z(s.ungroup):z(s.group,{disabled:!a})];return e?e(r,v,{actions:s,oneSelected:i,twoSelected:a,threeSelected:c}):v},[r,p,u,e,s,i,a,c,l,d,h,f]);return g.jsx(uO.Provider,{value:m,children:n})});function xne(){const t=Z.useContext(uO);if(!t)throw new Error("useActionsMenuSchema must be used inside of a ActionsMenuSchemaProvider.");return t}function bne(){const t=H();return Y("onlyFlippableShape",()=>{const{selectedShapes:e}=t;return e.length===1&&e.every(n=>t.isShapeOfType(n,"group")||t.isShapeOfType(n,"arrow")||t.isShapeOfType(n,"line")||t.isShapeOfType(n,"draw"))},[t])}function dO(){const t=H();return Y("showAutoSizeToggle",()=>{const{selectedShapes:e}=t;return e.length===1&&t.isShapeOfType(e[0],"text")&&e[0].props.autoSize===!1},[t])}const hO=Z.createContext({}),Cne=Ee(function({overrides:e,children:n}){var E;const r=H(),s=an(),o=dO(),i=bne(),a=r.selectedShapeIds.length,c=a>0,l=a>1,u=a>2,d=aO(),h=Y("atLeastOneShapeOnPage",()=>r.currentPageShapeIds.size>0,[]),f=Y("isTransparentBg",()=>r.instanceState.exportBackground,[]),p=gb(),m=mb(),v=!!((E=window.navigator.clipboard)!=null&&E.write),w=yb(),{onlySelectedShape:x}=r,b=x&&r.isShapeOrAncestorLocked(x),C=S.useMemo(()=>{let _=fb([ve("selection",o&&z(s["toggle-auto-size"]),w&&!b&&z(s["edit-link"]),c&&!b&&z(s.duplicate),p&&!b&&z(s.group),m&&!b&&z(s.ungroup),c&&z(s["toggle-lock"])),ve("modify",(l||i)&&ts("arrange","context-menu.arrange",l&&ve("align",z(s["align-left"]),z(s["align-center-horizontal"]),z(s["align-right"]),z(s["align-top"]),z(s["align-center-vertical"]),z(s["align-bottom"])),u&&ve("distribute",z(s["distribute-horizontal"]),z(s["distribute-vertical"])),l&&ve("stretch",z(s["stretch-horizontal"]),z(s["stretch-vertical"])),i&&!b&&ve("flip",z(s["flip-horizontal"]),z(s["flip-vertical"])),l&&ve("order",z(s.pack,{disabled:!l}),d&&z(s["stack-vertical"]),d&&z(s["stack-horizontal"]))),c&&!b&&ts("reorder","context-menu.reorder",ve("reorder",z(s["bring-to-front"]),z(s["bring-forward"]),z(s["send-backward"]),z(s["send-to-back"]))),c&&!b&&pb("MOVE_TO_PAGE_MENU",{readonlyOk:!1})),ve("clipboard-group",c&&!b&&z(s.cut),c&&z(s.copy),cO&&z(s.paste)),h&&ve("conversions",ts("copy-as","context-menu.copy-as",ve("copy-as-group",z(s["copy-as-svg"]),v&&z(s["copy-as-png"]),z(s["copy-as-json"])),ve("export-bg",z(s["toggle-transparent"],{checked:!f}))),ts("export-as","context-menu.export-as",ve("export-as-group",z(s["export-as-svg"]),z(s["export-as-png"]),z(s["export-as-json"])),ve("export-bg,",z(s["toggle-transparent"],{checked:!f})))),h&&ve("set-selection-group",z(s["select-all"]),c&&z(s["select-none"])),c&&!b&&ve("delete-group",z(s.delete))]);return e&&(_=e(r,_,{actions:s,oneSelected:c,twoSelected:l,threeSelected:u,showAutoSizeToggle:o,showUngroup:m,onlyFlippableShapeSelected:i})),_},[r,e,s,c,l,u,o,i,h,d,p,m,v,w,f,b]);return g.jsx(hO.Provider,{value:C,children:n})});function fO(){const t=Z.useContext(hO);if(!t)throw new Error("useContextMenuSchema must be used inside of a TLUiContextMenuSchemaProvider.");return t}const pO=S.createContext({});function _ne({overrides:t,children:e}){const n=H(),r=yl(),{addDialog:s}=Ma(),o=sO(),i=Y(tx.highlighterTool),a=S.useMemo(()=>{const c=[{id:"select",label:"tool.select",icon:"tool-pointer",kbd:"v",readonlyOk:!0,onSelect(u){n.setCurrentTool("select"),r("select-tool",{source:u,id:"select"})}},{id:"hand",label:"tool.hand",icon:"tool-hand",kbd:"h",readonlyOk:!0,onSelect(u){n.setCurrentTool("hand"),r("select-tool",{source:u,id:"hand"})}},{id:"eraser",label:"tool.eraser",icon:"tool-eraser",kbd:"e",readonlyOk:!1,onSelect(u){n.setCurrentTool("eraser"),r("select-tool",{source:u,id:"eraser"})}},{id:"draw",label:"tool.draw",readonlyOk:!1,icon:"tool-pencil",kbd:"d,b,x",onSelect(u){n.setCurrentTool("draw"),r("select-tool",{source:u,id:"draw"})}},...[...cs.values].map(u=>({id:u,label:`tool.${u}`,readonlyOk:!1,meta:{geo:u},kbd:u==="rectangle"?"r":u==="ellipse"?"o":void 0,icon:"geo-"+u,onSelect(d){n.batch(()=>{n.updateInstanceState({stylesForNextShape:{...n.instanceState.stylesForNextShape,[cs.id]:u}},!0),n.setCurrentTool("geo"),r("select-tool",{source:d,id:`geo-${u}`})})}})),{id:"arrow",label:"tool.arrow",readonlyOk:!1,icon:"tool-arrow",kbd:"a",onSelect(u){n.setCurrentTool("arrow"),r("select-tool",{source:u,id:"arrow"})}},{id:"line",label:"tool.line",readonlyOk:!1,icon:"tool-line",kbd:"l",onSelect(u){n.setCurrentTool("line"),r("select-tool",{source:u,id:"line"})}},{id:"frame",label:"tool.frame",readonlyOk:!1,icon:"tool-frame",kbd:"f",onSelect(u){n.setCurrentTool("frame"),r("select-tool",{source:u,id:"frame"})}},{id:"text",label:"tool.text",readonlyOk:!1,icon:"tool-text",kbd:"t",onSelect(u){n.setCurrentTool("text"),r("select-tool",{source:u,id:"text"})}},{id:"asset",label:"tool.asset",readonlyOk:!1,icon:"tool-media",kbd:"$u",onSelect(u){o(),r("select-tool",{source:u,id:"media"})}},{id:"note",label:"tool.note",readonlyOk:!1,icon:"tool-note",kbd:"n",onSelect(u){n.setCurrentTool("note"),r("select-tool",{source:u,id:"note"})}},{id:"laser",label:"tool.laser",readonlyOk:!0,icon:"tool-laser",kbd:"k",onSelect(u){n.setCurrentTool("laser"),r("select-tool",{source:u,id:"laser"})}},{id:"embed",label:"tool.embed",readonlyOk:!1,icon:"tool-embed",onSelect(u){s({component:G5}),r("select-tool",{source:u,id:"embed"})}}];i&&c.push({id:"highlight",label:"tool.highlight",readonlyOk:!0,icon:"tool-highlight",kbd:"!d",onSelect(u){n.setCurrentTool("highlight"),r("select-tool",{source:u,id:"highlight"})}});const l=Object.fromEntries(c.map(u=>[u.id,u]));return t?t(n,l,{insertMedia:o}):l},[i,t,n,r,o,s]);return g.jsx(pO.Provider,{value:a,children:e})}function vb(){const t=S.useContext(pO);if(!t)throw new Error("useTools must be used within a ToolProvider");return t}const gO=Z.createContext({}),Ene=Ee(function({overrides:e,children:n}){const r=H(),s=vb(),o=an(),i=S.useMemo(()=>{const a=me([ve("shortcuts-dialog.tools",z(o["toggle-tool-lock"]),z(s.select),z(s.draw),z(s.eraser),z(s.hand),z(s.rectangle),z(s.ellipse),z(s.arrow),z(s.line),z(s.text),z(s.frame),z(s.note),z(s.laser)),ve("shortcuts-dialog.file",z(o["insert-media"]),z(o.print)),ve("shortcuts-dialog.preferences",z(o["toggle-dark-mode"]),z(o["toggle-focus-mode"]),z(o["toggle-grid"])),ve("shortcuts-dialog.edit",z(o.undo),z(o.redo),z(o.cut),z(o.copy),z(o.paste),z(o["select-all"]),z(o.delete),z(o.duplicate),z(o["export-as-svg"]),z(o["export-as-png"])),ve("shortcuts-dialog.view",z(o["zoom-in"]),z(o["zoom-out"]),z(o["zoom-to-100"]),z(o["zoom-to-fit"]),z(o["zoom-to-selection"])),ve("shortcuts-dialog.transform",z(o["bring-to-front"]),z(o["bring-forward"]),z(o["send-backward"]),z(o["send-to-back"]),z(o.group),z(o.ungroup),z(o["flip-horizontal"]),z(o["flip-vertical"]),z(o["align-top"]),z(o["align-center-vertical"]),z(o["align-bottom"]),z(o["align-left"]),z(o["align-center-horizontal"]),z(o["align-right"]))]);return e?e(r,a,{tools:s,actions:o}):a},[r,e,o,s]);return g.jsx(gO.Provider,{value:i,children:n})});function Pne(){const t=Z.useContext(gO);if(!t)throw new Error("Shortcuts must be used inside of a ShortcutsProvider.");return t}const kne=()=>{const t=be(),e=Cr(),n=Pne();function r(s){if(e&&!s.readonlyOk)return null;switch(s.type){case"group":return g.jsxs("div",{className:"tlui-shortcuts-dialog__group",children:[g.jsx("h2",{className:"tlui-shortcuts-dialog__group__title",children:t(s.id)}),g.jsx("div",{className:"tlui-shortcuts-dialog__group__content",children:s.children.filter(o=>o.type==="item"&&o.actionItem.kbd).map(r)})]},s.id);case"item":{const{id:o,label:i,shortcutsLabel:a,kbd:c}=s.actionItem;return g.jsxs("div",{className:"tlui-shortcuts-dialog__key-pair",children:[g.jsx("div",{className:"tlui-shortcuts-dialog__key-pair__key",children:t(a??i)}),g.jsx("div",{className:"tlui-shortcuts-dialog__key-pair__value",children:g.jsx(Em,{children:c})})]},o)}}}return g.jsxs(g.Fragment,{children:[g.jsxs(Pm,{className:"tlui-shortcuts-dialog__header",children:[g.jsx(km,{children:t("shortcuts-dialog.title")}),g.jsx(Im,{})]}),g.jsx(rd,{className:"tlui-shortcuts-dialog__body",children:n.map(r)}),g.jsx("div",{className:"tlui-dialog__scrim"})]})};function mO(){const t=H();return{languages:qu,currentLanguage:t.user.locale}}const yO=Z.createContext({}),Ine=Ee(function({overrides:e,children:n}){const r=H(),s=an(),o=r.selectedShapeIds.length,i=o>0,a=o>1,c=o>2,{languages:l,currentLanguage:u}=mO(),{addDialog:d}=Ma(),h=S.useMemo(()=>{const f=me([ve("top",pb("LANGUAGE_MENU",{readonlyOk:!0}),z({id:"keyboard-shortcuts",label:"help-menu.keyboard-shortcuts",readonlyOk:!0,onSelect(){d({component:kne})}}))]);return e?e(r,f,{actions:s,currentLanguage:u,languages:l,oneSelected:i,twoSelected:a,threeSelected:c}):f},[r,e,l,s,i,a,c,u,d]);return g.jsx(yO.Provider,{value:h,children:n})});function $ne(){const t=Z.useContext(yO);if(!t)throw new Error("useHelpMenuSchema must be used inside of a helpTLUiMenuSchemaProvider.");return t}function vO(){const t=H();return Y("useCanRedo",()=>t.canRedo,[t])}function wO(){const t=H();return Y("useCanUndo",()=>t.canUndo,[t])}const SO=Z.createContext({});function Tne({overrides:t,children:e}){var B;const n=H(),r=an(),o=_r()<5,i=Y("isDarkMode",()=>n.user.isDarkMode,[n]),a=Y("animationSpeed",()=>n.user.animationSpeed,[n]),c=Y("isGridMode",()=>n.instanceState.isGridMode,[n]),l=Y("isSnapMode",()=>n.user.isSnapMode,[n]),u=Y("isToolLock",()=>n.instanceState.isToolLocked,[n]),d=Y("isFocusMode",()=>n.instanceState.isFocusMode,[n]),h=Y("isDebugMode",()=>n.instanceState.isDebugMode,[n]),f=Y("exportBackground",()=>n.instanceState.exportBackground,[n]),p=Y("emptyPage",()=>n.currentPageShapeIds.size===0,[n]),m=Y("selectedCount",()=>n.selectedShapeIds.length,[n]),v=m===0,w=m>0,x=m>1,b=m>2,C=!!((B=window.navigator.clipboard)!=null&&B.write),E=yb(),_=dO(),k=gb(),I=mb(),$=wO(),A=vO(),D=Y("isZoomedTo100",()=>n.zoomLevel===1,[n]),L=Y("oneEmbedSelected",()=>{const{onlySelectedShape:U}=n;return U?!!(n.isShapeOfType(U,"embed")&&U.props.url&&!n.isShapeOrAncestorLocked(U)):!1},[]),j=Y("oneEmbeddableBookmarkSelected",()=>{const{onlySelectedShape:U}=n;return U?!!(n.isShapeOfType(U,"bookmark")&&U.props.url&&Rs(U.props.url)&&!n.isShapeOrAncestorLocked(U)):!1},[]),M=S.useMemo(()=>{const U=me([ve("menu",ts("file","menu.file",ve("print",z(r.print,{disabled:p}))),ts("edit","menu.edit",ve("undo-actions",z(r.undo,{disabled:!$}),z(r.redo,{disabled:!A})),ve("clipboard-actions",z(r.cut,{disabled:v}),z(r.copy,{disabled:v}),z(r.paste,{disabled:!cO})),ve("conversions",ts("copy-as","menu.copy-as",ve("copy-as-group",z(r["copy-as-svg"],{disabled:p}),z(r["copy-as-png"],{disabled:p||!C}),z(r["copy-as-json"],{disabled:p})),ve("export-bg",z(r["toggle-transparent"],{checked:!f}))),ts("export-as","menu.export-as",ve("export-as-group",z(r["export-as-svg"],{disabled:p}),z(r["export-as-png"],{disabled:p}),z(r["export-as-json"],{disabled:p})),ve("export-bg",z(r["toggle-transparent"],{checked:!f})))),ve("set-selection-group",z(r["select-all"],{disabled:p}),z(r["select-none"],{disabled:!w})),ve("selection",_&&z(r["toggle-auto-size"]),E&&z(r["edit-link"]),z(r.duplicate,{disabled:!w}),k&&z(r.group),I&&z(r.ungroup)),ve("delete-group",z(r.delete,{disabled:!w})),ve("embeds",L&&z(r["open-embed-link"]),L&&z(r["convert-to-bookmark"]),j&&z(r["convert-to-embed"]))),ts("view","menu.view",ve("view-actions",z(r["zoom-in"]),z(r["zoom-out"]),z(r["zoom-to-100"],{disabled:D}),z(r["zoom-to-fit"],{disabled:p}),z(r["zoom-to-selection"],{disabled:p||!w})))),ve("extras",z(r["insert-embed"]),z(r["insert-media"])),ve("preferences",ts("preferences","menu.preferences",ve("preferences-actions",z(r["toggle-snap-mode"],{checked:l}),z(r["toggle-tool-lock"],{checked:u}),z(r["toggle-grid"],{checked:c}),z(r["toggle-dark-mode"],{checked:i}),z(r["toggle-focus-mode"],{checked:d}),z(r["toggle-reduce-motion"],{checked:a===0}),z(r["toggle-debug-mode"],{checked:h}))),o&&pb("LANGUAGE_MENU",{readonlyOk:!0}))]);return t?t(n,U,{actions:r,noneSelected:v,oneSelected:w,twoSelected:x,threeSelected:b}):U},[n,t,r,w,x,b,p,o,k,I,E,C,_,v,$,A,a,i,c,l,u,d,f,h,D,j,L]);return g.jsx(SO.Provider,{value:M,children:e})}function Ane(){const t=Z.useContext(SO);if(!t)throw new Error("useMenuSchema must be used inside of a TLUiMenuSchemaProvider.");return t}function Le(t){return{id:t.id,type:"item",readonlyOk:t.readonlyOk,toolItem:t}}const xO=Z.createContext([]);function Mne({overrides:t,children:e}){const n=H(),r=vb(),s=Y(tx.highlighterTool),o=Z.useMemo(()=>{const i=me([Le(r.select),Le(r.hand),Le(r.draw),Le(r.eraser),Le(r.arrow),Le(r.text),Le(r.note),Le(r.asset),Le(r.rectangle),Le(r.ellipse),Le(r.diamond),Le(r.triangle),Le(r.trapezoid),Le(r.rhombus),Le(r.hexagon),Le(r.cloud),Le(r.star),Le(r.oval),Le(r["x-box"]),Le(r["check-box"]),Le(r["arrow-left"]),Le(r["arrow-up"]),Le(r["arrow-down"]),Le(r["arrow-right"]),Le(r.frame),Le(r.line),s?Le(r.highlight):null,Le(r.laser)]);return t?t(n,i,{tools:r}):i},[n,s,t,r]);return g.jsx(xO.Provider,{value:o,children:e})}function One(){const t=Z.useContext(xO);if(!t)throw new Error("useToolbarSchema must be used within a ToolbarSchemaProvider");return t}function Dne(){const{addToast:t,removeToast:e,clearToasts:n}=bs(),{addDialog:r,clearDialogs:s,removeDialog:o,updateDialog:i}=Ma(),c=_r()<5,l=be();return S.useMemo(()=>({addToast:t,removeToast:e,clearToasts:n,addDialog:r,clearDialogs:s,removeDialog:o,updateDialog:i,msg:l,isMobile:c}),[r,t,s,n,l,o,e,i,c])}function Rne(t,e){const n={};for(const r of t)if(r.translations)for(const[s,o]of Bs(r.translations)){let i=n[s];i||(i=n[s]={}),Object.assign(i,o)}return{actionsMenu:(r,s,o)=>{for(const i of t)i.actionsMenu&&(s=i.actionsMenu(r,s,{...e,...o}));return s},actions:(r,s)=>{for(const o of t)o.actions&&(s=o.actions(r,s,e));return s},contextMenu:(r,s,o)=>{for(const i of t)i.contextMenu&&(s=i.contextMenu(r,s,{...e,...o}));return s},helpMenu:(r,s,o)=>{for(const i of t)i.helpMenu&&(s=i.helpMenu(r,s,{...e,...o}));return s},menu:(r,s,o)=>{for(const i of t)i.menu&&(s=i.menu(r,s,{...e,...o}));return s},toolbar:(r,s,o)=>{for(const i of t)i.toolbar&&(s=i.toolbar(r,s,{...e,...o}));return s},keyboardShortcutsMenu:(r,s,o)=>{for(const i of t)i.keyboardShortcutsMenu&&(s=i.keyboardShortcutsMenu(r,s,{...e,...o}));return s},tools:(r,s,o)=>{for(const i of t)i.tools&&(s=i.tools(r,s,{...e,...o}));return s},translations:n}}function bO(t){return S.useMemo(()=>t,t)}function Lne(t){const e=bO(t==null?[]:Array.isArray(t)?t:[t]);return S.useMemo(()=>{const n={};for(const r of e)if(r.translations)for(const[s,o]of Bs(r.translations)){let i=n[s];i||(i=n[s]={}),Object.assign(i,o)}return n},[e])}function jne(t){const e=Dne(),n=bO(t==null?[]:Array.isArray(t)?t:[t]);return S.useMemo(()=>Rne(n,e),[n,e])}function Nne({overrides:t,assetUrls:e,onUiEvent:n,children:r}){return g.jsx(Oq,{assetUrls:Pte(e),children:g.jsx(Lq,{overrides:Lne(t),children:g.jsx(VZ,{onEvent:n,children:g.jsx(lne,{children:g.jsx(fne,{children:g.jsx(wne,{children:g.jsx(zne,{overrides:t,children:r})})})})})})})}function zne({overrides:t,children:e}){const n=jne(t);return g.jsx(yne,{overrides:n.actions,children:g.jsx(_ne,{overrides:n.tools,children:g.jsx(Mne,{overrides:n.toolbar,children:g.jsx(Sne,{overrides:n.actionsMenu,children:g.jsx(Ene,{overrides:n.keyboardShortcutsMenu,children:g.jsx(Cne,{overrides:n.contextMenu,children:g.jsx(Ine,{overrides:n.helpMenu,children:g.jsx(Tne,{overrides:n.menu,children:e})})})})})})})})}function Fne(){const t=H(),n=an()["back-to-content"],[r,s]=S.useState(!1);return S.useEffect(()=>{let o=!1;const i=setInterval(()=>{const{renderingShapes:a}=t,l=a.filter(u=>u.isInViewport).length===0&&t.currentPageShapes.length>0;o!==l&&(s(l),o=l)},1e3);return()=>{clearInterval(i)}},[t]),r?g.jsx(se,{iconLeft:n.icon,label:n.label,onClick:()=>{n.onSelect("helper-buttons"),s(!1)}}):null}let FP=0;function Bne(t,e){const n=Array(e),r=Math.floor(Math.sqrt(e));for(let s=0;s<e;s++)FP++,n[s]={id:Ke("box"+FP),type:"geo",x:s%r*132,y:Math.floor(s/r)*132};t.batch(()=>{t.createShapes(n).setSelectedShapeIds(n.map(s=>s.id))})}const Une=S.memo(function({renderDebugMenuItems:e}){const n=be();return g.jsxs("div",{className:"tlui-debug-panel",children:[g.jsx(Hne,{}),g.jsx(Kne,{}),g.jsxs(li,{id:"debug",children:[g.jsx(Vd,{children:g.jsx(se,{icon:"dots-horizontal",title:n("debug-panel.more")})}),g.jsx(ui,{side:"top",align:"end",alignOffset:0,children:g.jsx(Vne,{renderDebugMenuItems:e})})]})]})}),Hne=Ee(function(){const e=H();return g.jsx("div",{className:"tlui-debug-panel__current-state",children:e.root.path.value})}),Kne=function(){const e=H(),n=Y("rendering shapes count",()=>e.renderingShapes.length,[e]);return g.jsxs("div",{children:[n," Shapes"]})},Vne=Ee(function({renderDebugMenuItems:e}){const n=H(),{addToast:r}=bs(),{addDialog:s}=Ma(),[o,i]=S.useState(!1);return g.jsxs(g.Fragment,{children:[g.jsxs(Ks,{children:[g.jsx(Bn,{onClick:()=>{r({id:Ze(),title:"Something happened",description:"Hey, attend to this thing over here. It might be important!"})},children:g.jsx("span",{children:"Show toast"})}),g.jsx(Bn,{onClick:()=>{s({component:({onClose:a})=>g.jsx(Yne,{displayDontShowAgain:!0,onCancel:()=>{a()},onContinue:()=>{a()}}),onClose:()=>{}})},children:g.jsx("span",{children:"Show dialog"})}),g.jsx(Bn,{onClick:()=>Bne(n,100),children:g.jsx("span",{children:"Create 100 shapes"})}),g.jsx(Bn,{onClick:()=>{function a({children:h}){let f=0;if(!h.length)return 0;for(const p of[...h])f++,f+=a(p);return f}const{selectedShapes:c}=n,l=c.length===0?n.renderingShapes:c,u=l.map(h=>document.getElementById(h.id).parentElement);let d=u.length;for(const h of u)d+=a(h);window.alert(`Shapes ${l.length}, DOM nodes:${d}`)},children:g.jsx("span",{children:"Count shapes and nodes"})}),(()=>{if(o)throw Error("oh no!")})(),g.jsx(Bn,{onClick:()=>{i(!0)},children:g.jsx("span",{children:"Throw error"})}),g.jsx(Bn,{onClick:()=>{XT()},children:g.jsx("span",{children:"Hard reset"})})]}),g.jsxs(Ks,{children:[g.jsx(lf,{flag:xt.debugSvg}),g.jsx(lf,{flag:xt.forceSrgb}),g.jsx(lf,{flag:xt.debugCursors,onChange:a=>{if(a){const l=Gne.map((u,d)=>({id:Ke(),type:"geo",x:d%5*175,y:Math.floor(d/5)*175,props:{text:u,w:150,h:150,fill:"semi"}}));n.createShapes(l)}}})]}),g.jsx(Ks,{children:Object.values(tx).map(a=>g.jsx(lf,{flag:a},a.name))}),e==null?void 0:e()]})});function Wne({label:t,value:e,onChange:n}){return g.jsx(KM,{title:t,checked:e,onSelect:()=>n(!e),children:t})}const lf=Ee(function({flag:e,onChange:n}){return g.jsx(Wne,{label:e.name.replace(/([a-z0-9])([A-Z])/g,r=>`${r[0]} ${r[1].toLowerCase()}`).replace(/^[a-z]/,r=>r.toUpperCase()),value:e.value,onChange:r=>{e.set(r),n==null||n(r)}})}),Gne=["none","default","pointer","cross","move","grab","grabbing","text","ew-resize","ns-resize","nesw-resize","nwse-resize","nwse-rotate","nesw-rotate","senw-rotate","swne-rotate","zoom-in","zoom-out"];function Yne({title:t="title",body:e="hello hello hello",cancel:n="Cancel",confirm:r="Continue",displayDontShowAgain:s=!1,onCancel:o,onContinue:i}){const[a,c]=S.useState(!1);return g.jsxs(g.Fragment,{children:[g.jsxs(Pm,{children:[g.jsx(km,{children:t}),g.jsx(Im,{})]}),g.jsx(rd,{style:{maxWidth:350},children:e}),g.jsxs(Nx,{className:"tlui-dialog__footer__actions",children:[s&&g.jsx(se,{onClick:()=>c(!a),iconLeft:a?"checkbox-checked":"checkbox-empty",style:{marginRight:"auto"},children:"Don't show again"}),g.jsx(se,{onClick:o,children:n}),g.jsx(se,{type:"primary",onClick:async()=>i(),children:r})]})]})}const Xne=({id:t,component:e,onClose:n})=>{const{removeDialog:r}=Ma(),s=Mn(),o=S.useCallback(i=>{if(!i){if(n)try{n()}catch(a){console.warn(a)}r(t)}},[t,n,r]);return g.jsx(v7,{onOpenChange:o,defaultOpen:!0,children:g.jsx(w7,{container:s,children:g.jsx(S7,{dir:"ltr",className:"tlui-dialog__overlay",children:g.jsx(x7,{dir:"ltr",className:"tlui-dialog__content",children:g.jsx(e,{onClose:()=>o(!1)})})})})})};function qne(){const{dialogs:t}=Ma();return g.jsx(g.Fragment,{children:t.map(e=>g.jsx(Xne,{...e},e.id))})}const Qne=Z.memo(qne);function Zne(){const t=H(),e=Y("follow",()=>t.instanceState.followingUserId,[t]);return e?g.jsx(Jne,{userId:e}):null}function Jne({userId:t}){const e=g3(t);return e?g.jsx("div",{className:"tlui-following",style:{borderColor:e.color}}):null}function CO(){const t=H(),{languages:e,currentLanguage:n}=mO(),r=S.useCallback(s=>t.user.updateUserPreferences({locale:s}),[t]);return g.jsxs(qx,{id:"help menu language",children:[g.jsx(Qx,{label:"menu.language","data-direction":"left"}),g.jsx(Zx,{sideOffset:-4,children:g.jsx(Ks,{children:e.map(({locale:s,label:o})=>g.jsx(WZ,{title:s,checked:s===n,onSelect:()=>r(s),children:g.jsx("span",{children:o})},s))})})]})}const ere=S.memo(function(){const e=Mn(),n=be(),[r,s]=Aa("help menu");return g.jsx("div",{className:"tlui-help-menu",children:g.jsxs(zM,{dir:"ltr",open:r,onOpenChange:s,modal:!1,children:[g.jsx(ad,{className:"tlui-button tlui-help-menu__button",dir:"ltr",title:n("help-menu.title"),children:g.jsx(In,{icon:"question-mark"})}),g.jsx(Xx,{container:e,dir:"ltr",children:g.jsx(FM,{className:"tlui-menu",side:"top",sideOffset:8,align:"end",alignOffset:0,collisionPadding:4,children:g.jsx(tre,{})})})]})})});function tre(){const t=$ne(),e=Cr();function n(r){if(e&&!r.readonlyOk)return null;switch(r.type){case"custom":{if(r.id==="LANGUAGE_MENU")return g.jsx(CO,{},"item");break}case"group":return g.jsx(Ks,{size:"small",children:r.children.map(n)},r.id);case"submenu":return g.jsxs(qx,{id:`help menu ${r.id}`,children:[g.jsx(Qx,{label:r.label}),g.jsx(Zx,{children:r.children.map(n)})]},r.id);case"item":{const{id:s,kbd:o,label:i,onSelect:a,icon:c}=r.actionItem;return g.jsx(Bn,{kbd:o,label:i,onClick:()=>a("help-menu"),iconLeft:c},s)}}}return g.jsx(g.Fragment,{children:t.map(n)})}function na(t,e,{checkForDefaultPrevented:n=!0}={}){return function(s){if(t==null||t(s),n===!1||!s.defaultPrevented)return e==null?void 0:e(s)}}function nre(t,e){typeof t=="function"?t(e):t!=null&&(t.current=e)}function _O(...t){return e=>t.forEach(n=>nre(n,e))}function Oa(...t){return S.useCallback(_O(...t),t)}function EO(t,e=[]){let n=[];function r(o,i){const a=S.createContext(i),c=n.length;n=[...n,i];function l(d){const{scope:h,children:f,...p}=d,m=(h==null?void 0:h[t][c])||a,v=S.useMemo(()=>p,Object.values(p));return S.createElement(m.Provider,{value:v},f)}function u(d,h){const f=(h==null?void 0:h[t][c])||a,p=S.useContext(f);if(p)return p;if(i!==void 0)return i;throw new Error(`\`${d}\` must be used within \`${o}\``)}return l.displayName=o+"Provider",[l,u]}const s=()=>{const o=n.map(i=>S.createContext(i));return function(a){const c=(a==null?void 0:a[t])||o;return S.useMemo(()=>({[`__scope${t}`]:{...a,[t]:c}}),[a,c])}};return s.scopeName=t,[r,rre(s,...e)]}function rre(...t){const e=t[0];if(t.length===1)return e;const n=()=>{const r=t.map(s=>({useScope:s(),scopeName:s.scopeName}));return function(o){const i=r.reduce((a,{useScope:c,scopeName:l})=>{const d=c(o)[`__scope${l}`];return{...a,...d}},{});return S.useMemo(()=>({[`__scope${e.scopeName}`]:i}),[i])}};return n.scopeName=e.scopeName,n}const wb=S.forwardRef((t,e)=>{const{children:n,...r}=t,s=S.Children.toArray(n),o=s.find(ore);if(o){const i=o.props.children,a=s.map(c=>c===o?S.Children.count(i)>1?S.Children.only(null):S.isValidElement(i)?i.props.children:null:c);return S.createElement(wS,W({},r,{ref:e}),S.isValidElement(i)?S.cloneElement(i,void 0,a):null)}return S.createElement(wS,W({},r,{ref:e}),n)});wb.displayName="Slot";const wS=S.forwardRef((t,e)=>{const{children:n,...r}=t;return S.isValidElement(n)?S.cloneElement(n,{...ire(r,n.props),ref:_O(e,n.ref)}):S.Children.count(n)>1?S.Children.only(null):null});wS.displayName="SlotClone";const sre=({children:t})=>S.createElement(S.Fragment,null,t);function ore(t){return S.isValidElement(t)&&t.type===sre}function ire(t,e){const n={...e};for(const r in e){const s=t[r],o=e[r];/^on[A-Z]/.test(r)?s&&o?n[r]=(...a)=>{o(...a),s(...a)}:s&&(n[r]=s):r==="style"?n[r]={...s,...o}:r==="className"&&(n[r]=[s,o].filter(Boolean).join(" "))}return{...t,...n}}const are=["a","button","div","form","h2","h3","img","input","label","li","nav","ol","p","span","svg","ul"],pa=are.reduce((t,e)=>{const n=S.forwardRef((r,s)=>{const{asChild:o,...i}=r,a=o?wb:e;return S.useEffect(()=>{window[Symbol.for("radix-ui")]=!0},[]),S.createElement(a,W({},i,{ref:s}))});return n.displayName=`Primitive.${e}`,{...t,[e]:n}},{});function cre(t,e){t&&so.flushSync(()=>t.dispatchEvent(e))}function di(t){const e=S.useRef(t);return S.useEffect(()=>{e.current=t}),S.useMemo(()=>(...n)=>{var r;return(r=e.current)===null||r===void 0?void 0:r.call(e,...n)},[])}function lre(t,e=globalThis==null?void 0:globalThis.document){const n=di(t);S.useEffect(()=>{const r=s=>{s.key==="Escape"&&n(s)};return e.addEventListener("keydown",r),()=>e.removeEventListener("keydown",r)},[n,e])}const SS="dismissableLayer.update",ure="dismissableLayer.pointerDownOutside",dre="dismissableLayer.focusOutside";let BP;const hre=S.createContext({layers:new Set,layersWithOutsidePointerEventsDisabled:new Set,branches:new Set}),fre=S.forwardRef((t,e)=>{var n;const{disableOutsidePointerEvents:r=!1,onEscapeKeyDown:s,onPointerDownOutside:o,onFocusOutside:i,onInteractOutside:a,onDismiss:c,...l}=t,u=S.useContext(hre),[d,h]=S.useState(null),f=(n=d==null?void 0:d.ownerDocument)!==null&&n!==void 0?n:globalThis==null?void 0:globalThis.document,[,p]=S.useState({}),m=Oa(e,I=>h(I)),v=Array.from(u.layers),[w]=[...u.layersWithOutsidePointerEventsDisabled].slice(-1),x=v.indexOf(w),b=d?v.indexOf(d):-1,C=u.layersWithOutsidePointerEventsDisabled.size>0,E=b>=x,_=pre(I=>{const $=I.target,A=[...u.branches].some(D=>D.contains($));!E||A||(o==null||o(I),a==null||a(I),I.defaultPrevented||c==null||c())},f),k=gre(I=>{const $=I.target;[...u.branches].some(D=>D.contains($))||(i==null||i(I),a==null||a(I),I.defaultPrevented||c==null||c())},f);return lre(I=>{b===u.layers.size-1&&(s==null||s(I),!I.defaultPrevented&&c&&(I.preventDefault(),c()))},f),S.useEffect(()=>{if(d)return r&&(u.layersWithOutsidePointerEventsDisabled.size===0&&(BP=f.body.style.pointerEvents,f.body.style.pointerEvents="none"),u.layersWithOutsidePointerEventsDisabled.add(d)),u.layers.add(d),UP(),()=>{r&&u.layersWithOutsidePointerEventsDisabled.size===1&&(f.body.style.pointerEvents=BP)}},[d,f,r,u]),S.useEffect(()=>()=>{d&&(u.layers.delete(d),u.layersWithOutsidePointerEventsDisabled.delete(d),UP())},[d,u]),S.useEffect(()=>{const I=()=>p({});return document.addEventListener(SS,I),()=>document.removeEventListener(SS,I)},[]),S.createElement(pa.div,W({},l,{ref:m,style:{pointerEvents:C?E?"auto":"none":void 0,...t.style},onFocusCapture:na(t.onFocusCapture,k.onFocusCapture),onBlurCapture:na(t.onBlurCapture,k.onBlurCapture),onPointerDownCapture:na(t.onPointerDownCapture,_.onPointerDownCapture)}))});function pre(t,e=globalThis==null?void 0:globalThis.document){const n=di(t),r=S.useRef(!1),s=S.useRef(()=>{});return S.useEffect(()=>{const o=a=>{if(a.target&&!r.current){let u=function(){PO(ure,n,l,{discrete:!0})};var c=u;const l={originalEvent:a};a.pointerType==="touch"?(e.removeEventListener("click",s.current),s.current=u,e.addEventListener("click",s.current,{once:!0})):u()}r.current=!1},i=window.setTimeout(()=>{e.addEventListener("pointerdown",o)},0);return()=>{window.clearTimeout(i),e.removeEventListener("pointerdown",o),e.removeEventListener("click",s.current)}},[e,n]),{onPointerDownCapture:()=>r.current=!0}}function gre(t,e=globalThis==null?void 0:globalThis.document){const n=di(t),r=S.useRef(!1);return S.useEffect(()=>{const s=o=>{o.target&&!r.current&&PO(dre,n,{originalEvent:o},{discrete:!1})};return e.addEventListener("focusin",s),()=>e.removeEventListener("focusin",s)},[e,n]),{onFocusCapture:()=>r.current=!0,onBlurCapture:()=>r.current=!1}}function UP(){const t=new CustomEvent(SS);document.dispatchEvent(t)}function PO(t,e,n,{discrete:r}){const s=n.originalEvent.target,o=new CustomEvent(t,{bubbles:!1,cancelable:!0,detail:n});e&&s.addEventListener(t,e,{once:!0}),r?cre(s,o):s.dispatchEvent(o)}let K0=0;function mre(){S.useEffect(()=>{var t,e;const n=document.querySelectorAll("[data-radix-focus-guard]");return document.body.insertAdjacentElement("afterbegin",(t=n[0])!==null&&t!==void 0?t:HP()),document.body.insertAdjacentElement("beforeend",(e=n[1])!==null&&e!==void 0?e:HP()),K0++,()=>{K0===1&&document.querySelectorAll("[data-radix-focus-guard]").forEach(r=>r.remove()),K0--}},[])}function HP(){const t=document.createElement("span");return t.setAttribute("data-radix-focus-guard",""),t.tabIndex=0,t.style.cssText="outline: none; opacity: 0; position: fixed; pointer-events: none",t}const V0="focusScope.autoFocusOnMount",W0="focusScope.autoFocusOnUnmount",KP={bubbles:!1,cancelable:!0},yre=S.forwardRef((t,e)=>{const{loop:n=!1,trapped:r=!1,onMountAutoFocus:s,onUnmountAutoFocus:o,...i}=t,[a,c]=S.useState(null),l=di(s),u=di(o),d=S.useRef(null),h=Oa(e,m=>c(m)),f=S.useRef({paused:!1,pause(){this.paused=!0},resume(){this.paused=!1}}).current;S.useEffect(()=>{if(r){let w=function(b){if(f.paused||!a)return;const C=b.target;a.contains(C)?d.current=C:ji(d.current,{select:!0})},x=function(b){f.paused||!a||a.contains(b.relatedTarget)||ji(d.current,{select:!0})};var m=w,v=x;return document.addEventListener("focusin",w),document.addEventListener("focusout",x),()=>{document.removeEventListener("focusin",w),document.removeEventListener("focusout",x)}}},[r,a,f.paused]),S.useEffect(()=>{if(a){WP.add(f);const m=document.activeElement;if(!a.contains(m)){const w=new CustomEvent(V0,KP);a.addEventListener(V0,l),a.dispatchEvent(w),w.defaultPrevented||(vre(Cre(kO(a)),{select:!0}),document.activeElement===m&&ji(a))}return()=>{a.removeEventListener(V0,l),setTimeout(()=>{const w=new CustomEvent(W0,KP);a.addEventListener(W0,u),a.dispatchEvent(w),w.defaultPrevented||ji(m??document.body,{select:!0}),a.removeEventListener(W0,u),WP.remove(f)},0)}}},[a,l,u,f]);const p=S.useCallback(m=>{if(!n&&!r||f.paused)return;const v=m.key==="Tab"&&!m.altKey&&!m.ctrlKey&&!m.metaKey,w=document.activeElement;if(v&&w){const x=m.currentTarget,[b,C]=wre(x);b&&C?!m.shiftKey&&w===C?(m.preventDefault(),n&&ji(b,{select:!0})):m.shiftKey&&w===b&&(m.preventDefault(),n&&ji(C,{select:!0})):w===x&&m.preventDefault()}},[n,r,f.paused]);return S.createElement(pa.div,W({tabIndex:-1},i,{ref:h,onKeyDown:p}))});function vre(t,{select:e=!1}={}){const n=document.activeElement;for(const r of t)if(ji(r,{select:e}),document.activeElement!==n)return}function wre(t){const e=kO(t),n=VP(e,t),r=VP(e.reverse(),t);return[n,r]}function kO(t){const e=[],n=document.createTreeWalker(t,NodeFilter.SHOW_ELEMENT,{acceptNode:r=>{const s=r.tagName==="INPUT"&&r.type==="hidden";return r.disabled||r.hidden||s?NodeFilter.FILTER_SKIP:r.tabIndex>=0?NodeFilter.FILTER_ACCEPT:NodeFilter.FILTER_SKIP}});for(;n.nextNode();)e.push(n.currentNode);return e}function VP(t,e){for(const n of t)if(!Sre(n,{upTo:e}))return n}function Sre(t,{upTo:e}){if(getComputedStyle(t).visibility==="hidden")return!0;for(;t;){if(e!==void 0&&t===e)return!1;if(getComputedStyle(t).display==="none")return!0;t=t.parentElement}return!1}function xre(t){return t instanceof HTMLInputElement&&"select"in t}function ji(t,{select:e=!1}={}){if(t&&t.focus){const n=document.activeElement;t.focus({preventScroll:!0}),t!==n&&xre(t)&&e&&t.select()}}const WP=bre();function bre(){let t=[];return{add(e){const n=t[0];e!==n&&(n==null||n.pause()),t=GP(t,e),t.unshift(e)},remove(e){var n;t=GP(t,e),(n=t[0])===null||n===void 0||n.resume()}}}function GP(t,e){const n=[...t],r=n.indexOf(e);return r!==-1&&n.splice(r,1),n}function Cre(t){return t.filter(e=>e.tagName!=="A")}const Uo=globalThis!=null&&globalThis.document?S.useLayoutEffect:()=>{},_re=Gk["useId".toString()]||(()=>{});let Ere=0;function Pre(t){const[e,n]=S.useState(_re());return Uo(()=>{t||n(r=>r??String(Ere++))},[t]),t||(e?`radix-${e}`:"")}function Da(t){return t.split("-")[0]}function Xd(t){return t.split("-")[1]}function vl(t){return["top","bottom"].includes(Da(t))?"x":"y"}function Sb(t){return t==="y"?"height":"width"}function YP(t,e,n){let{reference:r,floating:s}=t;const o=r.x+r.width/2-s.width/2,i=r.y+r.height/2-s.height/2,a=vl(e),c=Sb(a),l=r[c]/2-s[c]/2,u=a==="x";let d;switch(Da(e)){case"top":d={x:o,y:r.y-s.height};break;case"bottom":d={x:o,y:r.y+r.height};break;case"right":d={x:r.x+r.width,y:i};break;case"left":d={x:r.x-s.width,y:i};break;default:d={x:r.x,y:r.y}}switch(Xd(e)){case"start":d[a]-=l*(n&&u?-1:1);break;case"end":d[a]+=l*(n&&u?-1:1)}return d}const kre=async(t,e,n)=>{const{placement:r="bottom",strategy:s="absolute",middleware:o=[],platform:i}=n,a=await(i.isRTL==null?void 0:i.isRTL(e));let c=await i.getElementRects({reference:t,floating:e,strategy:s}),{x:l,y:u}=YP(c,r,a),d=r,h={},f=0;for(let p=0;p<o.length;p++){const{name:m,fn:v}=o[p],{x:w,y:x,data:b,reset:C}=await v({x:l,y:u,initialPlacement:r,placement:d,strategy:s,middlewareData:h,rects:c,platform:i,elements:{reference:t,floating:e}});l=w??l,u=x??u,h={...h,[m]:{...h[m],...b}},C&&f<=50&&(f++,typeof C=="object"&&(C.placement&&(d=C.placement),C.rects&&(c=C.rects===!0?await i.getElementRects({reference:t,floating:e,strategy:s}):C.rects),{x:l,y:u}=YP(c,d,a)),p=-1)}return{x:l,y:u,placement:d,strategy:s,middlewareData:h}};function IO(t){return typeof t!="number"?function(e){return{top:0,right:0,bottom:0,left:0,...e}}(t):{top:t,right:t,bottom:t,left:t}}function Ig(t){return{...t,top:t.y,left:t.x,right:t.x+t.width,bottom:t.y+t.height}}async function hd(t,e){var n;e===void 0&&(e={});const{x:r,y:s,platform:o,rects:i,elements:a,strategy:c}=t,{boundary:l="clippingAncestors",rootBoundary:u="viewport",elementContext:d="floating",altBoundary:h=!1,padding:f=0}=e,p=IO(f),m=a[h?d==="floating"?"reference":"floating":d],v=Ig(await o.getClippingRect({element:(n=await(o.isElement==null?void 0:o.isElement(m)))==null||n?m:m.contextElement||await(o.getDocumentElement==null?void 0:o.getDocumentElement(a.floating)),boundary:l,rootBoundary:u,strategy:c})),w=Ig(o.convertOffsetParentRelativeRectToViewportRelativeRect?await o.convertOffsetParentRelativeRectToViewportRelativeRect({rect:d==="floating"?{...i.floating,x:r,y:s}:i.reference,offsetParent:await(o.getOffsetParent==null?void 0:o.getOffsetParent(a.floating)),strategy:c}):i[d]);return{top:v.top-w.top+p.top,bottom:w.bottom-v.bottom+p.bottom,left:v.left-w.left+p.left,right:w.right-v.right+p.right}}const Ire=Math.min,Ni=Math.max;function xS(t,e,n){return Ni(t,Ire(e,n))}const XP=t=>({name:"arrow",options:t,async fn(e){const{element:n,padding:r=0}=t??{},{x:s,y:o,placement:i,rects:a,platform:c}=e;if(n==null)return{};const l=IO(r),u={x:s,y:o},d=vl(i),h=Xd(i),f=Sb(d),p=await c.getDimensions(n),m=d==="y"?"top":"left",v=d==="y"?"bottom":"right",w=a.reference[f]+a.reference[d]-u[d]-a.floating[f],x=u[d]-a.reference[d],b=await(c.getOffsetParent==null?void 0:c.getOffsetParent(n));let C=b?d==="y"?b.clientHeight||0:b.clientWidth||0:0;C===0&&(C=a.floating[f]);const E=w/2-x/2,_=l[m],k=C-p[f]-l[v],I=C/2-p[f]/2+E,$=xS(_,I,k),A=(h==="start"?l[m]:l[v])>0&&I!==$&&a.reference[f]<=a.floating[f];return{[d]:u[d]-(A?I<_?_-I:k-I:0),data:{[d]:$,centerOffset:I-$}}}}),$re={left:"right",right:"left",bottom:"top",top:"bottom"};function $g(t){return t.replace(/left|right|bottom|top/g,e=>$re[e])}function Tre(t,e,n){n===void 0&&(n=!1);const r=Xd(t),s=vl(t),o=Sb(s);let i=s==="x"?r===(n?"end":"start")?"right":"left":r==="start"?"bottom":"top";return e.reference[o]>e.floating[o]&&(i=$g(i)),{main:i,cross:$g(i)}}const Are={start:"end",end:"start"};function qP(t){return t.replace(/start|end/g,e=>Are[e])}const $O=["top","right","bottom","left"];$O.reduce((t,e)=>t.concat(e,e+"-start",e+"-end"),[]);const Mre=function(t){return t===void 0&&(t={}),{name:"flip",options:t,async fn(e){var n;const{placement:r,middlewareData:s,rects:o,initialPlacement:i,platform:a,elements:c}=e,{mainAxis:l=!0,crossAxis:u=!0,fallbackPlacements:d,fallbackStrategy:h="bestFit",flipAlignment:f=!0,...p}=t,m=Da(r),v=d||(m===i||!f?[$g(i)]:function(I){const $=$g(I);return[qP(I),$,qP($)]}(i)),w=[i,...v],x=await hd(e,p),b=[];let C=((n=s.flip)==null?void 0:n.overflows)||[];if(l&&b.push(x[m]),u){const{main:I,cross:$}=Tre(r,o,await(a.isRTL==null?void 0:a.isRTL(c.floating)));b.push(x[I],x[$])}if(C=[...C,{placement:r,overflows:b}],!b.every(I=>I<=0)){var E,_;const I=((E=(_=s.flip)==null?void 0:_.index)!=null?E:0)+1,$=w[I];if($)return{data:{index:I,overflows:C},reset:{placement:$}};let A="bottom";switch(h){case"bestFit":{var k;const D=(k=C.map(L=>[L,L.overflows.filter(j=>j>0).reduce((j,M)=>j+M,0)]).sort((L,j)=>L[1]-j[1])[0])==null?void 0:k[0].placement;D&&(A=D);break}case"initialPlacement":A=i}if(r!==A)return{reset:{placement:A}}}return{}}}};function QP(t,e){return{top:t.top-e.height,right:t.right-e.width,bottom:t.bottom-e.height,left:t.left-e.width}}function ZP(t){return $O.some(e=>t[e]>=0)}const Ore=function(t){let{strategy:e="referenceHidden",...n}=t===void 0?{}:t;return{name:"hide",async fn(r){const{rects:s}=r;switch(e){case"referenceHidden":{const o=QP(await hd(r,{...n,elementContext:"reference"}),s.reference);return{data:{referenceHiddenOffsets:o,referenceHidden:ZP(o)}}}case"escaped":{const o=QP(await hd(r,{...n,altBoundary:!0}),s.floating);return{data:{escapedOffsets:o,escaped:ZP(o)}}}default:return{}}}}},Dre=function(t){return t===void 0&&(t=0),{name:"offset",options:t,async fn(e){const{x:n,y:r}=e,s=await async function(o,i){const{placement:a,platform:c,elements:l}=o,u=await(c.isRTL==null?void 0:c.isRTL(l.floating)),d=Da(a),h=Xd(a),f=vl(a)==="x",p=["left","top"].includes(d)?-1:1,m=u&&f?-1:1,v=typeof i=="function"?i(o):i;let{mainAxis:w,crossAxis:x,alignmentAxis:b}=typeof v=="number"?{mainAxis:v,crossAxis:0,alignmentAxis:null}:{mainAxis:0,crossAxis:0,alignmentAxis:null,...v};return h&&typeof b=="number"&&(x=h==="end"?-1*b:b),f?{x:x*m,y:w*p}:{x:w*p,y:x*m}}(e,t);return{x:n+s.x,y:r+s.y,data:s}}}};function TO(t){return t==="x"?"y":"x"}const Rre=function(t){return t===void 0&&(t={}),{name:"shift",options:t,async fn(e){const{x:n,y:r,placement:s}=e,{mainAxis:o=!0,crossAxis:i=!1,limiter:a={fn:v=>{let{x:w,y:x}=v;return{x:w,y:x}}},...c}=t,l={x:n,y:r},u=await hd(e,c),d=vl(Da(s)),h=TO(d);let f=l[d],p=l[h];if(o){const v=d==="y"?"bottom":"right";f=xS(f+u[d==="y"?"top":"left"],f,f-u[v])}if(i){const v=h==="y"?"bottom":"right";p=xS(p+u[h==="y"?"top":"left"],p,p-u[v])}const m=a.fn({...e,[d]:f,[h]:p});return{...m,data:{x:m.x-n,y:m.y-r}}}}},Lre=function(t){return t===void 0&&(t={}),{options:t,fn(e){const{x:n,y:r,placement:s,rects:o,middlewareData:i}=e,{offset:a=0,mainAxis:c=!0,crossAxis:l=!0}=t,u={x:n,y:r},d=vl(s),h=TO(d);let f=u[d],p=u[h];const m=typeof a=="function"?a({...o,placement:s}):a,v=typeof m=="number"?{mainAxis:m,crossAxis:0}:{mainAxis:0,crossAxis:0,...m};if(c){const E=d==="y"?"height":"width",_=o.reference[d]-o.floating[E]+v.mainAxis,k=o.reference[d]+o.reference[E]-v.mainAxis;f<_?f=_:f>k&&(f=k)}if(l){var w,x,b,C;const E=d==="y"?"width":"height",_=["top","left"].includes(Da(s)),k=o.reference[h]-o.floating[E]+(_&&(w=(x=i.offset)==null?void 0:x[h])!=null?w:0)+(_?0:v.crossAxis),I=o.reference[h]+o.reference[E]+(_?0:(b=(C=i.offset)==null?void 0:C[h])!=null?b:0)-(_?v.crossAxis:0);p<k?p=k:p>I&&(p=I)}return{[d]:f,[h]:p}}}},jre=function(t){return t===void 0&&(t={}),{name:"size",options:t,async fn(e){const{placement:n,rects:r,platform:s,elements:o}=e,{apply:i,...a}=t,c=await hd(e,a),l=Da(n),u=Xd(n);let d,h;l==="top"||l==="bottom"?(d=l,h=u===(await(s.isRTL==null?void 0:s.isRTL(o.floating))?"start":"end")?"left":"right"):(h=l,d=u==="end"?"top":"bottom");const f=Ni(c.left,0),p=Ni(c.right,0),m=Ni(c.top,0),v=Ni(c.bottom,0),w={availableHeight:r.floating.height-(["left","right"].includes(n)?2*(m!==0||v!==0?m+v:Ni(c.top,c.bottom)):c[d]),availableWidth:r.floating.width-(["top","bottom"].includes(n)?2*(f!==0||p!==0?f+p:Ni(c.left,c.right)):c[h])},x=await s.getDimensions(o.floating);i==null||i({...e,...w});const b=await s.getDimensions(o.floating);return x.width!==b.width||x.height!==b.height?{reset:{rects:!0}}:{}}}};function AO(t){return t&&t.document&&t.location&&t.alert&&t.setInterval}function po(t){if(t==null)return window;if(!AO(t)){const e=t.ownerDocument;return e&&e.defaultView||window}return t}function qd(t){return po(t).getComputedStyle(t)}function Ws(t){return AO(t)?"":t?(t.nodeName||"").toLowerCase():""}function MO(){const t=navigator.userAgentData;return t!=null&&t.brands?t.brands.map(e=>e.brand+"/"+e.version).join(" "):navigator.userAgent}function ms(t){return t instanceof po(t).HTMLElement}function hi(t){return t instanceof po(t).Element}function xb(t){return typeof ShadowRoot>"u"?!1:t instanceof po(t).ShadowRoot||t instanceof ShadowRoot}function zm(t){const{overflow:e,overflowX:n,overflowY:r}=qd(t);return/auto|scroll|overlay|hidden/.test(e+r+n)}function Nre(t){return["table","td","th"].includes(Ws(t))}function JP(t){const e=/firefox/i.test(MO()),n=qd(t);return n.transform!=="none"||n.perspective!=="none"||n.contain==="paint"||["transform","perspective"].includes(n.willChange)||e&&n.willChange==="filter"||e&&!!n.filter&&n.filter!=="none"}function OO(){return!/^((?!chrome|android).)*safari/i.test(MO())}const ek=Math.min,bu=Math.max,Tg=Math.round;function Gs(t,e,n){var r,s,o,i;e===void 0&&(e=!1),n===void 0&&(n=!1);const a=t.getBoundingClientRect();let c=1,l=1;e&&ms(t)&&(c=t.offsetWidth>0&&Tg(a.width)/t.offsetWidth||1,l=t.offsetHeight>0&&Tg(a.height)/t.offsetHeight||1);const u=hi(t)?po(t):window,d=!OO()&&n,h=(a.left+(d&&(r=(s=u.visualViewport)==null?void 0:s.offsetLeft)!=null?r:0))/c,f=(a.top+(d&&(o=(i=u.visualViewport)==null?void 0:i.offsetTop)!=null?o:0))/l,p=a.width/c,m=a.height/l;return{width:p,height:m,top:f,right:h+p,bottom:f+m,left:h,x:h,y:f}}function ti(t){return(e=t,(e instanceof po(e).Node?t.ownerDocument:t.document)||window.document).documentElement;var e}function Fm(t){return hi(t)?{scrollLeft:t.scrollLeft,scrollTop:t.scrollTop}:{scrollLeft:t.pageXOffset,scrollTop:t.pageYOffset}}function DO(t){return Gs(ti(t)).left+Fm(t).scrollLeft}function zre(t,e,n){const r=ms(e),s=ti(e),o=Gs(t,r&&function(c){const l=Gs(c);return Tg(l.width)!==c.offsetWidth||Tg(l.height)!==c.offsetHeight}(e),n==="fixed");let i={scrollLeft:0,scrollTop:0};const a={x:0,y:0};if(r||!r&&n!=="fixed")if((Ws(e)!=="body"||zm(s))&&(i=Fm(e)),ms(e)){const c=Gs(e,!0);a.x=c.x+e.clientLeft,a.y=c.y+e.clientTop}else s&&(a.x=DO(s));return{x:o.left+i.scrollLeft-a.x,y:o.top+i.scrollTop-a.y,width:o.width,height:o.height}}function RO(t){return Ws(t)==="html"?t:t.assignedSlot||t.parentNode||(xb(t)?t.host:null)||ti(t)}function tk(t){return ms(t)&&getComputedStyle(t).position!=="fixed"?t.offsetParent:null}function bS(t){const e=po(t);let n=tk(t);for(;n&&Nre(n)&&getComputedStyle(n).position==="static";)n=tk(n);return n&&(Ws(n)==="html"||Ws(n)==="body"&&getComputedStyle(n).position==="static"&&!JP(n))?e:n||function(r){let s=RO(r);for(xb(s)&&(s=s.host);ms(s)&&!["html","body"].includes(Ws(s));){if(JP(s))return s;s=s.parentNode}return null}(t)||e}function nk(t){if(ms(t))return{width:t.offsetWidth,height:t.offsetHeight};const e=Gs(t);return{width:e.width,height:e.height}}function LO(t){const e=RO(t);return["html","body","#document"].includes(Ws(e))?t.ownerDocument.body:ms(e)&&zm(e)?e:LO(e)}function Ag(t,e){var n;e===void 0&&(e=[]);const r=LO(t),s=r===((n=t.ownerDocument)==null?void 0:n.body),o=po(r),i=s?[o].concat(o.visualViewport||[],zm(r)?r:[]):r,a=e.concat(i);return s?a:a.concat(Ag(i))}function rk(t,e,n){return e==="viewport"?Ig(function(r,s){const o=po(r),i=ti(r),a=o.visualViewport;let c=i.clientWidth,l=i.clientHeight,u=0,d=0;if(a){c=a.width,l=a.height;const h=OO();(h||!h&&s==="fixed")&&(u=a.offsetLeft,d=a.offsetTop)}return{width:c,height:l,x:u,y:d}}(t,n)):hi(e)?function(r,s){const o=Gs(r,!1,s==="fixed"),i=o.top+r.clientTop,a=o.left+r.clientLeft;return{top:i,left:a,x:a,y:i,right:a+r.clientWidth,bottom:i+r.clientHeight,width:r.clientWidth,height:r.clientHeight}}(e,n):Ig(function(r){var s;const o=ti(r),i=Fm(r),a=(s=r.ownerDocument)==null?void 0:s.body,c=bu(o.scrollWidth,o.clientWidth,a?a.scrollWidth:0,a?a.clientWidth:0),l=bu(o.scrollHeight,o.clientHeight,a?a.scrollHeight:0,a?a.clientHeight:0);let u=-i.scrollLeft+DO(r);const d=-i.scrollTop;return qd(a||o).direction==="rtl"&&(u+=bu(o.clientWidth,a?a.clientWidth:0)-c),{width:c,height:l,x:u,y:d}}(ti(t)))}function Fre(t){const e=Ag(t),n=["absolute","fixed"].includes(qd(t).position)&&ms(t)?bS(t):t;return hi(n)?e.filter(r=>hi(r)&&function(s,o){const i=o.getRootNode==null?void 0:o.getRootNode();if(s.contains(o))return!0;if(i&&xb(i)){let a=o;do{if(a&&s===a)return!0;a=a.parentNode||a.host}while(a)}return!1}(r,n)&&Ws(r)!=="body"):[]}const Bre={getClippingRect:function(t){let{element:e,boundary:n,rootBoundary:r,strategy:s}=t;const o=[...n==="clippingAncestors"?Fre(e):[].concat(n),r],i=o[0],a=o.reduce((c,l)=>{const u=rk(e,l,s);return c.top=bu(u.top,c.top),c.right=ek(u.right,c.right),c.bottom=ek(u.bottom,c.bottom),c.left=bu(u.left,c.left),c},rk(e,i,s));return{width:a.right-a.left,height:a.bottom-a.top,x:a.left,y:a.top}},convertOffsetParentRelativeRectToViewportRelativeRect:function(t){let{rect:e,offsetParent:n,strategy:r}=t;const s=ms(n),o=ti(n);if(n===o)return e;let i={scrollLeft:0,scrollTop:0};const a={x:0,y:0};if((s||!s&&r!=="fixed")&&((Ws(n)!=="body"||zm(o))&&(i=Fm(n)),ms(n))){const c=Gs(n,!0);a.x=c.x+n.clientLeft,a.y=c.y+n.clientTop}return{...e,x:e.x-i.scrollLeft+a.x,y:e.y-i.scrollTop+a.y}},isElement:hi,getDimensions:nk,getOffsetParent:bS,getDocumentElement:ti,getElementRects:t=>{let{reference:e,floating:n,strategy:r}=t;return{reference:zre(e,bS(n),r),floating:{...nk(n),x:0,y:0}}},getClientRects:t=>Array.from(t.getClientRects()),isRTL:t=>qd(t).direction==="rtl"};function Ure(t,e,n,r){r===void 0&&(r={});const{ancestorScroll:s=!0,ancestorResize:o=!0,elementResize:i=!0,animationFrame:a=!1}=r,c=s&&!a,l=o&&!a,u=c||l?[...hi(t)?Ag(t):[],...Ag(e)]:[];u.forEach(p=>{c&&p.addEventListener("scroll",n,{passive:!0}),l&&p.addEventListener("resize",n)});let d,h=null;if(i){let p=!0;h=new ResizeObserver(()=>{p||n(),p=!1}),hi(t)&&!a&&h.observe(t),h.observe(e)}let f=a?Gs(t):null;return a&&function p(){const m=Gs(t);!f||m.x===f.x&&m.y===f.y&&m.width===f.width&&m.height===f.height||n(),f=m,d=requestAnimationFrame(p)}(),n(),()=>{var p;u.forEach(m=>{c&&m.removeEventListener("scroll",n),l&&m.removeEventListener("resize",n)}),(p=h)==null||p.disconnect(),h=null,a&&cancelAnimationFrame(d)}}const Hre=(t,e,n)=>kre(t,e,{platform:Bre,...n});var CS=typeof document<"u"?S.useLayoutEffect:S.useEffect;function _S(t,e){if(t===e)return!0;if(typeof t!=typeof e)return!1;if(typeof t=="function"&&t.toString()===e.toString())return!0;let n,r,s;if(t&&e&&typeof t=="object"){if(Array.isArray(t)){if(n=t.length,n!=e.length)return!1;for(r=n;r--!==0;)if(!_S(t[r],e[r]))return!1;return!0}if(s=Object.keys(t),n=s.length,n!==Object.keys(e).length)return!1;for(r=n;r--!==0;)if(!Object.prototype.hasOwnProperty.call(e,s[r]))return!1;for(r=n;r--!==0;){const o=s[r];if(!(o==="_owner"&&t.$$typeof)&&!_S(t[o],e[o]))return!1}return!0}return t!==t&&e!==e}function Kre(t){const e=S.useRef(t);return CS(()=>{e.current=t}),e}function Vre(t){let{middleware:e,placement:n="bottom",strategy:r="absolute",whileElementsMounted:s}=t===void 0?{}:t;const o=S.useRef(null),i=S.useRef(null),a=Kre(s),c=S.useRef(null),[l,u]=S.useState({x:null,y:null,strategy:r,placement:n,middlewareData:{}}),[d,h]=S.useState(e);_S(d==null?void 0:d.map(b=>{let{options:C}=b;return C}),e==null?void 0:e.map(b=>{let{options:C}=b;return C}))||h(e);const f=S.useCallback(()=>{!o.current||!i.current||Hre(o.current,i.current,{middleware:d,placement:n,strategy:r}).then(b=>{p.current&&so.flushSync(()=>{u(b)})})},[d,n,r]);CS(()=>{p.current&&f()},[f]);const p=S.useRef(!1);CS(()=>(p.current=!0,()=>{p.current=!1}),[]);const m=S.useCallback(()=>{if(typeof c.current=="function"&&(c.current(),c.current=null),o.current&&i.current)if(a.current){const b=a.current(o.current,i.current,f);c.current=b}else f()},[f,a]),v=S.useCallback(b=>{o.current=b,m()},[m]),w=S.useCallback(b=>{i.current=b,m()},[m]),x=S.useMemo(()=>({reference:o,floating:i}),[]);return S.useMemo(()=>({...l,update:f,refs:x,reference:v,floating:w}),[l,f,x,v,w])}const Wre=t=>{const{element:e,padding:n}=t;function r(s){return Object.prototype.hasOwnProperty.call(s,"current")}return{name:"arrow",options:t,fn(s){return r(e)?e.current!=null?XP({element:e.current,padding:n}).fn(s):{}:e?XP({element:e,padding:n}).fn(s):{}}}};function Gre(t){const[e,n]=S.useState(void 0);return Uo(()=>{if(t){n({width:t.offsetWidth,height:t.offsetHeight});const r=new ResizeObserver(s=>{if(!Array.isArray(s)||!s.length)return;const o=s[0];let i,a;if("borderBoxSize"in o){const c=o.borderBoxSize,l=Array.isArray(c)?c[0]:c;i=l.inlineSize,a=l.blockSize}else i=t.offsetWidth,a=t.offsetHeight;n({width:i,height:a})});return r.observe(t,{box:"border-box"}),()=>r.unobserve(t)}else n(void 0)},[t]),e}const jO="Popper",[bb,NO]=EO(jO),[Yre,zO]=bb(jO),Xre=t=>{const{__scopePopper:e,children:n}=t,[r,s]=S.useState(null);return S.createElement(Yre,{scope:e,anchor:r,onAnchorChange:s},n)},qre="PopperAnchor",Qre=S.forwardRef((t,e)=>{const{__scopePopper:n,virtualRef:r,...s}=t,o=zO(qre,n),i=S.useRef(null),a=Oa(e,i);return S.useEffect(()=>{o.onAnchorChange((r==null?void 0:r.current)||i.current)}),r?null:S.createElement(pa.div,W({},s,{ref:a}))}),Mg="PopperContent",[Zre,eue]=bb(Mg),[Jre,ese]=bb(Mg,{hasParent:!1,positionUpdateFns:new Set}),tse=S.forwardRef((t,e)=>{var n,r,s,o,i,a,c,l;const{__scopePopper:u,side:d="bottom",sideOffset:h=0,align:f="center",alignOffset:p=0,arrowPadding:m=0,collisionBoundary:v=[],collisionPadding:w=0,sticky:x="partial",hideWhenDetached:b=!1,avoidCollisions:C=!0,onPlaced:E,..._}=t,k=zO(Mg,u),[I,$]=S.useState(null),A=Oa(e,ki=>$(ki)),[D,L]=S.useState(null),j=Gre(D),M=(n=j==null?void 0:j.width)!==null&&n!==void 0?n:0,B=(r=j==null?void 0:j.height)!==null&&r!==void 0?r:0,U=d+(f!=="center"?"-"+f:""),q=typeof w=="number"?w:{top:0,right:0,bottom:0,left:0,...w},N=Array.isArray(v)?v:[v],F=N.length>0,K={padding:q,boundary:N.filter(rse),altBoundary:F},{reference:Q,floating:ne,strategy:we,x:ke,y:de,placement:Ye,middlewareData:Xe,update:qe}=Vre({strategy:"fixed",placement:U,whileElementsMounted:Ure,middleware:[Dre({mainAxis:h+B,alignmentAxis:p}),C?Rre({mainAxis:!0,crossAxis:!1,limiter:x==="partial"?Lre():void 0,...K}):void 0,C?Mre({...K}):void 0,jre({...K,apply:({elements:ki,rects:Xm,availableWidth:qm,availableHeight:Qm})=>{const{width:Zm,height:ja}=Xm.reference,So=ki.floating.style;So.setProperty("--radix-popper-available-width",`${qm}px`),So.setProperty("--radix-popper-available-height",`${Qm}px`),So.setProperty("--radix-popper-anchor-width",`${Zm}px`),So.setProperty("--radix-popper-anchor-height",`${ja}px`)}}),D?Wre({element:D,padding:m}):void 0,sse({arrowWidth:M,arrowHeight:B}),b?Ore({strategy:"referenceHidden"}):void 0].filter(nse)});Uo(()=>{Q(k.anchor)},[Q,k.anchor]);const Be=ke!==null&&de!==null,[cn,vo]=FO(Ye),Dn=di(E);Uo(()=>{Be&&(Dn==null||Dn())},[Be,Dn]);const _s=(s=Xe.arrow)===null||s===void 0?void 0:s.x,Er=(o=Xe.arrow)===null||o===void 0?void 0:o.y,wo=((i=Xe.arrow)===null||i===void 0?void 0:i.centerOffset)!==0,[Es,tr]=S.useState();Uo(()=>{I&&tr(window.getComputedStyle(I).zIndex)},[I]);const{hasParent:Pr,positionUpdateFns:nr}=ese(Mg,u),ln=!Pr;S.useLayoutEffect(()=>{if(!ln)return nr.add(qe),()=>{nr.delete(qe)}},[ln,nr,qe]),Uo(()=>{ln&&Be&&Array.from(nr).reverse().forEach(ki=>requestAnimationFrame(ki))},[ln,Be,nr]);const ih={"data-side":cn,"data-align":vo,..._,ref:A,style:{..._.style,animation:Be?void 0:"none",opacity:(a=Xe.hide)!==null&&a!==void 0&&a.referenceHidden?0:void 0}};return S.createElement("div",{ref:ne,"data-radix-popper-content-wrapper":"",style:{position:we,left:0,top:0,transform:Be?`translate3d(${Math.round(ke)}px, ${Math.round(de)}px, 0)`:"translate3d(0, -200%, 0)",minWidth:"max-content",zIndex:Es,"--radix-popper-transform-origin":[(c=Xe.transformOrigin)===null||c===void 0?void 0:c.x,(l=Xe.transformOrigin)===null||l===void 0?void 0:l.y].join(" ")},dir:t.dir},S.createElement(Zre,{scope:u,placedSide:cn,onArrowChange:L,arrowX:_s,arrowY:Er,shouldHideArrow:wo},ln?S.createElement(Jre,{scope:u,hasParent:!0,positionUpdateFns:nr},S.createElement(pa.div,ih)):S.createElement(pa.div,ih)))});function nse(t){return t!==void 0}function rse(t){return t!==null}const sse=t=>({name:"transformOrigin",options:t,fn(e){var n,r,s,o,i;const{placement:a,rects:c,middlewareData:l}=e,d=((n=l.arrow)===null||n===void 0?void 0:n.centerOffset)!==0,h=d?0:t.arrowWidth,f=d?0:t.arrowHeight,[p,m]=FO(a),v={start:"0%",center:"50%",end:"100%"}[m],w=((r=(s=l.arrow)===null||s===void 0?void 0:s.x)!==null&&r!==void 0?r:0)+h/2,x=((o=(i=l.arrow)===null||i===void 0?void 0:i.y)!==null&&o!==void 0?o:0)+f/2;let b="",C="";return p==="bottom"?(b=d?v:`${w}px`,C=`${-f}px`):p==="top"?(b=d?v:`${w}px`,C=`${c.floating.height+f}px`):p==="right"?(b=`${-f}px`,C=d?v:`${x}px`):p==="left"&&(b=`${c.floating.width+f}px`,C=d?v:`${x}px`),{data:{x:b,y:C}}}});function FO(t){const[e,n="center"]=t.split("-");return[e,n]}const ose=Xre,ise=Qre,ase=tse,cse=S.forwardRef((t,e)=>{var n;const{container:r=globalThis==null||(n=globalThis.document)===null||n===void 0?void 0:n.body,...s}=t;return r?Z$.createPortal(S.createElement(pa.div,W({},s,{ref:e})),r):null});function lse(t,e){return S.useReducer((n,r)=>{const s=e[n][r];return s??n},t)}const Cb=t=>{const{present:e,children:n}=t,r=use(e),s=typeof n=="function"?n({present:r.isPresent}):S.Children.only(n),o=Oa(r.ref,s.ref);return typeof n=="function"||r.isPresent?S.cloneElement(s,{ref:o}):null};Cb.displayName="Presence";function use(t){const[e,n]=S.useState(),r=S.useRef({}),s=S.useRef(t),o=S.useRef("none"),i=t?"mounted":"unmounted",[a,c]=lse(i,{mounted:{UNMOUNT:"unmounted",ANIMATION_OUT:"unmountSuspended"},unmountSuspended:{MOUNT:"mounted",ANIMATION_END:"unmounted"},unmounted:{MOUNT:"mounted"}});return S.useEffect(()=>{const l=uf(r.current);o.current=a==="mounted"?l:"none"},[a]),Uo(()=>{const l=r.current,u=s.current;if(u!==t){const h=o.current,f=uf(l);t?c("MOUNT"):f==="none"||(l==null?void 0:l.display)==="none"?c("UNMOUNT"):c(u&&h!==f?"ANIMATION_OUT":"UNMOUNT"),s.current=t}},[t,c]),Uo(()=>{if(e){const l=d=>{const f=uf(r.current).includes(d.animationName);d.target===e&&f&&so.flushSync(()=>c("ANIMATION_END"))},u=d=>{d.target===e&&(o.current=uf(r.current))};return e.addEventListener("animationstart",u),e.addEventListener("animationcancel",l),e.addEventListener("animationend",l),()=>{e.removeEventListener("animationstart",u),e.removeEventListener("animationcancel",l),e.removeEventListener("animationend",l)}}else c("ANIMATION_END")},[e,c]),{isPresent:["mounted","unmountSuspended"].includes(a),ref:S.useCallback(l=>{l&&(r.current=getComputedStyle(l)),n(l)},[])}}function uf(t){return(t==null?void 0:t.animationName)||"none"}function dse({prop:t,defaultProp:e,onChange:n=()=>{}}){const[r,s]=hse({defaultProp:e,onChange:n}),o=t!==void 0,i=o?t:r,a=di(n),c=S.useCallback(l=>{if(o){const d=typeof l=="function"?l(t):l;d!==t&&a(d)}else s(l)},[o,t,s,a]);return[i,c]}function hse({defaultProp:t,onChange:e}){const n=S.useState(t),[r]=n,s=S.useRef(r),o=di(e);return S.useEffect(()=>{s.current!==r&&(o(r),s.current=r)},[r,s,o]),n}const BO="Popover",[UO,tue]=EO(BO,[NO]),_b=NO(),[fse,wl]=UO(BO),pse=t=>{const{__scopePopover:e,children:n,open:r,defaultOpen:s,onOpenChange:o,modal:i=!1}=t,a=_b(e),c=S.useRef(null),[l,u]=S.useState(!1),[d=!1,h]=dse({prop:r,defaultProp:s,onChange:o});return S.createElement(ose,a,S.createElement(fse,{scope:e,contentId:Pre(),triggerRef:c,open:d,onOpenChange:h,onOpenToggle:S.useCallback(()=>h(f=>!f),[h]),hasCustomAnchor:l,onCustomAnchorAdd:S.useCallback(()=>u(!0),[]),onCustomAnchorRemove:S.useCallback(()=>u(!1),[]),modal:i},n))},gse="PopoverTrigger",mse=S.forwardRef((t,e)=>{const{__scopePopover:n,...r}=t,s=wl(gse,n),o=_b(n),i=Oa(e,s.triggerRef),a=S.createElement(pa.button,W({type:"button","aria-haspopup":"dialog","aria-expanded":s.open,"aria-controls":s.contentId,"data-state":VO(s.open)},r,{ref:i,onClick:na(t.onClick,s.onOpenToggle)}));return s.hasCustomAnchor?a:S.createElement(ise,W({asChild:!0},o),a)}),HO="PopoverPortal",[yse,vse]=UO(HO,{forceMount:void 0}),wse=t=>{const{__scopePopover:e,forceMount:n,children:r,container:s}=t,o=wl(HO,e);return S.createElement(yse,{scope:e,forceMount:n},S.createElement(Cb,{present:n||o.open},S.createElement(cse,{asChild:!0,container:s},r)))},fd="PopoverContent",Sse=S.forwardRef((t,e)=>{const n=vse(fd,t.__scopePopover),{forceMount:r=n.forceMount,...s}=t,o=wl(fd,t.__scopePopover);return S.createElement(Cb,{present:r||o.open},o.modal?S.createElement(xse,W({},s,{ref:e})):S.createElement(bse,W({},s,{ref:e})))}),xse=S.forwardRef((t,e)=>{const n=wl(fd,t.__scopePopover),r=S.useRef(null),s=Oa(e,r),o=S.useRef(!1);return S.useEffect(()=>{const i=r.current;if(i)return F1(i)},[]),S.createElement(z1,{as:wb,allowPinchZoom:!0},S.createElement(KO,W({},t,{ref:s,trapFocus:n.open,disableOutsidePointerEvents:!0,onCloseAutoFocus:na(t.onCloseAutoFocus,i=>{var a;i.preventDefault(),o.current||(a=n.triggerRef.current)===null||a===void 0||a.focus()}),onPointerDownOutside:na(t.onPointerDownOutside,i=>{const a=i.detail.originalEvent,c=a.button===0&&a.ctrlKey===!0,l=a.button===2||c;o.current=l},{checkForDefaultPrevented:!1}),onFocusOutside:na(t.onFocusOutside,i=>i.preventDefault(),{checkForDefaultPrevented:!1})})))}),bse=S.forwardRef((t,e)=>{const n=wl(fd,t.__scopePopover),r=S.useRef(!1),s=S.useRef(!1);return S.createElement(KO,W({},t,{ref:e,trapFocus:!1,disableOutsidePointerEvents:!1,onCloseAutoFocus:o=>{var i;if((i=t.onCloseAutoFocus)===null||i===void 0||i.call(t,o),!o.defaultPrevented){var a;r.current||(a=n.triggerRef.current)===null||a===void 0||a.focus(),o.preventDefault()}r.current=!1,s.current=!1},onInteractOutside:o=>{var i,a;(i=t.onInteractOutside)===null||i===void 0||i.call(t,o),o.defaultPrevented||(r.current=!0,o.detail.originalEvent.type==="pointerdown"&&(s.current=!0));const c=o.target;((a=n.triggerRef.current)===null||a===void 0?void 0:a.contains(c))&&o.preventDefault(),o.detail.originalEvent.type==="focusin"&&s.current&&o.preventDefault()}}))}),KO=S.forwardRef((t,e)=>{const{__scopePopover:n,trapFocus:r,onOpenAutoFocus:s,onCloseAutoFocus:o,disableOutsidePointerEvents:i,onEscapeKeyDown:a,onPointerDownOutside:c,onFocusOutside:l,onInteractOutside:u,...d}=t,h=wl(fd,n),f=_b(n);return mre(),S.createElement(yre,{asChild:!0,loop:!0,trapped:r,onMountAutoFocus:s,onUnmountAutoFocus:o},S.createElement(fre,{asChild:!0,disableOutsidePointerEvents:i,onInteractOutside:u,onEscapeKeyDown:a,onPointerDownOutside:c,onFocusOutside:l,onDismiss:()=>h.onOpenChange(!1)},S.createElement(ase,W({"data-state":VO(h.open),role:"dialog",id:h.contentId},f,d,{ref:e,style:{...d.style,"--radix-popover-content-transform-origin":"var(--radix-popper-transform-origin)","--radix-popover-content-available-width":"var(--radix-popper-available-width)","--radix-popover-content-available-height":"var(--radix-popper-available-height)","--radix-popover-trigger-width":"var(--radix-popper-anchor-width)","--radix-popover-trigger-height":"var(--radix-popper-anchor-height)"}}))))});function VO(t){return t?"open":"closed"}const Cse=pse,_se=mse,WO=wse,GO=Sse,Eb=({id:t,children:e,onOpenChange:n})=>{const[r,s]=Aa(t,n);return g.jsx(Cse,{onOpenChange:s,open:r,children:g.jsx("div",{className:"tlui-popover",children:e})})},Pb=({children:t,disabled:e,"data-testid":n})=>g.jsx(_se,{"data-testid":n,disabled:e,asChild:!0,dir:"ltr",children:t}),YO=({side:t,children:e,align:n="center",sideOffset:r=8,alignOffset:s=0})=>{const o=Mn();return g.jsx(WO,{dir:"ltr",container:o,children:g.jsx(GO,{className:"tlui-popover__content",side:t,sideOffset:r,align:n,alignOffset:s,dir:"ltr",children:e})})},XO=S.memo(function(){const e=be(),n=Mn(),r=xne(),s=Cr();function o(i){if(s&&!i.readonlyOk)return null;switch(i.type){case"item":{const{id:a,icon:c,label:l,kbd:u,onSelect:d}=i.actionItem;return g.jsx(se,{className:"tlui-button-grid__button","data-testid":`menu-item.${i.id}`,icon:c,title:l?u?`${e(l)} ${ps(u)}`:`${e(l)}`:u?`${ps(u)}`:"",onClick:()=>d("actions-menu"),disabled:i.disabled},a)}}}return g.jsxs(Eb,{id:"actions menu",children:[g.jsx(Pb,{children:g.jsx(se,{className:"tlui-menu__trigger","data-testid":"main.action-menu",icon:"dots-vertical",title:e("actions-menu.title"),smallIcon:!0})}),g.jsx(WO,{dir:"ltr",container:n,children:g.jsx(GO,{className:"tlui-popover__content",side:"bottom",dir:"ltr",sideOffset:6,children:g.jsx("div",{className:"tlui-actions-menu tlui-button-grid__four",children:r.map(o)})})})]})}),qO=Ee(function(){const e=H(),n=an(),r=be(),s=n.duplicate,o=e.selectedShapeIds.length<=0;return g.jsx(se,{icon:s.icon,onClick:()=>s.onSelect("quick-actions"),disabled:o,title:`${r(s.label)} ${ps(s.kbd)}`,smallIcon:!0})}),Ese=S.memo(function(){const e=be();return g.jsxs(li,{id:"main menu",children:[g.jsx(Vd,{children:g.jsx(se,{className:"tlui-menu__trigger","data-testid":"main.menu",title:e("menu.title"),icon:"menu"})}),g.jsx(ui,{alignOffset:0,sideOffset:6,children:g.jsx(Pse,{})})]})});function Pse(){const t=H(),e=be(),n=Ane(),r=_r(),s=Cr();function o(i,a,c,l){switch(a.type){case"custom":return s&&!a.readonlyOk?null:a.id==="LANGUAGE_MENU"?g.jsx(CO,{},"item"):null;case"group":return s&&!a.readonlyOk?null:g.jsx(Ks,{size:l<=1?"medium":r<3||(c==null?void 0:c.type)==="submenu"&&l>2?"tiny":"medium",children:a.children.map(u=>o(i,u,a,l+1))},a.id);case"submenu":return s&&!a.readonlyOk?null:g.jsxs(qx,{id:`main menu ${c?c.id+" ":""}${a.id}`,children:[g.jsx(Qx,{label:a.label,"data-testid":`menu-item.${a.id}`}),g.jsx(Zx,{sideOffset:-4,alignOffset:-1,children:a.children.map(u=>o(i,u,a,l+1))})]},a.id);case"item":{if(s&&!a.readonlyOk)return null;const{id:u,checkbox:d,menuLabel:h,label:f,onSelect:p,kbd:m}=a.actionItem,v=h??f,w=v?e(v):void 0;return d?g.jsxs(KM,{onSelect:()=>p("menu"),title:w||"",checked:a.checked,disabled:a.disabled,children:[w&&g.jsx("span",{children:w}),m&&g.jsx(Em,{children:m})]},u):g.jsx(Bn,{"data-testid":`menu-item.${a.id}`,kbd:m,label:v,onClick:()=>p("menu"),disabled:a.disabled},u)}}}return g.jsx(g.Fragment,{children:n.map(i=>o(t,i,null,0))})}const kse=function({name:e,id:n,isCurrentPage:r}){const s=H(),o=S.useRef(null),i=S.useCallback(c=>{s.renamePage(n,c||"New Page",!0)},[s,n]),a=S.useCallback(c=>{s.mark("rename page"),s.renamePage(n,c||"New Page",!1)},[s,n]);return g.jsx(ub,{className:"tlui-page-menu__item__input",ref:c=>o.current=c,defaultValue:e,onValueChange:i,onComplete:a,onCancel:a,shouldManuallyMaintainScrollPositionWhenFocused:!0,autofocus:r,autoselect:!0})},ES=(t,e,n,r)=>{let s;const o=t.pages,i=n>r?o[r-1]:o[r],a=n>r?o[r]:o[r+1];i&&!a?s=Ms(i.index):!i&&a?s=RB(o[0].index):s=vu(i.index,a.index),s!==o[n].index&&(t.mark("moving page"),t.updatePage({id:e,index:s}))},sk=Ee(function({index:e,listSize:n,item:r,onRename:s}){const o=H(),i=be(),a=o.pages,c=S.useCallback(()=>{o.mark("creating page");const h=Un.createId();o.duplicatePage(r.id,h)},[o,r]),l=S.useCallback(()=>{ES(o,r.id,e,e-1)},[o,r,e]),u=S.useCallback(()=>{ES(o,r.id,e,e+1)},[o,r,e]),d=S.useCallback(()=>{o.mark("deleting page"),o.deletePage(r.id)},[o,r]);return g.jsxs(li,{id:`page item submenu ${e}`,children:[g.jsx(Vd,{children:g.jsx(se,{title:i("page-menu.submenu.title"),icon:"dots-vertical"})}),g.jsxs(ui,{alignOffset:0,children:[g.jsxs(Ks,{children:[s&&g.jsx(nc,{dir:"ltr",onSelect:s,asChild:!0,children:g.jsx(se,{className:"tlui-menu__button",label:"page-menu.submenu.rename"})}),g.jsx(nc,{dir:"ltr",onSelect:c,disabled:a.length>=ng,asChild:!0,children:g.jsx(se,{className:"tlui-menu__button",label:"page-menu.submenu.duplicate-page"})}),e>0&&g.jsx(nc,{dir:"ltr",onSelect:l,asChild:!0,children:g.jsx(se,{className:"tlui-menu__button",label:"page-menu.submenu.move-up"})}),e<n-1&&g.jsx(nc,{dir:"ltr",onSelect:u,asChild:!0,children:g.jsx(se,{className:"tlui-menu__button",label:"page-menu.submenu.move-down"})})]}),n>1&&g.jsx(Ks,{children:g.jsx(nc,{dir:"ltr",onSelect:d,asChild:!0,children:g.jsx(se,{className:"tlui-menu__button",label:"page-menu.submenu.delete"})})})]})]})}),Ise=function(){const e=H(),n=be(),r=_r(),s=S.useCallback(()=>m(!1),[]),[o,i]=Aa("page-menu",s),a=r<5?36:40,c=S.useRef(null),l=Y("pages",()=>e.pages,[e]),u=Y("currentPage",()=>e.currentPage,[e]),d=Cr(),h=Y("maxPageCountReached",()=>e.pages.length>=ng,[e]),f=Y("isCoarsePointer",()=>e.instanceState.isCoarsePointer,[e]),[p,m]=S.useState(!1),v=S.useCallback(()=>{d||m($=>!$)},[d]),w=S.useRef({isPointing:!1,status:"idle",pointing:null,startY:0,startIndex:0,dragIndex:0}),[x,b]=S.useState(Object.fromEntries(l.map(($,A)=>[$.id,{y:A*a,offsetY:0,isSelected:!1}])));S.useLayoutEffect(()=>{b(Object.fromEntries(l.map(($,A)=>[$.id,{y:A*a,offsetY:0,isSelected:!1}])))},[a,l]),S.useEffect(()=>{o&&requestAnimationFrame(()=>{const $=document.querySelector(`[data-testid="page-menu-item-${u.id}"]`);if($){const A=c.current;if(!A)return;const D=$.offsetTop,L=A.scrollTop;D<L&&A.scrollTo({top:D});const j=D+a,M=A.scrollTop+A.offsetHeight;j>M&&A.scrollTo({top:j-A.offsetHeight})}})},[a,u.id,o]);const C=S.useCallback($=>{const{clientY:A,currentTarget:D}=$,{dataset:{id:L,index:j}}=D;if(!L||!j)return;const M=w.current;Od($.currentTarget,$),M.status="pointing",M.pointing={id:L,index:+j};const U=x[L].y;M.startY=A,M.startIndex=Math.max(0,Math.min(Math.round(U/a),l.length-1))},[a,l.length,x]),E=S.useCallback($=>{const A=w.current;if(A.status==="pointing"){const{clientY:D}=$,L=D-A.startY;Math.abs(L)>5&&(A.status="dragging")}if(A.status==="dragging"){const{clientY:D}=$,L=D-A.startY,j=x[A.pointing.id],{startIndex:M,pointing:B}=A,U=j.y+L,q=Math.max(0,Math.min(Math.round(U/a),l.length-1)),N={...x};if(N[B.id]={y:j.y,offsetY:L,isSelected:!0},q!==A.dragIndex){A.dragIndex=q;for(let F=0;F<l.length;F++){const K=l[F];if(K.id===A.pointing.id)continue;let{y:Q}=N[K.id];q===M?Q=F*a:q<M?q<=F&&F<M?Q=(F+1)*a:Q=F*a:q>M&&(q>=F&&F>M?Q=(F-1)*a:Q=F*a),Q!==N[K.id].y&&(N[K.id]={y:Q,offsetY:0,isSelected:!0})}}b(N)}},[a,l,x]),_=S.useCallback($=>{const A=w.current;if(A.status==="dragging"){const{id:D,index:L}=A.pointing;ES(e,D,L,A.dragIndex)}hm($.currentTarget,$),A.status="idle"},[e]),k=S.useCallback($=>{const A=w.current;$.key==="Escape"&&(A.status==="dragging"&&b(Object.fromEntries(l.map((D,L)=>[D.id,{y:L*a,offsetY:0,isSelected:!1}]))),A.status="idle")},[a,l]),I=S.useCallback(()=>{if(d)return;e.mark("creating page");const $=Un.createId();e.createPage(n("page-menu.new-page-initial-name"),$),m(!0)},[e,n,d]);return g.jsxs(Eb,{id:"page menu",onOpenChange:i,open:o,children:[g.jsx(Pb,{children:g.jsx(se,{className:"tlui-page-menu__trigger tlui-menu__trigger","data-testid":"main.page-menu",icon:"chevron-down",title:u.name,children:g.jsx("div",{className:"tlui-page-menu__name",children:u.name})})}),g.jsx(YO,{side:"bottom",align:"start",sideOffset:6,children:g.jsxs("div",{className:"tlui-page-menu__wrapper",children:[g.jsxs("div",{className:"tlui-page-menu__header",children:[g.jsx("div",{className:"tlui-page-menu__header__title",children:n("page-menu.title")}),!d&&g.jsxs(g.Fragment,{children:[g.jsx(se,{"data-testid":"page-menu.edit",title:n(p?"page-menu.edit-done":"page-menu.edit-start"),icon:p?"check":"edit",onClick:v}),g.jsx(se,{"data-testid":"page-menu.create",icon:"plus",title:n(h?"page-menu.max-page-count-reached":"page-menu.create-new-page"),disabled:h,onClick:I})]})]}),g.jsx("div",{className:"tlui-page-menu__list tlui-menu__group",style:{height:a*l.length+4},ref:c,children:l.map(($,A)=>{const D=x[$.id]??{position:A*40,offsetY:0};return p?g.jsxs("div",{"data-testid":`page-menu-item-${$.id}`,className:"tlui-page_menu__item__sortable",style:{zIndex:$.id===u.id?888:A,transform:`translate(0px, ${D.y+D.offsetY}px)`},children:[g.jsx(se,{tabIndex:-1,className:"tlui-page_menu__item__sortable__handle",icon:"drag-handle-dots",onPointerDown:C,onPointerUp:_,onPointerMove:E,onKeyDown:k,"data-id":$.id,"data-index":A}),r<5&&f?g.jsx(se,{className:"tlui-page-menu__item__button",onClick:()=>{const L=window.prompt("Rename page",$.name);L&&L!==$.name&&e.renamePage($.id,L)},onDoubleClick:v,isChecked:$.id===u.id,children:g.jsx("span",{children:$.name})}):g.jsx("div",{className:"tlui-page_menu__item__sortable__title",style:{height:a},children:g.jsx(kse,{id:$.id,name:$.name,isCurrentPage:$.id===u.id})}),!d&&g.jsx("div",{className:"tlui-page_menu__item__submenu","data-isediting":p,children:g.jsx(sk,{index:A,item:$,listSize:l.length})})]},$.id+"_editing"):g.jsxs("div",{"data-testid":`page-menu-item-${$.id}`,className:"tlui-page-menu__item",children:[g.jsxs(se,{className:"tlui-page-menu__item__button tlui-page-menu__item__button__checkbox",onClick:()=>e.setCurrentPage($.id),onDoubleClick:v,isChecked:$.id===u.id,title:n("page-menu.go-to-page"),children:[g.jsx("div",{className:"tlui-page-menu__item__button__check",children:$.id===u.id&&g.jsx(In,{icon:"check"})}),g.jsx("span",{children:$.name})]}),!d&&g.jsx("div",{className:"tlui-page_menu__item__submenu",children:g.jsx(sk,{index:A,item:$,listSize:l.length,onRename:()=>{if(e.environment.isIos){const L=window.prompt("Rename page",$.name);L&&L!==$.name&&e.renamePage($.id,L)}else m(!0),e.setCurrentPage($.id)}})})]},$.id)})})]})})]})},QO=S.memo(function(){const e=be(),n=vO(),s=an().redo;return g.jsx(se,{"data-testid":"main.redo",icon:s.icon,title:`${e(s.label)} ${ps(s.kbd)}`,disabled:!n,onClick:()=>s.onSelect("quick-actions"),smallIcon:!0})}),ZO=Ee(function(){const e=H(),n=an(),r=be(),s=n.delete;if(Cr())return null;const i=e.selectedShapeIds.length<=0;return g.jsx(se,{icon:s.icon,onClick:()=>s.onSelect("quick-actions"),disabled:i,title:`${r(s.label)} ${ps(s.kbd)}`,smallIcon:!0})}),JO=S.memo(function(){const e=be(),n=wO(),s=an().undo;return g.jsx(se,{"data-testid":"main.undo",icon:s.icon,title:`${e(s.label)} ${ps(s.kbd)}`,disabled:!n,onClick:()=>s.onSelect("quick-actions"),smallIcon:!0})}),$se=Ee(function(){const e=H(),n=_r(),s=!Cr()&&!e.isInAny("hand","zoom","eraser");return g.jsx("div",{className:"tlui-menu-zone",children:g.jsxs("div",{className:"tlui-menu-zone__controls",children:[g.jsx(Ese,{}),g.jsx("div",{className:"tlui-menu-zone__divider"}),g.jsx(Ise,{}),n>=6&&s&&g.jsxs(g.Fragment,{children:[g.jsx("div",{className:"tlui-menu-zone__divider"}),g.jsx(JO,{}),g.jsx(QO,{}),g.jsx(ZO,{}),g.jsx(qO,{}),g.jsx(XO,{})]})]})})});function Tse(t,e){const[n,r]=Z.useState(e);Z.useLayoutEffect(()=>{const o=localStorage.getItem(t);if(o)try{r(JSON.parse(o))}catch{console.error(`Could not restore value ${t} from local storage.`)}},[t]);const s=Z.useCallback(o=>{r(i=>{const a=typeof o=="function"?o(i):o;return localStorage.setItem(t,JSON.stringify(a)),a})},[t]);return[n,s]}class Cu{constructor(e){y(this,"dpr",1);y(this,"colors",{shapeFill:"rgba(144, 144, 144, .1)",selectFill:"#2f80ed",viewportFill:"rgba(144, 144, 144, .1)"});y(this,"id",Ze());y(this,"cvs",null);y(this,"pageBounds",[]);y(this,"collaborators",[]);y(this,"canvasScreenBounds",new ae);y(this,"canvasPageBounds",new ae);y(this,"contentPageBounds",new ae);y(this,"contentScreenBounds",new ae);y(this,"originPagePoint",new P);y(this,"originPageCenter",new P);y(this,"isInViewport",!1);y(this,"debug",!1);y(this,"updateContentScreenBounds",()=>{const{contentScreenBounds:e,contentPageBounds:n,canvasScreenBounds:r}=this;let{x:s,y:o,w:i,h:a}=e;if(n.w>n.h){const c=r.w/(n.w/n.h);c>r.h?(s=(r.w-r.w*(r.h/c))/2,o=0,i=r.w*(r.h/c),a=r.h):(s=0,o=(r.h-c)/2,i=r.w,a=c)}else if(n.w<n.h){const c=r.h/(n.h/n.w);s=(r.w-c)/2,o=0,i=c,a=r.h}else s=r.h/2,o=0,i=r.h,a=r.h;e.set(s,o,i,a)});y(this,"updateCanvasPageBounds",()=>{const{canvasPageBounds:e,canvasScreenBounds:n,contentPageBounds:r,contentScreenBounds:s}=this;e.set(0,0,r.width/(s.width/n.width),r.height/(s.height/n.height)),e.center=r.center});y(this,"getScreenPoint",(e,n)=>{const{canvasScreenBounds:r}=this,s=(e-r.minX)*this.dpr,o=(n-r.minY)*this.dpr;return{x:s,y:o}});y(this,"getPagePoint",(e,n)=>{const{contentPageBounds:r,contentScreenBounds:s,canvasPageBounds:o}=this,{x:i,y:a}=this.getScreenPoint(e,n);return new P(o.minX+i*r.width/s.width,o.minY+a*r.height/s.height,1)});y(this,"minimapScreenPointToPagePoint",(e,n,r=!1,s=!1)=>{const{editor:o}=this,{viewportPageBounds:i}=o;let{x:a,y:c}=this.getPagePoint(e,n);if(s){const l=this.editor.currentPageBounds,u=i,d=((l==null?void 0:l.minX)??0)-u.width/2,h=((l==null?void 0:l.maxX)??0)+u.width/2,f=((l==null?void 0:l.minY)??0)-u.height/2,p=((l==null?void 0:l.maxY)??0)+u.height/2,m=Math.max(0,d+u.width-a),v=Math.max(0,-(h-u.width-a)),w=Math.max(0,f+u.height-c),x=Math.max(0,-(p-u.height-c)),b=Math.max(0,m-v),C=Math.max(0,v-m),E=Math.max(0,w-x),_=Math.max(0,x-w);b&&b>C?a+=b/2:C&&(a-=C/2),E&&E>_?c+=E/2:_&&(c-=_/2),a=Rr(a,d,h),c=Rr(c,f,p)}if(r){const{originPagePoint:l}=this,u=Math.abs(a-l.x),d=Math.abs(c-l.y);u>d?c=l.y:a=l.x}return new P(a,c)});y(this,"render",()=>{const{cvs:e,pageBounds:n}=this;this.updateCanvasPageBounds();const{editor:r,canvasScreenBounds:s,canvasPageBounds:o,contentPageBounds:i,contentScreenBounds:a}=this,{width:c,height:l}=s,{viewportPageBounds:u,selectedShapeIds:d}=r;if(!e||!n)return;const h=e.getContext("2d");if(!h)throw new Error("Minimap (shapes): Could not get context");h.resetTransform(),h.globalAlpha=1,h.clearRect(0,0,c,l);const f=a.width/i.width,p=a.height/i.height;h.translate((c-a.width)/2,(l-a.height)/2),h.scale(f,p),h.translate(-i.minX,-i.minY);const m=8/f,v=8/f,w=1/f,x=1/f,b=m/4,C=v/4,E=new Path2D,_=new Path2D,{shapeFill:k,selectFill:I,viewportFill:$}=this.colors;let A;for(let B=0,U=n.length;B<U;B++)A=n[B],Cu.roundedRect(d.includes(A.id)?_:E,A.minX,A.minY,A.width,A.height,Rr(m,w,A.width/b),Rr(v,x,A.height/C));if(h.fillStyle=k,h.fill(E),h.fillStyle=I,h.fill(_),this.debug){const B=ae.Common(n),{minX:U,minY:q,width:N,height:F}=B;h.strokeStyle="green",h.lineWidth=2/f,h.strokeRect(U+1/f,q+1/p,N-2/f,F-2/p)}{const{brush:B}=r.instanceState;if(B){const{x:U,y:q,w:N,h:F}=B;h.beginPath(),Cu.sharpRect(h,U,q,N,F),h.closePath(),h.fillStyle=$,h.fill()}}{const{minX:B,minY:U,width:q,height:N}=u;h.beginPath();const F=12/f,K=12/f;Cu.roundedRect(h,B,U,q,N,Math.min(q/4,F),Math.min(N/4,K)),h.closePath(),h.fillStyle=$,h.fill(),this.debug&&(h.strokeStyle="orange",h.strokeRect(B+1/f,U+1/p,q-2/f,N-2/p))}const D=2.5/f,L=2.5/p,{currentPageId:j}=r;let M;for(let B=0;B<this.collaborators.length;B++)M=this.collaborators[B],M.currentPageId===j&&(h.beginPath(),h.ellipse(Rr(M.cursor.x,o.minX+D,o.maxX-D),Rr(M.cursor.y,o.minY+L,o.maxY-L),5/f,5/p,0,0,Oe),h.fillStyle=M.color,h.fill());if(this.debug){h.lineWidth=2/f;{const{minX:B,minY:U,width:q,height:N}=i;h.strokeStyle="red",h.strokeRect(B+1/f,U+1/p,q-2/f,N-2/p)}{const{minX:B,minY:U,width:q,height:N}=o;h.strokeStyle="blue",h.strokeRect(B+1/f,U+1/p,q-2/f,N-2/p)}}});this.editor=e}setDpr(e){this.dpr=+e.toFixed(2)}static roundedRect(e,n,r,s,o,i,a){if(i<1&&a<1){e.rect(n,r,s,o);return}e.moveTo(n+i,r),e.lineTo(n+s-i,r),e.quadraticCurveTo(n+s,r,n+s,r+a),e.lineTo(n+s,r+o-a),e.quadraticCurveTo(n+s,r+o,n+s-i,r+o),e.lineTo(n+i,r+o),e.quadraticCurveTo(n,r+o,n,r+o-a),e.lineTo(n,r+a),e.quadraticCurveTo(n,r,n+i,r)}static sharpRect(e,n,r,s,o,i,a){e.rect(n,r,s,o)}}function Ase({shapeFill:t,selectFill:e,viewportFill:n}){const r=H(),s=S.useRef(null),o=S.useRef(!1),i=mm(),a=$T("dpr",()=>r.instanceState.devicePixelRatio,[r]),c=S.useMemo(()=>r.store.query.records("instance_presence"),[r]),l=S.useMemo(()=>new Cu(r),[r]);S.useEffect(()=>{const m=requestAnimationFrame(()=>{const v=getComputedStyle(r.getContainer());l.colors={shapeFill:v.getPropertyValue(t).trim(),selectFill:v.getPropertyValue(e).trim(),viewportFill:v.getPropertyValue(n).trim()},l.render()});return()=>{cancelAnimationFrame(m)}},[r,e,t,n,l,i]);const u=S.useCallback(m=>{if(!r.currentPageShapeIds.size)return;const v=l.minimapScreenPointToPagePoint(m.clientX,m.clientY,!1,!1),w=l.minimapScreenPointToPagePoint(m.clientX,m.clientY,!1,!0);l.originPagePoint.setTo(w),l.originPageCenter.setTo(r.viewportPageBounds.center),r.centerOnPoint(v,{duration:Ds})},[r,l]),d=S.useCallback(m=>{if(Od(m.currentTarget,m),!r.currentPageShapeIds.size)return;o.current=!0,l.isInViewport=!1;const v=l.minimapScreenPointToPagePoint(m.clientX,m.clientY,!1,!1),w=l.minimapScreenPointToPagePoint(m.clientX,m.clientY,!1,!0),x=r.viewportPageBounds;l.originPagePoint.setTo(w),l.originPageCenter.setTo(x.center),l.isInViewport=x.containsPoint(w),l.isInViewport||r.centerOnPoint(v,{duration:Ds})},[r,l]),h=S.useCallback(m=>{if(o.current){const b=l.minimapScreenPointToPagePoint(m.clientX,m.clientY,m.shiftKey,!0);if(l.isInViewport){const C=b.clone().sub(l.originPagePoint).add(l.originPageCenter),E=P.Add(l.originPageCenter,C);r.centerOnPoint(E);return}r.centerOnPoint(b)}const v=l.getPagePoint(m.clientX,m.clientY),w=r.pageToScreen(v),x={type:"pointer",target:"canvas",name:"pointer_move",...vr(m),point:w,isPen:r.instanceState.isPenMode};r.dispatch(x)},[r,l]),f=S.useCallback(m=>{o.current=!1},[]),p=S.useCallback(m=>{const v=l3(m);r.dispatch({type:"wheel",name:"wheel",delta:v,shiftKey:m.shiftKey,altKey:m.altKey,ctrlKey:m.metaKey||m.ctrlKey})},[r]);return Qi("update when dpr changes",()=>{const m=a.value;l.setDpr(m);const v=s.current,w=v.getBoundingClientRect(),x=w.width*m,b=w.height*m;v.width=x,v.height=b,l.canvasScreenBounds.set(w.x,w.y,x,b),l.cvs=s.current},[a,l]),Qi("minimap render when pagebounds or collaborators changes",()=>{const{currentPageShapeIds:m,viewportPageBounds:v,currentPageBounds:w}=r;a.value,l.contentPageBounds=w?ae.Expand(w,v):v,l.updateContentScreenBounds();const x=[];m.forEach(b=>{let C=r.getShapePageBounds(b);if(!C)return;const E=r.getShapeMask(b);if(E){const _=Bw(E,C.corners);if(!_)return;C=ae.FromPoints(_)}C&&(C.id=b,x.push(C))}),l.pageBounds=x,l.collaborators=c.value,l.render()},[r,l]),g.jsx("div",{className:"tlui-minimap",children:g.jsx("canvas",{ref:s,className:"tlui-minimap__canvas",onDoubleClick:u,onPointerMove:h,onPointerDown:d,onPointerUp:f,onWheel:p})})}const G0=Ee(function(){const e=H(),n=be(),r=_r(),s=e.zoomLevel,o=e.currentPageShapeIds.size>0,i=e.selectedShapeIds.length>0,a=e.zoomLevel===1,c=S.useCallback(()=>{e.resetZoom(e.viewportScreenCenter,{duration:Ds})},[e]);return g.jsxs(li,{id:"zoom",children:[g.jsx(Vd,{children:g.jsx(se,{title:`${n("navigation-zone.zoom")}`,"data-testid":"minimap.zoom-menu",className:r<5?"tlui-zoom-menu__button":"tlui-zoom-menu__button__pct",onDoubleClick:c,icon:r<4?"zoom-in":void 0,children:r<4?null:g.jsxs("span",{style:{flexGrow:0,textAlign:"center"},children:[Math.floor(s*100),"%"]})})}),g.jsx(ui,{side:"top",align:"start",alignOffset:0,children:g.jsxs(Ks,{children:[g.jsx(Xl,{action:"zoom-in","data-testid":"minimap.zoom-menu.zoom-in",noClose:!0}),g.jsx(Xl,{action:"zoom-out","data-testid":"minimap.zoom-menu.zoom-out",noClose:!0}),g.jsx(Xl,{action:"zoom-to-100","data-testid":"minimap.zoom-menu.zoom-to-100",noClose:!0,disabled:a}),g.jsx(Xl,{action:"zoom-to-fit",disabled:!o,"data-testid":"minimap.zoom-menu.zoom-to-fit",noClose:!0}),g.jsx(Xl,{action:"zoom-to-selection",disabled:!i,"data-testid":"minimap.zoom-menu.zoom-to-selection",noClose:!0})]})})]})});function Xl(t){const{action:e,disabled:n=!1,noClose:r=!1}=t,s=an();return g.jsx(Bn,{label:s[e].label,kbd:s[e].kbd,"data-testid":t["data-testid"],onClick:()=>s[e].onSelect("zoom-menu"),noClose:r,disabled:n})}const Mse=S.memo(function(){const e=an(),n=be(),r=_r(),[s,o]=Tse("minimap",!0),i=S.useCallback(()=>{o(a=>!a)},[o]);return r<4?null:g.jsxs("div",{className:"tlui-navigation-zone",children:[g.jsx("div",{className:"tlui-navigation-zone__controls",children:r<6?g.jsx(G0,{}):s?g.jsxs(g.Fragment,{children:[g.jsx(G0,{}),g.jsx(se,{title:n("navigation-zone.toggle-minimap"),className:"tlui-navigation-zone__toggle","data-testid":"minimap.toggle",onClick:i,icon:s?"chevrons-ne":"chevrons-sw"})]}):g.jsxs(g.Fragment,{children:[g.jsx(se,{icon:"minus","data-testid":"minimap.zoom-out",title:`${n(e["zoom-out"].label)} ${ps(e["zoom-out"].kbd)}`,onClick:()=>e["zoom-out"].onSelect("navigation-zone")}),g.jsx(G0,{}),g.jsx(se,{icon:"plus","data-testid":"minimap.zoom-in",title:`${n(e["zoom-in"].label)} ${ps(e["zoom-in"].kbd)}`,onClick:()=>e["zoom-in"].onSelect("navigation-zone")}),g.jsx(se,{title:n("navigation-zone.toggle-minimap"),className:"tlui-navigation-zone__toggle",onClick:i,icon:s?"chevrons-ne":"chevrons-sw"})]})}),r>=6&&!s&&g.jsx(Ase,{viewportFill:"--color-muted-1",selectFill:"--color-selected",shapeFill:"--color-text-3"})]})}),Ose=Ee(function(){const n=H().instanceState.isPenMode,r=an();if(!n)return null;const s=r["exit-pen-mode"];return g.jsx(se,{label:s.label,iconLeft:s.icon,onClick:()=>s.onSelect("helper-buttons")})}),Dse=Ee(function(){const e=H(),n=an();if(!e.instanceState.followingUserId)return null;const r=n["stop-following"];return g.jsx(se,{label:r.label,iconLeft:r.icon,onClick:()=>r.onSelect("people-menu")})});function Rse(t){const{uiType:e,items:n,title:r,style:s,value:o,columns:i=Rr(n.length,2,4),onValueChange:a}=t,c=H(),l=be(),u=S.useRef(!1),{handleButtonClick:d,handleButtonPointerDown:h,handleButtonPointerEnter:f,handleButtonPointerUp:p}=S.useMemo(()=>{const v=()=>{u.current=!1,window.removeEventListener("pointerup",v)};return{handleButtonClick:E=>{const{id:_}=E.currentTarget.dataset;o.type==="shared"&&o.value===_||(c.mark("point picker item"),a(s,_,!1))},handleButtonPointerDown:E=>{const{id:_}=E.currentTarget.dataset;c.mark("point picker item"),a(s,_,!0),u.current=!0,window.addEventListener("pointerup",v)},handleButtonPointerEnter:E=>{if(!u.current)return;const{id:_}=E.currentTarget.dataset;a(s,_,!0)},handleButtonPointerUp:E=>{const{id:_}=E.currentTarget.dataset;a(s,_,!1)}}},[o,c,a,s]),m=Y("theme",()=>An({isDarkMode:c.user.isDarkMode}),[c]);return g.jsx("div",{className:le("tlui-button-grid",{"tlui-button-grid__two":i===2,"tlui-button-grid__three":i===3,"tlui-button-grid__four":i===4}),children:n.map(v=>g.jsx(se,{"data-id":v.value,"data-testid":`style.${e}.${v.value}`,"aria-label":v.value,"data-state":o.type==="shared"&&o.value===v.value?"hinted":void 0,title:r+"  "+l(`${e}-style.${v.value}`),className:le("tlui-button-grid__button"),style:s===xr?{color:m[v.value].solid}:void 0,onPointerEnter:f,onPointerDown:h,onPointerUp:p,onClick:d,icon:v.icon},v.value))})}const xc=S.memo(Rse);function e4(t,[e,n]){return Math.min(n,Math.max(e,t))}function Lse(t){const e=S.useRef({value:t,previous:t});return S.useMemo(()=>(e.current.value!==t&&(e.current.previous=e.current.value,e.current.value=t),e.current.previous),[t])}const t4=["PageUp","PageDown"],n4=["ArrowUp","ArrowDown","ArrowLeft","ArrowRight"],r4={"from-left":["Home","PageDown","ArrowDown","ArrowLeft"],"from-right":["Home","PageDown","ArrowDown","ArrowRight"],"from-bottom":["Home","PageDown","ArrowDown","ArrowLeft"],"from-top":["Home","PageDown","ArrowUp","ArrowLeft"]},Qd="Slider",[PS,jse,Nse]=$m(Qd),[s4,nue]=oo(Qd,[Nse]),[zse,Bm]=s4(Qd),Fse=S.forwardRef((t,e)=>{const{name:n,min:r=0,max:s=100,step:o=1,orientation:i="horizontal",disabled:a=!1,minStepsBetweenThumbs:c=0,defaultValue:l=[r],value:u,onValueChange:d=()=>{},onValueCommit:h=()=>{},inverted:f=!1,...p}=t,[m,v]=S.useState(null),w=et(e,M=>v(M)),x=S.useRef(new Set),b=S.useRef(0),C=i==="horizontal",E=m?!!m.closest("form"):!0,_=C?Bse:Use,[k=[],I]=Ca({prop:u,defaultProp:l,onChange:M=>{var B;(B=[...x.current][b.current])===null||B===void 0||B.focus(),d(M)}}),$=S.useRef(k);function A(M){const B=Qse(k,M);j(M,B)}function D(M){j(M,b.current)}function L(){const M=$.current[b.current];k[b.current]!==M&&h(k)}function j(M,B,{commit:U}={commit:!1}){const q=toe(o),N=noe(Math.round((M-r)/o)*o+r,q),F=e4(N,[r,s]);I((K=[])=>{const Q=Xse(K,F,B);if(eoe(Q,c*o)){b.current=Q.indexOf(F);const ne=String(Q)!==String(K);return ne&&U&&h(Q),ne?Q:K}else return K})}return S.createElement(zse,{scope:t.__scopeSlider,disabled:a,min:r,max:s,valueIndexToChangeRef:b,thumbs:x.current,values:k,orientation:i},S.createElement(PS.Provider,{scope:t.__scopeSlider},S.createElement(PS.Slot,{scope:t.__scopeSlider},S.createElement(_,W({"aria-disabled":a,"data-disabled":a?"":void 0},p,{ref:w,onPointerDown:oe(p.onPointerDown,()=>{a||($.current=k)}),min:r,max:s,inverted:f,onSlideStart:a?void 0:A,onSlideMove:a?void 0:D,onSlideEnd:a?void 0:L,onHomeKeyDown:()=>!a&&j(r,0,{commit:!0}),onEndKeyDown:()=>!a&&j(s,k.length-1,{commit:!0}),onStepKeyDown:({event:M,direction:B})=>{if(!a){const N=t4.includes(M.key)||M.shiftKey&&n4.includes(M.key)?10:1,F=b.current,K=k[F],Q=o*N*B;j(K+Q,F,{commit:!0})}}})))),E&&k.map((M,B)=>S.createElement(Yse,{key:B,name:n?n+(k.length>1?"[]":""):void 0,value:M})))}),[o4,i4]=s4(Qd,{startEdge:"left",endEdge:"right",size:"width",direction:1}),Bse=S.forwardRef((t,e)=>{const{min:n,max:r,dir:s,inverted:o,onSlideStart:i,onSlideMove:a,onSlideEnd:c,onStepKeyDown:l,...u}=t,[d,h]=S.useState(null),f=et(e,b=>h(b)),p=S.useRef(),m=zx(s),v=m==="ltr",w=v&&!o||!v&&o;function x(b){const C=p.current||d.getBoundingClientRect(),E=[0,C.width],k=kb(E,w?[n,r]:[r,n]);return p.current=C,k(b-C.left)}return S.createElement(o4,{scope:t.__scopeSlider,startEdge:w?"left":"right",endEdge:w?"right":"left",direction:w?1:-1,size:"width"},S.createElement(a4,W({dir:m,"data-orientation":"horizontal"},u,{ref:f,style:{...u.style,"--radix-slider-thumb-transform":"translateX(-50%)"},onSlideStart:b=>{const C=x(b.clientX);i==null||i(C)},onSlideMove:b=>{const C=x(b.clientX);a==null||a(C)},onSlideEnd:()=>{p.current=void 0,c==null||c()},onStepKeyDown:b=>{const E=r4[w?"from-left":"from-right"].includes(b.key);l==null||l({event:b,direction:E?-1:1})}})))}),Use=S.forwardRef((t,e)=>{const{min:n,max:r,inverted:s,onSlideStart:o,onSlideMove:i,onSlideEnd:a,onStepKeyDown:c,...l}=t,u=S.useRef(null),d=et(e,u),h=S.useRef(),f=!s;function p(m){const v=h.current||u.current.getBoundingClientRect(),w=[0,v.height],b=kb(w,f?[r,n]:[n,r]);return h.current=v,b(m-v.top)}return S.createElement(o4,{scope:t.__scopeSlider,startEdge:f?"bottom":"top",endEdge:f?"top":"bottom",size:"height",direction:f?1:-1},S.createElement(a4,W({"data-orientation":"vertical"},l,{ref:d,style:{...l.style,"--radix-slider-thumb-transform":"translateY(50%)"},onSlideStart:m=>{const v=p(m.clientY);o==null||o(v)},onSlideMove:m=>{const v=p(m.clientY);i==null||i(v)},onSlideEnd:()=>{h.current=void 0,a==null||a()},onStepKeyDown:m=>{const w=r4[f?"from-bottom":"from-top"].includes(m.key);c==null||c({event:m,direction:w?-1:1})}})))}),a4=S.forwardRef((t,e)=>{const{__scopeSlider:n,onSlideStart:r,onSlideMove:s,onSlideEnd:o,onHomeKeyDown:i,onEndKeyDown:a,onStepKeyDown:c,...l}=t,u=Bm(Qd,n);return S.createElement(Fe.span,W({},l,{ref:e,onKeyDown:oe(t.onKeyDown,d=>{d.key==="Home"?(i(d),d.preventDefault()):d.key==="End"?(a(d),d.preventDefault()):t4.concat(n4).includes(d.key)&&(c(d),d.preventDefault())}),onPointerDown:oe(t.onPointerDown,d=>{const h=d.target;h.setPointerCapture(d.pointerId),d.preventDefault(),u.thumbs.has(h)?h.focus():r(d)}),onPointerMove:oe(t.onPointerMove,d=>{d.target.hasPointerCapture(d.pointerId)&&s(d)}),onPointerUp:oe(t.onPointerUp,d=>{const h=d.target;h.hasPointerCapture(d.pointerId)&&(h.releasePointerCapture(d.pointerId),o(d))})}))}),Hse="SliderTrack",Kse=S.forwardRef((t,e)=>{const{__scopeSlider:n,...r}=t,s=Bm(Hse,n);return S.createElement(Fe.span,W({"data-disabled":s.disabled?"":void 0,"data-orientation":s.orientation},r,{ref:e}))}),ok="SliderRange",Vse=S.forwardRef((t,e)=>{const{__scopeSlider:n,...r}=t,s=Bm(ok,n),o=i4(ok,n),i=S.useRef(null),a=et(e,i),c=s.values.length,l=s.values.map(h=>c4(h,s.min,s.max)),u=c>1?Math.min(...l):0,d=100-Math.max(...l);return S.createElement(Fe.span,W({"data-orientation":s.orientation,"data-disabled":s.disabled?"":void 0},r,{ref:a,style:{...t.style,[o.startEdge]:u+"%",[o.endEdge]:d+"%"}}))}),ik="SliderThumb",Wse=S.forwardRef((t,e)=>{const n=jse(t.__scopeSlider),[r,s]=S.useState(null),o=et(e,a=>s(a)),i=S.useMemo(()=>r?n().findIndex(a=>a.ref.current===r):-1,[n,r]);return S.createElement(Gse,W({},t,{ref:o,index:i}))}),Gse=S.forwardRef((t,e)=>{const{__scopeSlider:n,index:r,...s}=t,o=Bm(ik,n),i=i4(ik,n),[a,c]=S.useState(null),l=et(e,v=>c(v)),u=rM(a),d=o.values[r],h=d===void 0?0:c4(d,o.min,o.max),f=qse(r,o.values.length),p=u==null?void 0:u[i.size],m=p?Zse(p,h,i.direction):0;return S.useEffect(()=>{if(a)return o.thumbs.add(a),()=>{o.thumbs.delete(a)}},[a,o.thumbs]),S.createElement("span",{style:{transform:"var(--radix-slider-thumb-transform)",position:"absolute",[i.startEdge]:`calc(${h}% + ${m}px)`}},S.createElement(PS.ItemSlot,{scope:t.__scopeSlider},S.createElement(Fe.span,W({role:"slider","aria-label":t["aria-label"]||f,"aria-valuemin":o.min,"aria-valuenow":d,"aria-valuemax":o.max,"aria-orientation":o.orientation,"data-orientation":o.orientation,"data-disabled":o.disabled?"":void 0,tabIndex:o.disabled?void 0:0},s,{ref:l,style:d===void 0?{display:"none"}:t.style,onFocus:oe(t.onFocus,()=>{o.valueIndexToChangeRef.current=r})}))))}),Yse=t=>{const{value:e,...n}=t,r=S.useRef(null),s=Lse(e);return S.useEffect(()=>{const o=r.current,i=window.HTMLInputElement.prototype,c=Object.getOwnPropertyDescriptor(i,"value").set;if(s!==e&&c){const l=new Event("input",{bubbles:!0});c.call(o,e),o.dispatchEvent(l)}},[s,e]),S.createElement("input",W({style:{display:"none"}},n,{ref:r,defaultValue:e}))};function Xse(t=[],e,n){const r=[...t];return r[n]=e,r.sort((s,o)=>s-o)}function c4(t,e,n){const o=100/(n-e)*(t-e);return e4(o,[0,100])}function qse(t,e){return e>2?`Value ${t+1} of ${e}`:e===2?["Minimum","Maximum"][t]:void 0}function Qse(t,e){if(t.length===1)return 0;const n=t.map(s=>Math.abs(s-e)),r=Math.min(...n);return n.indexOf(r)}function Zse(t,e,n){const r=t/2,o=kb([0,50],[0,r]);return(r-o(e)*n)*n}function Jse(t){return t.slice(0,-1).map((e,n)=>t[n+1]-e)}function eoe(t,e){if(e>0){const n=Jse(t);return Math.min(...n)>=e}return!0}function kb(t,e){return n=>{if(t[0]===t[1]||e[0]===e[1])return e[0];const r=(e[1]-e[0])/(t[1]-t[0]);return e[0]+r*(n-t[0])}}function toe(t){return(String(t).split(".")[1]||"").length}function noe(t,e){const n=Math.pow(10,e);return Math.round(t*n)/n}const roe=Fse,soe=Kse,ooe=Vse,ioe=Wse,aoe=S.memo(function(e){const{title:n,steps:r,value:s,label:o,onValueChange:i}=e,a=H(),c=be(),l=S.useCallback(h=>{i(h[0],!0)},[i]),u=S.useCallback(()=>{a.mark("click slider")},[a]),d=S.useCallback(()=>{s&&i(s,!1)},[s,i]);return g.jsx("div",{className:"tlui-slider__container",children:g.jsxs(roe,{"data-testid":e["data-testid"],className:"tlui-slider","area-label":"Opacity",dir:"ltr",min:0,max:r,step:1,value:s?[s]:void 0,onPointerDown:u,onValueChange:l,onPointerUp:d,title:n+"  "+c(o),children:[g.jsx(soe,{className:"tlui-slider__track",dir:"ltr",children:s!==null&&g.jsx(ooe,{className:"tlui-slider__range",dir:"ltr"})}),s!==null&&g.jsx(ioe,{className:"tlui-slider__thumb",dir:"ltr"})]})})}),coe=S.memo(function({label:e,uiTypeA:n,uiTypeB:r,labelA:s,labelB:o,itemsA:i,itemsB:a,styleA:c,styleB:l,valueA:u,valueB:d,onValueChange:h}){const f=be(),p=S.useMemo(()=>{var v;return((v=i.find(w=>u.type==="shared"&&u.value===w.value))==null?void 0:v.icon)??"mixed"},[i,u]),m=S.useMemo(()=>{var v;return((v=a.find(w=>d.type==="shared"&&d.value===w.value))==null?void 0:v.icon)??"mixed"},[a,d]);return u===void 0&&d===void 0?null:g.jsxs("div",{className:"tlui-style-panel__double-select-picker",children:[g.jsx("div",{title:f(e),className:"tlui-style-panel__double-select-picker-label",children:f(e)}),g.jsxs(li,{id:`style panel ${n} A`,children:[g.jsx(ad,{asChild:!0,children:g.jsx(se,{"data-testid":`style.${n}`,title:f(s)+"  "+f(u===null?"style-panel.mixed":`${n}-style.${u}`),icon:p,invertIcon:!0,smallIcon:!0})}),g.jsx(ui,{side:"bottom",align:"end",sideOffset:0,alignOffset:-2,children:g.jsx("div",{className:le("tlui-button-grid",{"tlui-button-grid__two":i.length<4,"tlui-button-grid__four":i.length>=4}),children:i.map(v=>g.jsx(Bn,{className:"tlui-button-grid__button",title:f(s)+"  "+f(`${n}-style.${v.value}`),"data-testid":`style.${n}.${v.value}`,icon:v.icon,onClick:()=>h(c,v.value,!1),invertIcon:!0},v.value))})})]}),g.jsxs(li,{id:`style panel ${r}`,children:[g.jsx(ad,{asChild:!0,children:g.jsx(se,{"data-testid":`style.${r}`,title:f(o)+"  "+f(d===null?"style-panel.mixed":`${r}-style.${d}`),icon:m,smallIcon:!0})}),g.jsx(ui,{side:"bottom",align:"end",sideOffset:0,alignOffset:-2,children:g.jsx("div",{className:le("tlui-button-grid",{"tlui-button-grid__two":i.length<4,"tlui-button-grid__four":i.length>=4}),children:a.map(v=>g.jsx(Bn,{className:"tlui-button-grid__button",title:f(o)+"  "+f(`${r}-style.${v.value}`),"data-testid":`style.${r}.${v.value}`,icon:v.icon,onClick:()=>h(l,v.value,!1)},v.value))})})]})]})}),Ib=S.memo(function({id:e,label:n,uiType:r,style:s,items:o,value:i,onValueChange:a}){const c=be(),l=S.useMemo(()=>{var u;return(u=o.find(d=>i.type==="shared"&&d.value===i.value))==null?void 0:u.icon},[o,i]);return g.jsxs(li,{id:`style panel ${e}`,children:[g.jsx(ad,{asChild:!0,children:g.jsx(se,{"data-testid":`style.${r}`,title:i.type==="mixed"?c("style-panel.mixed"):c(`${r}-style.${i.value}`),label:n,icon:l??"mixed"})}),g.jsx(ui,{side:"left",align:"center",alignOffset:0,children:g.jsx("div",{className:le("tlui-button-grid",{"tlui-button-grid__two":o.length<3,"tlui-button-grid__three":o.length==3,"tlui-button-grid__four":o.length>=4}),children:o.map(u=>g.jsx(Bn,{className:"tlui-button-grid__button","data-testid":`style.${r}.${u.value}`,title:c(`${r}-style.${u.value}`),icon:u.icon,onClick:()=>a(s,u.value,!1)},u.value))})})]})}),Nr={color:[{value:"black",icon:"color"},{value:"grey",icon:"color"},{value:"light-violet",icon:"color"},{value:"violet",icon:"color"},{value:"blue",icon:"color"},{value:"light-blue",icon:"color"},{value:"yellow",icon:"color"},{value:"orange",icon:"color"},{value:"green",icon:"color"},{value:"light-green",icon:"color"},{value:"light-red",icon:"color"},{value:"red",icon:"color"}],fill:[{value:"none",icon:"fill-none"},{value:"semi",icon:"fill-semi"},{value:"solid",icon:"fill-solid"},{value:"pattern",icon:"fill-pattern"}],dash:[{value:"draw",icon:"dash-draw"},{value:"dashed",icon:"dash-dashed"},{value:"dotted",icon:"dash-dotted"},{value:"solid",icon:"dash-solid"}],size:[{value:"s",icon:"size-small"},{value:"m",icon:"size-medium"},{value:"l",icon:"size-large"},{value:"xl",icon:"size-extra-large"}],font:[{value:"draw",icon:"font-draw"},{value:"sans",icon:"font-sans"},{value:"serif",icon:"font-serif"},{value:"mono",icon:"font-mono"}],horizontalAlign:[{value:"start",icon:"text-align-left"},{value:"middle",icon:"text-align-center"},{value:"end",icon:"text-align-right"}],verticalAlign:[{value:"start",icon:"vertical-align-start"},{value:"middle",icon:"vertical-align-center"},{value:"end",icon:"vertical-align-end"}],geo:[{value:"rectangle",icon:"geo-rectangle"},{value:"ellipse",icon:"geo-ellipse"},{value:"cloud",icon:"geo-cloud"},{value:"triangle",icon:"geo-triangle"},{value:"diamond",icon:"geo-diamond"},{value:"pentagon",icon:"geo-pentagon"},{value:"hexagon",icon:"geo-hexagon"},{value:"octagon",icon:"geo-octagon"},{value:"star",icon:"geo-star"},{value:"rhombus",icon:"geo-rhombus"},{value:"rhombus-2",icon:"geo-rhombus-2"},{value:"oval",icon:"geo-oval"},{value:"trapezoid",icon:"geo-trapezoid"},{value:"arrow-right",icon:"geo-arrow-right"},{value:"arrow-left",icon:"geo-arrow-left"},{value:"arrow-up",icon:"geo-arrow-up"},{value:"arrow-down",icon:"geo-arrow-down"},{value:"x-box",icon:"geo-x-box"},{value:"check-box",icon:"geo-check-box"}],arrowheadStart:[{value:"none",icon:"arrowhead-none"},{value:"arrow",icon:"arrowhead-arrow"},{value:"triangle",icon:"arrowhead-triangle"},{value:"square",icon:"arrowhead-square"},{value:"dot",icon:"arrowhead-dot"},{value:"diamond",icon:"arrowhead-diamond"},{value:"inverted",icon:"arrowhead-triangle-inverted"},{value:"bar",icon:"arrowhead-bar"}],arrowheadEnd:[{value:"none",icon:"arrowhead-none"},{value:"arrow",icon:"arrowhead-arrow"},{value:"triangle",icon:"arrowhead-triangle"},{value:"square",icon:"arrowhead-square"},{value:"dot",icon:"arrowhead-dot"},{value:"diamond",icon:"arrowhead-diamond"},{value:"inverted",icon:"arrowhead-triangle-inverted"},{value:"bar",icon:"arrowhead-bar"}],spline:[{value:"line",icon:"spline-line"},{value:"cubic",icon:"spline-cubic"}]},loe=[xr,da,Vc,hs];function uoe(t){var r;const e=new Uw(t.sharedStyles),n=t.selectedShapeIds.length>0||!!((r=t.root.current.value)!=null&&r.shapeType);if(e.size===0&&t.isIn("select")&&t.selectedShapeIds.length===0)for(const s of loe)e.applyValue(s,t.getStyleForNextShape(s));return e.size===0&&!n?null:{styles:e,opacity:t.sharedOpacity}}const l4=function({isMobile:e}){const n=H(),r=Y("getRelevantStyles",()=>uoe(n),[n]),s=S.useCallback(()=>{e||n.updateInstanceState({isChangingStyle:!1})},[n,e]);if(!r)return null;const{styles:o,opacity:i}=r,a=o.get(cs),c=o.get(qp),l=o.get(Xp),u=o.get(Zp),d=o.get(ds),h=a===void 0,f=c===void 0&&l===void 0,p=u===void 0,m=d===void 0;return g.jsxs("div",{className:"tlui-style-panel","data-ismobile":e,onPointerLeave:s,children:[g.jsx(doe,{styles:o,opacity:i}),!m&&g.jsx(hoe,{styles:o}),!(h&&f&&p)&&g.jsxs("div",{className:"tlui-style-panel__section","aria-label":"style panel styles",children:[g.jsx(foe,{styles:o}),g.jsx(goe,{styles:o}),g.jsx(poe,{styles:o})]})]})};function Zd(){const t=H();return Z.useMemo(()=>function(e,n,r){t.setStyle(e,n,r),t.updateInstanceState({isChangingStyle:!0})},[t])}const ql=[.1,.25,.5,.75,1];function doe({styles:t,opacity:e}){const n=H(),r=be(),s=Zd(),o=Z.useCallback((h,f)=>{const p=ql[h];n.setOpacity(p,f),n.updateInstanceState({isChangingStyle:!0})},[n]),i=t.get(xr),a=t.get(Vc),c=t.get(da),l=t.get(hs),u=a!==void 0||c!==void 0||l!==void 0,d=e.type==="mixed"?-1:ql.indexOf(M7(ql,h=>Math.abs(h-e.value)));return g.jsxs(g.Fragment,{children:[g.jsxs("div",{tabIndex:-1,className:"tlui-style-panel__section__common","aria-label":"style panel styles",children:[i===void 0?null:g.jsx(xc,{title:r("style-panel.color"),uiType:"color",style:xr,items:Nr.color,value:i,onValueChange:s}),e===void 0?null:g.jsx(aoe,{"data-testid":"style.opacity",value:d>=0?d:ql.length-1,label:e.type==="mixed"?"style-panel.mixed":`opacity-style.${e}`,onValueChange:o,steps:ql.length-1,title:r("style-panel.opacity")})]}),u&&g.jsxs("div",{className:"tlui-style-panel__section","aria-label":"style panel styles",children:[a===void 0?null:g.jsx(xc,{title:r("style-panel.fill"),uiType:"fill",style:Vc,items:Nr.fill,value:a,onValueChange:s}),c===void 0?null:g.jsx(xc,{title:r("style-panel.dash"),uiType:"dash",style:da,items:Nr.dash,value:c,onValueChange:s}),l===void 0?null:g.jsx(xc,{title:r("style-panel.size"),uiType:"size",style:hs,items:Nr.size,value:l,onValueChange:s})]})]})}function hoe({styles:t}){const e=be(),n=Zd(),r=t.get(ds),s=t.get(Xu),o=t.get(Qp);return r===void 0&&s===void 0?null:g.jsxs("div",{className:"tlui-style-panel__section","aria-label":"style panel text",children:[r===void 0?null:g.jsx(xc,{title:e("style-panel.font"),uiType:"font",style:ds,items:Nr.font,value:r,onValueChange:n}),s===void 0?null:g.jsxs("div",{className:"tlui-style-panel__row",children:[g.jsx(xc,{title:e("style-panel.align"),uiType:"align",style:Xu,items:Nr.horizontalAlign,value:s,onValueChange:n}),o===void 0?g.jsx(se,{title:e("style-panel.vertical-align"),"data-testid":"vertical-align",icon:"vertical-align-center",disabled:!0}):g.jsx(Ib,{id:"geo-vertical-alignment",uiType:"verticalAlign",style:Qp,items:Nr.verticalAlign,value:o,onValueChange:n})]})]})}function foe({styles:t}){const e=Zd(),n=t.get(cs);return n===void 0?null:g.jsx(Ib,{id:"geo",label:"style-panel.geo",uiType:"geo",style:cs,items:Nr.geo,value:n,onValueChange:e})}function poe({styles:t}){const e=Zd(),n=t.get(Zp);return n===void 0?null:g.jsx(Ib,{id:"spline",label:"style-panel.spline",uiType:"spline",style:Zp,items:Nr.spline,value:n,onValueChange:e})}function goe({styles:t}){const e=Zd(),n=t.get(qp),r=t.get(Xp);return!n||!r?null:g.jsx(coe,{label:"style-panel.arrowheads",uiTypeA:"arrowheadStart",styleA:Xp,itemsA:Nr.arrowheadStart,valueA:r,uiTypeB:"arrowheadEnd",styleB:qp,itemsB:Nr.arrowheadEnd,valueB:n,onValueChange:e,labelA:"style-panel.arrowhead-start",labelB:"style-panel.arrowhead-end"})}function moe({toast:t}){const{removeToast:e}=bs(),n=be(),r=o=>{o||e(t.id)},s=t.actions&&t.actions.length>0;return g.jsxs(Ste,{onOpenChange:r,className:"tlui-toast__container",duration:t.keepOpen?1/0:5e3,children:[t.icon&&g.jsx("div",{className:"tlui-toast__icon",children:g.jsx(In,{icon:t.icon})}),g.jsxs("div",{className:"tlui-toast__main",children:[g.jsxs("div",{className:"tlui-toast__content",children:[g.jsx(xte,{className:"tlui-toast__title",children:t.title}),g.jsx(bte,{className:"tlui-toast__description",children:t.description})]}),t.actions&&g.jsxs("div",{className:"tlui-toast__actions",children:[t.actions.map((o,i)=>g.jsx(Cte,{altText:o.label,asChild:!0,onClick:o.onClick,children:g.jsx(se,{className:o.type==="warn"?"tlui-button__warning":"tlui-button__primary",children:o.label})},i)),s&&g.jsx(OP,{asChild:!0,children:g.jsx(se,{className:"tlui-toast__close",style:{marginLeft:"auto"},children:t.closeLabel??n("toast.close")})})]})]}),!s&&g.jsx(OP,{asChild:!0,children:g.jsx(se,{className:"tlui-toast__close",children:t.closeLabel??n("toast.close")})})]})}function yoe(){const{toasts:t}=bs();return g.jsx(g.Fragment,{children:t.map(e=>g.jsx(moe,{toast:e},e.id))})}const voe=S.memo(yoe);function woe(){const{toasts:t}=bs(),[e,n]=S.useState(!1);return S.useEffect(()=>{let r=!1;return t.length?n(!0):setTimeout(()=>{r||n(!1)},1e3),()=>{r=!0}},[t.length,n]),e?g.jsx(rte,{className:"tlui-toast__viewport"}):null}function Soe(){const t=H(),e=be(),n=Y("current color",()=>{const o=t.sharedStyles.get(xr);return o?o.type==="mixed"?null:An({isDarkMode:t.user.isDarkMode})[o.value].solid:"var(--color-muted-1)"},[t]),r=Y("isHandOrEraserToolActive",()=>t.isInAny("hand","zoom","eraser","laser"),[t]),s=S.useCallback(o=>{o||t.updateInstanceState({isChangingStyle:!1})},[t]);return g.jsxs(Eb,{id:"style menu",onOpenChange:s,children:[g.jsx(Pb,{disabled:r,children:g.jsx(se,{className:"tlui-toolbar__tools__button tlui-toolbar__styles__button","data-testid":"mobile.styles",style:{color:n??"var(--color-text)"},title:e("style-panel.title"),children:g.jsx(In,{icon:n?"blob":"mixed"})})}),g.jsx(YO,{side:"top",align:"end",children:g.jsx(l4,{isMobile:!0})})]})}const xoe=["select","hand","draw","eraser","text","zoom","laser","highlight"];function boe({activeToolId:t}){const e=H(),n=_r(),r=be(),s=Y("is tool locked",()=>e.instanceState.isToolLocked,[e]);return!t||xoe.includes(t)?null:g.jsx(se,{title:r("action.toggle-tool-lock"),className:le("tlui-toolbar__lock-button",{"tlui-toolbar__lock-button__mobile":n<5}),icon:s?"lock":"unlock",onClick:()=>e.updateInstanceState({isToolLocked:!s}),smallIcon:!0})}const Coe=S.memo(function(){const e=H(),n=be(),r=_r(),s=Z.useRef(void 0),o=Cr(),i=One(),a=i.find(x=>x.toolItem.id==="laser"),c=Y("current tool id",()=>e.currentToolId,[e]),l=c==="hand",u=Y("geo",()=>e.sharedStyles.getAsKnownValue(cs),[e]),d=!o,h=!(o||l),f=x=>x.label?`${n(x.label)} ${x.kbd?ps(x.kbd):""}`:"",p=i.find(x=>tc(x.toolItem,c,u)),{itemsInPanel:m,itemsInDropdown:v,dropdownFirstItem:w}=Z.useMemo(()=>{const x=[],b=[];let C;const E=Math.min(8,5+r);for(let _=4;_<i.length;_++){const k=i[_];_<E?x.push(k):(k===p&&(C=k),b.push(k))}return C||(s.current||(s.current=b[0]),C=s.current,b.includes(C)||(C=b[0])),s.current=C,b.length<=2&&(x.push(...b),b.length=0),{itemsInPanel:x,itemsInDropdown:b,dropdownFirstItem:C}},[i,p,r]);return g.jsx("div",{className:"tlui-toolbar",children:g.jsxs("div",{className:"tlui-toolbar__inner",children:[g.jsxs("div",{className:"tlui-toolbar__left",children:[!o&&g.jsxs("div",{className:le("tlui-toolbar__extras",{"tlui-toolbar__extras__hidden":!h}),children:[r<6&&g.jsxs("div",{className:"tlui-toolbar__extras__controls",children:[g.jsx(JO,{}),g.jsx(QO,{}),g.jsx(ZO,{}),g.jsx(qO,{}),g.jsx(XO,{})]}),g.jsx(boe,{activeToolId:c})]}),g.jsxs("div",{className:le("tlui-toolbar__tools",{"tlui-toolbar__tools__mobile":r<5}),children:[i.slice(0,2).map(({toolItem:x})=>g.jsx(Ql,{item:x,title:f(x),isSelected:tc(x,c,u)},x.id)),o&&a&&g.jsx(Ql,{item:a.toolItem,title:f(a.toolItem),isSelected:tc(a.toolItem,c,u)},a.toolItem.id),d&&g.jsxs(g.Fragment,{children:[g.jsx("div",{className:"tlui-toolbar__divider"}),i.slice(2,4).map(({toolItem:x})=>g.jsx(Ql,{item:x,title:f(x),isSelected:tc(x,c,u)},x.id)),g.jsx("div",{className:"tlui-toolbar__divider"}),m.map(({toolItem:x})=>g.jsx(Ql,{item:x,title:f(x),isSelected:tc(x,c,u)},x.id)),v.length?g.jsxs(g.Fragment,{children:[g.jsx(Ql,{item:w.toolItem,title:f(w.toolItem),isSelected:tc(w.toolItem,c,u)},w.toolItem.id),g.jsxs(li,{id:"toolbar overflow",modal:!1,children:[g.jsx(Vd,{children:g.jsx(se,{className:"tlui-toolbar__tools__button tlui-toolbar__overflow",icon:"chevron-up","data-testid":"tools.more",title:n("tool-panel.more")})}),g.jsx(ui,{side:"top",align:"center",children:g.jsx(_oe,{toolbarItems:v})})]})]}):null]})]})]}),r<5&&!o&&g.jsx("div",{className:"tlui-toolbar__tools",children:g.jsx(Soe,{})})]})})}),_oe=Ee(function({toolbarItems:e}){const n=be();return g.jsx("div",{className:"tlui-button-grid__four tlui-button-grid__reverse",children:e.map(({toolItem:{id:r,meta:s,kbd:o,label:i,onSelect:a,icon:c}})=>g.jsx(Bn,{className:"tlui-button-grid__button","data-testid":`tools.${r}`,"data-tool":r,"data-geo":(s==null?void 0:s.geo)??"","aria-label":i,onClick:()=>a("toolbar"),title:i?`${n(i)} ${o?ps(o):""}`:"",icon:c},r))})});function Ql({item:t,title:e,isSelected:n}){var r;return g.jsx(se,{className:"tlui-toolbar__tools__button","data-testid":`tools.${t.id}`,"data-tool":t.id,"data-geo":((r=t.meta)==null?void 0:r.geo)??"","aria-label":t.label,title:e,icon:t.icon,"data-state":n?"selected":void 0,onClick:()=>t.onSelect("toolbar"),onTouchStart:s=>{je(s),t.onSelect("toolbar")}})}const tc=(t,e,n)=>{var r,s;return(r=t.meta)!=null&&r.geo?e==="geo"&&n===((s=t.meta)==null?void 0:s.geo):e===t.id};function Eoe(){const t=H(),{addToast:e}=bs();S.useEffect(()=>{function n({name:r,count:s}){e({title:"Maximum Shapes Reached",description:`You've reached the maximum number of shapes allowed on ${r} (${s}). Please delete some shapes or move to a different page to continue.`})}return t.addListener("max-shapes",n),()=>{t.removeListener("max-shapes",n)}},[t,e])}var Y0=typeof navigator<"u"?navigator.userAgent.toLowerCase().indexOf("firefox")>0:!1;function X0(t,e,n,r){t.addEventListener?t.addEventListener(e,n,r):t.attachEvent&&t.attachEvent("on".concat(e),function(){n(window.event)})}function u4(t,e){for(var n=e.slice(0,e.length-1),r=0;r<n.length;r++)n[r]=t[n[r].toLowerCase()];return n}function d4(t){typeof t!="string"&&(t=""),t=t.replace(/\s/g,"");for(var e=t.split(","),n=e.lastIndexOf("");n>=0;)e[n-1]+=",",e.splice(n,1),n=e.lastIndexOf("");return e}function Poe(t,e){for(var n=t.length>=e.length?t:e,r=t.length>=e.length?e:t,s=!0,o=0;o<n.length;o++)r.indexOf(n[o])===-1&&(s=!1);return s}var pd={backspace:8,"":8,tab:9,clear:12,enter:13,"":13,return:13,esc:27,escape:27,space:32,left:37,up:38,right:39,down:40,del:46,delete:46,ins:45,insert:45,home:36,end:35,pageup:33,pagedown:34,capslock:20,num_0:96,num_1:97,num_2:98,num_3:99,num_4:100,num_5:101,num_6:102,num_7:103,num_8:104,num_9:105,num_multiply:106,num_add:107,num_enter:108,num_subtract:109,num_decimal:110,num_divide:111,"":20,",":188,".":190,"/":191,"`":192,"-":Y0?173:189,"=":Y0?61:187,";":Y0?59:186,"'":222,"[":219,"]":221,"\\":220},ys={"":16,shift:16,"":18,alt:18,option:18,"":17,ctrl:17,control:17,"":91,cmd:91,command:91},kS={16:"shiftKey",18:"altKey",17:"ctrlKey",91:"metaKey",shiftKey:16,ctrlKey:17,altKey:18,metaKey:91},Lt={16:!1,18:!1,17:!1,91:!1},ht={};for(var df=1;df<20;df++)pd["f".concat(df)]=111+df;var Ue=[],ak=!1,h4="all",f4=[],Jd=function(e){return pd[e.toLowerCase()]||ys[e.toLowerCase()]||e.toUpperCase().charCodeAt(0)},koe=function(e){return Object.keys(pd).find(function(n){return pd[n]===e})},Ioe=function(e){return Object.keys(ys).find(function(n){return ys[n]===e})};function p4(t){h4=t||"all"}function gd(){return h4||"all"}function $oe(){return Ue.slice(0)}function Toe(){return Ue.map(function(t){return koe(t)||Ioe(t)||String.fromCharCode(t)})}function Aoe(){var t=[];return Object.keys(ht).forEach(function(e){ht[e].forEach(function(n){var r=n.key,s=n.scope,o=n.mods,i=n.shortcut;t.push({scope:s,shortcut:i,mods:o,keys:r.split("+").map(function(a){return Jd(a)})})})}),t}function Moe(t){var e=t.target||t.srcElement,n=e.tagName,r=!0;return(e.isContentEditable||(n==="INPUT"||n==="TEXTAREA"||n==="SELECT")&&!e.readOnly)&&(r=!1),r}function Ooe(t){return typeof t=="string"&&(t=Jd(t)),Ue.indexOf(t)!==-1}function Doe(t,e){var n,r;t||(t=gd());for(var s in ht)if(Object.prototype.hasOwnProperty.call(ht,s))for(n=ht[s],r=0;r<n.length;)n[r].scope===t?n.splice(r,1):r++;gd()===t&&p4(e||"all")}function Roe(t){var e=t.keyCode||t.which||t.charCode,n=Ue.indexOf(e);if(n>=0&&Ue.splice(n,1),t.key&&t.key.toLowerCase()==="meta"&&Ue.splice(0,Ue.length),(e===93||e===224)&&(e=91),e in Lt){Lt[e]=!1;for(var r in ys)ys[r]===e&&(zr[r]=!1)}}function Loe(t){if(typeof t>"u")Object.keys(ht).forEach(function(i){return delete ht[i]});else if(Array.isArray(t))t.forEach(function(i){i.key&&q0(i)});else if(typeof t=="object")t.key&&q0(t);else if(typeof t=="string"){for(var e=arguments.length,n=new Array(e>1?e-1:0),r=1;r<e;r++)n[r-1]=arguments[r];var s=n[0],o=n[1];typeof s=="function"&&(o=s,s=""),q0({key:t,scope:s,method:o,splitKey:"+"})}}var q0=function(e){var n=e.key,r=e.scope,s=e.method,o=e.splitKey,i=o===void 0?"+":o,a=d4(n);a.forEach(function(c){var l=c.split(i),u=l.length,d=l[u-1],h=d==="*"?"*":Jd(d);if(ht[h]){r||(r=gd());var f=u>1?u4(ys,l):[];ht[h]=ht[h].filter(function(p){var m=s?p.method===s:!0;return!(m&&p.scope===r&&Poe(p.mods,f))})}})};function ck(t,e,n,r){if(e.element===r){var s;if(e.scope===n||e.scope==="all"){s=e.mods.length>0;for(var o in Lt)Object.prototype.hasOwnProperty.call(Lt,o)&&(!Lt[o]&&e.mods.indexOf(+o)>-1||Lt[o]&&e.mods.indexOf(+o)===-1)&&(s=!1);(e.mods.length===0&&!Lt[16]&&!Lt[18]&&!Lt[17]&&!Lt[91]||s||e.shortcut==="*")&&(e.keys=[],e.keys=e.keys.concat(Ue),e.method(t,e)===!1&&(t.preventDefault?t.preventDefault():t.returnValue=!1,t.stopPropagation&&t.stopPropagation(),t.cancelBubble&&(t.cancelBubble=!0)))}}}function lk(t,e){var n=ht["*"],r=t.keyCode||t.which||t.charCode;if(zr.filter.call(this,t)){if((r===93||r===224)&&(r=91),Ue.indexOf(r)===-1&&r!==229&&Ue.push(r),["ctrlKey","altKey","shiftKey","metaKey"].forEach(function(p){var m=kS[p];t[p]&&Ue.indexOf(m)===-1?Ue.push(m):!t[p]&&Ue.indexOf(m)>-1?Ue.splice(Ue.indexOf(m),1):p==="metaKey"&&t[p]&&Ue.length===3&&(t.ctrlKey||t.shiftKey||t.altKey||(Ue=Ue.slice(Ue.indexOf(m))))}),r in Lt){Lt[r]=!0;for(var s in ys)ys[s]===r&&(zr[s]=!0);if(!n)return}for(var o in Lt)Object.prototype.hasOwnProperty.call(Lt,o)&&(Lt[o]=t[kS[o]]);t.getModifierState&&!(t.altKey&&!t.ctrlKey)&&t.getModifierState("AltGraph")&&(Ue.indexOf(17)===-1&&Ue.push(17),Ue.indexOf(18)===-1&&Ue.push(18),Lt[17]=!0,Lt[18]=!0);var i=gd();if(n)for(var a=0;a<n.length;a++)n[a].scope===i&&(t.type==="keydown"&&n[a].keydown||t.type==="keyup"&&n[a].keyup)&&ck(t,n[a],i,e);if(r in ht){for(var c=0;c<ht[r].length;c++)if((t.type==="keydown"&&ht[r][c].keydown||t.type==="keyup"&&ht[r][c].keyup)&&ht[r][c].key){for(var l=ht[r][c],u=l.splitKey,d=l.key.split(u),h=[],f=0;f<d.length;f++)h.push(Jd(d[f]));h.sort().join("")===Ue.sort().join("")&&ck(t,l,i,e)}}}}function joe(t){return f4.indexOf(t)>-1}function zr(t,e,n){Ue=[];var r=d4(t),s=[],o="all",i=document,a=0,c=!1,l=!0,u="+",d=!1;for(n===void 0&&typeof e=="function"&&(n=e),Object.prototype.toString.call(e)==="[object Object]"&&(e.scope&&(o=e.scope),e.element&&(i=e.element),e.keyup&&(c=e.keyup),e.keydown!==void 0&&(l=e.keydown),e.capture!==void 0&&(d=e.capture),typeof e.splitKey=="string"&&(u=e.splitKey)),typeof e=="string"&&(o=e);a<r.length;a++)t=r[a].split(u),s=[],t.length>1&&(s=u4(ys,t)),t=t[t.length-1],t=t==="*"?"*":Jd(t),t in ht||(ht[t]=[]),ht[t].push({keyup:c,keydown:l,scope:o,mods:s,shortcut:r[a],method:n,key:r[a],splitKey:u,element:i});typeof i<"u"&&!joe(i)&&window&&(f4.push(i),X0(i,"keydown",function(h){lk(h,i)},d),ak||(ak=!0,X0(window,"focus",function(){Ue=[]},d)),X0(i,"keyup",function(h){lk(h,i),Roe(h)},d))}function Noe(t){var e=arguments.length>1&&arguments[1]!==void 0?arguments[1]:"all";Object.keys(ht).forEach(function(n){var r=ht[n].filter(function(s){return s.scope===e&&s.shortcut===t});r.forEach(function(s){s&&s.method&&s.method()})})}var Q0={getPressedKeyString:Toe,setScope:p4,getScope:gd,deleteScope:Doe,getPressedKeyCodes:$oe,getAllKeyCodes:Aoe,isPressed:Ooe,filter:Moe,trigger:Noe,unbind:Loe,keyMap:pd,modifier:ys,modifierMap:kS};for(var Z0 in Q0)Object.prototype.hasOwnProperty.call(Q0,Z0)&&(zr[Z0]=Q0[Z0]);if(typeof window<"u"){var zoe=window.hotkeys;zr.noConflict=function(t){return t&&window.hotkeys===zr&&(window.hotkeys=zoe),zr},window.hotkeys=zr}const uk=["copy","cut","paste","asset"];function Foe(){const t=H(),e=Cr(),n=an(),r=vb(),s=Y("is focused",()=>t.instanceState.isFocused,[t]);S.useEffect(()=>{if(!s)return;const o=t.getContainer();zr.setScope(t.store.id);const i=(c,l)=>{zr(c,{element:o,scope:t.store.id},l)},a=()=>t.isMenuOpen||t.editingShapeId!==null||t.crashingError;for(const c of Object.values(n))c.kbd&&(e&&!c.readonlyOk||uk.includes(c.id)||i(dk(c.kbd),l=>{a()||(je(l),c.onSelect("kbd"))}));for(const c of Object.values(r))!c.kbd||!c.readonlyOk&&t.instanceState.isReadonly||uk.includes(c.id)||i(dk(c.kbd),l=>{a()||(je(l),c.onSelect("kbd"))});return()=>{zr.deleteScope(t.store.id)}},[n,r,e,t,s])}function dk(t){return Boe(t).map(e=>{let n="";const r=e.split("");return r.length===1?n=r[0]:r[0]==="!"?n=`shift+${r[1]}`:r[0]==="?"?n=`alt+${r[1]}`:r[0]==="$"?r[1]==="!"?n=`cmd+shift+${r[2]},ctrl+shift+${r[2]}`:r[1]==="?"?n=`cmd++${r[2]},ctrl+alt+${r[2]}`:n=`cmd+${r[1]},ctrl+${r[1]}`:n=e,n}).join(",")}function Boe(t){typeof t!="string"&&(t=""),t=t.replace(/\s/g,"");const e=t.split(",");let n=e.lastIndexOf("");for(;n>=0;)e[n-1]+=",",e.splice(n,1),n=e.lastIndexOf("");return e}const Uoe=Z.memo(function({shareZone:e,topZone:n,renderDebugMenuItems:r,children:s,hideUi:o,...i}){return g.jsx(Nne,{...i,children:g.jsx(Hoe,{hideUi:o,shareZone:e,topZone:n,renderDebugMenuItems:r,children:s})})}),Hoe=Z.memo(function({children:e,hideUi:n,...r}){return g.jsxs(g.Fragment,{children:[e,n?null:g.jsx(Koe,{...r})]})}),Koe=Z.memo(function({shareZone:e,topZone:n,renderDebugMenuItems:r}){const s=H(),o=be(),i=_r(),a=Y("isReadonlyMode",()=>s.instanceState.isReadonly,[s]),c=Y("focus",()=>s.instanceState.isFocusMode,[s]),l=Y("debug",()=>s.instanceState.isDebugMode,[s]);Foe(),Gte(),Eoe();const{"toggle-focus-mode":u}=an();return g.jsx(B5,{children:g.jsxs("main",{className:le("tlui-layout",{"tlui-layout__mobile":i<5}),children:[c?g.jsx("div",{className:"tlui-layout__top",children:g.jsx(se,{className:"tlui-focus-button",title:`${o("focus-mode.toggle-focus-mode")}`,icon:"dot",onClick:()=>u.onSelect("menu")})}):g.jsxs(g.Fragment,{children:[g.jsxs("div",{className:"tlui-layout__top",children:[g.jsxs("div",{className:"tlui-layout__top__left",children:[g.jsx($se,{}),g.jsxs("div",{className:"tlui-helper-buttons",children:[g.jsx(Ose,{}),g.jsx(Fne,{}),g.jsx(Dse,{})]})]}),g.jsx("div",{className:"tlui-layout__top__center",children:n}),g.jsxs("div",{className:"tlui-layout__top__right",children:[e,i>=5&&!a&&g.jsx("div",{className:"tlui-style-panel__wrapper",children:g.jsx(l4,{})})]})]}),g.jsxs("div",{className:"tlui-layout__bottom",children:[g.jsxs("div",{className:"tlui-layout__bottom__main",children:[g.jsx(Mse,{}),g.jsx(Coe,{}),i>=4&&g.jsx(ere,{})]}),l&&g.jsx(Une,{renderDebugMenuItems:r??null})]})]}),g.jsx(voe,{}),g.jsx(Qne,{}),g.jsx(woe,{}),g.jsx(Zne,{})]})})}),g4="ContextMenu",[Voe,rue]=oo(g4,[Om]),Cs=Om(),[Woe,m4]=Voe(g4),Goe=t=>{const{__scopeContextMenu:e,children:n,onOpenChange:r,dir:s,modal:o=!0}=t,[i,a]=S.useState(!1),c=Cs(e),l=rn(r),u=S.useCallback(d=>{a(d),l(d)},[l]);return S.createElement(Woe,{scope:e,open:i,onOpenChange:u,modal:o},S.createElement(kM,W({},c,{dir:s,open:i,onOpenChange:u,modal:o}),n))},Yoe="ContextMenuTrigger",Xoe=S.forwardRef((t,e)=>{const{__scopeContextMenu:n,disabled:r=!1,...s}=t,o=m4(Yoe,n),i=Cs(n),a=S.useRef({x:0,y:0}),c=S.useRef({getBoundingClientRect:()=>DOMRect.fromRect({width:0,height:0,...a.current})}),l=S.useRef(0),u=S.useCallback(()=>window.clearTimeout(l.current),[]),d=h=>{a.current={x:h.clientX,y:h.clientY},o.onOpenChange(!0)};return S.useEffect(()=>u,[u]),S.useEffect(()=>void(r&&u()),[r,u]),S.createElement(S.Fragment,null,S.createElement(IM,W({},i,{virtualRef:c})),S.createElement(Fe.span,W({"data-state":o.open?"open":"closed","data-disabled":r?"":void 0},s,{ref:e,style:{WebkitTouchCallout:"none",...t.style},onContextMenu:r?t.onContextMenu:oe(t.onContextMenu,h=>{u(),d(h),h.preventDefault()}),onPointerDown:r?t.onPointerDown:oe(t.onPointerDown,hf(h=>{u(),l.current=window.setTimeout(()=>d(h),700)})),onPointerMove:r?t.onPointerMove:oe(t.onPointerMove,hf(u)),onPointerCancel:r?t.onPointerCancel:oe(t.onPointerCancel,hf(u)),onPointerUp:r?t.onPointerUp:oe(t.onPointerUp,hf(u))})))}),qoe=t=>{const{__scopeContextMenu:e,...n}=t,r=Cs(e);return S.createElement($M,W({},r,n))},Qoe="ContextMenuContent",Zoe=S.forwardRef((t,e)=>{const{__scopeContextMenu:n,...r}=t,s=m4(Qoe,n),o=Cs(n),i=S.useRef(!1);return S.createElement(TM,W({},o,r,{ref:e,side:"right",sideOffset:2,align:"start",onCloseAutoFocus:a=>{var c;(c=t.onCloseAutoFocus)===null||c===void 0||c.call(t,a),!a.defaultPrevented&&i.current&&a.preventDefault(),i.current=!1},onInteractOutside:a=>{var c;(c=t.onInteractOutside)===null||c===void 0||c.call(t,a),!a.defaultPrevented&&!s.modal&&(i.current=!0)},style:{...t.style,"--radix-context-menu-content-transform-origin":"var(--radix-popper-transform-origin)","--radix-context-menu-content-available-width":"var(--radix-popper-available-width)","--radix-context-menu-content-available-height":"var(--radix-popper-available-height)","--radix-context-menu-trigger-width":"var(--radix-popper-anchor-width)","--radix-context-menu-trigger-height":"var(--radix-popper-anchor-height)"}}))}),Joe=S.forwardRef((t,e)=>{const{__scopeContextMenu:n,...r}=t,s=Cs(n);return S.createElement(AM,W({},s,r,{ref:e}))}),eie=S.forwardRef((t,e)=>{const{__scopeContextMenu:n,...r}=t,s=Cs(n);return S.createElement(MM,W({},s,r,{ref:e}))}),tie=S.forwardRef((t,e)=>{const{__scopeContextMenu:n,...r}=t,s=Cs(n);return S.createElement(OM,W({},s,r,{ref:e}))}),nie=t=>{const{__scopeContextMenu:e,children:n,onOpenChange:r,open:s,defaultOpen:o}=t,i=Cs(e),[a,c]=Ca({prop:s,defaultProp:o,onChange:r});return S.createElement(DM,W({},i,{open:a,onOpenChange:c}),n)},rie=S.forwardRef((t,e)=>{const{__scopeContextMenu:n,...r}=t,s=Cs(n);return S.createElement(RM,W({},s,r,{ref:e}))}),sie=S.forwardRef((t,e)=>{const{__scopeContextMenu:n,...r}=t,s=Cs(n);return S.createElement(LM,W({},s,r,{ref:e,style:{...t.style,"--radix-context-menu-content-transform-origin":"var(--radix-popper-transform-origin)","--radix-context-menu-content-available-width":"var(--radix-popper-available-width)","--radix-context-menu-content-available-height":"var(--radix-popper-available-height)","--radix-context-menu-trigger-width":"var(--radix-popper-anchor-width)","--radix-context-menu-trigger-height":"var(--radix-popper-anchor-height)"}}))});function hf(t){return e=>e.pointerType!=="mouse"?t(e):void 0}const oie=Goe,iie=Xoe,IS=qoe,aie=Zoe,$S=Joe,TS=eie,cie=tie,y4=nie,v4=rie,w4=sie,lie=Ee(function(){const e=H(),n=Mn(),r=e.pages,s=e.currentPageId,o=be(),{addToast:i}=bs();return g.jsxs(y4,{children:[g.jsx(v4,{dir:"ltr",asChild:!0,children:g.jsx(se,{className:"tlui-menu__button",label:"context-menu.move-to-page","data-testid":"menu-item.move-to-page",icon:"chevron-right"})}),g.jsx(IS,{container:n,dir:"ltr",children:g.jsxs(w4,{className:"tlui-menu",sideOffset:-4,collisionPadding:4,children:[g.jsx($S,{dir:"ltr",className:"tlui-menu__group","data-testid":"menu-item.pages",children:r.map(a=>g.jsx(TS,{disabled:s===a.id,onSelect:()=>{e.mark("move_shapes_to_page"),e.moveShapesToPage(e.selectedShapeIds,a.id);const c=e.getPage(a.id);c&&i({title:"Changed Page",description:`Moved to ${c.name}.`,actions:[{label:"Go Back",type:"primary",onClick:()=>{e.mark("change-page"),e.setCurrentPage(s)}}]})},asChild:!0,children:g.jsx(se,{title:a.name,className:"tlui-menu__button tlui-context-menu__move-to-page__name",children:g.jsx("span",{children:a.name})})},a.id))},"pages"),g.jsx($S,{dir:"ltr",className:"tlui-menu__group","data-testid":"menu-item.new-page",children:g.jsx(TS,{onSelect:()=>{e.mark("move_shapes_to_page");const a=Un.createId(),c=e.selectedShapeIds,l=e.currentPageId;e.batch(()=>{e.createPage("Page 1",a),e.setCurrentPage(l),e.moveShapesToPage(c,a)})},asChild:!0,children:g.jsx(se,{title:o("context.pages.new-page"),className:"tlui-menu__button tlui-context-menu__move-to-page__name",children:o("context.pages.new-page")})},"new-page")},"new-page")]})})]})}),uie=function({children:e}){const n=H(),r=fO(),s=S.useCallback(d=>{if(d){if(n.instanceState.isCoarsePointer){const{selectedShapes:h,inputs:{currentPagePoint:f}}=n,p=n.getShapesAtPoint(f);if(!n.selectedShapes.length||!p.some(m=>h.includes(m))){const m=p.filter(v=>n.isShapeOrAncestorLocked(v));m.length&&n.select(...m.map(v=>v.id))}}}else{const{onlySelectedShape:h}=n;h&&n.isShapeOrAncestorLocked(h)&&n.setSelectedShapeIds([])}},[n]),[o,i]=Aa("context menu",s),a=Cr(),c=r.length===0||a&&r.every(d=>!d.readonlyOk),u=!Y("isSelectToolActive",()=>n.currentToolId==="select",[n])||c;return g.jsxs(oie,{dir:"ltr",onOpenChange:i,children:[g.jsx(iie,{onContextMenu:u?je:void 0,dir:"ltr",disabled:u,children:e}),g.jsx(die,{})]})};function die(){const t=H(),e=be(),n=fO(),[r,s]=Aa("context menu sub"),o=Cr(),i=_r(),a=Mn(),[c,l]=S.useState(!1);function u(d,h,f,p){if(o&&!h.readonlyOk)return null;switch(h.type){case"custom":{switch(h.id){case"MOVE_TO_PAGE_MENU":return g.jsx(lie,{},h.id)}break}case"group":return g.jsx($S,{dir:"ltr",className:le("tlui-menu__group",{"tlui-menu__group__small":(f==null?void 0:f.type)==="submenu"}),"data-testid":`menu-item.${h.id}`,children:h.children.map(m=>u(d,m,h,p+1))},h.id);case"submenu":return g.jsxs(y4,{onOpenChange:s,children:[g.jsx(v4,{dir:"ltr",disabled:h.disabled,asChild:!0,children:g.jsx(se,{className:"tlui-menu__button",label:h.label,"data-testid":`menu-item.${h.id}`,icon:"chevron-right"})}),g.jsx(IS,{container:a,dir:"ltr",children:g.jsx(w4,{className:"tlui-menu",sideOffset:-4,collisionPadding:4,children:h.children.map(m=>u(d,m,h,p+1))})})]},h.id);case"item":{if(o&&!h.readonlyOk)return null;const{id:m,checkbox:v,contextMenuLabel:w,label:x,onSelect:b,kbd:C,icon:E}=h.actionItem,_=w??x,k=_?e(_):void 0;return v?g.jsxs(cie,{className:"tlui-button tlui-menu__button tlui-menu__checkbox-item",dir:"ltr",disabled:h.disabled,onSelect:I=>{b("context-menu"),je(I)},title:k||void 0,checked:h.checked,children:[g.jsx("div",{className:"tlui-menu__checkbox-item__check",style:{transformOrigin:"75% center",transform:`scale(${h.checked?1:.5})`,opacity:h.checked?1:.5},children:g.jsx(In,{small:!0,icon:h.checked?"check":"checkbox-empty"})}),k&&g.jsx("span",{children:k}),C&&g.jsx(Em,{children:C})]},m):g.jsx(TS,{dir:"ltr",asChild:!0,children:g.jsx(se,{className:"tlui-menu__button","data-testid":`menu-item.${m}`,kbd:C,label:_,disabled:h.disabled,iconLeft:i<3&&p>2?E:void 0,onClick:()=>{c?l(!1):b("context-menu")}})},m)}}}return g.jsx(IS,{dir:"ltr",container:a,children:g.jsx(aie,{className:"tlui-menu scrollable",alignOffset:-4,collisionPadding:4,onContextMenu:je,children:n.map(d=>u(t,d,null,0))})})}function hk(t,e){let n=0;for(;t[e+n];)n+=t[e+n]+1;return n+1}function hie(t){return new TextDecoder("ascii").decode(t.slice(0,3))==="GIF"}function fie(t){const e=new Uint8Array(t);let n,r,s=0,o=0;if(!hie(t))return!1;for(n=e[10]&128,r=e[10]&7,s+=6,s+=7,s+=n?3*Math.pow(2,r+1):0;o<2&&s<e.length;)switch(e[s]){case 44:o+=1,n=e[s+9]&128,r=e[s+9]&7,s+=10,s+=n?3*Math.pow(2,r+1):0,s+=hk(e,s+1)+1;break;case 33:s+=2,s+=hk(e,s);break;case 59:s=e.length;break;default:s=e.length;break}return o>1}function pie(t,e){const n=t.w/e.w,r=t.h/e.h;return n<=1&&r<=1?t:n>r?{w:t.w/n,h:t.h/n}:{w:t.w/r,h:t.h/r}}async function gie(t){return t.type==="image/gif"?await new Promise((e,n)=>{const r=new FileReader;r.onerror=()=>n(r.error),r.onload=()=>{e({isAnimated:r.result?fie(r.result):!1})},r.readAsArrayBuffer(t)}):{isAnimated:!x4(t.type)}}async function mie(t,e,n){return await new Promise(r=>{const s=new Image;s.onload=()=>{const o=document.createElement("canvas"),i=o.getContext("2d");if(!i)return;o.width=e*2,o.height=n*2,i.drawImage(s,0,0,o.width,o.height);const a=o.toDataURL();r(a)},s.crossOrigin="anonymous",s.src=t})}const S4=["image/jpeg","image/png","image/gif","image/svg+xml"],yie=["video/mp4","video/quicktime"],x4=t=>S4.includes(t),vie=1e3,wie=1e3;function Sie(){const t=H();S.useEffect(()=>{t.registerExternalAssetHandler("file",async({file:e})=>await new Promise((n,r)=>{const s=new FileReader;s.onerror=()=>r(s.error),s.onload=async()=>{let o=s.result;const i=x4(e.type),a=i?VC.getImageSizeFromSrc:VC.getVideoSizeFromSrc;e.type==="video/quicktime"&&o.includes("video/quicktime")&&(o=o.replace("video/quicktime","video/mp4"));const c=await a(o),l=pie(c,{w:vie,h:wie});l!==c&&(e.type==="image/jpeg"||e.type==="image/png")&&(o=await mie(o,l.w,l.h));const u=$c.createId(Mf(o)),d=await gie(e),h={id:u,type:i?"image":"video",typeName:"asset",props:{name:e.name,src:o,w:l.w,h:l.h,mimeType:e.type,isAnimated:d.isAnimated},meta:{}};n(h)},s.readAsDataURL(e)})),t.registerExternalAssetHandler("url",async({url:e})=>{var r,s,o;let n;try{const a=await(await fetch(e,{method:"GET",mode:"no-cors"})).text(),c=new DOMParser().parseFromString(a,"text/html");n={image:((r=c.head.querySelector('meta[property="og:image"]'))==null?void 0:r.getAttribute("content"))??"",title:((s=c.head.querySelector('meta[property="og:title"]'))==null?void 0:s.getAttribute("content"))??Su(e,32),description:((o=c.head.querySelector('meta[property="og:description"]'))==null?void 0:o.getAttribute("content"))??""}}catch(i){console.error(i),n={image:"",title:Su(e,32),description:""}}return{id:$c.createId(Mf(e)),typeName:"asset",type:"bookmark",props:{src:e,description:n.description,image:n.image,title:n.title},meta:{}}}),t.registerExternalContentHandler("svg-text",async({point:e,text:n})=>{const r=e??(t.inputs.shiftKey?t.inputs.currentPagePoint:t.viewportPageCenter),s=new DOMParser().parseFromString(n,"image/svg+xml").querySelector("svg");if(!s)throw new Error("No <svg/> element present");let o=parseFloat(s.getAttribute("width")||"0"),i=parseFloat(s.getAttribute("height")||"0");if(!(o&&i)){document.body.appendChild(s);const c=s.getBoundingClientRect();document.body.removeChild(s),o=c.width,i=c.height}const a=await t.getAssetForExternalContent({type:"file",file:new File([n],"asset.svg",{type:"image/svg+xml"})});if(!a)throw Error("Could not create an asset");J0(t,[a],r)}),t.registerExternalContentHandler("embed",({point:e,url:n,embed:r})=>{const s=e??(t.inputs.shiftKey?t.inputs.currentPagePoint:t.viewportPageCenter),{width:o,height:i}=r,a=Ke(),c={id:a,type:"embed",x:s.x-(o||450)/2,y:s.y-(i||450)/2,props:{w:o,h:i,url:n}};t.createShapes([c]).select(a)}),t.registerExternalContentHandler("files",async({point:e,files:n})=>{const r=e??(t.inputs.shiftKey?t.inputs.currentPagePoint:t.viewportPageCenter),s=new P(r.x,r.y),o=[];await Promise.all(n.map(async(i,a)=>{if(!i.type)throw new Error("No mime type");if(!S4.concat(yie).includes(i.type))return console.warn(`${i.name} not loaded - Extension not allowed.`),null;try{const c=await t.getAssetForExternalContent({type:"file",file:i});if(!c)throw Error("Could not create an asset");o[a]=c}catch(c){return console.error(c),null}})),J0(t,me(o),s)}),t.registerExternalContentHandler("text",async({point:e,text:n})=>{const r=e??(t.inputs.shiftKey?t.inputs.currentPagePoint:t.viewportPageCenter),s=t.getShapeUtil("text").getDefaultProps(),o=MJ(n);let i,a,c,l="middle";const u=o.split(`
`).length>1,d=IJ(o);u&&(l=u?d?"end":"start":"middle");const h=t.textMeasure.measureText(o,{...Ft,fontFamily:Vs[s.font],fontSize:Bo[s.size],width:"fit-content"}),f=Math.min(u?t.viewportPageBounds.width*.9:920,Math.max(200,t.viewportPageBounds.width*.9));if(h.w>f){const p=t.textMeasure.measureText(o,{...Ft,fontFamily:Vs[s.font],fontSize:Bo[s.size],width:f+"px"});i=p.w,a=p.h,c=!1,l=d?"end":"start"}else i=h.w,a=h.h,c=!0;r.y-a/2<t.viewportPageBounds.minY+40&&(r.y=t.viewportPageBounds.minY+40+a/2),t.createShapes([{id:Ke(),type:"text",x:r.x-i/2,y:r.y-a/2,props:{text:o,align:l,autoSize:c,w:i}}])}),t.registerExternalContentHandler("url",async({point:e,url:n})=>{const r=Rs(n);if(r)return t.putExternalContent({type:"embed",url:r.url,point:e,embed:r.definition});const s=e??(t.inputs.shiftKey?t.inputs.currentPagePoint:t.viewportPageCenter),o=$c.createId(Mf(n));let i=t.getAsset(o),a=!1;if(!i){a=!0;const c=await t.getAssetForExternalContent({type:"url",url:n});if(!c)throw Error("Could not create an asset");i=c}t.batch(()=>{a&&t.createAssets([i]),J0(t,[i],s)})})},[t])}async function J0(t,e,n){if(!e.length)return;const r=P.From(n),s=[];for(const o of e)switch(o.type){case"bookmark":{s.push({id:Ke(),type:"bookmark",x:r.x-150,y:r.y-160,opacity:1,props:{assetId:o.id,url:o.props.src}}),r.x+=300;break}case"image":{s.push({id:Ke(),type:"image",x:r.x-o.props.w/2,y:r.y-o.props.h/2,opacity:1,props:{assetId:o.id,w:o.props.w,h:o.props.h}}),r.x+=o.props.w;break}case"video":s.push({id:Ke(),type:"video",x:r.x-o.props.w/2,y:r.y-o.props.h/2,opacity:1,props:{assetId:o.id,w:o.props.w,h:o.props.h}}),r.x+=o.props.w}t.batch(()=>{const o=e.filter(c=>!t.getAsset(c.id));o.length&&t.createAssets(o),t.createShapes(s).select(...s.map(c=>c.id));const{viewportPageBounds:i}=t;let{selectionPageBounds:a}=t;if(a){const c=a.center.sub(n);t.updateShapes(s.map(l=>({id:l.id,type:l.type,x:l.x-c.x,y:l.y-c.y})))}a=t.selectionPageBounds,a&&!i.contains(a)&&t.zoomToSelection()})}const ff=(t,e)=>{const[n,r]=S.useState(2);return S.useEffect(()=>{const{url:s,style:o="normal",weight:i="500",display:a,featureSettings:c,stretch:l,unicodeRange:u,variant:d}=e;let h=!1;r(2);const f={style:o,weight:i,display:a,featureSettings:c,stretch:l,unicodeRange:u,variant:d},p=new FontFace(t,`url(${s})`,f);return p.load().then(()=>{h||(document.fonts.add(p),r(0))}).catch(m=>{h||(console.error(m),r(1))}),p.$$_url=s,p.$$_fontface=`
@font-face {
	font-family: ${p.family};
	font-stretch: ${p.stretch};
	font-weight: ${p.weight};
	font-style: ${p.style};
	src: url("${s}") format("woff2")
}`,()=>{document.fonts.delete(p),h=!0}},[t,e]),n};function xie(t){return{draw:{url:t.fonts.draw},serif:{url:t.fonts.serif},sansSerif:{url:t.fonts.sansSerif},monospace:{url:t.fonts.monospace}}}function bie(t){const e=S.useMemo(()=>xie(t),[t]),n=[ff("tldraw_draw",e.draw),ff("tldraw_serif",e.serif),ff("tldraw_sans",e.sansSerif),ff("tldraw_mono",e.monospace)];return{error:n.some(r=>r===1),done:!n.some(r=>r===2)}}function Cie(t){const{children:e,...n}=t,r={initialState:"select",...n,components:S.useMemo(()=>({Scribble:JZ,SelectionForeground:rJ,SelectionBackground:eJ,Handles:GZ,HoveredShapeIndicator:YZ,...n.components}),[n.components]),shapeUtils:S.useMemo(()=>[...f5,...n.shapeUtils??[]],[n.shapeUtils]),tools:S.useMemo(()=>[...Qee,...mJ,...n.tools??[]],[n.tools])},s=_te(n.assetUrls),{done:o,error:i}=bie(s);return i?g.jsx(wH,{children:"Could not load assets. Please refresh the page."}):o?g.jsx(gH,{...r,children:g.jsxs(Uoe,{...r,children:[g.jsx(uie,{children:g.jsx(lx,{})}),e,g.jsx(_ie,{})]})}):g.jsx(B3,{children:"Loading assets..."})}function _ie(){return Sie(),null}Ce({tldrawFileFormatVersion:nj,schema:Ce({schemaVersion:jh,storeVersion:jh,recordVersions:Rw(fe,Ce({version:jh,subTypeVersions:Rw(fe,jh).optional(),subTypeKey:fe.optional()}))}),records:Yn(Ce({id:fe,typeName:fe}).allowUnknownProperties())});const Vr=()=>new Map,AS=t=>{const e=Vr();return t.forEach((n,r)=>{e.set(r,n)}),e},go=(t,e,n)=>{let r=t.get(e);return r===void 0&&t.set(e,r=n()),r},Eie=(t,e)=>{const n=[];for(const[r,s]of t)n.push(e(s,r));return n},Pie=(t,e)=>{for(const[n,r]of t)if(e(r,n))return!0;return!1},ga=()=>new Set,ev=t=>t[t.length-1],kie=(t,e)=>{for(let n=0;n<e.length;n++)t.push(e[n])},fi=Array.from,Iie=Array.isArray;class $b{constructor(){this._observers=Vr()}on(e,n){go(this._observers,e,ga).add(n)}once(e,n){const r=(...s)=>{this.off(e,r),n(...s)};this.on(e,r)}off(e,n){const r=this._observers.get(e);r!==void 0&&(r.delete(n),r.size===0&&this._observers.delete(e))}emit(e,n){return fi((this._observers.get(e)||Vr()).values()).forEach(r=>r(...n))}destroy(){this._observers=Vr()}}const no=Math.floor,gp=Math.abs,Tb=(t,e)=>t<e?t:e,Ra=(t,e)=>t>e?t:e,$ie=Math.pow,b4=t=>t!==0?t<0:1/t<0,Tie=String.fromCharCode,Aie=t=>t.toLowerCase(),Mie=/^\s*/g,Oie=t=>t.replace(Mie,""),Die=/([A-Z])/g,fk=(t,e)=>Oie(t.replace(Die,n=>`${e}${Aie(n)}`)),Rie=t=>{const e=unescape(encodeURIComponent(t)),n=e.length,r=new Uint8Array(n);for(let s=0;s<n;s++)r[s]=e.codePointAt(s);return r},md=typeof TextEncoder<"u"?new TextEncoder:null,Lie=t=>md.encode(t),jie=md?Lie:Rie;let _u=typeof TextDecoder>"u"?null:new TextDecoder("utf-8",{fatal:!0,ignoreBOM:!0});_u&&_u.decode(new Uint8Array).length===1&&(_u=null);const pk=t=>t===void 0?null:t;class Nie{constructor(){this.map=new Map}setItem(e,n){this.map.set(e,n)}getItem(e){return this.map.get(e)}}let C4=new Nie,Ab=!0;try{typeof localStorage<"u"&&(C4=localStorage,Ab=!1)}catch{}const _4=C4,zie=t=>Ab||addEventListener("storage",t),Fie=t=>Ab||removeEventListener("storage",t),Bie=Object.assign,Uie=Object.keys,Hie=(t,e)=>{for(const n in t)e(t[n],n)},Kie=(t,e)=>{const n=[];for(const r in t)n.push(e(t[r],r));return n},Og=t=>Uie(t).length,Vie=t=>{for(const e in t)return!1;return!0},Wie=(t,e)=>{for(const n in t)if(!e(t[n],n))return!1;return!0},E4=(t,e)=>Object.prototype.hasOwnProperty.call(t,e),Gie=(t,e)=>t===e||Og(t)===Og(e)&&Wie(t,(n,r)=>(n!==void 0||E4(e,r))&&e[r]===n),Mb=(t,e,n=0)=>{try{for(;n<t.length;n++)t[n](...e)}finally{n<t.length&&Mb(t,e,n+1)}},Yie=t=>t,Xie=(t,e)=>t===e,Eu=(t,e)=>{if(t==null||e==null)return Xie(t,e);if(t.constructor!==e.constructor)return!1;if(t===e)return!0;switch(t.constructor){case ArrayBuffer:t=new Uint8Array(t),e=new Uint8Array(e);case Uint8Array:{if(t.byteLength!==e.byteLength)return!1;for(let n=0;n<t.length;n++)if(t[n]!==e[n])return!1;break}case Set:{if(t.size!==e.size)return!1;for(const n of t)if(!e.has(n))return!1;break}case Map:{if(t.size!==e.size)return!1;for(const n of t.keys())if(!e.has(n)||!Eu(t.get(n),e.get(n)))return!1;break}case Object:if(Og(t)!==Og(e))return!1;for(const n in t)if(!E4(t,n)||!Eu(t[n],e[n]))return!1;break;case Array:if(t.length!==e.length)return!1;for(let n=0;n<t.length;n++)if(!Eu(t[n],e[n]))return!1;break;default:return!1}return!0},qie=(t,e)=>e.includes(t),Zc=typeof process<"u"&&process.release&&/node|io\.js/.test(process.release.name),P4=typeof window<"u"&&typeof document<"u"&&!Zc;let Zr;const Qie=()=>{if(Zr===void 0)if(Zc){Zr=Vr();const t=process.argv;let e=null;for(let n=0;n<t.length;n++){const r=t[n];r[0]==="-"?(e!==null&&Zr.set(e,""),e=r):e!==null&&(Zr.set(e,r),e=null)}e!==null&&Zr.set(e,"")}else typeof location=="object"?(Zr=Vr(),(location.search||"?").slice(1).split("&").forEach(t=>{if(t.length!==0){const[e,n]=t.split("=");Zr.set(`--${fk(e,"-")}`,n),Zr.set(`-${fk(e,"-")}`,n)}})):Zr=Vr();return Zr},MS=t=>Qie().has(t),OS=t=>pk(Zc?process.env[t.toUpperCase()]:_4.getItem(t)),Zie=t=>MS("--"+t)||OS(t)!==null;Zie("production");const gk=Zc&&qie({}.FORCE_COLOR,["true","1","2"]),Jie=!MS("no-colors")&&(!Zc||process.stdout.isTTY||gk)&&(!Zc||MS("color")||gk||OS("COLORTERM")!==null||(OS("TERM")||"").includes("color")),mk=1,yk=2,tv=4,nv=8,yd=32,Ys=64,qn=128,Um=31,DS=63,ra=127,eae=2147483647,k4=Number.MAX_SAFE_INTEGER,tae=Number.isInteger||(t=>typeof t=="number"&&isFinite(t)&&no(t)===t),pi=t=>new Error(t),ls=()=>{throw pi("Method unimplemented")},vs=()=>{throw pi("Unexpected case")},I4=pi("Unexpected end of array"),$4=pi("Integer out of Range");class Hm{constructor(e){this.arr=e,this.pos=0}}const Pi=t=>new Hm(t),nae=t=>t.pos!==t.arr.length,rae=(t,e)=>{const n=Rb(t.arr.buffer,t.pos+t.arr.byteOffset,e);return t.pos+=e,n},Gt=t=>rae(t,ge(t)),Jc=t=>t.arr[t.pos++],ge=t=>{let e=0,n=1;const r=t.arr.length;for(;t.pos<r;){const s=t.arr[t.pos++];if(e=e+(s&ra)*n,n*=128,s<qn)return e;if(e>k4)throw $4}throw I4},Ob=t=>{let e=t.arr[t.pos++],n=e&DS,r=64;const s=(e&Ys)>0?-1:1;if(!(e&qn))return s*n;const o=t.arr.length;for(;t.pos<o;){if(e=t.arr[t.pos++],n=n+(e&ra)*r,r*=128,e<qn)return s*n;if(n>k4)throw $4}throw I4},sae=t=>{let e=ge(t);if(e===0)return"";{let n=String.fromCodePoint(Jc(t));if(--e<100)for(;e--;)n+=String.fromCodePoint(Jc(t));else for(;e>0;){const r=e<1e4?e:1e4,s=t.arr.subarray(t.pos,t.pos+r);t.pos+=r,n+=String.fromCodePoint.apply(null,s),e-=r}return decodeURIComponent(escape(n))}},oae=t=>_u.decode(Gt(t)),ni=_u?oae:sae,Db=(t,e)=>{const n=new DataView(t.arr.buffer,t.arr.byteOffset+t.pos,e);return t.pos+=e,n},iae=t=>Db(t,4).getFloat32(0,!1),aae=t=>Db(t,8).getFloat64(0,!1),cae=t=>Db(t,8).getBigInt64(0,!1),lae=[t=>{},t=>null,Ob,iae,aae,cae,t=>!1,t=>!0,ni,t=>{const e=ge(t),n={};for(let r=0;r<e;r++){const s=ni(t);n[s]=vd(t)}return n},t=>{const e=ge(t),n=[];for(let r=0;r<e;r++)n.push(vd(t));return n},Gt],vd=t=>lae[127-Jc(t)](t);class vk extends Hm{constructor(e,n){super(e),this.reader=n,this.s=null,this.count=0}read(){return this.count===0&&(this.s=this.reader(this),nae(this)?this.count=ge(this)+1:this.count=-1),this.count--,this.s}}class mp extends Hm{constructor(e){super(e),this.s=0,this.count=0}read(){if(this.count===0){this.s=Ob(this);const e=b4(this.s);this.count=1,e&&(this.s=-this.s,this.count=ge(this)+2)}return this.count--,this.s}}class rv extends Hm{constructor(e){super(e),this.s=0,this.count=0,this.diff=0}read(){if(this.count===0){const e=Ob(this),n=e&1;this.diff=no(e/2),this.count=1,n&&(this.count=ge(this)+2)}return this.s+=this.diff,this.count--,this.s}}class uae{constructor(e){this.decoder=new mp(e),this.str=ni(this.decoder),this.spos=0}read(){const e=this.spos+this.decoder.read(),n=this.str.slice(this.spos,e);return this.spos=e,n}}const T4=t=>new Uint8Array(t),Rb=(t,e,n)=>new Uint8Array(t,e,n),dae=t=>new Uint8Array(t),hae=t=>{let e="";for(let n=0;n<t.byteLength;n++)e+=Tie(t[n]);return btoa(e)},fae=t=>Buffer.from(t.buffer,t.byteOffset,t.byteLength).toString("base64"),pae=t=>{const e=atob(t),n=T4(e.length);for(let r=0;r<e.length;r++)n[r]=e.charCodeAt(r);return n},gae=t=>{const e=Buffer.from(t,"base64");return new Uint8Array(e.buffer,e.byteOffset,e.byteLength)},mae=P4?hae:fae,yae=P4?pae:gae,vae=t=>{const e=T4(t.byteLength);return e.set(t),e};class eh{constructor(){this.cpos=0,this.cbuf=new Uint8Array(100),this.bufs=[]}}const Xt=()=>new eh,Lb=t=>{let e=t.cpos;for(let n=0;n<t.bufs.length;n++)e+=t.bufs[n].length;return e},rt=t=>{const e=new Uint8Array(Lb(t));let n=0;for(let r=0;r<t.bufs.length;r++){const s=t.bufs[r];e.set(s,n),n+=s.length}return e.set(Rb(t.cbuf.buffer,0,t.cpos),n),e},wae=(t,e)=>{const n=t.cbuf.length;n-t.cpos<e&&(t.bufs.push(Rb(t.cbuf.buffer,0,t.cpos)),t.cbuf=new Uint8Array(Ra(n,e)*2),t.cpos=0)},_t=(t,e)=>{const n=t.cbuf.length;t.cpos===n&&(t.bufs.push(t.cbuf),t.cbuf=new Uint8Array(n*2),t.cpos=0),t.cbuf[t.cpos++]=e},RS=_t,ie=(t,e)=>{for(;e>ra;)_t(t,qn|ra&e),e=no(e/128);_t(t,ra&e)},jb=(t,e)=>{const n=b4(e);for(n&&(e=-e),_t(t,(e>DS?qn:0)|(n?Ys:0)|DS&e),e=no(e/64);e>0;)_t(t,(e>ra?qn:0)|ra&e),e=no(e/128)},LS=new Uint8Array(3e4),Sae=LS.length/3,xae=(t,e)=>{if(e.length<Sae){const n=md.encodeInto(e,LS).written||0;ie(t,n);for(let r=0;r<n;r++)_t(t,LS[r])}else pt(t,jie(e))},bae=(t,e)=>{const n=unescape(encodeURIComponent(e)),r=n.length;ie(t,r);for(let s=0;s<r;s++)_t(t,n.codePointAt(s))},sa=md&&md.encodeInto?xae:bae,Km=(t,e)=>{const n=t.cbuf.length,r=t.cpos,s=Tb(n-r,e.length),o=e.length-s;t.cbuf.set(e.subarray(0,s),r),t.cpos+=s,o>0&&(t.bufs.push(t.cbuf),t.cbuf=new Uint8Array(Ra(n*2,o)),t.cbuf.set(e.subarray(s)),t.cpos=o)},pt=(t,e)=>{ie(t,e.byteLength),Km(t,e)},Nb=(t,e)=>{wae(t,e);const n=new DataView(t.cbuf.buffer,t.cpos,e);return t.cpos+=e,n},Cae=(t,e)=>Nb(t,4).setFloat32(0,e,!1),_ae=(t,e)=>Nb(t,8).setFloat64(0,e,!1),Eae=(t,e)=>Nb(t,8).setBigInt64(0,e,!1),wk=new DataView(new ArrayBuffer(4)),Pae=t=>(wk.setFloat32(0,t),wk.getFloat32(0)===t),wd=(t,e)=>{switch(typeof e){case"string":_t(t,119),sa(t,e);break;case"number":tae(e)&&gp(e)<=eae?(_t(t,125),jb(t,e)):Pae(e)?(_t(t,124),Cae(t,e)):(_t(t,123),_ae(t,e));break;case"bigint":_t(t,122),Eae(t,e);break;case"object":if(e===null)_t(t,126);else if(Iie(e)){_t(t,117),ie(t,e.length);for(let n=0;n<e.length;n++)wd(t,e[n])}else if(e instanceof Uint8Array)_t(t,116),pt(t,e);else{_t(t,118);const n=Object.keys(e);ie(t,n.length);for(let r=0;r<n.length;r++){const s=n[r];sa(t,s),wd(t,e[s])}}break;case"boolean":_t(t,e?120:121);break;default:_t(t,127)}};class Sk extends eh{constructor(e){super(),this.w=e,this.s=null,this.count=0}write(e){this.s===e?this.count++:(this.count>0&&ie(this,this.count-1),this.count=1,this.w(this,e),this.s=e)}}const xk=t=>{t.count>0&&(jb(t.encoder,t.count===1?t.s:-t.s),t.count>1&&ie(t.encoder,t.count-2))};class yp{constructor(){this.encoder=new eh,this.s=0,this.count=0}write(e){this.s===e?this.count++:(xk(this),this.count=1,this.s=e)}toUint8Array(){return xk(this),rt(this.encoder)}}const bk=t=>{if(t.count>0){const e=t.diff*2+(t.count===1?0:1);jb(t.encoder,e),t.count>1&&ie(t.encoder,t.count-2)}};class sv{constructor(){this.encoder=new eh,this.s=0,this.count=0,this.diff=0}write(e){this.diff===e-this.s?(this.s=e,this.count++):(bk(this),this.count=1,this.diff=e-this.s,this.s=e)}toUint8Array(){return bk(this),rt(this.encoder)}}class kae{constructor(){this.sarr=[],this.s="",this.lensE=new yp}write(e){this.s+=e,this.s.length>19&&(this.sarr.push(this.s),this.s=""),this.lensE.write(e.length)}toUint8Array(){const e=new eh;return this.sarr.push(this.s),this.s="",sa(e,this.sarr.join("")),Km(e,this.lensE.toUint8Array()),rt(e)}}const Iae=crypto.getRandomValues.bind(crypto),A4=()=>Iae(new Uint32Array(1))[0],$ae=[1e7]+-1e3+-4e3+-8e3+-1e11,Tae=()=>$ae.replace(/[018]/g,t=>(t^A4()&15>>t/4).toString(16)),ma=Date.now,Ck=t=>new Promise(t);Promise.all.bind(Promise);class Aae{constructor(e,n){this.left=e,this.right=n}}const Is=(t,e)=>new Aae(t,e);typeof DOMParser<"u"&&new DOMParser;const Mae=t=>Eie(t,(e,n)=>`${n}:${e};`).join(""),mo=Symbol,M4=mo(),O4=mo(),Oae=mo(),Dae=mo(),Rae=mo(),D4=mo(),Lae=mo(),R4=mo(),jae=mo(),Nae=t=>{const e=[];let n=0;for(;n<t.length;n++){const r=t[n];r.constructor===String||r.constructor===Number||r.constructor===Object&&e.push(JSON.stringify(r))}return e},zae={[M4]:Is("font-weight","bold"),[O4]:Is("font-weight","normal"),[Oae]:Is("color","blue"),[Rae]:Is("color","green"),[Dae]:Is("color","grey"),[D4]:Is("color","red"),[Lae]:Is("color","purple"),[R4]:Is("color","orange"),[jae]:Is("color","black")},Fae=t=>{const e=[],n=[],r=Vr();let s=[],o=0;for(;o<t.length;o++){const i=t[o],a=zae[i];if(a!==void 0)r.set(a.left,a.right);else if(i.constructor===String||i.constructor===Number){const c=Mae(r);o>0||c.length>0?(e.push("%c"+i),n.push(c)):e.push(i)}else break}for(o>0&&(s=n,s.unshift(e.join("")));o<t.length;o++){const i=t[o];i instanceof Symbol||s.push(i)}return s},Bae=Jie?Fae:Nae,Uae=(...t)=>{console.log(...Bae(t)),Hae.forEach(e=>e.print(t))},Hae=ga(),L4=t=>({[Symbol.iterator](){return this},next:t}),Kae=(t,e)=>L4(()=>{let n;do n=t.next();while(!n.done&&!e(n.value));return n}),ov=(t,e)=>L4(()=>{const{done:n,value:r}=t.next();return{done:n,value:n?void 0:e(r)}});class zb{constructor(e,n){this.clock=e,this.len=n}}class th{constructor(){this.clients=new Map}}const j4=(t,e,n)=>e.clients.forEach((r,s)=>{const o=t.doc.store.clients.get(s);for(let i=0;i<r.length;i++){const a=r[i];q4(t,o,a.clock,a.len,n)}}),Vae=(t,e)=>{let n=0,r=t.length-1;for(;n<=r;){const s=no((n+r)/2),o=t[s],i=o.clock;if(i<=e){if(e<i+o.len)return s;n=s+1}else r=s-1}return null},N4=(t,e)=>{const n=t.clients.get(e.client);return n!==void 0&&Vae(n,e.clock)!==null},Fb=t=>{t.clients.forEach(e=>{e.sort((s,o)=>s.clock-o.clock);let n,r;for(n=1,r=1;n<e.length;n++){const s=e[r-1],o=e[n];s.clock+s.len>=o.clock?s.len=Ra(s.len,o.clock+o.len-s.clock):(r<n&&(e[r]=o),r++)}e.length=r})},Wae=t=>{const e=new th;for(let n=0;n<t.length;n++)t[n].clients.forEach((r,s)=>{if(!e.clients.has(s)){const o=r.slice();for(let i=n+1;i<t.length;i++)kie(o,t[i].clients.get(s)||[]);e.clients.set(s,o)}});return Fb(e),e},Dg=(t,e,n,r)=>{go(t.clients,e,()=>[]).push(new zb(n,r))},Gae=()=>new th,Yae=t=>{const e=Gae();return t.clients.forEach((n,r)=>{const s=[];for(let o=0;o<n.length;o++){const i=n[o];if(i.deleted){const a=i.id.clock;let c=i.length;if(o+1<n.length)for(let l=n[o+1];o+1<n.length&&l.deleted;l=n[++o+1])c+=l.length;s.push(new zb(a,c))}}s.length>0&&e.clients.set(r,s)}),e},Sl=(t,e)=>{ie(t.restEncoder,e.clients.size),fi(e.clients.entries()).sort((n,r)=>r[0]-n[0]).forEach(([n,r])=>{t.resetDsCurVal(),ie(t.restEncoder,n);const s=r.length;ie(t.restEncoder,s);for(let o=0;o<s;o++){const i=r[o];t.writeDsClock(i.clock),t.writeDsLen(i.len)}})},Bb=t=>{const e=new th,n=ge(t.restDecoder);for(let r=0;r<n;r++){t.resetDsCurVal();const s=ge(t.restDecoder),o=ge(t.restDecoder);if(o>0){const i=go(e.clients,s,()=>[]);for(let a=0;a<o;a++)i.push(new zb(t.readDsClock(),t.readDsLen()))}}return e},_k=(t,e,n)=>{const r=new th,s=ge(t.restDecoder);for(let o=0;o<s;o++){t.resetDsCurVal();const i=ge(t.restDecoder),a=ge(t.restDecoder),c=n.clients.get(i)||[],l=Pt(n,i);for(let u=0;u<a;u++){const d=t.readDsClock(),h=d+t.readDsLen();if(d<l){l<h&&Dg(r,i,l,h-l);let f=ws(c,d),p=c[f];for(!p.deleted&&p.id.clock<d&&(c.splice(f+1,0,Bg(e,p,d-p.id.clock)),f++);f<c.length&&(p=c[f++],p.id.clock<h);)p.deleted||(h<p.id.clock+p.length&&c.splice(f,0,Bg(e,p,h-p.id.clock)),p.delete(e))}else Dg(r,i,d,h-d)}}if(r.clients.size>0){const o=new ya;return ie(o.restEncoder,0),Sl(o,r),o.toUint8Array()}return null},z4=A4;class xl extends $b{constructor({guid:e=Tae(),collectionid:n=null,gc:r=!0,gcFilter:s=()=>!0,meta:o=null,autoLoad:i=!1,shouldLoad:a=!0}={}){super(),this.gc=r,this.gcFilter=s,this.clientID=z4(),this.guid=e,this.collectionid=n,this.share=new Map,this.store=new Y4,this._transaction=null,this._transactionCleanups=[],this.subdocs=new Set,this._item=null,this.shouldLoad=a,this.autoLoad=i,this.meta=o,this.isLoaded=!1,this.isSynced=!1,this.whenLoaded=Ck(l=>{this.on("load",()=>{this.isLoaded=!0,l(this)})});const c=()=>Ck(l=>{const u=d=>{(d===void 0||d===!0)&&(this.off("sync",u),l())};this.on("sync",u)});this.on("sync",l=>{l===!1&&this.isSynced&&(this.whenSynced=c()),this.isSynced=l===void 0||l===!0,this.isLoaded||this.emit("load",[])}),this.whenSynced=c()}load(){const e=this._item;e!==null&&!this.shouldLoad&&Ne(e.parent.doc,n=>{n.subdocsLoaded.add(this)},null,!0),this.shouldLoad=!0}getSubdocs(){return this.subdocs}getSubdocGuids(){return new Set(fi(this.subdocs).map(e=>e.guid))}transact(e,n=null){return Ne(this,e,n)}get(e,n=Ut){const r=go(this.share,e,()=>{const o=new n;return o._integrate(this,null),o}),s=r.constructor;if(n!==Ut&&s!==n)if(s===Ut){const o=new n;o._map=r._map,r._map.forEach(i=>{for(;i!==null;i=i.left)i.parent=o}),o._start=r._start;for(let i=o._start;i!==null;i=i.right)i.parent=o;return o._length=r._length,this.share.set(e,o),o._integrate(this,null),o}else throw new Error(`Type with the name ${e} has already been defined with a different constructor`);return r}getArray(e=""){return this.get(e,Dc)}getText(e=""){return this.get(e,nl)}getMap(e=""){return this.get(e,tl)}getXmlFragment(e=""){return this.get(e,va)}toJSON(){const e={};return this.share.forEach((n,r)=>{e[r]=n.toJSON()}),e}destroy(){fi(this.subdocs).forEach(n=>n.destroy());const e=this._item;if(e!==null){this._item=null;const n=e.content;n.doc=new xl({guid:this.guid,...n.opts,shouldLoad:!1}),n.doc._item=e,Ne(e.parent.doc,r=>{const s=n.doc;e.deleted||r.subdocsAdded.add(s),r.subdocsRemoved.add(this)},null,!0)}this.emit("destroyed",[!0]),this.emit("destroy",[this]),super.destroy()}on(e,n){super.on(e,n)}off(e,n){super.off(e,n)}}class F4{constructor(e){this.restDecoder=e}resetDsCurVal(){}readDsClock(){return ge(this.restDecoder)}readDsLen(){return ge(this.restDecoder)}}class B4 extends F4{readLeftID(){return xe(ge(this.restDecoder),ge(this.restDecoder))}readRightID(){return xe(ge(this.restDecoder),ge(this.restDecoder))}readClient(){return ge(this.restDecoder)}readInfo(){return Jc(this.restDecoder)}readString(){return ni(this.restDecoder)}readParentInfo(){return ge(this.restDecoder)===1}readTypeRef(){return ge(this.restDecoder)}readLen(){return ge(this.restDecoder)}readAny(){return vd(this.restDecoder)}readBuf(){return vae(Gt(this.restDecoder))}readJSON(){return JSON.parse(ni(this.restDecoder))}readKey(){return ni(this.restDecoder)}}class Xae{constructor(e){this.dsCurrVal=0,this.restDecoder=e}resetDsCurVal(){this.dsCurrVal=0}readDsClock(){return this.dsCurrVal+=ge(this.restDecoder),this.dsCurrVal}readDsLen(){const e=ge(this.restDecoder)+1;return this.dsCurrVal+=e,e}}class el extends Xae{constructor(e){super(e),this.keys=[],ge(e),this.keyClockDecoder=new rv(Gt(e)),this.clientDecoder=new mp(Gt(e)),this.leftClockDecoder=new rv(Gt(e)),this.rightClockDecoder=new rv(Gt(e)),this.infoDecoder=new vk(Gt(e),Jc),this.stringDecoder=new uae(Gt(e)),this.parentInfoDecoder=new vk(Gt(e),Jc),this.typeRefDecoder=new mp(Gt(e)),this.lenDecoder=new mp(Gt(e))}readLeftID(){return new Oc(this.clientDecoder.read(),this.leftClockDecoder.read())}readRightID(){return new Oc(this.clientDecoder.read(),this.rightClockDecoder.read())}readClient(){return this.clientDecoder.read()}readInfo(){return this.infoDecoder.read()}readString(){return this.stringDecoder.read()}readParentInfo(){return this.parentInfoDecoder.read()===1}readTypeRef(){return this.typeRefDecoder.read()}readLen(){return this.lenDecoder.read()}readAny(){return vd(this.restDecoder)}readBuf(){return Gt(this.restDecoder)}readJSON(){return vd(this.restDecoder)}readKey(){const e=this.keyClockDecoder.read();if(e<this.keys.length)return this.keys[e];{const n=this.stringDecoder.read();return this.keys.push(n),n}}}class U4{constructor(){this.restEncoder=Xt()}toUint8Array(){return rt(this.restEncoder)}resetDsCurVal(){}writeDsClock(e){ie(this.restEncoder,e)}writeDsLen(e){ie(this.restEncoder,e)}}class nh extends U4{writeLeftID(e){ie(this.restEncoder,e.client),ie(this.restEncoder,e.clock)}writeRightID(e){ie(this.restEncoder,e.client),ie(this.restEncoder,e.clock)}writeClient(e){ie(this.restEncoder,e)}writeInfo(e){RS(this.restEncoder,e)}writeString(e){sa(this.restEncoder,e)}writeParentInfo(e){ie(this.restEncoder,e?1:0)}writeTypeRef(e){ie(this.restEncoder,e)}writeLen(e){ie(this.restEncoder,e)}writeAny(e){wd(this.restEncoder,e)}writeBuf(e){pt(this.restEncoder,e)}writeJSON(e){sa(this.restEncoder,JSON.stringify(e))}writeKey(e){sa(this.restEncoder,e)}}class H4{constructor(){this.restEncoder=Xt(),this.dsCurrVal=0}toUint8Array(){return rt(this.restEncoder)}resetDsCurVal(){this.dsCurrVal=0}writeDsClock(e){const n=e-this.dsCurrVal;this.dsCurrVal=e,ie(this.restEncoder,n)}writeDsLen(e){e===0&&vs(),ie(this.restEncoder,e-1),this.dsCurrVal+=e}}class ya extends H4{constructor(){super(),this.keyMap=new Map,this.keyClock=0,this.keyClockEncoder=new sv,this.clientEncoder=new yp,this.leftClockEncoder=new sv,this.rightClockEncoder=new sv,this.infoEncoder=new Sk(RS),this.stringEncoder=new kae,this.parentInfoEncoder=new Sk(RS),this.typeRefEncoder=new yp,this.lenEncoder=new yp}toUint8Array(){const e=Xt();return ie(e,0),pt(e,this.keyClockEncoder.toUint8Array()),pt(e,this.clientEncoder.toUint8Array()),pt(e,this.leftClockEncoder.toUint8Array()),pt(e,this.rightClockEncoder.toUint8Array()),pt(e,rt(this.infoEncoder)),pt(e,this.stringEncoder.toUint8Array()),pt(e,rt(this.parentInfoEncoder)),pt(e,this.typeRefEncoder.toUint8Array()),pt(e,this.lenEncoder.toUint8Array()),Km(e,rt(this.restEncoder)),rt(e)}writeLeftID(e){this.clientEncoder.write(e.client),this.leftClockEncoder.write(e.clock)}writeRightID(e){this.clientEncoder.write(e.client),this.rightClockEncoder.write(e.clock)}writeClient(e){this.clientEncoder.write(e)}writeInfo(e){this.infoEncoder.write(e)}writeString(e){this.stringEncoder.write(e)}writeParentInfo(e){this.parentInfoEncoder.write(e?1:0)}writeTypeRef(e){this.typeRefEncoder.write(e)}writeLen(e){this.lenEncoder.write(e)}writeAny(e){wd(this.restEncoder,e)}writeBuf(e){pt(this.restEncoder,e)}writeJSON(e){wd(this.restEncoder,e)}writeKey(e){const n=this.keyMap.get(e);n===void 0?(this.keyClockEncoder.write(this.keyClock++),this.stringEncoder.write(e)):this.keyClockEncoder.write(n)}}const qae=(t,e,n,r)=>{r=Ra(r,e[0].id.clock);const s=ws(e,r);ie(t.restEncoder,e.length-s),t.writeClient(n),ie(t.restEncoder,r);const o=e[s];o.write(t,r-o.id.clock);for(let i=s+1;i<e.length;i++)e[i].write(t,0)},Ub=(t,e,n)=>{const r=new Map;n.forEach((s,o)=>{Pt(e,o)>s&&r.set(o,s)}),Vm(e).forEach((s,o)=>{n.has(o)||r.set(o,0)}),ie(t.restEncoder,r.size),fi(r.entries()).sort((s,o)=>o[0]-s[0]).forEach(([s,o])=>{qae(t,e.clients.get(s),s,o)})},Qae=(t,e)=>{const n=Vr(),r=ge(t.restDecoder);for(let s=0;s<r;s++){const o=ge(t.restDecoder),i=new Array(o),a=t.readClient();let c=ge(t.restDecoder);n.set(a,{i:0,refs:i});for(let l=0;l<o;l++){const u=t.readInfo();switch(Um&u){case 0:{const d=t.readLen();i[l]=new pr(xe(a,c),d),c+=d;break}case 10:{const d=ge(t.restDecoder);i[l]=new gr(xe(a,c),d),c+=d;break}default:{const d=(u&(Ys|qn))===0,h=new St(xe(a,c),null,(u&qn)===qn?t.readLeftID():null,null,(u&Ys)===Ys?t.readRightID():null,d?t.readParentInfo()?e.get(t.readString()):t.readLeftID():null,d&&(u&yd)===yd?t.readString():null,g6(t,u));i[l]=h,c+=h.length}}}}return n},Zae=(t,e,n)=>{const r=[];let s=fi(n.keys()).sort((f,p)=>f-p);if(s.length===0)return null;const o=()=>{if(s.length===0)return null;let f=n.get(s[s.length-1]);for(;f.refs.length===f.i;)if(s.pop(),s.length>0)f=n.get(s[s.length-1]);else return null;return f};let i=o();if(i===null&&r.length===0)return null;const a=new Y4,c=new Map,l=(f,p)=>{const m=c.get(f);(m==null||m>p)&&c.set(f,p)};let u=i.refs[i.i++];const d=new Map,h=()=>{for(const f of r){const p=f.id.client,m=n.get(p);m?(m.i--,a.clients.set(p,m.refs.slice(m.i)),n.delete(p),m.i=0,m.refs=[]):a.clients.set(p,[f]),s=s.filter(v=>v!==p)}r.length=0};for(;;){if(u.constructor!==gr){const p=go(d,u.id.client,()=>Pt(e,u.id.client))-u.id.clock;if(p<0)r.push(u),l(u.id.client,u.id.clock-1),h();else{const m=u.getMissing(t,e);if(m!==null){r.push(u);const v=n.get(m)||{refs:[],i:0};if(v.refs.length===v.i)l(m,Pt(e,m)),h();else{u=v.refs[v.i++];continue}}else(p===0||p<u.length)&&(u.integrate(t,p),d.set(u.id.client,u.id.clock+u.length))}}if(r.length>0)u=r.pop();else if(i!==null&&i.i<i.refs.length)u=i.refs[i.i++];else{if(i=o(),i===null)break;u=i.refs[i.i++]}}if(a.clients.size>0){const f=new ya;return Ub(f,a,new Map),ie(f.restEncoder,0),{missing:c,update:f.toUint8Array()}}return null},Jae=(t,e)=>Ub(t,e.doc.store,e.beforeState),ece=(t,e,n,r=new el(t))=>Ne(e,s=>{s.local=!1;let o=!1;const i=s.doc,a=i.store,c=Qae(r,i),l=Zae(s,a,c),u=a.pendingStructs;if(u){for(const[h,f]of u.missing)if(f<Pt(a,h)){o=!0;break}if(l){for(const[h,f]of l.missing){const p=u.missing.get(h);(p==null||p>f)&&u.missing.set(h,f)}u.update=Rg([u.update,l.update])}}else a.pendingStructs=l;const d=_k(r,s,a);if(a.pendingDs){const h=new el(Pi(a.pendingDs));ge(h.restDecoder);const f=_k(h,s,a);d&&f?a.pendingDs=Rg([d,f]):a.pendingDs=d||f}else a.pendingDs=d;if(o){const h=a.pendingStructs.update;a.pendingStructs=null,K4(s.doc,h)}},n,!1),K4=(t,e,n,r=el)=>{const s=Pi(e);ece(s,t,n,new r(s))},tce=(t,e,n)=>K4(t,e,n,B4),nce=(t,e,n=new Map)=>{Ub(t,e.store,n),Sl(t,Yae(e.store))},rce=(t,e=new Uint8Array([0]),n=new ya)=>{const r=V4(e);nce(n,t,r);const s=[n.toUint8Array()];if(t.store.pendingDs&&s.push(t.store.pendingDs),t.store.pendingStructs&&s.push(wce(t.store.pendingStructs.update,e)),s.length>1){if(n.constructor===nh)return yce(s.map((o,i)=>i===0?o:xce(o)));if(n.constructor===ya)return Rg(s)}return s[0]},sce=(t,e)=>rce(t,e,new nh),oce=t=>{const e=new Map,n=ge(t.restDecoder);for(let r=0;r<n;r++){const s=ge(t.restDecoder),o=ge(t.restDecoder);e.set(s,o)}return e},V4=t=>oce(new F4(Pi(t))),W4=(t,e)=>(ie(t.restEncoder,e.size),fi(e.entries()).sort((n,r)=>r[0]-n[0]).forEach(([n,r])=>{ie(t.restEncoder,n),ie(t.restEncoder,r)}),t),ice=(t,e)=>W4(t,Vm(e.store)),ace=(t,e=new H4)=>(t instanceof Map?W4(e,t):ice(e,t),e.toUint8Array()),cce=t=>ace(t,new U4);class lce{constructor(){this.l=[]}}const Ek=()=>new lce,Pk=(t,e)=>t.l.push(e),kk=(t,e)=>{const n=t.l,r=n.length;t.l=n.filter(s=>e!==s),r===t.l.length&&console.error("[yjs] Tried to remove event handler that doesn't exist.")},G4=(t,e,n)=>Mb(t.l,[e,n]);class Oc{constructor(e,n){this.client=e,this.clock=n}}const pf=(t,e)=>t===e||t!==null&&e!==null&&t.client===e.client&&t.clock===e.clock,xe=(t,e)=>new Oc(t,e),uce=t=>{for(const[e,n]of t.doc.share.entries())if(n===t)return e;throw vs()},Zl=(t,e)=>e===void 0?!t.deleted:e.sv.has(t.id.client)&&(e.sv.get(t.id.client)||0)>t.id.clock&&!N4(e.ds,t.id),jS=(t,e)=>{const n=go(t.meta,jS,ga),r=t.doc.store;n.has(e)||(e.sv.forEach((s,o)=>{s<Pt(r,o)&&gi(t,xe(o,s))}),j4(t,e.ds,s=>{}),n.add(e))};class Y4{constructor(){this.clients=new Map,this.pendingStructs=null,this.pendingDs=null}}const Vm=t=>{const e=new Map;return t.clients.forEach((n,r)=>{const s=n[n.length-1];e.set(r,s.id.clock+s.length)}),e},Pt=(t,e)=>{const n=t.clients.get(e);if(n===void 0)return 0;const r=n[n.length-1];return r.id.clock+r.length},X4=(t,e)=>{let n=t.clients.get(e.id.client);if(n===void 0)n=[],t.clients.set(e.id.client,n);else{const r=n[n.length-1];if(r.id.clock+r.length!==e.id.clock)throw vs()}n.push(e)},ws=(t,e)=>{let n=0,r=t.length-1,s=t[r],o=s.id.clock;if(o===e)return r;let i=no(e/(o+s.length-1)*r);for(;n<=r;){if(s=t[i],o=s.id.clock,o<=e){if(e<o+s.length)return i;n=i+1}else r=i-1;i=no((n+r)/2)}throw vs()},dce=(t,e)=>{const n=t.clients.get(e.client);return n[ws(n,e.clock)]},iv=dce,NS=(t,e,n)=>{const r=ws(e,n),s=e[r];return s.id.clock<n&&s instanceof St?(e.splice(r+1,0,Bg(t,s,n-s.id.clock)),r+1):r},gi=(t,e)=>{const n=t.doc.store.clients.get(e.client);return n[NS(t,n,e.clock)]},Ik=(t,e,n)=>{const r=e.clients.get(n.client),s=ws(r,n.clock),o=r[s];return n.clock!==o.id.clock+o.length-1&&o.constructor!==pr&&r.splice(s+1,0,Bg(t,o,n.clock-o.id.clock+1)),o},hce=(t,e,n)=>{const r=t.clients.get(e.id.client);r[ws(r,e.id.clock)]=n},q4=(t,e,n,r,s)=>{if(r===0)return;const o=n+r;let i=NS(t,e,n),a;do a=e[i++],o<a.id.clock+a.length&&NS(t,e,o),s(a);while(i<e.length&&e[i].id.clock<o)};class fce{constructor(e,n,r){this.doc=e,this.deleteSet=new th,this.beforeState=Vm(e.store),this.afterState=new Map,this.changed=new Map,this.changedParentTypes=new Map,this._mergeStructs=[],this.origin=n,this.meta=new Map,this.local=r,this.subdocsAdded=new Set,this.subdocsRemoved=new Set,this.subdocsLoaded=new Set,this._needFormattingCleanup=!1}}const $k=(t,e)=>e.deleteSet.clients.size===0&&!Pie(e.afterState,(n,r)=>e.beforeState.get(r)!==n)?!1:(Fb(e.deleteSet),Jae(t,e),Sl(t,e.deleteSet),!0),Tk=(t,e,n)=>{const r=e._item;(r===null||r.id.clock<(t.beforeState.get(r.id.client)||0)&&!r.deleted)&&go(t.changed,e,ga).add(n)},vp=(t,e)=>{let n=t[e],r=t[e-1],s=e;for(;s>0;n=r,r=t[--s-1]){if(r.deleted===n.deleted&&r.constructor===n.constructor&&r.mergeWith(n)){n instanceof St&&n.parentSub!==null&&n.parent._map.get(n.parentSub)===n&&n.parent._map.set(n.parentSub,r);continue}break}const o=e-s;return o&&t.splice(e+1-o,o),o},pce=(t,e,n)=>{for(const[r,s]of t.clients.entries()){const o=e.clients.get(r);for(let i=s.length-1;i>=0;i--){const a=s[i],c=a.clock+a.len;for(let l=ws(o,a.clock),u=o[l];l<o.length&&u.id.clock<c;u=o[++l]){const d=o[l];if(a.clock+a.len<=d.id.clock)break;d instanceof St&&d.deleted&&!d.keep&&n(d)&&d.gc(e,!1)}}}},gce=(t,e)=>{t.clients.forEach((n,r)=>{const s=e.clients.get(r);for(let o=n.length-1;o>=0;o--){const i=n[o],a=Tb(s.length-1,1+ws(s,i.clock+i.len-1));for(let c=a,l=s[c];c>0&&l.id.clock>=i.clock;l=s[c])c-=1+vp(s,c)}})},Q4=(t,e)=>{if(e<t.length){const n=t[e],r=n.doc,s=r.store,o=n.deleteSet,i=n._mergeStructs;try{Fb(o),n.afterState=Vm(n.doc.store),r.emit("beforeObserverCalls",[n,r]);const a=[];n.changed.forEach((c,l)=>a.push(()=>{(l._item===null||!l._item.deleted)&&l._callObserver(n,c)})),a.push(()=>{n.changedParentTypes.forEach((c,l)=>{l._dEH.l.length>0&&(l._item===null||!l._item.deleted)&&(c=c.filter(u=>u.target._item===null||!u.target._item.deleted),c.forEach(u=>{u.currentTarget=l,u._path=null}),c.sort((u,d)=>u.path.length-d.path.length),G4(l._dEH,c,n))})}),a.push(()=>r.emit("afterTransaction",[n,r])),Mb(a,[]),n._needFormattingCleanup&&Dce(n)}finally{r.gc&&pce(o,s,r.gcFilter),gce(o,s),n.afterState.forEach((u,d)=>{const h=n.beforeState.get(d)||0;if(h!==u){const f=s.clients.get(d),p=Ra(ws(f,h),1);for(let m=f.length-1;m>=p;)m-=1+vp(f,m)}});for(let u=i.length-1;u>=0;u--){const{client:d,clock:h}=i[u].id,f=s.clients.get(d),p=ws(f,h);p+1<f.length&&vp(f,p+1)>1||p>0&&vp(f,p)}if(!n.local&&n.afterState.get(r.clientID)!==n.beforeState.get(r.clientID)&&(Uae(R4,M4,"[yjs] ",O4,D4,"Changed the client-id because another client seems to be using it."),r.clientID=z4()),r.emit("afterTransactionCleanup",[n,r]),r._observers.has("update")){const u=new nh;$k(u,n)&&r.emit("update",[u.toUint8Array(),n.origin,r,n])}if(r._observers.has("updateV2")){const u=new ya;$k(u,n)&&r.emit("updateV2",[u.toUint8Array(),n.origin,r,n])}const{subdocsAdded:a,subdocsLoaded:c,subdocsRemoved:l}=n;(a.size>0||l.size>0||c.size>0)&&(a.forEach(u=>{u.clientID=r.clientID,u.collectionid==null&&(u.collectionid=r.collectionid),r.subdocs.add(u)}),l.forEach(u=>r.subdocs.delete(u)),r.emit("subdocs",[{loaded:c,added:a,removed:l},r,n]),l.forEach(u=>u.destroy())),t.length<=e+1?(r._transactionCleanups=[],r.emit("afterAllTransactions",[r,t])):Q4(t,e+1)}}},Ne=(t,e,n=null,r=!0)=>{const s=t._transactionCleanups;let o=!1,i=null;t._transaction===null&&(o=!0,t._transaction=new fce(t,n,r),s.push(t._transaction),s.length===1&&t.emit("beforeAllTransactions",[t]),t.emit("beforeTransaction",[t._transaction,t]));try{i=e(t._transaction)}finally{if(o){const a=t._transaction===s[0];t._transaction=null,a&&Q4(s,0)}}return i};function*mce(t){const e=ge(t.restDecoder);for(let n=0;n<e;n++){const r=ge(t.restDecoder),s=t.readClient();let o=ge(t.restDecoder);for(let i=0;i<r;i++){const a=t.readInfo();if(a===10){const c=ge(t.restDecoder);yield new gr(xe(s,o),c),o+=c}else if(Um&a){const c=(a&(Ys|qn))===0,l=new St(xe(s,o),null,(a&qn)===qn?t.readLeftID():null,null,(a&Ys)===Ys?t.readRightID():null,c?t.readParentInfo()?t.readString():t.readLeftID():null,c&&(a&yd)===yd?t.readString():null,g6(t,a));yield l,o+=l.length}else{const c=t.readLen();yield new pr(xe(s,o),c),o+=c}}}}class Hb{constructor(e,n){this.gen=mce(e),this.curr=null,this.done=!1,this.filterSkips=n,this.next()}next(){do this.curr=this.gen.next().value||null;while(this.filterSkips&&this.curr!==null&&this.curr.constructor===gr);return this.curr}}class Kb{constructor(e){this.currClient=0,this.startClock=0,this.written=0,this.encoder=e,this.clientStructs=[]}}const yce=t=>Rg(t,B4,nh),vce=(t,e)=>{if(t.constructor===pr){const{client:n,clock:r}=t.id;return new pr(xe(n,r+e),t.length-e)}else if(t.constructor===gr){const{client:n,clock:r}=t.id;return new gr(xe(n,r+e),t.length-e)}else{const n=t,{client:r,clock:s}=n.id;return new St(xe(r,s+e),null,xe(r,s+e-1),null,n.rightOrigin,n.parent,n.parentSub,n.content.splice(e))}},Rg=(t,e=el,n=ya)=>{if(t.length===1)return t[0];const r=t.map(u=>new e(Pi(u)));let s=r.map(u=>new Hb(u,!0)),o=null;const i=new n,a=new Kb(i);for(;s=s.filter(h=>h.curr!==null),s.sort((h,f)=>{if(h.curr.id.client===f.curr.id.client){const p=h.curr.id.clock-f.curr.id.clock;return p===0?h.curr.constructor===f.curr.constructor?0:h.curr.constructor===gr?1:-1:p}else return f.curr.id.client-h.curr.id.client}),s.length!==0;){const u=s[0],d=u.curr.id.client;if(o!==null){let h=u.curr,f=!1;for(;h!==null&&h.id.clock+h.length<=o.struct.id.clock+o.struct.length&&h.id.client>=o.struct.id.client;)h=u.next(),f=!0;if(h===null||h.id.client!==d||f&&h.id.clock>o.struct.id.clock+o.struct.length)continue;if(d!==o.struct.id.client)Lo(a,o.struct,o.offset),o={struct:h,offset:0},u.next();else if(o.struct.id.clock+o.struct.length<h.id.clock)if(o.struct.constructor===gr)o.struct.length=h.id.clock+h.length-o.struct.id.clock;else{Lo(a,o.struct,o.offset);const p=h.id.clock-o.struct.id.clock-o.struct.length;o={struct:new gr(xe(d,o.struct.id.clock+o.struct.length),p),offset:0}}else{const p=o.struct.id.clock+o.struct.length-h.id.clock;p>0&&(o.struct.constructor===gr?o.struct.length-=p:h=vce(h,p)),o.struct.mergeWith(h)||(Lo(a,o.struct,o.offset),o={struct:h,offset:0},u.next())}}else o={struct:u.curr,offset:0},u.next();for(let h=u.curr;h!==null&&h.id.client===d&&h.id.clock===o.struct.id.clock+o.struct.length&&h.constructor!==gr;h=u.next())Lo(a,o.struct,o.offset),o={struct:h,offset:0}}o!==null&&(Lo(a,o.struct,o.offset),o=null),Vb(a);const c=r.map(u=>Bb(u)),l=Wae(c);return Sl(i,l),i.toUint8Array()},wce=(t,e,n=el,r=ya)=>{const s=V4(e),o=new r,i=new Kb(o),a=new n(Pi(t)),c=new Hb(a,!1);for(;c.curr;){const u=c.curr,d=u.id.client,h=s.get(d)||0;if(c.curr.constructor===gr){c.next();continue}if(u.id.clock+u.length>h)for(Lo(i,u,Ra(h-u.id.clock,0)),c.next();c.curr&&c.curr.id.client===d;)Lo(i,c.curr,0),c.next();else for(;c.curr&&c.curr.id.client===d&&c.curr.id.clock+c.curr.length<=h;)c.next()}Vb(i);const l=Bb(a);return Sl(o,l),o.toUint8Array()},Z4=t=>{t.written>0&&(t.clientStructs.push({written:t.written,restEncoder:rt(t.encoder.restEncoder)}),t.encoder.restEncoder=Xt(),t.written=0)},Lo=(t,e,n)=>{t.written>0&&t.currClient!==e.id.client&&Z4(t),t.written===0&&(t.currClient=e.id.client,t.encoder.writeClient(e.id.client),ie(t.encoder.restEncoder,e.id.clock+n)),e.write(t.encoder,n),t.written++},Vb=t=>{Z4(t);const e=t.encoder.restEncoder;ie(e,t.clientStructs.length);for(let n=0;n<t.clientStructs.length;n++){const r=t.clientStructs[n];ie(e,r.written),Km(e,r.restEncoder)}},Sce=(t,e,n,r)=>{const s=new n(Pi(t)),o=new Hb(s,!1),i=new r,a=new Kb(i);for(let l=o.curr;l!==null;l=o.next())Lo(a,e(l),0);Vb(a);const c=Bb(s);return Sl(i,c),i.toUint8Array()},xce=t=>Sce(t,Yie,el,nh),Ak="You must not compute changes after the event-handler fired.";class Wm{constructor(e,n){this.target=e,this.currentTarget=e,this.transaction=n,this._changes=null,this._keys=null,this._delta=null,this._path=null}get path(){return this._path||(this._path=bce(this.currentTarget,this.target))}deletes(e){return N4(this.transaction.deleteSet,e.id)}get keys(){if(this._keys===null){if(this.transaction.doc._transactionCleanups.length===0)throw pi(Ak);const e=new Map,n=this.target;this.transaction.changed.get(n).forEach(s=>{if(s!==null){const o=n._map.get(s);let i,a;if(this.adds(o)){let c=o.left;for(;c!==null&&this.adds(c);)c=c.left;if(this.deletes(o))if(c!==null&&this.deletes(c))i="delete",a=ev(c.content.getContent());else return;else c!==null&&this.deletes(c)?(i="update",a=ev(c.content.getContent())):(i="add",a=void 0)}else if(this.deletes(o))i="delete",a=ev(o.content.getContent());else return;e.set(s,{action:i,oldValue:a})}}),this._keys=e}return this._keys}get delta(){return this.changes.delta}adds(e){return e.id.clock>=(this.transaction.beforeState.get(e.id.client)||0)}get changes(){let e=this._changes;if(e===null){if(this.transaction.doc._transactionCleanups.length===0)throw pi(Ak);const n=this.target,r=ga(),s=ga(),o=[];if(e={added:r,deleted:s,delta:o,keys:this.keys},this.transaction.changed.get(n).has(null)){let a=null;const c=()=>{a&&o.push(a)};for(let l=n._start;l!==null;l=l.right)l.deleted?this.deletes(l)&&!this.adds(l)&&((a===null||a.delete===void 0)&&(c(),a={delete:0}),a.delete+=l.length,s.add(l)):this.adds(l)?((a===null||a.insert===void 0)&&(c(),a={insert:[]}),a.insert=a.insert.concat(l.content.getContent()),r.add(l)):((a===null||a.retain===void 0)&&(c(),a={retain:0}),a.retain+=l.length);a!==null&&a.retain===void 0&&c()}this._changes=e}return e}}const bce=(t,e)=>{const n=[];for(;e._item!==null&&e!==t;){if(e._item.parentSub!==null)n.unshift(e._item.parentSub);else{let r=0,s=e._item.parent._start;for(;s!==e._item&&s!==null;)s.deleted||r++,s=s.right;n.unshift(r)}e=e._item.parent}return n},J4=80;let Wb=0;class Cce{constructor(e,n){e.marker=!0,this.p=e,this.index=n,this.timestamp=Wb++}}const _ce=t=>{t.timestamp=Wb++},e6=(t,e,n)=>{t.p.marker=!1,t.p=e,e.marker=!0,t.index=n,t.timestamp=Wb++},Ece=(t,e,n)=>{if(t.length>=J4){const r=t.reduce((s,o)=>s.timestamp<o.timestamp?s:o);return e6(r,e,n),r}else{const r=new Cce(e,n);return t.push(r),r}},Gm=(t,e)=>{if(t._start===null||e===0||t._searchMarker===null)return null;const n=t._searchMarker.length===0?null:t._searchMarker.reduce((o,i)=>gp(e-o.index)<gp(e-i.index)?o:i);let r=t._start,s=0;for(n!==null&&(r=n.p,s=n.index,_ce(n));r.right!==null&&s<e;){if(!r.deleted&&r.countable){if(e<s+r.length)break;s+=r.length}r=r.right}for(;r.left!==null&&s>e;)r=r.left,!r.deleted&&r.countable&&(s-=r.length);for(;r.left!==null&&r.left.id.client===r.id.client&&r.left.id.clock+r.left.length===r.id.clock;)r=r.left,!r.deleted&&r.countable&&(s-=r.length);return n!==null&&gp(n.index-s)<r.parent.length/J4?(e6(n,r,s),n):Ece(t._searchMarker,r,s)},Sd=(t,e,n)=>{for(let r=t.length-1;r>=0;r--){const s=t[r];if(n>0){let o=s.p;for(o.marker=!1;o&&(o.deleted||!o.countable);)o=o.left,o&&!o.deleted&&o.countable&&(s.index-=o.length);if(o===null||o.marker===!0){t.splice(r,1);continue}s.p=o,o.marker=!0}(e<s.index||n>0&&e===s.index)&&(s.index=Ra(e,s.index+n))}},Ym=(t,e,n)=>{const r=t,s=e.changedParentTypes;for(;go(s,t,()=>[]).push(n),t._item!==null;)t=t._item.parent;G4(r._eH,n,e)};class Ut{constructor(){this._item=null,this._map=new Map,this._start=null,this.doc=null,this._length=0,this._eH=Ek(),this._dEH=Ek(),this._searchMarker=null}get parent(){return this._item?this._item.parent:null}_integrate(e,n){this.doc=e,this._item=n}_copy(){throw ls()}clone(){throw ls()}_write(e){}get _first(){let e=this._start;for(;e!==null&&e.deleted;)e=e.right;return e}_callObserver(e,n){!e.local&&this._searchMarker&&(this._searchMarker.length=0)}observe(e){Pk(this._eH,e)}observeDeep(e){Pk(this._dEH,e)}unobserve(e){kk(this._eH,e)}unobserveDeep(e){kk(this._dEH,e)}toJSON(){}}const t6=(t,e,n)=>{e<0&&(e=t._length+e),n<0&&(n=t._length+n);let r=n-e;const s=[];let o=t._start;for(;o!==null&&r>0;){if(o.countable&&!o.deleted){const i=o.content.getContent();if(i.length<=e)e-=i.length;else{for(let a=e;a<i.length&&r>0;a++)s.push(i[a]),r--;e=0}}o=o.right}return s},n6=t=>{const e=[];let n=t._start;for(;n!==null;){if(n.countable&&!n.deleted){const r=n.content.getContent();for(let s=0;s<r.length;s++)e.push(r[s])}n=n.right}return e},xd=(t,e)=>{let n=0,r=t._start;for(;r!==null;){if(r.countable&&!r.deleted){const s=r.content.getContent();for(let o=0;o<s.length;o++)e(s[o],n++,t)}r=r.right}},r6=(t,e)=>{const n=[];return xd(t,(r,s)=>{n.push(e(r,s,t))}),n},Pce=t=>{let e=t._start,n=null,r=0;return{[Symbol.iterator](){return this},next:()=>{if(n===null){for(;e!==null&&e.deleted;)e=e.right;if(e===null)return{done:!0,value:void 0};n=e.content.getContent(),r=0,e=e.right}const s=n[r++];return n.length<=r&&(n=null),{done:!1,value:s}}}},s6=(t,e)=>{const n=Gm(t,e);let r=t._start;for(n!==null&&(r=n.p,e-=n.index);r!==null;r=r.right)if(!r.deleted&&r.countable){if(e<r.length)return r.content.getContent()[e];e-=r.length}},Lg=(t,e,n,r)=>{let s=n;const o=t.doc,i=o.clientID,a=o.store,c=n===null?e._start:n.right;let l=[];const u=()=>{l.length>0&&(s=new St(xe(i,Pt(a,i)),s,s&&s.lastId,c,c&&c.id,e,null,new wa(l)),s.integrate(t,0),l=[])};r.forEach(d=>{if(d===null)l.push(d);else switch(d.constructor){case Number:case Object:case Boolean:case Array:case String:l.push(d);break;default:switch(u(),d.constructor){case Uint8Array:case ArrayBuffer:s=new St(xe(i,Pt(a,i)),s,s&&s.lastId,c,c&&c.id,e,null,new rh(new Uint8Array(d))),s.integrate(t,0);break;case xl:s=new St(xe(i,Pt(a,i)),s,s&&s.lastId,c,c&&c.id,e,null,new sh(d)),s.integrate(t,0);break;default:if(d instanceof Ut)s=new St(xe(i,Pt(a,i)),s,s&&s.lastId,c,c&&c.id,e,null,new yo(d)),s.integrate(t,0);else throw new Error("Unexpected content type in insert operation")}}}),u()},o6=pi("Length exceeded!"),i6=(t,e,n,r)=>{if(n>e._length)throw o6;if(n===0)return e._searchMarker&&Sd(e._searchMarker,n,r.length),Lg(t,e,null,r);const s=n,o=Gm(e,n);let i=e._start;for(o!==null&&(i=o.p,n-=o.index,n===0&&(i=i.prev,n+=i&&i.countable&&!i.deleted?i.length:0));i!==null;i=i.right)if(!i.deleted&&i.countable){if(n<=i.length){n<i.length&&gi(t,xe(i.id.client,i.id.clock+n));break}n-=i.length}return e._searchMarker&&Sd(e._searchMarker,s,r.length),Lg(t,e,i,r)},kce=(t,e,n)=>{let s=(e._searchMarker||[]).reduce((o,i)=>i.index>o.index?i:o,{index:0,p:e._start}).p;if(s)for(;s.right;)s=s.right;return Lg(t,e,s,n)},a6=(t,e,n,r)=>{if(r===0)return;const s=n,o=r,i=Gm(e,n);let a=e._start;for(i!==null&&(a=i.p,n-=i.index);a!==null&&n>0;a=a.right)!a.deleted&&a.countable&&(n<a.length&&gi(t,xe(a.id.client,a.id.clock+n)),n-=a.length);for(;r>0&&a!==null;)a.deleted||(r<a.length&&gi(t,xe(a.id.client,a.id.clock+r)),a.delete(t),r-=a.length),a=a.right;if(r>0)throw o6;e._searchMarker&&Sd(e._searchMarker,s,-o+r)},jg=(t,e,n)=>{const r=e._map.get(n);r!==void 0&&r.delete(t)},Gb=(t,e,n,r)=>{const s=e._map.get(n)||null,o=t.doc,i=o.clientID;let a;if(r==null)a=new wa([r]);else switch(r.constructor){case Number:case Object:case Boolean:case Array:case String:a=new wa([r]);break;case Uint8Array:a=new rh(r);break;case xl:a=new sh(r);break;default:if(r instanceof Ut)a=new yo(r);else throw new Error("Unexpected content type")}new St(xe(i,Pt(o.store,i)),s,s&&s.lastId,null,null,e,n,a).integrate(t,0)},Yb=(t,e)=>{const n=t._map.get(e);return n!==void 0&&!n.deleted?n.content.getContent()[n.length-1]:void 0},c6=t=>{const e={};return t._map.forEach((n,r)=>{n.deleted||(e[r]=n.content.getContent()[n.length-1])}),e},l6=(t,e)=>{const n=t._map.get(e);return n!==void 0&&!n.deleted},gf=t=>Kae(t.entries(),e=>!e[1].deleted);class Ice extends Wm{constructor(e,n){super(e,n),this._transaction=n}}class Dc extends Ut{constructor(){super(),this._prelimContent=[],this._searchMarker=[]}static from(e){const n=new Dc;return n.push(e),n}_integrate(e,n){super._integrate(e,n),this.insert(0,this._prelimContent),this._prelimContent=null}_copy(){return new Dc}clone(){const e=new Dc;return e.insert(0,this.toArray().map(n=>n instanceof Ut?n.clone():n)),e}get length(){return this._prelimContent===null?this._length:this._prelimContent.length}_callObserver(e,n){super._callObserver(e,n),Ym(this,e,new Ice(this,e))}insert(e,n){this.doc!==null?Ne(this.doc,r=>{i6(r,this,e,n)}):this._prelimContent.splice(e,0,...n)}push(e){this.doc!==null?Ne(this.doc,n=>{kce(n,this,e)}):this._prelimContent.push(...e)}unshift(e){this.insert(0,e)}delete(e,n=1){this.doc!==null?Ne(this.doc,r=>{a6(r,this,e,n)}):this._prelimContent.splice(e,n)}get(e){return s6(this,e)}toArray(){return n6(this)}slice(e=0,n=this.length){return t6(this,e,n)}toJSON(){return this.map(e=>e instanceof Ut?e.toJSON():e)}map(e){return r6(this,e)}forEach(e){xd(this,e)}[Symbol.iterator](){return Pce(this)}_write(e){e.writeTypeRef(Zce)}}const $ce=t=>new Dc;class Tce extends Wm{constructor(e,n,r){super(e,n),this.keysChanged=r}}class tl extends Ut{constructor(e){super(),this._prelimContent=null,e===void 0?this._prelimContent=new Map:this._prelimContent=new Map(e)}_integrate(e,n){super._integrate(e,n),this._prelimContent.forEach((r,s)=>{this.set(s,r)}),this._prelimContent=null}_copy(){return new tl}clone(){const e=new tl;return this.forEach((n,r)=>{e.set(r,n instanceof Ut?n.clone():n)}),e}_callObserver(e,n){Ym(this,e,new Tce(this,e,n))}toJSON(){const e={};return this._map.forEach((n,r)=>{if(!n.deleted){const s=n.content.getContent()[n.length-1];e[r]=s instanceof Ut?s.toJSON():s}}),e}get size(){return[...gf(this._map)].length}keys(){return ov(gf(this._map),e=>e[0])}values(){return ov(gf(this._map),e=>e[1].content.getContent()[e[1].length-1])}entries(){return ov(gf(this._map),e=>[e[0],e[1].content.getContent()[e[1].length-1]])}forEach(e){this._map.forEach((n,r)=>{n.deleted||e(n.content.getContent()[n.length-1],r,this)})}[Symbol.iterator](){return this.entries()}delete(e){this.doc!==null?Ne(this.doc,n=>{jg(n,this,e)}):this._prelimContent.delete(e)}set(e,n){return this.doc!==null?Ne(this.doc,r=>{Gb(r,this,e,n)}):this._prelimContent.set(e,n),n}get(e){return Yb(this,e)}has(e){return l6(this,e)}clear(){this.doc!==null?Ne(this.doc,e=>{this.forEach(function(n,r,s){jg(e,s,r)})}):this._prelimContent.clear()}_write(e){e.writeTypeRef(Jce)}}const Ace=t=>new tl,Ho=(t,e)=>t===e||typeof t=="object"&&typeof e=="object"&&t&&e&&Gie(t,e);class zS{constructor(e,n,r,s){this.left=e,this.right=n,this.index=r,this.currentAttributes=s}forward(){switch(this.right===null&&vs(),this.right.content.constructor){case bt:this.right.deleted||bl(this.currentAttributes,this.right.content);break;default:this.right.deleted||(this.index+=this.right.length);break}this.left=this.right,this.right=this.right.right}}const Mk=(t,e,n)=>{for(;e.right!==null&&n>0;){switch(e.right.content.constructor){case bt:e.right.deleted||bl(e.currentAttributes,e.right.content);break;default:e.right.deleted||(n<e.right.length&&gi(t,xe(e.right.id.client,e.right.id.clock+n)),e.index+=e.right.length,n-=e.right.length);break}e.left=e.right,e.right=e.right.right}return e},mf=(t,e,n)=>{const r=new Map,s=Gm(e,n);if(s){const o=new zS(s.p.left,s.p,s.index,r);return Mk(t,o,n-s.index)}else{const o=new zS(null,e._start,0,r);return Mk(t,o,n)}},u6=(t,e,n,r)=>{for(;n.right!==null&&(n.right.deleted===!0||n.right.content.constructor===bt&&Ho(r.get(n.right.content.key),n.right.content.value));)n.right.deleted||r.delete(n.right.content.key),n.forward();const s=t.doc,o=s.clientID;r.forEach((i,a)=>{const c=n.left,l=n.right,u=new St(xe(o,Pt(s.store,o)),c,c&&c.lastId,l,l&&l.id,e,null,new bt(a,i));u.integrate(t,0),n.right=u,n.forward()})},bl=(t,e)=>{const{key:n,value:r}=e;r===null?t.delete(n):t.set(n,r)},d6=(t,e)=>{for(;t.right!==null;){if(!(t.right.deleted||t.right.content.constructor===bt&&Ho(e[t.right.content.key]||null,t.right.content.value)))break;t.forward()}},h6=(t,e,n,r)=>{const s=t.doc,o=s.clientID,i=new Map;for(const a in r){const c=r[a],l=n.currentAttributes.get(a)||null;if(!Ho(l,c)){i.set(a,l);const{left:u,right:d}=n;n.right=new St(xe(o,Pt(s.store,o)),u,u&&u.lastId,d,d&&d.id,e,null,new bt(a,c)),n.right.integrate(t,0),n.forward()}}return i},av=(t,e,n,r,s)=>{n.currentAttributes.forEach((h,f)=>{s[f]===void 0&&(s[f]=null)});const o=t.doc,i=o.clientID;d6(n,s);const a=h6(t,e,n,s),c=r.constructor===String?new Ss(r):r instanceof Ut?new yo(r):new La(r);let{left:l,right:u,index:d}=n;e._searchMarker&&Sd(e._searchMarker,n.index,c.getLength()),u=new St(xe(i,Pt(o.store,i)),l,l&&l.lastId,u,u&&u.id,e,null,c),u.integrate(t,0),n.right=u,n.index=d,n.forward(),u6(t,e,n,a)},Ok=(t,e,n,r,s)=>{const o=t.doc,i=o.clientID;d6(n,s);const a=h6(t,e,n,s);e:for(;n.right!==null&&(r>0||a.size>0&&(n.right.deleted||n.right.content.constructor===bt));){if(!n.right.deleted)switch(n.right.content.constructor){case bt:{const{key:c,value:l}=n.right.content,u=s[c];if(u!==void 0){if(Ho(u,l))a.delete(c);else{if(r===0)break e;a.set(c,l)}n.right.delete(t)}else n.currentAttributes.set(c,l);break}default:r<n.right.length&&gi(t,xe(n.right.id.client,n.right.id.clock+r)),r-=n.right.length;break}n.forward()}if(r>0){let c="";for(;r>0;r--)c+=`
`;n.right=new St(xe(i,Pt(o.store,i)),n.left,n.left&&n.left.lastId,n.right,n.right&&n.right.id,e,null,new Ss(c)),n.right.integrate(t,0),n.forward()}u6(t,e,n,a)},f6=(t,e,n,r,s)=>{let o=e;const i=Vr();for(;o&&(!o.countable||o.deleted);){if(!o.deleted&&o.content.constructor===bt){const l=o.content;i.set(l.key,l)}o=o.right}let a=0,c=!1;for(;e!==o;){if(n===e&&(c=!0),!e.deleted){const l=e.content;switch(l.constructor){case bt:{const{key:u,value:d}=l,h=r.get(u)||null;(i.get(u)!==l||h===d)&&(e.delete(t),a++,!c&&(s.get(u)||null)===d&&h!==d&&(h===null?s.delete(u):s.set(u,h))),!c&&!e.deleted&&bl(s,l);break}}}e=e.right}return a},Mce=(t,e)=>{for(;e&&e.right&&(e.right.deleted||!e.right.countable);)e=e.right;const n=new Set;for(;e&&(e.deleted||!e.countable);){if(!e.deleted&&e.content.constructor===bt){const r=e.content.key;n.has(r)?e.delete(t):n.add(r)}e=e.left}},Oce=t=>{let e=0;return Ne(t.doc,n=>{let r=t._start,s=t._start,o=Vr();const i=AS(o);for(;s;){if(s.deleted===!1)switch(s.content.constructor){case bt:bl(i,s.content);break;default:e+=f6(n,r,s,o,i),o=AS(i),r=s;break}s=s.right}}),e},Dce=t=>{const e=new Set,n=t.doc;for(const[r,s]of t.afterState.entries()){const o=t.beforeState.get(r)||0;s!==o&&q4(t,n.store.clients.get(r),o,s,i=>{!i.deleted&&i.content.constructor===bt&&i.constructor!==pr&&e.add(i.parent)})}Ne(n,r=>{j4(t,t.deleteSet,s=>{if(s instanceof pr||!s.parent._hasFormatting||e.has(s.parent))return;const o=s.parent;s.content.constructor===bt?e.add(o):Mce(r,s)});for(const s of e)Oce(s)})},Dk=(t,e,n)=>{const r=n,s=AS(e.currentAttributes),o=e.right;for(;n>0&&e.right!==null;){if(e.right.deleted===!1)switch(e.right.content.constructor){case yo:case La:case Ss:n<e.right.length&&gi(t,xe(e.right.id.client,e.right.id.clock+n)),n-=e.right.length,e.right.delete(t);break}e.forward()}o&&f6(t,o,e.right,s,e.currentAttributes);const i=(e.left||e.right).parent;return i._searchMarker&&Sd(i._searchMarker,e.index,-r+n),e};class Rce extends Wm{constructor(e,n,r){super(e,n),this.childListChanged=!1,this.keysChanged=new Set,r.forEach(s=>{s===null?this.childListChanged=!0:this.keysChanged.add(s)})}get changes(){if(this._changes===null){const e={keys:this.keys,delta:this.delta,added:new Set,deleted:new Set};this._changes=e}return this._changes}get delta(){if(this._delta===null){const e=this.target.doc,n=[];Ne(e,r=>{const s=new Map,o=new Map;let i=this.target._start,a=null;const c={};let l="",u=0,d=0;const h=()=>{if(a!==null){let f=null;switch(a){case"delete":d>0&&(f={delete:d}),d=0;break;case"insert":(typeof l=="object"||l.length>0)&&(f={insert:l},s.size>0&&(f.attributes={},s.forEach((p,m)=>{p!==null&&(f.attributes[m]=p)}))),l="";break;case"retain":u>0&&(f={retain:u},Vie(c)||(f.attributes=Bie({},c))),u=0;break}f&&n.push(f),a=null}};for(;i!==null;){switch(i.content.constructor){case yo:case La:this.adds(i)?this.deletes(i)||(h(),a="insert",l=i.content.getContent()[0],h()):this.deletes(i)?(a!=="delete"&&(h(),a="delete"),d+=1):i.deleted||(a!=="retain"&&(h(),a="retain"),u+=1);break;case Ss:this.adds(i)?this.deletes(i)||(a!=="insert"&&(h(),a="insert"),l+=i.content.str):this.deletes(i)?(a!=="delete"&&(h(),a="delete"),d+=i.length):i.deleted||(a!=="retain"&&(h(),a="retain"),u+=i.length);break;case bt:{const{key:f,value:p}=i.content;if(this.adds(i)){if(!this.deletes(i)){const m=s.get(f)||null;Ho(m,p)?p!==null&&i.delete(r):(a==="retain"&&h(),Ho(p,o.get(f)||null)?delete c[f]:c[f]=p)}}else if(this.deletes(i)){o.set(f,p);const m=s.get(f)||null;Ho(m,p)||(a==="retain"&&h(),c[f]=m)}else if(!i.deleted){o.set(f,p);const m=c[f];m!==void 0&&(Ho(m,p)?m!==null&&i.delete(r):(a==="retain"&&h(),p===null?delete c[f]:c[f]=p))}i.deleted||(a==="insert"&&h(),bl(s,i.content));break}}i=i.right}for(h();n.length>0;){const f=n[n.length-1];if(f.retain!==void 0&&f.attributes===void 0)n.pop();else break}}),this._delta=n}return this._delta}}class nl extends Ut{constructor(e){super(),this._pending=e!==void 0?[()=>this.insert(0,e)]:[],this._searchMarker=[],this._hasFormatting=!1}get length(){return this._length}_integrate(e,n){super._integrate(e,n);try{this._pending.forEach(r=>r())}catch(r){console.error(r)}this._pending=null}_copy(){return new nl}clone(){const e=new nl;return e.applyDelta(this.toDelta()),e}_callObserver(e,n){super._callObserver(e,n);const r=new Rce(this,e,n);Ym(this,e,r),!e.local&&this._hasFormatting&&(e._needFormattingCleanup=!0)}toString(){let e="",n=this._start;for(;n!==null;)!n.deleted&&n.countable&&n.content.constructor===Ss&&(e+=n.content.str),n=n.right;return e}toJSON(){return this.toString()}applyDelta(e,{sanitize:n=!0}={}){this.doc!==null?Ne(this.doc,r=>{const s=new zS(null,this._start,0,new Map);for(let o=0;o<e.length;o++){const i=e[o];if(i.insert!==void 0){const a=!n&&typeof i.insert=="string"&&o===e.length-1&&s.right===null&&i.insert.slice(-1)===`
`?i.insert.slice(0,-1):i.insert;(typeof a!="string"||a.length>0)&&av(r,this,s,a,i.attributes||{})}else i.retain!==void 0?Ok(r,this,s,i.retain,i.attributes||{}):i.delete!==void 0&&Dk(r,s,i.delete)}}):this._pending.push(()=>this.applyDelta(e))}toDelta(e,n,r){const s=[],o=new Map,i=this.doc;let a="",c=this._start;function l(){if(a.length>0){const d={};let h=!1;o.forEach((p,m)=>{h=!0,d[m]=p});const f={insert:a};h&&(f.attributes=d),s.push(f),a=""}}const u=()=>{for(;c!==null;){if(Zl(c,e)||n!==void 0&&Zl(c,n))switch(c.content.constructor){case Ss:{const d=o.get("ychange");e!==void 0&&!Zl(c,e)?(d===void 0||d.user!==c.id.client||d.type!=="removed")&&(l(),o.set("ychange",r?r("removed",c.id):{type:"removed"})):n!==void 0&&!Zl(c,n)?(d===void 0||d.user!==c.id.client||d.type!=="added")&&(l(),o.set("ychange",r?r("added",c.id):{type:"added"})):d!==void 0&&(l(),o.delete("ychange")),a+=c.content.str;break}case yo:case La:{l();const d={insert:c.content.getContent()[0]};if(o.size>0){const h={};d.attributes=h,o.forEach((f,p)=>{h[p]=f})}s.push(d);break}case bt:Zl(c,e)&&(l(),bl(o,c.content));break}c=c.right}l()};return e||n?Ne(i,d=>{e&&jS(d,e),n&&jS(d,n),u()},"cleanup"):u(),s}insert(e,n,r){if(n.length<=0)return;const s=this.doc;s!==null?Ne(s,o=>{const i=mf(o,this,e);r||(r={},i.currentAttributes.forEach((a,c)=>{r[c]=a})),av(o,this,i,n,r)}):this._pending.push(()=>this.insert(e,n,r))}insertEmbed(e,n,r={}){const s=this.doc;s!==null?Ne(s,o=>{const i=mf(o,this,e);av(o,this,i,n,r)}):this._pending.push(()=>this.insertEmbed(e,n,r))}delete(e,n){if(n===0)return;const r=this.doc;r!==null?Ne(r,s=>{Dk(s,mf(s,this,e),n)}):this._pending.push(()=>this.delete(e,n))}format(e,n,r){if(n===0)return;const s=this.doc;s!==null?Ne(s,o=>{const i=mf(o,this,e);i.right!==null&&Ok(o,this,i,n,r)}):this._pending.push(()=>this.format(e,n,r))}removeAttribute(e){this.doc!==null?Ne(this.doc,n=>{jg(n,this,e)}):this._pending.push(()=>this.removeAttribute(e))}setAttribute(e,n){this.doc!==null?Ne(this.doc,r=>{Gb(r,this,e,n)}):this._pending.push(()=>this.setAttribute(e,n))}getAttribute(e){return Yb(this,e)}getAttributes(){return c6(this)}_write(e){e.writeTypeRef(ele)}}const Lce=t=>new nl;class cv{constructor(e,n=()=>!0){this._filter=n,this._root=e,this._currentNode=e._start,this._firstCall=!0}[Symbol.iterator](){return this}next(){let e=this._currentNode,n=e&&e.content&&e.content.type;if(e!==null&&(!this._firstCall||e.deleted||!this._filter(n)))do if(n=e.content.type,!e.deleted&&(n.constructor===bd||n.constructor===va)&&n._start!==null)e=n._start;else for(;e!==null;)if(e.right!==null){e=e.right;break}else e.parent===this._root?e=null:e=e.parent._item;while(e!==null&&(e.deleted||!this._filter(e.content.type)));return this._firstCall=!1,e===null?{value:void 0,done:!0}:(this._currentNode=e,{value:e.content.type,done:!1})}}class va extends Ut{constructor(){super(),this._prelimContent=[]}get firstChild(){const e=this._first;return e?e.content.getContent()[0]:null}_integrate(e,n){super._integrate(e,n),this.insert(0,this._prelimContent),this._prelimContent=null}_copy(){return new va}clone(){const e=new va;return e.insert(0,this.toArray().map(n=>n instanceof Ut?n.clone():n)),e}get length(){return this._prelimContent===null?this._length:this._prelimContent.length}createTreeWalker(e){return new cv(this,e)}querySelector(e){e=e.toUpperCase();const r=new cv(this,s=>s.nodeName&&s.nodeName.toUpperCase()===e).next();return r.done?null:r.value}querySelectorAll(e){return e=e.toUpperCase(),fi(new cv(this,n=>n.nodeName&&n.nodeName.toUpperCase()===e))}_callObserver(e,n){Ym(this,e,new zce(this,n,e))}toString(){return r6(this,e=>e.toString()).join("")}toJSON(){return this.toString()}toDOM(e=document,n={},r){const s=e.createDocumentFragment();return r!==void 0&&r._createAssociation(s,this),xd(this,o=>{s.insertBefore(o.toDOM(e,n,r),null)}),s}insert(e,n){this.doc!==null?Ne(this.doc,r=>{i6(r,this,e,n)}):this._prelimContent.splice(e,0,...n)}insertAfter(e,n){if(this.doc!==null)Ne(this.doc,r=>{const s=e&&e instanceof Ut?e._item:e;Lg(r,this,s,n)});else{const r=this._prelimContent,s=e===null?0:r.findIndex(o=>o===e)+1;if(s===0&&e!==null)throw pi("Reference item not found");r.splice(s,0,...n)}}delete(e,n=1){this.doc!==null?Ne(this.doc,r=>{a6(r,this,e,n)}):this._prelimContent.splice(e,n)}toArray(){return n6(this)}push(e){this.insert(this.length,e)}unshift(e){this.insert(0,e)}get(e){return s6(this,e)}slice(e=0,n=this.length){return t6(this,e,n)}forEach(e){xd(this,e)}_write(e){e.writeTypeRef(nle)}}const jce=t=>new va;class bd extends va{constructor(e="UNDEFINED"){super(),this.nodeName=e,this._prelimAttrs=new Map}get nextSibling(){const e=this._item?this._item.next:null;return e?e.content.type:null}get prevSibling(){const e=this._item?this._item.prev:null;return e?e.content.type:null}_integrate(e,n){super._integrate(e,n),this._prelimAttrs.forEach((r,s)=>{this.setAttribute(s,r)}),this._prelimAttrs=null}_copy(){return new bd(this.nodeName)}clone(){const e=new bd(this.nodeName),n=this.getAttributes();return Hie(n,(r,s)=>{typeof r=="string"&&e.setAttribute(s,r)}),e.insert(0,this.toArray().map(r=>r instanceof Ut?r.clone():r)),e}toString(){const e=this.getAttributes(),n=[],r=[];for(const a in e)r.push(a);r.sort();const s=r.length;for(let a=0;a<s;a++){const c=r[a];n.push(c+'="'+e[c]+'"')}const o=this.nodeName.toLocaleLowerCase(),i=n.length>0?" "+n.join(" "):"";return`<${o}${i}>${super.toString()}</${o}>`}removeAttribute(e){this.doc!==null?Ne(this.doc,n=>{jg(n,this,e)}):this._prelimAttrs.delete(e)}setAttribute(e,n){this.doc!==null?Ne(this.doc,r=>{Gb(r,this,e,n)}):this._prelimAttrs.set(e,n)}getAttribute(e){return Yb(this,e)}hasAttribute(e){return l6(this,e)}getAttributes(){return c6(this)}toDOM(e=document,n={},r){const s=e.createElement(this.nodeName),o=this.getAttributes();for(const i in o){const a=o[i];typeof a=="string"&&s.setAttribute(i,a)}return xd(this,i=>{s.appendChild(i.toDOM(e,n,r))}),r!==void 0&&r._createAssociation(s,this),s}_write(e){e.writeTypeRef(tle),e.writeKey(this.nodeName)}}const Nce=t=>new bd(t.readKey());class zce extends Wm{constructor(e,n,r){super(e,r),this.childListChanged=!1,this.attributesChanged=new Set,n.forEach(s=>{s===null?this.childListChanged=!0:this.attributesChanged.add(s)})}}class Ng extends tl{constructor(e){super(),this.hookName=e}_copy(){return new Ng(this.hookName)}clone(){const e=new Ng(this.hookName);return this.forEach((n,r)=>{e.set(r,n)}),e}toDOM(e=document,n={},r){const s=n[this.hookName];let o;return s!==void 0?o=s.createDom(this):o=document.createElement(this.hookName),o.setAttribute("data-yjs-hook",this.hookName),r!==void 0&&r._createAssociation(o,this),o}_write(e){e.writeTypeRef(rle),e.writeKey(this.hookName)}}const Fce=t=>new Ng(t.readKey());class zg extends nl{get nextSibling(){const e=this._item?this._item.next:null;return e?e.content.type:null}get prevSibling(){const e=this._item?this._item.prev:null;return e?e.content.type:null}_copy(){return new zg}clone(){const e=new zg;return e.applyDelta(this.toDelta()),e}toDOM(e=document,n,r){const s=e.createTextNode(this.toString());return r!==void 0&&r._createAssociation(s,this),s}toString(){return this.toDelta().map(e=>{const n=[];for(const s in e.attributes){const o=[];for(const i in e.attributes[s])o.push({key:i,value:e.attributes[s][i]});o.sort((i,a)=>i.key<a.key?-1:1),n.push({nodeName:s,attrs:o})}n.sort((s,o)=>s.nodeName<o.nodeName?-1:1);let r="";for(let s=0;s<n.length;s++){const o=n[s];r+=`<${o.nodeName}`;for(let i=0;i<o.attrs.length;i++){const a=o.attrs[i];r+=` ${a.key}="${a.value}"`}r+=">"}r+=e.insert;for(let s=n.length-1;s>=0;s--)r+=`</${n[s].nodeName}>`;return r}).join("")}toJSON(){return this.toString()}_write(e){e.writeTypeRef(sle)}}const Bce=t=>new zg;class Xb{constructor(e,n){this.id=e,this.length=n}get deleted(){throw ls()}mergeWith(e){return!1}write(e,n,r){throw ls()}integrate(e,n){throw ls()}}const Uce=0;class pr extends Xb{get deleted(){return!0}delete(){}mergeWith(e){return this.constructor!==e.constructor?!1:(this.length+=e.length,!0)}integrate(e,n){n>0&&(this.id.clock+=n,this.length-=n),X4(e.doc.store,this)}write(e,n){e.writeInfo(Uce),e.writeLen(this.length-n)}getMissing(e,n){return null}}class rh{constructor(e){this.content=e}getLength(){return 1}getContent(){return[this.content]}isCountable(){return!0}copy(){return new rh(this.content)}splice(e){throw ls()}mergeWith(e){return!1}integrate(e,n){}delete(e){}gc(e){}write(e,n){e.writeBuf(this.content)}getRef(){return 3}}const Hce=t=>new rh(t.readBuf());class Cd{constructor(e){this.len=e}getLength(){return this.len}getContent(){return[]}isCountable(){return!1}copy(){return new Cd(this.len)}splice(e){const n=new Cd(this.len-e);return this.len=e,n}mergeWith(e){return this.len+=e.len,!0}integrate(e,n){Dg(e.deleteSet,n.id.client,n.id.clock,this.len),n.markDeleted()}delete(e){}gc(e){}write(e,n){e.writeLen(this.len-n)}getRef(){return 1}}const Kce=t=>new Cd(t.readLen()),p6=(t,e)=>new xl({guid:t,...e,shouldLoad:e.shouldLoad||e.autoLoad||!1});class sh{constructor(e){e._item&&console.error("This document was already integrated as a sub-document. You should create a second instance instead with the same guid."),this.doc=e;const n={};this.opts=n,e.gc||(n.gc=!1),e.autoLoad&&(n.autoLoad=!0),e.meta!==null&&(n.meta=e.meta)}getLength(){return 1}getContent(){return[this.doc]}isCountable(){return!0}copy(){return new sh(p6(this.doc.guid,this.opts))}splice(e){throw ls()}mergeWith(e){return!1}integrate(e,n){this.doc._item=n,e.subdocsAdded.add(this.doc),this.doc.shouldLoad&&e.subdocsLoaded.add(this.doc)}delete(e){e.subdocsAdded.has(this.doc)?e.subdocsAdded.delete(this.doc):e.subdocsRemoved.add(this.doc)}gc(e){}write(e,n){e.writeString(this.doc.guid),e.writeAny(this.opts)}getRef(){return 9}}const Vce=t=>new sh(p6(t.readString(),t.readAny()));class La{constructor(e){this.embed=e}getLength(){return 1}getContent(){return[this.embed]}isCountable(){return!0}copy(){return new La(this.embed)}splice(e){throw ls()}mergeWith(e){return!1}integrate(e,n){}delete(e){}gc(e){}write(e,n){e.writeJSON(this.embed)}getRef(){return 5}}const Wce=t=>new La(t.readJSON());class bt{constructor(e,n){this.key=e,this.value=n}getLength(){return 1}getContent(){return[]}isCountable(){return!1}copy(){return new bt(this.key,this.value)}splice(e){throw ls()}mergeWith(e){return!1}integrate(e,n){const r=n.parent;r._searchMarker=null,r._hasFormatting=!0}delete(e){}gc(e){}write(e,n){e.writeKey(this.key),e.writeJSON(this.value)}getRef(){return 6}}const Gce=t=>new bt(t.readKey(),t.readJSON());class Fg{constructor(e){this.arr=e}getLength(){return this.arr.length}getContent(){return this.arr}isCountable(){return!0}copy(){return new Fg(this.arr)}splice(e){const n=new Fg(this.arr.slice(e));return this.arr=this.arr.slice(0,e),n}mergeWith(e){return this.arr=this.arr.concat(e.arr),!0}integrate(e,n){}delete(e){}gc(e){}write(e,n){const r=this.arr.length;e.writeLen(r-n);for(let s=n;s<r;s++){const o=this.arr[s];e.writeString(o===void 0?"undefined":JSON.stringify(o))}}getRef(){return 2}}const Yce=t=>{const e=t.readLen(),n=[];for(let r=0;r<e;r++){const s=t.readString();s==="undefined"?n.push(void 0):n.push(JSON.parse(s))}return new Fg(n)};class wa{constructor(e){this.arr=e}getLength(){return this.arr.length}getContent(){return this.arr}isCountable(){return!0}copy(){return new wa(this.arr)}splice(e){const n=new wa(this.arr.slice(e));return this.arr=this.arr.slice(0,e),n}mergeWith(e){return this.arr=this.arr.concat(e.arr),!0}integrate(e,n){}delete(e){}gc(e){}write(e,n){const r=this.arr.length;e.writeLen(r-n);for(let s=n;s<r;s++){const o=this.arr[s];e.writeAny(o)}}getRef(){return 8}}const Xce=t=>{const e=t.readLen(),n=[];for(let r=0;r<e;r++)n.push(t.readAny());return new wa(n)};class Ss{constructor(e){this.str=e}getLength(){return this.str.length}getContent(){return this.str.split("")}isCountable(){return!0}copy(){return new Ss(this.str)}splice(e){const n=new Ss(this.str.slice(e));this.str=this.str.slice(0,e);const r=this.str.charCodeAt(e-1);return r>=55296&&r<=56319&&(this.str=this.str.slice(0,e-1)+"",n.str=""+n.str.slice(1)),n}mergeWith(e){return this.str+=e.str,!0}integrate(e,n){}delete(e){}gc(e){}write(e,n){e.writeString(n===0?this.str:this.str.slice(n))}getRef(){return 4}}const qce=t=>new Ss(t.readString()),Qce=[$ce,Ace,Lce,Nce,jce,Fce,Bce],Zce=0,Jce=1,ele=2,tle=3,nle=4,rle=5,sle=6;class yo{constructor(e){this.type=e}getLength(){return 1}getContent(){return[this.type]}isCountable(){return!0}copy(){return new yo(this.type._copy())}splice(e){throw ls()}mergeWith(e){return!1}integrate(e,n){this.type._integrate(e.doc,n)}delete(e){let n=this.type._start;for(;n!==null;)n.deleted?n.id.clock<(e.beforeState.get(n.id.client)||0)&&e._mergeStructs.push(n):n.delete(e),n=n.right;this.type._map.forEach(r=>{r.deleted?r.id.clock<(e.beforeState.get(r.id.client)||0)&&e._mergeStructs.push(r):r.delete(e)}),e.changed.delete(this.type)}gc(e){let n=this.type._start;for(;n!==null;)n.gc(e,!0),n=n.right;this.type._start=null,this.type._map.forEach(r=>{for(;r!==null;)r.gc(e,!0),r=r.left}),this.type._map=new Map}write(e,n){this.type._write(e)}getRef(){return 7}}const ole=t=>new yo(Qce[t.readTypeRef()](t)),Bg=(t,e,n)=>{const{client:r,clock:s}=e.id,o=new St(xe(r,s+n),e,xe(r,s+n-1),e.right,e.rightOrigin,e.parent,e.parentSub,e.content.splice(n));return e.deleted&&o.markDeleted(),e.keep&&(o.keep=!0),e.redone!==null&&(o.redone=xe(e.redone.client,e.redone.clock+n)),e.right=o,o.right!==null&&(o.right.left=o),t._mergeStructs.push(o),o.parentSub!==null&&o.right===null&&o.parent._map.set(o.parentSub,o),e.length=n,o};class St extends Xb{constructor(e,n,r,s,o,i,a,c){super(e,c.getLength()),this.origin=r,this.left=n,this.right=s,this.rightOrigin=o,this.parent=i,this.parentSub=a,this.redone=null,this.content=c,this.info=this.content.isCountable()?yk:0}set marker(e){(this.info&nv)>0!==e&&(this.info^=nv)}get marker(){return(this.info&nv)>0}get keep(){return(this.info&mk)>0}set keep(e){this.keep!==e&&(this.info^=mk)}get countable(){return(this.info&yk)>0}get deleted(){return(this.info&tv)>0}set deleted(e){this.deleted!==e&&(this.info^=tv)}markDeleted(){this.info|=tv}getMissing(e,n){if(this.origin&&this.origin.client!==this.id.client&&this.origin.clock>=Pt(n,this.origin.client))return this.origin.client;if(this.rightOrigin&&this.rightOrigin.client!==this.id.client&&this.rightOrigin.clock>=Pt(n,this.rightOrigin.client))return this.rightOrigin.client;if(this.parent&&this.parent.constructor===Oc&&this.id.client!==this.parent.client&&this.parent.clock>=Pt(n,this.parent.client))return this.parent.client;if(this.origin&&(this.left=Ik(e,n,this.origin),this.origin=this.left.lastId),this.rightOrigin&&(this.right=gi(e,this.rightOrigin),this.rightOrigin=this.right.id),(this.left&&this.left.constructor===pr||this.right&&this.right.constructor===pr)&&(this.parent=null),!this.parent)this.left&&this.left.constructor===St&&(this.parent=this.left.parent,this.parentSub=this.left.parentSub),this.right&&this.right.constructor===St&&(this.parent=this.right.parent,this.parentSub=this.right.parentSub);else if(this.parent.constructor===Oc){const r=iv(n,this.parent);r.constructor===pr?this.parent=null:this.parent=r.content.type}return null}integrate(e,n){if(n>0&&(this.id.clock+=n,this.left=Ik(e,e.doc.store,xe(this.id.client,this.id.clock-1)),this.origin=this.left.lastId,this.content=this.content.splice(n),this.length-=n),this.parent){if(!this.left&&(!this.right||this.right.left!==null)||this.left&&this.left.right!==this.right){let r=this.left,s;if(r!==null)s=r.right;else if(this.parentSub!==null)for(s=this.parent._map.get(this.parentSub)||null;s!==null&&s.left!==null;)s=s.left;else s=this.parent._start;const o=new Set,i=new Set;for(;s!==null&&s!==this.right;){if(i.add(s),o.add(s),pf(this.origin,s.origin)){if(s.id.client<this.id.client)r=s,o.clear();else if(pf(this.rightOrigin,s.rightOrigin))break}else if(s.origin!==null&&i.has(iv(e.doc.store,s.origin)))o.has(iv(e.doc.store,s.origin))||(r=s,o.clear());else break;s=s.right}this.left=r}if(this.left!==null){const r=this.left.right;this.right=r,this.left.right=this}else{let r;if(this.parentSub!==null)for(r=this.parent._map.get(this.parentSub)||null;r!==null&&r.left!==null;)r=r.left;else r=this.parent._start,this.parent._start=this;this.right=r}this.right!==null?this.right.left=this:this.parentSub!==null&&(this.parent._map.set(this.parentSub,this),this.left!==null&&this.left.delete(e)),this.parentSub===null&&this.countable&&!this.deleted&&(this.parent._length+=this.length),X4(e.doc.store,this),this.content.integrate(e,this),Tk(e,this.parent,this.parentSub),(this.parent._item!==null&&this.parent._item.deleted||this.parentSub!==null&&this.right!==null)&&this.delete(e)}else new pr(this.id,this.length).integrate(e,0)}get next(){let e=this.right;for(;e!==null&&e.deleted;)e=e.right;return e}get prev(){let e=this.left;for(;e!==null&&e.deleted;)e=e.left;return e}get lastId(){return this.length===1?this.id:xe(this.id.client,this.id.clock+this.length-1)}mergeWith(e){if(this.constructor===e.constructor&&pf(e.origin,this.lastId)&&this.right===e&&pf(this.rightOrigin,e.rightOrigin)&&this.id.client===e.id.client&&this.id.clock+this.length===e.id.clock&&this.deleted===e.deleted&&this.redone===null&&e.redone===null&&this.content.constructor===e.content.constructor&&this.content.mergeWith(e.content)){const n=this.parent._searchMarker;return n&&n.forEach(r=>{r.p===e&&(r.p=this,!this.deleted&&this.countable&&(r.index-=this.length))}),e.keep&&(this.keep=!0),this.right=e.right,this.right!==null&&(this.right.left=this),this.length+=e.length,!0}return!1}delete(e){if(!this.deleted){const n=this.parent;this.countable&&this.parentSub===null&&(n._length-=this.length),this.markDeleted(),Dg(e.deleteSet,this.id.client,this.id.clock,this.length),Tk(e,n,this.parentSub),this.content.delete(e)}}gc(e,n){if(!this.deleted)throw vs();this.content.gc(e),n?hce(e,this,new pr(this.id,this.length)):this.content=new Cd(this.length)}write(e,n){const r=n>0?xe(this.id.client,this.id.clock+n-1):this.origin,s=this.rightOrigin,o=this.parentSub,i=this.content.getRef()&Um|(r===null?0:qn)|(s===null?0:Ys)|(o===null?0:yd);if(e.writeInfo(i),r!==null&&e.writeLeftID(r),s!==null&&e.writeRightID(s),r===null&&s===null){const a=this.parent;if(a._item!==void 0){const c=a._item;if(c===null){const l=uce(a);e.writeParentInfo(!0),e.writeString(l)}else e.writeParentInfo(!1),e.writeLeftID(c.id)}else a.constructor===String?(e.writeParentInfo(!0),e.writeString(a)):a.constructor===Oc?(e.writeParentInfo(!1),e.writeLeftID(a)):vs();o!==null&&e.writeString(o)}this.content.write(e,n)}}const g6=(t,e)=>ile[e&Um](t),ile=[()=>{vs()},Kce,Yce,Hce,qce,Wce,Gce,ole,Xce,Vce,()=>{vs()}],ale=10;class gr extends Xb{get deleted(){return!0}delete(){}mergeWith(e){return this.constructor!==e.constructor?!1:(this.length+=e.length,!0)}integrate(e,n){vs()}write(e,n){e.writeInfo(ale),ie(e.restEncoder,this.length-n)}getMissing(e,n){return null}}const m6=typeof globalThis<"u"?globalThis:typeof window<"u"?window:typeof global<"u"?global:{},y6="__ $YJS$ __";m6[y6]===!0&&console.error("Yjs was already imported. This breaks constructor checks and will lead to issues! - https://github.com/yjs/yjs/issues/438");m6[y6]=!0;const v6=new Map;class cle{constructor(e){this.room=e,this.onmessage=null,this._onChange=n=>n.key===e&&this.onmessage!==null&&this.onmessage({data:yae(n.newValue||"")}),zie(this._onChange)}postMessage(e){_4.setItem(this.room,mae(dae(e)))}close(){Fie(this._onChange)}}const lle=typeof BroadcastChannel>"u"?cle:BroadcastChannel,qb=t=>go(v6,t,()=>{const e=ga(),n=new lle(t);return n.onmessage=r=>e.forEach(s=>s(r.data,"broadcastchannel")),{bc:n,subs:e}}),ule=(t,e)=>(qb(t).subs.add(e),e),dle=(t,e)=>{const n=qb(t),r=n.subs.delete(e);return r&&n.subs.size===0&&(n.bc.close(),v6.delete(t)),r},rc=(t,e,n=null)=>{const r=qb(t);r.bc.postMessage(e),r.subs.forEach(s=>s(e,n))},w6=0,Qb=1,S6=2,FS=(t,e)=>{ie(t,w6);const n=cce(e);pt(t,n)},x6=(t,e,n)=>{ie(t,Qb),pt(t,sce(e,n))},hle=(t,e,n)=>x6(e,n,Gt(t)),b6=(t,e,n)=>{try{tce(e,Gt(t),n)}catch(r){console.error("Caught error while handling a Yjs update",r)}},fle=(t,e)=>{ie(t,S6),pt(t,e)},ple=b6,gle=(t,e,n,r)=>{const s=ge(t);switch(s){case w6:hle(t,e,n);break;case Qb:b6(t,n,r);break;case S6:ple(t,n,r);break;default:throw new Error("Unknown message type")}return s},mle=0,yle=(t,e,n)=>{switch(ge(t)){case mle:n(e,ni(t))}},lv=3e4;class vle extends $b{constructor(e){super(),this.doc=e,this.clientID=e.clientID,this.states=new Map,this.meta=new Map,this._checkInterval=setInterval(()=>{const n=ma();this.getLocalState()!==null&&lv/2<=n-this.meta.get(this.clientID).lastUpdated&&this.setLocalState(this.getLocalState());const r=[];this.meta.forEach((s,o)=>{o!==this.clientID&&lv<=n-s.lastUpdated&&this.states.has(o)&&r.push(o)}),r.length>0&&Zb(this,r,"timeout")},no(lv/10)),e.on("destroy",()=>{this.destroy()}),this.setLocalState({})}destroy(){this.emit("destroy",[this]),this.setLocalState(null),super.destroy(),clearInterval(this._checkInterval)}getLocalState(){return this.states.get(this.clientID)||null}setLocalState(e){const n=this.clientID,r=this.meta.get(n),s=r===void 0?0:r.clock+1,o=this.states.get(n);e===null?this.states.delete(n):this.states.set(n,e),this.meta.set(n,{clock:s,lastUpdated:ma()});const i=[],a=[],c=[],l=[];e===null?l.push(n):o==null?e!=null&&i.push(n):(a.push(n),Eu(o,e)||c.push(n)),(i.length>0||c.length>0||l.length>0)&&this.emit("change",[{added:i,updated:c,removed:l},"local"]),this.emit("update",[{added:i,updated:a,removed:l},"local"])}setLocalStateField(e,n){const r=this.getLocalState();r!==null&&this.setLocalState({...r,[e]:n})}getStates(){return this.states}}const Zb=(t,e,n)=>{const r=[];for(let s=0;s<e.length;s++){const o=e[s];if(t.states.has(o)){if(t.states.delete(o),o===t.clientID){const i=t.meta.get(o);t.meta.set(o,{clock:i.clock+1,lastUpdated:ma()})}r.push(o)}}r.length>0&&(t.emit("change",[{added:[],updated:[],removed:r},n]),t.emit("update",[{added:[],updated:[],removed:r},n]))},Pu=(t,e,n=t.states)=>{const r=e.length,s=Xt();ie(s,r);for(let o=0;o<r;o++){const i=e[o],a=n.get(i)||null,c=t.meta.get(i).clock;ie(s,i),ie(s,c),sa(s,JSON.stringify(a))}return rt(s)},wle=(t,e,n)=>{const r=Pi(e),s=ma(),o=[],i=[],a=[],c=[],l=ge(r);for(let u=0;u<l;u++){const d=ge(r);let h=ge(r);const f=JSON.parse(ni(r)),p=t.meta.get(d),m=t.states.get(d),v=p===void 0?0:p.clock;(v<h||v===h&&f===null&&t.states.has(d))&&(f===null?d===t.clientID&&t.getLocalState()!=null?h++:t.states.delete(d):t.states.set(d,f),t.meta.set(d,{clock:h,lastUpdated:s}),p===void 0&&f!==null?o.push(d):p!==void 0&&f===null?c.push(d):f!==null&&(Eu(f,m)||a.push(d),i.push(d)))}(o.length>0||a.length>0||c.length>0)&&t.emit("change",[{added:o,updated:a,removed:c},n]),(o.length>0||i.length>0||c.length>0)&&t.emit("update",[{added:o,updated:i,removed:c},n])},Sle=t=>Kie(t,(e,n)=>`${encodeURIComponent(n)}=${encodeURIComponent(e)}`).join("&"),Yi=0,C6=3,Rc=1,xle=2,oh=[];oh[Yi]=(t,e,n,r,s)=>{ie(t,Yi);const o=gle(e,t,n.doc,n);r&&o===Qb&&!n.synced&&(n.synced=!0)};oh[C6]=(t,e,n,r,s)=>{ie(t,Rc),pt(t,Pu(n.awareness,Array.from(n.awareness.getStates().keys())))};oh[Rc]=(t,e,n,r,s)=>{wle(n.awareness,Gt(e),n)};oh[xle]=(t,e,n,r,s)=>{yle(e,n.doc,(o,i)=>ble(n,i))};const Rk=3e4,ble=(t,e)=>console.warn(`Permission denied to access ${t.url}.
${e}`),_6=(t,e,n)=>{const r=Pi(e),s=Xt(),o=ge(r),i=t.messageHandlers[o];return i?i(s,r,t,n,o):console.error("Unable to compute message"),s},E6=t=>{if(t.shouldConnect&&t.ws===null){const e=new t._WS(t.url);e.binaryType="arraybuffer",t.ws=e,t.wsconnecting=!0,t.wsconnected=!1,t.synced=!1,e.onmessage=n=>{t.wsLastMessageReceived=ma();const r=_6(t,new Uint8Array(n.data),!0);Lb(r)>1&&e.send(rt(r))},e.onerror=n=>{t.emit("connection-error",[n,t])},e.onclose=n=>{t.emit("connection-close",[n,t]),t.ws=null,t.wsconnecting=!1,t.wsconnected?(t.wsconnected=!1,t.synced=!1,Zb(t.awareness,Array.from(t.awareness.getStates().keys()).filter(r=>r!==t.doc.clientID),t),t.emit("status",[{status:"disconnected"}])):t.wsUnsuccessfulReconnects++,setTimeout(E6,Tb($ie(2,t.wsUnsuccessfulReconnects)*100,t.maxBackoffTime),t)},e.onopen=()=>{t.wsLastMessageReceived=ma(),t.wsconnecting=!1,t.wsconnected=!0,t.wsUnsuccessfulReconnects=0,t.emit("status",[{status:"connected"}]);const n=Xt();if(ie(n,Yi),FS(n,t.doc),e.send(rt(n)),t.awareness.getLocalState()!==null){const r=Xt();ie(r,Rc),pt(r,Pu(t.awareness,[t.doc.clientID])),e.send(rt(r))}},t.emit("status",[{status:"connecting"}])}},uv=(t,e)=>{const n=t.ws;t.wsconnected&&n&&n.readyState===n.OPEN&&n.send(e),t.bcconnected&&rc(t.bcChannel,e,t)};class Cle extends $b{constructor(e,n,r,{connect:s=!0,awareness:o=new vle(r),params:i={},WebSocketPolyfill:a=WebSocket,resyncInterval:c=-1,maxBackoffTime:l=2500,disableBc:u=!1}={}){for(super();e[e.length-1]==="/";)e=e.slice(0,e.length-1);const d=Sle(i);this.maxBackoffTime=l,this.bcChannel=e+"/"+n,this.url=e+"/"+n+(d.length===0?"":"?"+d),this.roomname=n,this.doc=r,this._WS=a,this.awareness=o,this.wsconnected=!1,this.wsconnecting=!1,this.bcconnected=!1,this.disableBc=u,this.wsUnsuccessfulReconnects=0,this.messageHandlers=oh.slice(),this._synced=!1,this.ws=null,this.wsLastMessageReceived=0,this.shouldConnect=s,this._resyncInterval=0,c>0&&(this._resyncInterval=setInterval(()=>{if(this.ws&&this.ws.readyState===WebSocket.OPEN){const h=Xt();ie(h,Yi),FS(h,r),this.ws.send(rt(h))}},c)),this._bcSubscriber=(h,f)=>{if(f!==this){const p=_6(this,new Uint8Array(h),!1);Lb(p)>1&&rc(this.bcChannel,rt(p),this)}},this._updateHandler=(h,f)=>{if(f!==this){const p=Xt();ie(p,Yi),fle(p,h),uv(this,rt(p))}},this.doc.on("update",this._updateHandler),this._awarenessUpdateHandler=({added:h,updated:f,removed:p},m)=>{const v=h.concat(f).concat(p),w=Xt();ie(w,Rc),pt(w,Pu(o,v)),uv(this,rt(w))},this._unloadHandler=()=>{Zb(this.awareness,[r.clientID],"window unload")},typeof window<"u"?window.addEventListener("unload",this._unloadHandler):typeof process<"u"&&process.on("exit",this._unloadHandler),o.on("update",this._awarenessUpdateHandler),this._checkInterval=setInterval(()=>{this.wsconnected&&Rk<ma()-this.wsLastMessageReceived&&this.ws.close()},Rk/10),s&&this.connect()}get synced(){return this._synced}set synced(e){this._synced!==e&&(this._synced=e,this.emit("synced",[e]),this.emit("sync",[e]))}destroy(){this._resyncInterval!==0&&clearInterval(this._resyncInterval),clearInterval(this._checkInterval),this.disconnect(),typeof window<"u"?window.removeEventListener("unload",this._unloadHandler):typeof process<"u"&&process.off("exit",this._unloadHandler),this.awareness.off("update",this._awarenessUpdateHandler),this.doc.off("update",this._updateHandler),super.destroy()}connectBc(){if(this.disableBc)return;this.bcconnected||(ule(this.bcChannel,this._bcSubscriber),this.bcconnected=!0);const e=Xt();ie(e,Yi),FS(e,this.doc),rc(this.bcChannel,rt(e),this);const n=Xt();ie(n,Yi),x6(n,this.doc),rc(this.bcChannel,rt(n),this);const r=Xt();ie(r,C6),rc(this.bcChannel,rt(r),this);const s=Xt();ie(s,Rc),pt(s,Pu(this.awareness,[this.doc.clientID])),rc(this.bcChannel,rt(s),this)}disconnectBc(){const e=Xt();ie(e,Rc),pt(e,Pu(this.awareness,[this.doc.clientID],new Map)),uv(this,rt(e)),this.bcconnected&&(dle(this.bcChannel,this._bcSubscriber),this.bcconnected=!1)}disconnect(){this.shouldConnect=!1,this.disconnectBc(),this.ws!==null&&this.ws.close()}connect(){this.shouldConnect=!0,!this.wsconnected&&this.ws===null&&(E6(this),this.connectBc())}}function _le({roomId:t="example",hostUrl:e="wss://tldraw.ilias8.comf:5123",shapeUtils:n=[]}){const[r]=S.useState(()=>Vw({shapeUtils:[...f5,...n]})),[s,o]=S.useState({status:"loading"}),{doc:i,room:a,yRecords:c}=S.useMemo(()=>{const l=new xl({gc:!0});return{doc:l,room:new Cle(e,t,l,{connect:!0}),yRecords:l.getMap(`tl_${t}`)}},[e,t]);return S.useEffect(()=>{const l=[];let u=!1;return a.on("status",({status:d})=>{if(d==="connecting"||d==="disconnected"){o({store:r,status:"synced-remote",connectionStatus:"offline"});return}if(d!=="connected")return;if(console.log("HOLA"),u){o({store:r,status:"synced-remote",connectionStatus:"online"});return}u=!0,c.size===0?(Ne(i,()=>{r.clear(),r.put([dm.create({id:"document:document"}),Un.create({id:"page:page",name:"Page 1",index:"a1"})])}),i.transact(()=>{for(const x of r.allRecords())c.set(x.id,x)})):Ne(i,()=>{r.clear(),r.put([...c.values()])}),l.push(r.listen(function({changes:b}){i.transact(()=>{Object.values(b.added).forEach(C=>{c.set(C.id,C)}),Object.values(b.updated).forEach(([C,E])=>{c.set(E.id,E)}),Object.values(b.removed).forEach(C=>{c.delete(C.id)})})},{source:"user",scope:"document"}));const h=(x,b)=>{if(b.local)return;const C=[],E=[];x.forEach(_=>{_.changes.keys.forEach((k,I)=>{switch(k.action){case"add":case"update":{E.push(c.get(I));break}case"delete":{C.push(I);break}}})}),r.mergeRemoteChanges(()=>{C.length&&r.remove(C),E.length&&r.put(E),console.log("hola"),fetch("/api/save-file",{method:"POST",headers:{"Content-Type":"application/json"},body:JSON.stringify(r.getSnapshot())})})};c.observeDeep(h),l.push(()=>c.unobserveDeep(h));const f=a.awareness.clientID.toString(),p=Yu.createId(f),m=X("ok",()=>x3()),v=_j(m,p)(r);a.awareness.setLocalStateField("presence",v.value),l.push(Td("when presence changes",()=>{const x=v.value;requestAnimationFrame(()=>{a.awareness.setLocalStateField("presence",x)})}));const w=x=>{const b=a.awareness.getStates(),C=[],E=[];for(const _ of x.added){const k=b.get(_);k!=null&&k.presence&&k.presence.id!==p&&E.push(k.presence)}for(const _ of x.updated){const k=b.get(_);k!=null&&k.presence&&k.presence.id!==p&&E.push(k.presence)}for(const _ of x.removed)C.push(Yu.createId(_.toString()));r.mergeRemoteChanges(()=>{C.length&&r.remove(C),E.length&&r.put(E)})};a.awareness.on("update",w),l.push(()=>a.awareness.off("update",w)),o({store:r,status:"synced-remote",connectionStatus:"online"})}),()=>{l.forEach(d=>d()),l.length=0}},[a,i,r,c]),s}const Ele="wss://tldraw.ilias8.com:5123";var jk;const Lk=((jk=document.getElementById("roomid"))==null?void 0:jk.innerText)??"";let BS=1;isNaN(parseInt(Lk))||(BS=parseInt(Lk));function Ple(){const t=_le({roomId:`y-tldraw-${BS}`,hostUrl:Ele});return console.log("RoomID->",`y-tldraw-${BS}`),g.jsx("div",{className:"tldraw__editor",children:g.jsx(Cie,{store:t,shareZone:g.jsx(kle,{})})})}const kle=Ee(()=>{const t=H(),{color:e,name:n}=t.user;return g.jsxs("div",{style:{pointerEvents:"none",display:"flex"},children:[g.jsx("input",{type:"color",value:e,onChange:r=>{}}),g.jsx("input",{value:n,onChange:r=>{}})]})});Av.createRoot(document.getElementById("root")).render(g.jsx(Z.StrictMode,{children:g.jsx(Ple,{})}));
